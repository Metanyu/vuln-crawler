{
    "CVSSv3": {
        "CVSS": "3.1",
        "attackVector": "NETWORK",
        "attackComplexity": "LOW",
        "privilegesRequired": "NONE",
        "userInteraction": "REQUIRED",
        "scope": "UNCHANGED",
        "confidentiality": "HIGH",
        "integrity": "HIGH",
        "availability": "HIGH"
    },
    "credit": [
        "Amel Bouziane-Leblond"
    ],
    "cvssDetails": [],
    "cvssScore": 8.8,
    "disclosureTime": "2023-12-29 15:45:10",
    "epssDetails": {
        "modelVersion": "v2023.03.01",
        "percentile": "0.05745",
        "probability": "0.00042"
    },
    "exploitMaturity": "Not Defined",
    "id": "SNYK-UNMANAGED-APACHEOPENOFFICE-6141111",
    "identifiers": {
        "CVE": [
            "CVE-2023-47804"
        ],
        "CWE": [
            "CWE-20"
        ]
    },
    "language": "cpp",
    "malicious": false,
    "packageManager": "unmanaged",
    "publicationTime": "2023-12-31 19:10:01",
    "remediation": "Upgrade apache/openoffice to version 4.1.15 or higher. ",
    "severity": "high",
    "socialTrendAlert": false,
    "title": "Improper Input Validation",
    "vulnDescription": {
        "Overview": "Affected versions of this package are vulnerable to Improper Input Validation in links appearing in user-supplied internal macro calls. An attacker can execute arbitrary scripts by convincing a user to activate links using certain URI schemes without needing additional approval. "
    },
    "source_code": [
        {
            "filename": "main/sd/source/core/drawdoc.cxx",
            "diff": "@@ -277,7 +277,9 @@ SdDrawDocument::SdDrawDocument(DocumentType eType, SfxObjectShell* pDrDocSh)\n \n \tif (mpDocSh)\n \t{\n-\t\tSetLinkManager( new sfx2::LinkManager(mpDocSh) );\n+        sfx2::LinkManager *linkMgr = new sfx2::LinkManager(mpDocSh);\n+        linkMgr->SetAutoAskUpdateAllLinks();\n+\t\tSetLinkManager( linkMgr );\n \t}\n \n \tsal_uLong nCntrl = rOutliner.GetControlWord();"
        },
        {
            "filename": "main/svx/source/svdraw/svdograf.cxx",
            "diff": "@@ -819,10 +819,13 @@ sal_Bool SdrGrafObj::ImpUpdateGraphicLink( sal_Bool bAsynchron ) const\n     sal_Bool bRet = sal_False;\n     if( pGraphicLink )\n \t{\n-\t\tif ( bAsynchron )\n-\t\t\tpGraphicLink->UpdateAsynchron();\n-\t\telse\n-\t\t\tpGraphicLink->DataChanged( ImpLoadLinkedGraphic( aFileName, aFilterName ) );\n+        sfx2::LinkManager *linkMgr = pGraphicLink->GetLinkManager();\n+        if ((linkMgr == NULL) || (linkMgr->GetUserAllowsLinkUpdate(NULL))) {\n+            if ( bAsynchron )\n+                pGraphicLink->UpdateAsynchron();\n+            else\n+                pGraphicLink->DataChanged( ImpLoadLinkedGraphic( aFileName, aFilterName ) );\n+        } // else links shall not be updated\n         bRet = sal_True;\n     }\n \treturn bRet;"
        },
        {
            "filename": "main/svx/source/unodraw/unoshap2.cxx",
            "diff": "@@ -1623,6 +1623,7 @@ uno::Sequence< OUString > SAL_CALL SvxShapePolyPolygonBezier::getSupportedServic\n #ifndef _SFXDOCFILE_HXX\n #include <sfx2/docfile.hxx>\n #endif\n+#include <sfx2/linkmgr.hxx>\n #include <sfx2/app.hxx>\n #include <sfx2/fcontnr.hxx>\n #endif\n@@ -1718,7 +1719,14 @@ bool SvxGraphicObject::setPropertyValueImpl( const ::rtl::OUString& rName, const\n \t\t\t\tconst SfxFilter*\tpSfxFilter = NULL;\n \t\t\t\tSfxMedium\t\t\taSfxMedium( aURL, STREAM_READ | STREAM_SHARE_DENYNONE, sal_False );\n \n-\t\t\t\tSFX_APP()->GetFilterMatcher().GuessFilter( aSfxMedium, &pSfxFilter, SFX_FILTER_IMPORT, SFX_FILTER_NOTINSTALLED | SFX_FILTER_EXECUTABLE );\n+                // SfxFilterMatcher::GuessFilter() may ``taste'' linked files, so we must be sure we are authorized to access them\n+                sfx2::LinkManager *linkManager = NULL;\n+                if (mpModel) {\n+                    linkManager = mpModel->GetLinkManager();\n+                }\n+                if ((linkManager == NULL) || (linkManager->GetUserAllowsLinkUpdate(SFX_APP()->GetTopWindow()))) {\n+                    SFX_APP()->GetFilterMatcher().GuessFilter( aSfxMedium, &pSfxFilter, SFX_FILTER_IMPORT, SFX_FILTER_NOTINSTALLED | SFX_FILTER_EXECUTABLE );\n+                }\n \n \t\t\t\tif( !pSfxFilter )\n \t\t\t\t{"
        },
        {
            "filename": "main/sw/source/core/doc/docnew.cxx",
            "diff": "@@ -341,6 +341,7 @@ SwDoc::SwDoc()\n     mbPurgeOLE =\n                             true;\n \n+    pLinkMgr->SetAutoAskUpdateAllLinks();\n     //\n     // COMPATIBILITY FLAGS START\n     //"
        },
        {
            "filename": "main/sw/source/core/doc/notxtfrm.cxx",
            "diff": "@@ -33,6 +33,7 @@\n #include <svtools/soerr.hxx>\n #include <sfx2/progress.hxx>\n #include <sfx2/docfile.hxx>\n+#include <sfx2/linkmgr.hxx>\n #include <sfx2/printer.hxx>\n #include <editeng/udlnitem.hxx>\n #include <editeng/colritem.hxx>\n@@ -937,9 +938,11 @@ void SwNoTxtFrm::PaintPicture( OutputDevice* pOut, const SwRect &rGrfArea ) cons\n \t\t\t\t\t!(aTmpSz = pGrfNd->GetTwipSize()).Width() ||\n \t\t\t\t\t!aTmpSz.Height() || !pGrfNd->GetAutoFmtLvl() )\n \t\t\t\t{\n-                    // --> OD 2006-12-22 #i73788#\n-                    pGrfNd->TriggerAsyncRetrieveInputStream();\n-                    // <--\n+                    if (pShell->GetDoc()->GetLinkManager().GetUserAllowsLinkUpdate(pShell->GetWin())) {\n+                        // --> OD 2006-12-22 #i73788#\n+                        pGrfNd->TriggerAsyncRetrieveInputStream();\n+                        // <--\n+                    }\n \t\t\t\t}\n                 String aTxt( pGrfNd->GetTitle() );\n \t\t\t\tif ( !aTxt.Len() )"
        }
    ],
    "commitTime": "2023-11-08 21:01:04"
}