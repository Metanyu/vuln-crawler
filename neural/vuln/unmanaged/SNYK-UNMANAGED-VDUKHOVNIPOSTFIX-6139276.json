{
    "CVSSv3": {
        "CVSS": "3.1",
        "attackVector": "NETWORK",
        "attackComplexity": "LOW",
        "privilegesRequired": "NONE",
        "userInteraction": "NONE",
        "scope": "UNCHANGED",
        "confidentiality": "LOW",
        "integrity": "HIGH",
        "availability": "NONE"
    },
    "credit": [
        "SEC Consult"
    ],
    "cvssDetails": [
        {
            "assigner": "SUSE",
            "cvssV3BaseScore": 5.3,
            "cvssV3Vector": {
                "CVSS": "3.1",
                "attackVector": "NETWORK",
                "attackComplexity": "LOW",
                "privilegesRequired": "NONE",
                "userInteraction": "NONE",
                "scope": "UNCHANGED",
                "confidentiality": "NONE",
                "integrity": "LOW",
                "availability": "NONE"
            },
            "severity": "medium"
        },
        {
            "assigner": "NVD",
            "cvssV3BaseScore": 5.3,
            "cvssV3Vector": {
                "CVSS": "3.1",
                "attackVector": "NETWORK",
                "attackComplexity": "LOW",
                "privilegesRequired": "NONE",
                "userInteraction": "NONE",
                "scope": "UNCHANGED",
                "confidentiality": "NONE",
                "integrity": "LOW",
                "availability": "NONE"
            },
            "severity": "medium"
        },
        {
            "assigner": "Red Hat",
            "cvssV3BaseScore": 5.3,
            "cvssV3Vector": {
                "CVSS": "3.1",
                "attackVector": "NETWORK",
                "attackComplexity": "LOW",
                "privilegesRequired": "NONE",
                "userInteraction": "NONE",
                "scope": "UNCHANGED",
                "confidentiality": "NONE",
                "integrity": "LOW",
                "availability": "NONE"
            },
            "severity": "medium"
        }
    ],
    "cvssScore": 8.2,
    "disclosureTime": "2023-12-24 06:47:57",
    "epssDetails": {
        "modelVersion": "v2023.03.01",
        "percentile": "0.16139",
        "probability": "0.00050"
    },
    "exploitMaturity": "Not Defined",
    "id": "SNYK-UNMANAGED-VDUKHOVNIPOSTFIX-6139276",
    "identifiers": {
        "CVE": [
            "CVE-2023-51764"
        ],
        "CWE": [
            "CWE-924"
        ]
    },
    "language": "cpp",
    "malicious": false,
    "packageManager": "unmanaged",
    "publicationTime": "2023-12-25 13:51:05",
    "remediation": "Upgrade vdukhovni/postfix to version 3.5.23, 3.6.13, 3.7.9, 3.8.4 or higher. ",
    "severity": "high",
    "socialTrendAlert": false,
    "title": "Improper Enforcement of Message Integrity During Transmission in a Communication Channel",
    "vulnDescription": {
        "Overview": "Affected versions of this package are vulnerable to Improper Enforcement of Message Integrity During Transmission in a Communication Channel due to improper handling of SMTP protocol sequences, which allows header smuggling. An attacker can inject e-mail messages that appear to originate from the server, thus bypassing SPF protection mechanisms by exploiting the support for <LF>.<CR><LF> sequences, which are not universally handled by other e-mail servers. This is only exploitable if smtpd_data_restrictions is not configured with reject_unauth_pipelining or other protective options available in recent versions. ",
        "Workaround": "This vulnerability can be mitigated by configuring smtpd_data_restrictions with reject_unauth_pipelining or by setting smtpd_forbid_bare_newline to yes after upgrading. "
    },
    "source_code": [
        {
            "filename": "postfix/HISTORY",
            "diff": "@@ -27212,3 +27212,17 @@ Apologies for any names omitted.\n \tdelimiter. Fixed by restoring Postfix 2.10 behavior to use\n \ta configured recipient delimiter value. Reported by Tod\n \tA. Sandman. Files: proto/postconf.proto, local/local_expand.c.\n+\n+20231221\n+\n+\tSecurity: with \"smtpd_forbid_bare_newline = yes\" (default\n+\t\"no\" for Postfix < 3.9), reply with \"Error: bare <LF>\n+\treceived\" and disconnect when an SMTP client sends a line\n+\tending in <LF>, violating the RFC 5321 requirement that\n+\tlines must end in <CR><LF>. This prevents SMTP smuggling\n+\tattacks that target a recipient at a Postfix server. For\n+\tbackwards compatibility, local clients are excluded by\n+\tdefault with \"smtpd_forbid_bare_newline_exclusions =\n+\t$mynetworks\". Files: mantools/postlink, proto/postconf.proto,\n+\tglobal/mail_params.h, global/smtp_stream.c, global/smtp_stream.h,\n+\tsmtpd/smtpd.c."
        },
        {
            "filename": "postfix/RELEASE_NOTES",
            "diff": "@@ -25,6 +25,31 @@ now also distributed with the more recent Eclipse Public License\n (EPL) 2.0. Recipients can choose to take the software under the\n license of their choice. Those who are more comfortable with the\n IPL can continue with that license.\n+  \n+Major changes with Postfix 3.8.4\n+================================\n+\n+Security: the Postfix SMTP server optionally disconnects a remote\n+SMTP client that sends a 'bare newline' line ending in SMTP. This\n+prevents an SMTP smuggling attack on recipients at a Postfix server.\n+For background, see https://www.postfix.org/smtp-smuggling.html\n+\n+Sites concerned about SMTP smuggling attacks should enable this\n+feature in Internet-facing Postfix servers. For compatibility with\n+non-standard clients, Postfix by default excludes clients in\n+mynetworks from this countermeasure.\n+\n+The default settings are:\n+\n+    # Optionally disconnect remote SMTP clients that send bare newlines,\n+    # but allow local clients with non-standard SMTP implementations\n+    # such as netcat, fax machines, or load balancer health checks.\n+    #\n+    smtpd_forbid_bare_newline = no\n+    smtpd_forbid_bare_newline_exclusions = $mynetworks\n+\n+This feature is back-ported from Postfix 3.9, with the difference\n+that \"smtpd_forbid_bare_newline = no\" by default.\n \n Major changes with Postfix 3.8.1\n ================================"
        },
        {
            "filename": "postfix/html/postconf.5.html",
            "diff": "@@ -15604,6 +15604,65 @@ <h2> Postfix main.cf file format </h2>\n </p>\n \n \n+</DD>\n+\n+<DT><b><a name=\"smtpd_forbid_bare_newline\">smtpd_forbid_bare_newline</a>\n+(default: Postfix &lt; 3.9: no)</b></DT><DD>\n+\n+<p> Reply with \"Error: bare &lt;LF&gt; received\" and disconnect\n+when a remote SMTP client sends a line ending in &lt;LF&gt;, violating\n+the <a href=\"https://tools.ietf.org/html/rfc5321\">RFC 5321</a> requirement that lines must end in &lt;CR&gt;&lt;LF&gt;.\n+This feature is disbled by default with Postfix &lt; 3.9. Use\n+<a href=\"postconf.5.html#smtpd_forbid_bare_newline_exclusions\">smtpd_forbid_bare_newline_exclusions</a> to exclude non-standard clients\n+such as netcat. Specify \"<a href=\"postconf.5.html#smtpd_forbid_bare_newline\">smtpd_forbid_bare_newline</a> = no\" to disable\n+(not recommended for an Internet-connected MTA). </p>\n+\n+<p> See <a href=\"https://www.postfix.org/smtp-smuggling.html\">\n+https://www.postfix.org/smtp-smuggling.html</a> for details.\n+\n+<p> Example: </p>\n+\n+<blockquote>\n+<pre>\n+# Disconnect remote SMTP clients that send bare newlines, but allow\n+# local clients with non-standard SMTP implementations such as netcat,\n+# fax machines, or load balancer health checks.\n+#\n+<a href=\"postconf.5.html#smtpd_forbid_bare_newline\">smtpd_forbid_bare_newline</a> = yes\n+<a href=\"postconf.5.html#smtpd_forbid_bare_newline_exclusions\">smtpd_forbid_bare_newline_exclusions</a> = $<a href=\"postconf.5.html#mynetworks\">mynetworks</a>\n+</pre>\n+</blockquote>\n+\n+<p> This feature is available in Postfix &ge; 3.9, 3.8.4, 3.7.9,\n+3.6.13, and 3.5.23. </p>\n+\n+\n+</DD>\n+\n+<DT><b><a name=\"smtpd_forbid_bare_newline_exclusions\">smtpd_forbid_bare_newline_exclusions</a>\n+(default: $<a href=\"postconf.5.html#mynetworks\">mynetworks</a>)</b></DT><DD>\n+\n+<p> Exclude the specified clients from <a href=\"postconf.5.html#smtpd_forbid_bare_newline\">smtpd_forbid_bare_newline</a>\n+enforcement. It uses the same syntax and parent-domain matching\n+behavior as <a href=\"postconf.5.html#mynetworks\">mynetworks</a>. </p>\n+\n+<p> Example: </p>\n+\n+<blockquote>\n+<pre>\n+# Disconnect remote SMTP clients that send bare newlines, but allow\n+# local clients with non-standard SMTP implementations such as netcat,\n+# fax machines, or load balancer health checks.\n+#\n+<a href=\"postconf.5.html#smtpd_forbid_bare_newline\">smtpd_forbid_bare_newline</a> = yes\n+<a href=\"postconf.5.html#smtpd_forbid_bare_newline_exclusions\">smtpd_forbid_bare_newline_exclusions</a> = $<a href=\"postconf.5.html#mynetworks\">mynetworks</a>\n+</pre>\n+</blockquote>\n+\n+<p> This feature is available in Postfix &ge; 3.9, 3.8.4, 3.7.9,\n+3.6.13, and 3.5.23. </p>\n+\n+\n </DD>\n \n <DT><b><a name=\"smtpd_forbid_unauth_pipelining\">smtpd_forbid_unauth_pipelining</a>"
        },
        {
            "filename": "postfix/html/smtpd.8.html",
            "diff": "@@ -649,107 +649,107 @@\n               tialization functions.\n \n <b>OBSOLETE STARTTLS CONTROLS</b>\n-       The following configuration parameters  exist  for  compatibility  with\n-       Postfix  versions  before  2.3.  Support for these will be removed in a\n+       The  following  configuration  parameters  exist for compatibility with\n+       Postfix versions before 2.3. Support for these will  be  removed  in  a\n        future release.\n \n        <b><a href=\"postconf.5.html#smtpd_use_tls\">smtpd_use_tls</a> (no)</b>\n-              Opportunistic TLS: announce  STARTTLS  support  to  remote  SMTP\n+              Opportunistic  TLS:  announce  STARTTLS  support  to remote SMTP\n               clients, but do not require that clients use TLS encryption.\n \n        <b><a href=\"postconf.5.html#smtpd_enforce_tls\">smtpd_enforce_tls</a> (no)</b>\n               Mandatory TLS: announce STARTTLS support to remote SMTP clients,\n               and require that clients use TLS encryption.\n \n        <b><a href=\"postconf.5.html#smtpd_tls_cipherlist\">smtpd_tls_cipherlist</a> (empty)</b>\n-              Obsolete Postfix &lt; 2.3 control for the Postfix SMTP  server  TLS\n+              Obsolete  Postfix  &lt; 2.3 control for the Postfix SMTP server TLS\n               cipher list.\n \n <b>SMTPUTF8 CONTROLS</b>\n        Preliminary SMTPUTF8 support is introduced with Postfix 3.0.\n \n        <b><a href=\"postconf.5.html#smtputf8_enable\">smtputf8_enable</a> (yes)</b>\n-              Enable  preliminary SMTPUTF8 support for the protocols described\n+              Enable preliminary SMTPUTF8 support for the protocols  described\n               in <a href=\"https://tools.ietf.org/html/rfc6531\">RFC 6531</a>, <a href=\"https://tools.ietf.org/html/rfc6532\">RFC 6532</a>, and <a href=\"https://tools.ietf.org/html/rfc6533\">RFC 6533</a>.\n \n        <b><a href=\"postconf.5.html#strict_smtputf8\">strict_smtputf8</a> (no)</b>\n               Enable stricter enforcement of the SMTPUTF8 protocol.\n \n        <b><a href=\"postconf.5.html#smtputf8_autodetect_classes\">smtputf8_autodetect_classes</a> (sendmail, verify)</b>\n-              Detect that a message requires SMTPUTF8 support for  the  speci-\n+              Detect  that  a message requires SMTPUTF8 support for the speci-\n               fied mail origin classes.\n \n        Available in Postfix version 3.2 and later:\n \n        <b><a href=\"postconf.5.html#enable_idna2003_compatibility\">enable_idna2003_compatibility</a> (no)</b>\n-              Enable   'transitional'   compatibility   between  IDNA2003  and\n-              IDNA2008, when converting UTF-8 domain names to/from  the  ASCII\n+              Enable  'transitional'  compatibility   between   IDNA2003   and\n+              IDNA2008,  when  converting UTF-8 domain names to/from the ASCII\n               form that is used for DNS lookups.\n \n <b>VERP SUPPORT CONTROLS</b>\n-       With  VERP  style delivery, each recipient of a message receives a cus-\n-       tomized copy of the message with his/her own recipient address  encoded\n+       With VERP style delivery, each recipient of a message receives  a  cus-\n+       tomized  copy of the message with his/her own recipient address encoded\n        in the envelope sender address.  The <a href=\"VERP_README.html\">VERP_README</a> file describes config-\n-       uration and operation details of Postfix support for variable  envelope\n-       return  path addresses.  VERP style delivery is requested with the SMTP\n-       XVERP command or with the \"sendmail  -V\"  command-line  option  and  is\n+       uration  and operation details of Postfix support for variable envelope\n+       return path addresses.  VERP style delivery is requested with the  SMTP\n+       XVERP  command  or  with  the  \"sendmail -V\" command-line option and is\n        available in Postfix version 1.1 and later.\n \n        <b><a href=\"postconf.5.html#default_verp_delimiters\">default_verp_delimiters</a> (+=)</b>\n               The two default VERP delimiter characters.\n \n        <b><a href=\"postconf.5.html#verp_delimiter_filter\">verp_delimiter_filter</a> (-=+)</b>\n-              The  characters  Postfix accepts as VERP delimiter characters on\n+              The characters Postfix accepts as VERP delimiter  characters  on\n               the Postfix <a href=\"sendmail.1.html\"><b>sendmail</b>(1)</a> command line and in SMTP commands.\n \n        Available in Postfix version 1.1 and 2.0:\n \n        <b><a href=\"postconf.5.html#authorized_verp_clients\">authorized_verp_clients</a> ($<a href=\"postconf.5.html#mynetworks\">mynetworks</a>)</b>\n-              What remote SMTP clients are allowed to specify the  XVERP  com-\n+              What  remote  SMTP clients are allowed to specify the XVERP com-\n               mand.\n \n        Available in Postfix version 2.1 and later:\n \n        <b><a href=\"postconf.5.html#smtpd_authorized_verp_clients\">smtpd_authorized_verp_clients</a> ($<a href=\"postconf.5.html#authorized_verp_clients\">authorized_verp_clients</a>)</b>\n-              What  remote  SMTP clients are allowed to specify the XVERP com-\n+              What remote SMTP clients are allowed to specify the  XVERP  com-\n               mand.\n \n <b>TROUBLE SHOOTING CONTROLS</b>\n-       The <a href=\"DEBUG_README.html\">DEBUG_README</a> document describes how to debug parts of  the  Postfix\n-       mail  system.  The  methods  vary from making the software log a lot of\n+       The  <a href=\"DEBUG_README.html\">DEBUG_README</a>  document describes how to debug parts of the Postfix\n+       mail system. The methods vary from making the software  log  a  lot  of\n        detail, to running some daemon processes under control of a call tracer\n        or debugger.\n \n        <b><a href=\"postconf.5.html#debug_peer_level\">debug_peer_level</a> (2)</b>\n-              The  increment  in verbose logging level when a nexthop destina-\n-              tion, remote client or server name or network address matches  a\n+              The increment in verbose logging level when a  nexthop  destina-\n+              tion,  remote client or server name or network address matches a\n               pattern given with the <a href=\"postconf.5.html#debug_peer_list\">debug_peer_list</a> parameter.\n \n        <b><a href=\"postconf.5.html#debug_peer_list\">debug_peer_list</a> (empty)</b>\n-              Optional  list  of  nexthop destination, remote client or server\n-              name or network address patterns that,  if  matched,  cause  the\n-              verbose  logging  level  to  increase by the amount specified in\n+              Optional list of nexthop destination, remote  client  or  server\n+              name  or  network  address  patterns that, if matched, cause the\n+              verbose logging level to increase by  the  amount  specified  in\n               $<a href=\"postconf.5.html#debug_peer_level\">debug_peer_level</a>.\n \n        <b><a href=\"postconf.5.html#error_notice_recipient\">error_notice_recipient</a> (postmaster)</b>\n-              The recipient of postmaster notifications  about  mail  delivery\n+              The  recipient  of  postmaster notifications about mail delivery\n               problems that are caused by policy, resource, software or proto-\n               col errors.\n \n        <b><a href=\"postconf.5.html#internal_mail_filter_classes\">internal_mail_filter_classes</a> (empty)</b>\n-              What  categories  of  Postfix-generated  mail  are  subject   to\n-              before-queue    content    inspection    by   <a href=\"postconf.5.html#non_smtpd_milters\">non_smtpd_milters</a>,\n+              What   categories  of  Postfix-generated  mail  are  subject  to\n+              before-queue   content    inspection    by    <a href=\"postconf.5.html#non_smtpd_milters\">non_smtpd_milters</a>,\n               <a href=\"postconf.5.html#header_checks\">header_checks</a> and <a href=\"postconf.5.html#body_checks\">body_checks</a>.\n \n        <b><a href=\"postconf.5.html#notify_classes\">notify_classes</a> (resource, software)</b>\n               The list of error classes that are reported to the postmaster.\n \n        <b><a href=\"postconf.5.html#smtpd_reject_footer\">smtpd_reject_footer</a> (empty)</b>\n-              Optional information that is appended after  each  Postfix  SMTP\n+              Optional  information  that  is appended after each Postfix SMTP\n               server 4XX or 5XX response.\n \n        <b><a href=\"postconf.5.html#soft_bounce\">soft_bounce</a> (no)</b>\n-              Safety  net to keep mail queued that would otherwise be returned\n+              Safety net to keep mail queued that would otherwise be  returned\n               to the sender.\n \n        Available in Postfix version 2.1 and later:\n@@ -760,110 +760,110 @@\n        Available in Postfix version 2.10 and later:\n \n        <b><a href=\"postconf.5.html#smtpd_log_access_permit_actions\">smtpd_log_access_permit_actions</a> (empty)</b>\n-              Enable  logging  of  the  named  \"permit\" actions in SMTP server\n-              access lists (by default, the SMTP server logs \"reject\"  actions\n+              Enable logging of the named  \"permit\"  actions  in  SMTP  server\n+              access  lists (by default, the SMTP server logs \"reject\" actions\n               but not \"permit\" actions).\n \n <b>KNOWN VERSUS UNKNOWN RECIPIENT CONTROLS</b>\n-       As  of  Postfix  version  2.0, the SMTP server rejects mail for unknown\n+       As of Postfix version 2.0, the SMTP server  rejects  mail  for  unknown\n        recipients. This prevents the mail queue from clogging up with undeliv-\n-       erable  MAILER-DAEMON messages. Additional information on this topic is\n+       erable MAILER-DAEMON messages. Additional information on this topic  is\n        in the <a href=\"LOCAL_RECIPIENT_README.html\">LOCAL_RECIPIENT_README</a> and <a href=\"ADDRESS_CLASS_README.html\">ADDRESS_CLASS_README</a> documents.\n \n        <b><a href=\"postconf.5.html#show_user_unknown_table_name\">show_user_unknown_table_name</a> (yes)</b>\n-              Display the name of the recipient table in  the  \"User  unknown\"\n+              Display  the  name  of the recipient table in the \"User unknown\"\n               responses.\n \n        <b><a href=\"postconf.5.html#canonical_maps\">canonical_maps</a> (empty)</b>\n-              Optional  address  mapping lookup tables for message headers and\n+              Optional address mapping lookup tables for message  headers  and\n               envelopes.\n \n        <b><a href=\"postconf.5.html#recipient_canonical_maps\">recipient_canonical_maps</a> (empty)</b>\n-              Optional address mapping lookup tables for envelope  and  header\n+              Optional  address  mapping lookup tables for envelope and header\n               recipient addresses.\n \n        <b><a href=\"postconf.5.html#sender_canonical_maps\">sender_canonical_maps</a> (empty)</b>\n-              Optional  address  mapping lookup tables for envelope and header\n+              Optional address mapping lookup tables for envelope  and  header\n               sender addresses.\n \n        Parameters concerning known/unknown local recipients:\n \n        <b><a href=\"postconf.5.html#mydestination\">mydestination</a> ($<a href=\"postconf.5.html#myhostname\">myhostname</a>, localhost.$<a href=\"postconf.5.html#mydomain\">mydomain</a>, localhost)</b>\n-              The list of domains that are delivered via the  $<a href=\"postconf.5.html#local_transport\">local_transport</a>\n+              The  list of domains that are delivered via the $<a href=\"postconf.5.html#local_transport\">local_transport</a>\n               mail delivery transport.\n \n        <b><a href=\"postconf.5.html#inet_interfaces\">inet_interfaces</a> (all)</b>\n-              The  local  network  interface  addresses  that this mail system\n+              The local network interface  addresses  that  this  mail  system\n               receives mail on.\n \n        <b><a href=\"postconf.5.html#proxy_interfaces\">proxy_interfaces</a> (empty)</b>\n-              The remote network interface addresses  that  this  mail  system\n-              receives  mail  on by way of a proxy or network address transla-\n+              The  remote  network  interface  addresses that this mail system\n+              receives mail on by way of a proxy or network  address  transla-\n               tion unit.\n \n        <b><a href=\"postconf.5.html#inet_protocols\">inet_protocols</a> (see 'postconf -d output')</b>\n-              The Internet protocols Postfix will attempt to use  when  making\n+              The  Internet  protocols Postfix will attempt to use when making\n               or accepting connections.\n \n        <b><a href=\"postconf.5.html#local_recipient_maps\">local_recipient_maps</a> (<a href=\"proxymap.8.html\">proxy</a>:unix:passwd.byname $<a href=\"postconf.5.html#alias_maps\">alias_maps</a>)</b>\n               Lookup tables with all names or addresses of local recipients: a\n-              recipient address is local when its domain  matches  $<a href=\"postconf.5.html#mydestination\">mydestina</a>-\n+              recipient  address  is local when its domain matches $<a href=\"postconf.5.html#mydestination\">mydestina</a>-\n               <a href=\"postconf.5.html#mydestination\">tion</a>, $<a href=\"postconf.5.html#inet_interfaces\">inet_interfaces</a> or $<a href=\"postconf.5.html#proxy_interfaces\">proxy_interfaces</a>.\n \n        <b><a href=\"postconf.5.html#unknown_local_recipient_reject_code\">unknown_local_recipient_reject_code</a> (550)</b>\n               The numerical Postfix SMTP server response code when a recipient\n-              address is local, and $<a href=\"postconf.5.html#local_recipient_maps\">local_recipient_maps</a> specifies a list  of\n+              address  is local, and $<a href=\"postconf.5.html#local_recipient_maps\">local_recipient_maps</a> specifies a list of\n               lookup tables that does not match the recipient.\n \n        Parameters concerning known/unknown recipients of relay destinations:\n \n        <b><a href=\"postconf.5.html#relay_domains\">relay_domains</a> (Postfix</b> &gt;<b>= 3.0: empty, Postfix</b> &lt; <b>3.0: $<a href=\"postconf.5.html#mydestination\">mydestination</a>)</b>\n-              What  destination  domains  (and subdomains thereof) this system\n+              What destination domains (and subdomains  thereof)  this  system\n               will relay mail to.\n \n        <b><a href=\"postconf.5.html#relay_recipient_maps\">relay_recipient_maps</a> (empty)</b>\n-              Optional lookup tables with all valid addresses in  the  domains\n+              Optional  lookup  tables with all valid addresses in the domains\n               that match $<a href=\"postconf.5.html#relay_domains\">relay_domains</a>.\n \n        <b><a href=\"postconf.5.html#unknown_relay_recipient_reject_code\">unknown_relay_recipient_reject_code</a> (550)</b>\n-              The  numerical  Postfix  SMTP server reply code when a recipient\n-              address matches $<a href=\"postconf.5.html#relay_domains\">relay_domains</a>, and <a href=\"postconf.5.html#relay_recipient_maps\">relay_recipient_maps</a>  speci-\n-              fies  a  list of lookup tables that does not match the recipient\n+              The numerical Postfix SMTP server reply code  when  a  recipient\n+              address  matches $<a href=\"postconf.5.html#relay_domains\">relay_domains</a>, and <a href=\"postconf.5.html#relay_recipient_maps\">relay_recipient_maps</a> speci-\n+              fies a list of lookup tables that does not match  the  recipient\n               address.\n \n-       Parameters  concerning  known/unknown  recipients  in   virtual   alias\n+       Parameters   concerning   known/unknown  recipients  in  virtual  alias\n        domains:\n \n        <b><a href=\"postconf.5.html#virtual_alias_domains\">virtual_alias_domains</a> ($<a href=\"postconf.5.html#virtual_alias_maps\">virtual_alias_maps</a>)</b>\n-              Postfix  is the final destination for the specified list of vir-\n+              Postfix is the final destination for the specified list of  vir-\n               tual alias domains, that is, domains for which all addresses are\n               aliased to addresses in other local or remote domains.\n \n        <b><a href=\"postconf.5.html#virtual_alias_maps\">virtual_alias_maps</a> ($<a href=\"postconf.5.html#virtual_maps\">virtual_maps</a>)</b>\n-              Optional  lookup  tables  that  alias specific mail addresses or\n+              Optional lookup tables that alias  specific  mail  addresses  or\n               domains to other local or remote addresses.\n \n        <b><a href=\"postconf.5.html#unknown_virtual_alias_reject_code\">unknown_virtual_alias_reject_code</a> (550)</b>\n-              The Postfix SMTP server reply  code  when  a  recipient  address\n-              matches  $<a href=\"postconf.5.html#virtual_alias_domains\">virtual_alias_domains</a>,  and $<a href=\"postconf.5.html#virtual_alias_maps\">virtual_alias_maps</a> speci-\n-              fies a list of lookup tables that does not match  the  recipient\n+              The  Postfix  SMTP  server  reply  code when a recipient address\n+              matches $<a href=\"postconf.5.html#virtual_alias_domains\">virtual_alias_domains</a>, and  $<a href=\"postconf.5.html#virtual_alias_maps\">virtual_alias_maps</a>  speci-\n+              fies  a  list of lookup tables that does not match the recipient\n               address.\n \n        Parameters  concerning  known/unknown  recipients  in  virtual  mailbox\n        domains:\n \n        <b><a href=\"postconf.5.html#virtual_mailbox_domains\">virtual_mailbox_domains</a> ($<a href=\"postconf.5.html#virtual_mailbox_maps\">virtual_mailbox_maps</a>)</b>\n-              Postfix is the final  destination  for  the  specified  list  of\n-              domains;  mail  is  delivered  via  the  $<a href=\"postconf.5.html#virtual_transport\">virtual_transport</a> mail\n+              Postfix  is  the  final  destination  for  the specified list of\n+              domains; mail  is  delivered  via  the  $<a href=\"postconf.5.html#virtual_transport\">virtual_transport</a>  mail\n               delivery transport.\n \n        <b><a href=\"postconf.5.html#virtual_mailbox_maps\">virtual_mailbox_maps</a> (empty)</b>\n-              Optional lookup tables with all valid addresses in  the  domains\n+              Optional  lookup  tables with all valid addresses in the domains\n               that match $<a href=\"postconf.5.html#virtual_mailbox_domains\">virtual_mailbox_domains</a>.\n \n        <b><a href=\"postconf.5.html#unknown_virtual_mailbox_reject_code\">unknown_virtual_mailbox_reject_code</a> (550)</b>\n-              The  Postfix  SMTP  server  reply  code when a recipient address\n-              matches  $<a href=\"postconf.5.html#virtual_mailbox_domains\">virtual_mailbox_domains</a>,   and   $<a href=\"postconf.5.html#virtual_mailbox_maps\">virtual_mailbox_maps</a>\n+              The Postfix SMTP server reply  code  when  a  recipient  address\n+              matches   $<a href=\"postconf.5.html#virtual_mailbox_domains\">virtual_mailbox_domains</a>,   and  $<a href=\"postconf.5.html#virtual_mailbox_maps\">virtual_mailbox_maps</a>\n               specifies a list of lookup tables that does not match the recip-\n               ient address.\n \n@@ -872,100 +872,100 @@\n        control client request rates.\n \n        <b><a href=\"postconf.5.html#line_length_limit\">line_length_limit</a> (2048)</b>\n-              Upon  input,  long  lines  are chopped up into pieces of at most\n+              Upon input, long lines are chopped up into  pieces  of  at  most\n               this length; upon delivery, long lines are reconstructed.\n \n        <b><a href=\"postconf.5.html#queue_minfree\">queue_minfree</a> (0)</b>\n               The minimal amount of free space in bytes in the queue file sys-\n               tem that is needed to receive mail.\n \n        <b><a href=\"postconf.5.html#message_size_limit\">message_size_limit</a> (10240000)</b>\n-              The  maximal  size  in  bytes  of  a message, including envelope\n+              The maximal size in  bytes  of  a  message,  including  envelope\n               information.\n \n        <b><a href=\"postconf.5.html#smtpd_recipient_limit\">smtpd_recipient_limit</a> (1000)</b>\n-              The maximal number of recipients that the  Postfix  SMTP  server\n+              The  maximal  number  of recipients that the Postfix SMTP server\n               accepts per message delivery request.\n \n        <b><a href=\"postconf.5.html#smtpd_timeout\">smtpd_timeout</a> (normal: 300s, overload: 10s)</b>\n-              When  the  Postfix  SMTP  server  wants  to  send an SMTP server\n-              response, how long the Postfix SMTP  server  will  wait  for  an\n-              underlying  network  write  operation  to complete; and when the\n-              Postfix SMTP server Postfix wants  to  receive  an  SMTP  client\n-              request,  how  long  the  Postfix  SMTP  server will wait for an\n+              When the Postfix SMTP  server  wants  to  send  an  SMTP  server\n+              response,  how  long  the  Postfix  SMTP server will wait for an\n+              underlying network write operation to  complete;  and  when  the\n+              Postfix  SMTP  server  Postfix  wants  to receive an SMTP client\n+              request, how long the Postfix  SMTP  server  will  wait  for  an\n               underlying network read operation to complete.\n \n        <b><a href=\"postconf.5.html#smtpd_history_flush_threshold\">smtpd_history_flush_threshold</a> (100)</b>\n-              The maximal number of lines in the Postfix SMTP  server  command\n-              history  before it is flushed upon receipt of EHLO, RSET, or end\n+              The  maximal  number of lines in the Postfix SMTP server command\n+              history before it is flushed upon receipt of EHLO, RSET, or  end\n               of DATA.\n \n        Available in Postfix version 2.3 and later:\n \n        <b><a href=\"postconf.5.html#smtpd_peername_lookup\">smtpd_peername_lookup</a> (yes)</b>\n-              Attempt to look up the remote SMTP client hostname,  and  verify\n+              Attempt  to  look up the remote SMTP client hostname, and verify\n               that the name matches the client IP address.\n \n        The per SMTP client connection count and request rate limits are imple-\n-       mented in co-operation with the <a href=\"anvil.8.html\"><b>anvil</b>(8)</a> service, and are available  in\n+       mented  in co-operation with the <a href=\"anvil.8.html\"><b>anvil</b>(8)</a> service, and are available in\n        Postfix version 2.2 and later.\n \n        <b><a href=\"postconf.5.html#smtpd_client_connection_count_limit\">smtpd_client_connection_count_limit</a> (50)</b>\n-              How  many simultaneous connections any client is allowed to make\n+              How many simultaneous connections any client is allowed to  make\n               to this service.\n \n        <b><a href=\"postconf.5.html#smtpd_client_connection_rate_limit\">smtpd_client_connection_rate_limit</a> (0)</b>\n-              The maximal number of connection attempts any client is  allowed\n+              The  maximal number of connection attempts any client is allowed\n               to make to this service per time unit.\n \n        <b><a href=\"postconf.5.html#smtpd_client_message_rate_limit\">smtpd_client_message_rate_limit</a> (0)</b>\n-              The  maximal number of message delivery requests that any client\n-              is allowed to make to this service per time unit, regardless  of\n+              The maximal number of message delivery requests that any  client\n+              is  allowed to make to this service per time unit, regardless of\n               whether or not Postfix actually accepts those messages.\n \n        <b><a href=\"postconf.5.html#smtpd_client_recipient_rate_limit\">smtpd_client_recipient_rate_limit</a> (0)</b>\n-              The  maximal  number  of  recipient addresses that any client is\n-              allowed to send to this service per  time  unit,  regardless  of\n+              The maximal number of recipient addresses  that  any  client  is\n+              allowed  to  send  to  this service per time unit, regardless of\n               whether or not Postfix actually accepts those recipients.\n \n        <b><a href=\"postconf.5.html#smtpd_client_event_limit_exceptions\">smtpd_client_event_limit_exceptions</a> ($<a href=\"postconf.5.html#mynetworks\">mynetworks</a>)</b>\n-              Clients  that  are excluded from smtpd_client_*_count/rate_limit\n+              Clients that are excluded  from  smtpd_client_*_count/rate_limit\n               restrictions.\n \n        Available in Postfix version 2.3 and later:\n \n        <b><a href=\"postconf.5.html#smtpd_client_new_tls_session_rate_limit\">smtpd_client_new_tls_session_rate_limit</a> (0)</b>\n-              The maximal number of new (i.e., uncached) TLS sessions  that  a\n+              The  maximal  number of new (i.e., uncached) TLS sessions that a\n               remote SMTP client is allowed to negotiate with this service per\n               time unit.\n \n        Available in Postfix version 2.9 - 3.6:\n \n        <b><a href=\"postconf.5.html#smtpd_per_record_deadline\">smtpd_per_record_deadline</a> (normal: no, overload: yes)</b>\n               Change  the  behavior  of  the  <a href=\"postconf.5.html#smtpd_timeout\">smtpd_timeout</a>  and  <a href=\"postconf.5.html#smtpd_starttls_timeout\">smtpd_start</a>-\n-              <a href=\"postconf.5.html#smtpd_starttls_timeout\">tls_timeout</a>  time  limits,  from  a time limit per read or write\n-              system call, to a time limit  to  send  or  receive  a  complete\n-              record  (an  SMTP command line, SMTP response line, SMTP message\n+              <a href=\"postconf.5.html#smtpd_starttls_timeout\">tls_timeout</a> time limits, from a time limit  per  read  or  write\n+              system  call,  to  a  time  limit  to send or receive a complete\n+              record (an SMTP command line, SMTP response line,  SMTP  message\n               content line, or TLS protocol message).\n \n        Available in Postfix version 3.1 and later:\n \n        <b><a href=\"postconf.5.html#smtpd_client_auth_rate_limit\">smtpd_client_auth_rate_limit</a> (0)</b>\n-              The maximal number of AUTH commands that any client  is  allowed\n-              to  send to this service per time unit, regardless of whether or\n+              The  maximal  number of AUTH commands that any client is allowed\n+              to send to this service per time unit, regardless of whether  or\n               not Postfix actually accepts those commands.\n \n        Available in Postfix version 3.7 and later:\n \n        <b><a href=\"postconf.5.html#smtpd_per_request_deadline\">smtpd_per_request_deadline</a> (normal: no, overload: yes)</b>\n               Change  the  behavior  of  the  <a href=\"postconf.5.html#smtpd_timeout\">smtpd_timeout</a>  and  <a href=\"postconf.5.html#smtpd_starttls_timeout\">smtpd_start</a>-\n-              <a href=\"postconf.5.html#smtpd_starttls_timeout\">tls_timeout</a>  time limits, from a time limit per plaintext or TLS\n-              read or write call, to a combined time  limit  for  receiving  a\n-              complete  SMTP request and for sending a complete SMTP response.\n+              <a href=\"postconf.5.html#smtpd_starttls_timeout\">tls_timeout</a> time limits, from a time limit per plaintext or  TLS\n+              read  or  write  call,  to a combined time limit for receiving a\n+              complete SMTP request and for sending a complete SMTP  response.\n \n        <b><a href=\"postconf.5.html#smtpd_min_data_rate\">smtpd_min_data_rate</a> (500)</b>\n-              The minimum plaintext data transfer  rate  in  bytes/second  for\n-              DATA   and  BDAT  requests,  when  deadlines  are  enabled  with\n+              The  minimum  plaintext  data  transfer rate in bytes/second for\n+              DATA  and  BDAT  requests,  when  deadlines  are  enabled   with\n               <a href=\"postconf.5.html#smtpd_per_request_deadline\">smtpd_per_request_deadline</a>.\n \n        <b><a href=\"postconf.5.html#header_from_format\">header_from_format</a> (standard)</b>\n@@ -974,11 +974,11 @@\n        Available in Postfix version 3.8 and later:\n \n        <b><a href=\"postconf.5.html#smtpd_client_ipv4_prefix_length\">smtpd_client_ipv4_prefix_length</a> (32)</b>\n-              Aggregate smtpd_client_*_count and  smtpd_client_*_rate  statis-\n+              Aggregate  smtpd_client_*_count  and smtpd_client_*_rate statis-\n               tics by IPv4 network blocks with the specified network prefix.\n \n        <b><a href=\"postconf.5.html#smtpd_client_ipv6_prefix_length\">smtpd_client_ipv6_prefix_length</a> (84)</b>\n-              Aggregate  smtpd_client_*_count  and smtpd_client_*_rate statis-\n+              Aggregate smtpd_client_*_count and  smtpd_client_*_rate  statis-\n               tics by IPv6 network blocks with the specified network prefix.\n \n        Available in Postfix 3.9, 3.8.1, 3.7.6, 3.6.10, 3.5.20 and later:\n@@ -987,56 +987,67 @@\n               Disconnect  remote  SMTP clients that violate <a href=\"https://tools.ietf.org/html/rfc2920\">RFC 2920</a> (or 5321)\n               command pipelining constraints.\n \n+       Available in Postfix 3.9, 3.8.4, 3.7.9, 3.6.13, 3.5.23 and later:\n+\n+       <b><a href=\"postconf.5.html#smtpd_forbid_bare_newline\">smtpd_forbid_bare_newline</a> (Postfix</b> &lt; <b>3.9: no)</b>\n+              Reply with \"Error: bare &lt;LF&gt; received\"  and  disconnect  when  a\n+              remote  SMTP  client  sends a line ending in &lt;LF&gt;, violating the\n+              <a href=\"https://tools.ietf.org/html/rfc5321\">RFC 5321</a> requirement that lines must end in &lt;CR&gt;&lt;LF&gt;.\n+\n+       <b><a href=\"postconf.5.html#smtpd_forbid_bare_newline_exclusions\">smtpd_forbid_bare_newline_exclusions</a> ($<a href=\"postconf.5.html#mynetworks\">mynetworks</a>)</b>\n+              Exclude the  specified  clients  from  <a href=\"postconf.5.html#smtpd_forbid_bare_newline\">smtpd_forbid_bare_newline</a>\n+              enforcement.\n+\n <b>TARPIT CONTROLS</b>\n-       When a remote SMTP client makes errors, the  Postfix  SMTP  server  can\n-       insert  delays  before  responding. This can help to slow down run-away\n-       software.  The behavior is controlled by an error counter  that  counts\n+       When  a  remote  SMTP  client makes errors, the Postfix SMTP server can\n+       insert delays before responding. This can help to  slow  down  run-away\n+       software.   The  behavior is controlled by an error counter that counts\n        the number of errors within an SMTP session that a client makes without\n        delivering mail.\n \n        <b><a href=\"postconf.5.html#smtpd_error_sleep_time\">smtpd_error_sleep_time</a> (1s)</b>\n-              With Postfix version 2.1 and later:  the  SMTP  server  response\n-              delay  after a client has made more than $<a href=\"postconf.5.html#smtpd_soft_error_limit\">smtpd_soft_error_limit</a>\n-              errors, and fewer than $<a href=\"postconf.5.html#smtpd_hard_error_limit\">smtpd_hard_error_limit</a>  errors,  without\n+              With  Postfix  version  2.1  and later: the SMTP server response\n+              delay after a client has made more than  $<a href=\"postconf.5.html#smtpd_soft_error_limit\">smtpd_soft_error_limit</a>\n+              errors,  and  fewer than $<a href=\"postconf.5.html#smtpd_hard_error_limit\">smtpd_hard_error_limit</a> errors, without\n               delivering mail.\n \n        <b><a href=\"postconf.5.html#smtpd_soft_error_limit\">smtpd_soft_error_limit</a> (10)</b>\n-              The  number  of  errors  a remote SMTP client is allowed to make\n-              without delivering mail before the  Postfix  SMTP  server  slows\n+              The number of errors a remote SMTP client  is  allowed  to  make\n+              without  delivering  mail  before  the Postfix SMTP server slows\n               down all its responses.\n \n        <b><a href=\"postconf.5.html#smtpd_hard_error_limit\">smtpd_hard_error_limit</a> (normal: 20, overload: 1)</b>\n-              The  maximal number of errors a remote SMTP client is allowed to\n+              The maximal number of errors a remote SMTP client is allowed  to\n               make without delivering mail.\n \n        <b><a href=\"postconf.5.html#smtpd_junk_command_limit\">smtpd_junk_command_limit</a> (normal: 100, overload: 1)</b>\n-              The number of junk commands (NOOP, VRFY, ETRN or  RSET)  that  a\n-              remote  SMTP  client  can  send  before  the Postfix SMTP server\n+              The  number  of  junk commands (NOOP, VRFY, ETRN or RSET) that a\n+              remote SMTP client can  send  before  the  Postfix  SMTP  server\n               starts to increment the error counter with each junk command.\n \n        Available in Postfix version 2.1 and later:\n \n        <b><a href=\"postconf.5.html#smtpd_recipient_overshoot_limit\">smtpd_recipient_overshoot_limit</a> (1000)</b>\n-              The number of recipients that a remote SMTP client can  send  in\n+              The  number  of recipients that a remote SMTP client can send in\n               excess  of  the  limit  specified  with  $<a href=\"postconf.5.html#smtpd_recipient_limit\">smtpd_recipient_limit</a>,\n-              before the Postfix SMTP server increments the per-session  error\n+              before  the Postfix SMTP server increments the per-session error\n               count for each excess recipient.\n \n <b>ACCESS POLICY DELEGATION CONTROLS</b>\n-       As  of version 2.1, Postfix can be configured to delegate access policy\n-       decisions to an external server that runs  outside  Postfix.   See  the\n+       As of version 2.1, Postfix can be configured to delegate access  policy\n+       decisions  to  an  external  server that runs outside Postfix.  See the\n        file <a href=\"SMTPD_POLICY_README.html\">SMTPD_POLICY_README</a> for more information.\n \n        <b><a href=\"postconf.5.html#smtpd_policy_service_max_idle\">smtpd_policy_service_max_idle</a> (300s)</b>\n-              The  time after which an idle SMTPD policy service connection is\n+              The time after which an idle SMTPD policy service connection  is\n               closed.\n \n        <b><a href=\"postconf.5.html#smtpd_policy_service_max_ttl\">smtpd_policy_service_max_ttl</a> (1000s)</b>\n-              The time after which an active SMTPD policy  service  connection\n+              The  time  after which an active SMTPD policy service connection\n               is closed.\n \n        <b><a href=\"postconf.5.html#smtpd_policy_service_timeout\">smtpd_policy_service_timeout</a> (100s)</b>\n-              The  time limit for connecting to, writing to, or receiving from\n+              The time limit for connecting to, writing to, or receiving  from\n               a delegated SMTPD policy server.\n \n        Available in Postfix version 3.0 and later:\n@@ -1046,81 +1057,81 @@\n               The default action when an SMTPD policy service request fails.\n \n        <b><a href=\"postconf.5.html#smtpd_policy_service_request_limit\">smtpd_policy_service_request_limit</a> (0)</b>\n-              The maximal number of requests per SMTPD policy service  connec-\n+              The  maximal number of requests per SMTPD policy service connec-\n               tion, or zero (no limit).\n \n        <b><a href=\"postconf.5.html#smtpd_policy_service_try_limit\">smtpd_policy_service_try_limit</a> (2)</b>\n-              The  maximal  number of attempts to send an SMTPD policy service\n+              The maximal number of attempts to send an SMTPD  policy  service\n               request before giving up.\n \n        <b><a href=\"postconf.5.html#smtpd_policy_service_retry_delay\">smtpd_policy_service_retry_delay</a> (1s)</b>\n-              The delay between attempts to resend a failed SMTPD policy  ser-\n+              The  delay between attempts to resend a failed SMTPD policy ser-\n               vice request.\n \n        Available in Postfix version 3.1 and later:\n \n        <b><a href=\"postconf.5.html#smtpd_policy_service_policy_context\">smtpd_policy_service_policy_context</a> (empty)</b>\n-              Optional  information  that the Postfix SMTP server specifies in\n-              the \"policy_context\"  attribute  of  a  policy  service  request\n-              (originally,  to  share the same service endpoint among multiple\n+              Optional information that the Postfix SMTP server  specifies  in\n+              the  \"policy_context\"  attribute  of  a  policy  service request\n+              (originally, to share the same service endpoint  among  multiple\n               <a href=\"postconf.5.html#check_policy_service\">check_policy_service</a> clients).\n \n <b>ACCESS CONTROLS</b>\n-       The <a href=\"SMTPD_ACCESS_README.html\">SMTPD_ACCESS_README</a> document gives an introduction to all the  SMTP\n+       The  <a href=\"SMTPD_ACCESS_README.html\">SMTPD_ACCESS_README</a> document gives an introduction to all the SMTP\n        server access control features.\n \n        <b><a href=\"postconf.5.html#smtpd_delay_reject\">smtpd_delay_reject</a> (yes)</b>\n-              Wait    until    the   RCPT   TO   command   before   evaluating\n+              Wait   until   the   RCPT   TO   command    before    evaluating\n               $<a href=\"postconf.5.html#smtpd_client_restrictions\">smtpd_client_restrictions</a>,     $<a href=\"postconf.5.html#smtpd_helo_restrictions\">smtpd_helo_restrictions</a>     and\n               $<a href=\"postconf.5.html#smtpd_sender_restrictions\">smtpd_sender_restrictions</a>,  or  wait  until  the  ETRN  command\n-              before      evaluating      $<a href=\"postconf.5.html#smtpd_client_restrictions\">smtpd_client_restrictions</a>       and\n+              before       evaluating      $<a href=\"postconf.5.html#smtpd_client_restrictions\">smtpd_client_restrictions</a>      and\n               $<a href=\"postconf.5.html#smtpd_helo_restrictions\">smtpd_helo_restrictions</a>.\n \n        <b><a href=\"postconf.5.html#parent_domain_matches_subdomains\">parent_domain_matches_subdomains</a> (see 'postconf -d' output)</b>\n-              A  list of Postfix features where the pattern \"example.com\" also\n-              matches subdomains  of  example.com,  instead  of  requiring  an\n+              A list of Postfix features where the pattern \"example.com\"  also\n+              matches  subdomains  of  example.com,  instead  of  requiring an\n               explicit \".example.com\" pattern.\n \n        <b><a href=\"postconf.5.html#smtpd_client_restrictions\">smtpd_client_restrictions</a> (empty)</b>\n-              Optional  restrictions  that  the Postfix SMTP server applies in\n+              Optional restrictions that the Postfix SMTP  server  applies  in\n               the context of a client connection request.\n \n        <b><a href=\"postconf.5.html#smtpd_helo_required\">smtpd_helo_required</a> (no)</b>\n-              Require that a remote SMTP client  introduces  itself  with  the\n-              HELO  or  EHLO  command before sending the MAIL command or other\n+              Require  that  a  remote  SMTP client introduces itself with the\n+              HELO or EHLO command before sending the MAIL  command  or  other\n               commands that require EHLO negotiation.\n \n        <b><a href=\"postconf.5.html#smtpd_helo_restrictions\">smtpd_helo_restrictions</a> (empty)</b>\n-              Optional restrictions that the Postfix SMTP  server  applies  in\n+              Optional  restrictions  that  the Postfix SMTP server applies in\n               the context of a client HELO command.\n \n        <b><a href=\"postconf.5.html#smtpd_sender_restrictions\">smtpd_sender_restrictions</a> (empty)</b>\n-              Optional  restrictions  that  the Postfix SMTP server applies in\n+              Optional restrictions that the Postfix SMTP  server  applies  in\n               the context of a client MAIL FROM command.\n \n        <b><a href=\"postconf.5.html#smtpd_recipient_restrictions\">smtpd_recipient_restrictions</a> (see 'postconf -d' output)</b>\n-              Optional restrictions that the Postfix SMTP  server  applies  in\n-              the    context    of   a   client   RCPT   TO   command,   after\n+              Optional  restrictions  that  the Postfix SMTP server applies in\n+              the   context   of   a   client   RCPT   TO    command,    after\n               <a href=\"postconf.5.html#smtpd_relay_restrictions\">smtpd_relay_restrictions</a>.\n \n        <b><a href=\"postconf.5.html#smtpd_etrn_restrictions\">smtpd_etrn_restrictions</a> (empty)</b>\n-              Optional restrictions that the Postfix SMTP  server  applies  in\n+              Optional  restrictions  that  the Postfix SMTP server applies in\n               the context of a client ETRN command.\n \n        <b><a href=\"postconf.5.html#allow_untrusted_routing\">allow_untrusted_routing</a> (no)</b>\n-              Forward       mail       with      sender-specified      routing\n-              (user[@%!]remote[@%!]site) from untrusted  clients  to  destina-\n+              Forward      mail      with       sender-specified       routing\n+              (user[@%!]remote[@%!]site)  from  untrusted  clients to destina-\n               tions matching $<a href=\"postconf.5.html#relay_domains\">relay_domains</a>.\n \n        <b><a href=\"postconf.5.html#smtpd_restriction_classes\">smtpd_restriction_classes</a> (empty)</b>\n               User-defined aliases for groups of access restrictions.\n \n        <b><a href=\"postconf.5.html#smtpd_null_access_lookup_key\">smtpd_null_access_lookup_key</a> (</b>&lt;&gt;<b>)</b>\n-              The  lookup  key  to be used in SMTP <a href=\"access.5.html\"><b>access</b>(5)</a> tables instead of\n+              The lookup key to be used in SMTP <a href=\"access.5.html\"><b>access</b>(5)</a>  tables  instead  of\n               the null sender address.\n \n        <b><a href=\"postconf.5.html#permit_mx_backup_networks\">permit_mx_backup_networks</a> (empty)</b>\n-              Restrict the use of the <a href=\"postconf.5.html#permit_mx_backup\">permit_mx_backup</a> SMTP access feature  to\n+              Restrict  the use of the <a href=\"postconf.5.html#permit_mx_backup\">permit_mx_backup</a> SMTP access feature to\n               only domains whose primary MX hosts match the listed networks.\n \n        Available in Postfix version 2.0 and later:\n@@ -1130,19 +1141,19 @@\n               applies in the context of the SMTP DATA command.\n \n        <b><a href=\"postconf.5.html#smtpd_expansion_filter\">smtpd_expansion_filter</a> (see 'postconf -d' output)</b>\n-              What characters are allowed in $name  expansions  of  RBL  reply\n+              What  characters  are  allowed  in $name expansions of RBL reply\n               templates.\n \n        Available in Postfix version 2.1 and later:\n \n        <b><a href=\"postconf.5.html#smtpd_reject_unlisted_sender\">smtpd_reject_unlisted_sender</a> (no)</b>\n-              Request  that  the Postfix SMTP server rejects mail from unknown\n-              sender addresses, even when no  explicit  <a href=\"postconf.5.html#reject_unlisted_sender\">reject_unlisted_sender</a>\n+              Request that the Postfix SMTP server rejects mail  from  unknown\n+              sender  addresses,  even when no explicit <a href=\"postconf.5.html#reject_unlisted_sender\">reject_unlisted_sender</a>\n               access restriction is specified.\n \n        <b><a href=\"postconf.5.html#smtpd_reject_unlisted_recipient\">smtpd_reject_unlisted_recipient</a> (yes)</b>\n-              Request  that  the  Postfix SMTP server rejects mail for unknown\n-              recipient     addresses,     even     when      no      explicit\n+              Request that the Postfix SMTP server rejects  mail  for  unknown\n+              recipient      addresses,      even     when     no     explicit\n               <a href=\"postconf.5.html#reject_unlisted_recipient\">reject_unlisted_recipient</a> access restriction is specified.\n \n        Available in Postfix version 2.2 and later:\n@@ -1156,17 +1167,17 @@\n        <b><a href=\"postconf.5.html#smtpd_relay_restrictions\">smtpd_relay_restrictions</a> (<a href=\"postconf.5.html#permit_mynetworks\">permit_mynetworks</a>, <a href=\"postconf.5.html#permit_sasl_authenticated\">permit_sasl_authenticated</a>,</b>\n        <b><a href=\"postconf.5.html#defer_unauth_destination\">defer_unauth_destination</a>)</b>\n               Access restrictions for mail relay control that the Postfix SMTP\n-              server  applies  in  the  context of the RCPT TO command, before\n+              server applies in the context of the  RCPT  TO  command,  before\n               <a href=\"postconf.5.html#smtpd_recipient_restrictions\">smtpd_recipient_restrictions</a>.\n \n <b>SENDER AND RECIPIENT ADDRESS VERIFICATION CONTROLS</b>\n-       Postfix version 2.1 introduces sender and recipient  address  verifica-\n+       Postfix  version  2.1 introduces sender and recipient address verifica-\n        tion.  This feature is implemented by sending probe email messages that\n        are  not  actually  delivered.   This  feature  is  requested  via  the\n-       <a href=\"postconf.5.html#reject_unverified_sender\">reject_unverified_sender</a>    and    <a href=\"postconf.5.html#reject_unverified_recipient\">reject_unverified_recipient</a>   access\n-       restrictions.  The status of verification probes is maintained  by  the\n-       <a href=\"verify.8.html\"><b>verify</b>(8)</a>  server.  See the file <a href=\"ADDRESS_VERIFICATION_README.html\">ADDRESS_VERIFICATION_README</a> for infor-\n-       mation about how to configure and operate the Postfix  sender/recipient\n+       <a href=\"postconf.5.html#reject_unverified_sender\">reject_unverified_sender</a>   and    <a href=\"postconf.5.html#reject_unverified_recipient\">reject_unverified_recipient</a>    access\n+       restrictions.   The  status of verification probes is maintained by the\n+       <a href=\"verify.8.html\"><b>verify</b>(8)</a> server.  See the file <a href=\"ADDRESS_VERIFICATION_README.html\">ADDRESS_VERIFICATION_README</a> for  infor-\n+       mation  about how to configure and operate the Postfix sender/recipient\n        address verification service.\n \n        <b><a href=\"postconf.5.html#address_verify_poll_count\">address_verify_poll_count</a> (normal: 3, overload: 1)</b>\n@@ -1178,26 +1189,26 @@\n               fication request in progress.\n \n        <b><a href=\"postconf.5.html#address_verify_sender\">address_verify_sender</a> ($<a href=\"postconf.5.html#double_bounce_sender\">double_bounce_sender</a>)</b>\n-              The  sender address to use in address verification probes; prior\n+              The sender address to use in address verification probes;  prior\n               to Postfix 2.5 the default was \"postmaster\".\n \n        <b><a href=\"postconf.5.html#unverified_sender_reject_code\">unverified_sender_reject_code</a> (450)</b>\n               The numerical Postfix SMTP server response code when a recipient\n               address is rejected by the <a href=\"postconf.5.html#reject_unverified_sender\">reject_unverified_sender</a> restriction.\n \n        <b><a href=\"postconf.5.html#unverified_recipient_reject_code\">unverified_recipient_reject_code</a> (450)</b>\n-              The numerical Postfix SMTP  server  response  when  a  recipient\n-              address  is rejected by the <a href=\"postconf.5.html#reject_unverified_recipient\">reject_unverified_recipient</a> restric-\n+              The  numerical  Postfix  SMTP  server  response when a recipient\n+              address is rejected by the <a href=\"postconf.5.html#reject_unverified_recipient\">reject_unverified_recipient</a>  restric-\n               tion.\n \n        Available in Postfix version 2.6 and later:\n \n        <b><a href=\"postconf.5.html#unverified_sender_defer_code\">unverified_sender_defer_code</a> (450)</b>\n-              The numerical Postfix SMTP server response code  when  a  sender\n+              The  numerical  Postfix  SMTP server response code when a sender\n               address probe fails due to a temporary error condition.\n \n        <b><a href=\"postconf.5.html#unverified_recipient_defer_code\">unverified_recipient_defer_code</a> (450)</b>\n-              The  numerical  Postfix  SMTP  server  response when a recipient\n+              The numerical Postfix SMTP  server  response  when  a  recipient\n               address probe fails due to a temporary error condition.\n \n        <b><a href=\"postconf.5.html#unverified_sender_reject_reason\">unverified_sender_reject_reason</a> (empty)</b>\n@@ -1209,17 +1220,17 @@\n               <a href=\"postconf.5.html#reject_unverified_recipient\">reject_unverified_recipient</a>.\n \n        <b><a href=\"postconf.5.html#unverified_sender_tempfail_action\">unverified_sender_tempfail_action</a> ($<a href=\"postconf.5.html#reject_tempfail_action\">reject_tempfail_action</a>)</b>\n-              The Postfix SMTP server's action  when  <a href=\"postconf.5.html#reject_unverified_sender\">reject_unverified_sender</a>\n+              The  Postfix  SMTP server's action when <a href=\"postconf.5.html#reject_unverified_sender\">reject_unverified_sender</a>\n               fails due to a temporary error condition.\n \n        <b><a href=\"postconf.5.html#unverified_recipient_tempfail_action\">unverified_recipient_tempfail_action</a> ($<a href=\"postconf.5.html#reject_tempfail_action\">reject_tempfail_action</a>)</b>\n-              The  Postfix SMTP server's action when <a href=\"postconf.5.html#reject_unverified_recipient\">reject_unverified_recipi</a>-\n+              The Postfix SMTP server's action when  <a href=\"postconf.5.html#reject_unverified_recipient\">reject_unverified_recipi</a>-\n               <a href=\"postconf.5.html#reject_unverified_recipient\">ent</a> fails due to a temporary error condition.\n \n        Available with Postfix 2.9 and later:\n \n        <b><a href=\"postconf.5.html#address_verify_sender_ttl\">address_verify_sender_ttl</a> (0s)</b>\n-              The time  between  changes  in  the  time-dependent  portion  of\n+              The  time  between  changes  in  the  time-dependent  portion of\n               address verification probe sender addresses.\n \n <b>ACCESS CONTROL RESPONSES</b>\n@@ -1231,61 +1242,61 @@\n               map \"reject\" action.\n \n        <b><a href=\"postconf.5.html#defer_code\">defer_code</a> (450)</b>\n-              The  numerical  Postfix  SMTP server response code when a remote\n+              The numerical Postfix SMTP server response code  when  a  remote\n               SMTP client request is rejected by the \"defer\" restriction.\n \n        <b><a href=\"postconf.5.html#invalid_hostname_reject_code\">invalid_hostname_reject_code</a> (501)</b>\n-              The numerical Postfix SMTP server response code when the  client\n-              HELO   or   EHLO   command   parameter   is   rejected   by  the\n+              The  numerical Postfix SMTP server response code when the client\n+              HELO  or   EHLO   command   parameter   is   rejected   by   the\n               <a href=\"postconf.5.html#reject_invalid_helo_hostname\">reject_invalid_helo_hostname</a> restriction.\n \n        <b><a href=\"postconf.5.html#maps_rbl_reject_code\">maps_rbl_reject_code</a> (554)</b>\n-              The numerical Postfix SMTP server response code  when  a  remote\n-              SMTP   client  request  is  blocked  by  the  <a href=\"postconf.5.html#reject_rbl_client\">reject_rbl_client</a>,\n+              The  numerical  Postfix  SMTP server response code when a remote\n+              SMTP  client  request  is  blocked  by  the   <a href=\"postconf.5.html#reject_rbl_client\">reject_rbl_client</a>,\n               <a href=\"postconf.5.html#reject_rhsbl_client\">reject_rhsbl_client</a>,                <a href=\"postconf.5.html#reject_rhsbl_reverse_client\">reject_rhsbl_reverse_client</a>,\n               <a href=\"postconf.5.html#reject_rhsbl_sender\">reject_rhsbl_sender</a> or <a href=\"postconf.5.html#reject_rhsbl_recipient\">reject_rhsbl_recipient</a> restriction.\n \n        <b><a href=\"postconf.5.html#non_fqdn_reject_code\">non_fqdn_reject_code</a> (504)</b>\n-              The  numerical  Postfix  SMTP  server  reply  code when a client\n-              request  is  rejected  by   the   <a href=\"postconf.5.html#reject_non_fqdn_helo_hostname\">reject_non_fqdn_helo_hostname</a>,\n+              The numerical Postfix SMTP  server  reply  code  when  a  client\n+              request   is   rejected  by  the  <a href=\"postconf.5.html#reject_non_fqdn_helo_hostname\">reject_non_fqdn_helo_hostname</a>,\n               <a href=\"postconf.5.html#reject_non_fqdn_sender\">reject_non_fqdn_sender</a> or <a href=\"postconf.5.html#reject_non_fqdn_recipient\">reject_non_fqdn_recipient</a> restriction.\n \n        <b><a href=\"postconf.5.html#plaintext_reject_code\">plaintext_reject_code</a> (450)</b>\n-              The numerical Postfix SMTP server response code when  a  request\n+              The  numerical  Postfix SMTP server response code when a request\n               is rejected by the <b><a href=\"postconf.5.html#reject_plaintext_session\">reject_plaintext_session</a></b> restriction.\n \n        <b><a href=\"postconf.5.html#reject_code\">reject_code</a> (554)</b>\n-              The  numerical  Postfix  SMTP server response code when a remote\n+              The numerical Postfix SMTP server response code  when  a  remote\n               SMTP client request is rejected by the \"reject\" restriction.\n \n        <b><a href=\"postconf.5.html#relay_domains_reject_code\">relay_domains_reject_code</a> (554)</b>\n-              The numerical Postfix SMTP server response code  when  a  client\n-              request  is  rejected by the <a href=\"postconf.5.html#reject_unauth_destination\">reject_unauth_destination</a> recipient\n+              The  numerical  Postfix  SMTP server response code when a client\n+              request is rejected by the  <a href=\"postconf.5.html#reject_unauth_destination\">reject_unauth_destination</a>  recipient\n               restriction.\n \n        <b><a href=\"postconf.5.html#unknown_address_reject_code\">unknown_address_reject_code</a> (450)</b>\n               The numerical response code when the Postfix SMTP server rejects\n               a sender or recipient address because its domain is unknown.\n \n        <b><a href=\"postconf.5.html#unknown_client_reject_code\">unknown_client_reject_code</a> (450)</b>\n-              The  numerical  Postfix  SMTP server response code when a client\n-              without valid address  &lt;=&gt;  name  mapping  is  rejected  by  the\n+              The numerical Postfix SMTP server response code  when  a  client\n+              without  valid  address  &lt;=&gt;  name  mapping  is  rejected by the\n               <a href=\"postconf.5.html#reject_unknown_client_hostname\">reject_unknown_client_hostname</a> restriction.\n \n        <b><a href=\"postconf.5.html#unknown_hostname_reject_code\">unknown_hostname_reject_code</a> (450)</b>\n-              The  numerical  Postfix SMTP server response code when the host-\n-              name specified with the HELO or EHLO command is rejected by  the\n+              The numerical Postfix SMTP server response code when  the  host-\n+              name  specified with the HELO or EHLO command is rejected by the\n               <a href=\"postconf.5.html#reject_unknown_helo_hostname\">reject_unknown_helo_hostname</a> restriction.\n \n        Available in Postfix version 2.0 and later:\n \n        <b><a href=\"postconf.5.html#default_rbl_reply\">default_rbl_reply</a> (see 'postconf -d' output)</b>\n-              The  default Postfix SMTP server response template for a request\n+              The default Postfix SMTP server response template for a  request\n               that is rejected by an RBL-based restriction.\n \n        <b><a href=\"postconf.5.html#multi_recipient_bounce_reject_code\">multi_recipient_bounce_reject_code</a> (550)</b>\n-              The numerical Postfix SMTP server response code  when  a  remote\n-              SMTP  client  request  is  blocked  by  the <a href=\"postconf.5.html#reject_multi_recipient_bounce\">reject_multi_recipi</a>-\n+              The  numerical  Postfix  SMTP server response code when a remote\n+              SMTP client  request  is  blocked  by  the  <a href=\"postconf.5.html#reject_multi_recipient_bounce\">reject_multi_recipi</a>-\n               <a href=\"postconf.5.html#reject_multi_recipient_bounce\">ent_bounce</a> restriction.\n \n        <b><a href=\"postconf.5.html#rbl_reply_maps\">rbl_reply_maps</a> (empty)</b>\n@@ -1295,52 +1306,52 @@\n \n        <b><a href=\"postconf.5.html#access_map_defer_code\">access_map_defer_code</a> (450)</b>\n               The numerical Postfix SMTP server response code for an <a href=\"access.5.html\"><b>access</b>(5)</a>\n-              map    \"defer\"    action,    including    \"<a href=\"postconf.5.html#defer_if_permit\">defer_if_permit</a>\"   or\n+              map   \"defer\"    action,    including    \"<a href=\"postconf.5.html#defer_if_permit\">defer_if_permit</a>\"    or\n               \"<a href=\"postconf.5.html#defer_if_reject\">defer_if_reject</a>\".\n \n        <b><a href=\"postconf.5.html#reject_tempfail_action\">reject_tempfail_action</a> (<a href=\"postconf.5.html#defer_if_permit\">defer_if_permit</a>)</b>\n-              The Postfix SMTP server's action when a reject-type  restriction\n+              The  Postfix SMTP server's action when a reject-type restriction\n               fails due to a temporary error condition.\n \n        <b><a href=\"postconf.5.html#unknown_helo_hostname_tempfail_action\">unknown_helo_hostname_tempfail_action</a> ($<a href=\"postconf.5.html#reject_tempfail_action\">reject_tempfail_action</a>)</b>\n-              The  Postfix SMTP server's action when <a href=\"postconf.5.html#reject_unknown_helo_hostname\">reject_unknown_helo_host</a>-\n+              The Postfix SMTP server's action when  <a href=\"postconf.5.html#reject_unknown_helo_hostname\">reject_unknown_helo_host</a>-\n               <a href=\"postconf.5.html#reject_unknown_helo_hostname\">name</a> fails due to a temporary error condition.\n \n        <b><a href=\"postconf.5.html#unknown_address_tempfail_action\">unknown_address_tempfail_action</a> ($<a href=\"postconf.5.html#reject_tempfail_action\">reject_tempfail_action</a>)</b>\n-              The      Postfix      SMTP      server's       action       when\n-              <a href=\"postconf.5.html#reject_unknown_sender_domain\">reject_unknown_sender_domain</a>  or <a href=\"postconf.5.html#reject_unknown_recipient_domain\">reject_unknown_recipient_domain</a>\n+              The       Postfix       SMTP      server's      action      when\n+              <a href=\"postconf.5.html#reject_unknown_sender_domain\">reject_unknown_sender_domain</a> or  <a href=\"postconf.5.html#reject_unknown_recipient_domain\">reject_unknown_recipient_domain</a>\n               fail due to a temporary error condition.\n \n <b>MISCELLANEOUS CONTROLS</b>\n        <b><a href=\"postconf.5.html#config_directory\">config_directory</a> (see 'postconf -d' output)</b>\n-              The default location of the Postfix <a href=\"postconf.5.html\">main.cf</a> and  <a href=\"master.5.html\">master.cf</a>  con-\n+              The  default  location of the Postfix <a href=\"postconf.5.html\">main.cf</a> and <a href=\"master.5.html\">master.cf</a> con-\n               figuration files.\n \n        <b><a href=\"postconf.5.html#daemon_timeout\">daemon_timeout</a> (18000s)</b>\n-              How  much  time  a  Postfix  daemon process may take to handle a\n+              How much time a Postfix daemon process  may  take  to  handle  a\n               request before it is terminated by a built-in watchdog timer.\n \n        <b><a href=\"postconf.5.html#command_directory\">command_directory</a> (see 'postconf -d' output)</b>\n               The location of all postfix administrative commands.\n \n        <b><a href=\"postconf.5.html#double_bounce_sender\">double_bounce_sender</a> (double-bounce)</b>\n-              The sender address of postmaster notifications that  are  gener-\n+              The  sender  address of postmaster notifications that are gener-\n               ated by the mail system.\n \n        <b><a href=\"postconf.5.html#ipc_timeout\">ipc_timeout</a> (3600s)</b>\n-              The  time  limit  for  sending  or receiving information over an\n+              The time limit for sending  or  receiving  information  over  an\n               internal communication channel.\n \n        <b><a href=\"postconf.5.html#mail_name\">mail_name</a> (Postfix)</b>\n-              The mail system name that is displayed in Received: headers,  in\n+              The  mail system name that is displayed in Received: headers, in\n               the SMTP greeting banner, and in bounced mail.\n \n        <b><a href=\"postconf.5.html#mail_owner\">mail_owner</a> (postfix)</b>\n-              The  UNIX  system  account  that owns the Postfix queue and most\n+              The UNIX system account that owns the  Postfix  queue  and  most\n               Postfix daemon processes.\n \n        <b><a href=\"postconf.5.html#max_idle\">max_idle</a> (100s)</b>\n-              The maximum amount of time that an idle Postfix  daemon  process\n+              The  maximum  amount of time that an idle Postfix daemon process\n               waits for an incoming connection before terminating voluntarily.\n \n        <b><a href=\"postconf.5.html#max_use\">max_use</a> (100)</b>\n@@ -1351,11 +1362,11 @@\n               The internet hostname of this mail system.\n \n        <b><a href=\"postconf.5.html#mynetworks\">mynetworks</a> (see 'postconf -d' output)</b>\n-              The  list of \"trusted\" remote SMTP clients that have more privi-\n+              The list of \"trusted\" remote SMTP clients that have more  privi-\n               leges than \"strangers\".\n \n        <b><a href=\"postconf.5.html#myorigin\">myorigin</a> ($<a href=\"postconf.5.html#myhostname\">myhostname</a>)</b>\n-              The domain name that locally-posted mail appears to  come  from,\n+              The  domain  name that locally-posted mail appears to come from,\n               and that locally posted mail is delivered to.\n \n        <b><a href=\"postconf.5.html#process_id\">process_id</a> (read-only)</b>\n@@ -1368,24 +1379,24 @@\n               The location of the Postfix top-level queue directory.\n \n        <b><a href=\"postconf.5.html#recipient_delimiter\">recipient_delimiter</a> (empty)</b>\n-              The  set of characters that can separate an email address local-\n+              The set of characters that can separate an email address  local-\n               part, user name, or a .forward file name from its extension.\n \n        <b><a href=\"postconf.5.html#smtpd_banner\">smtpd_banner</a> ($<a href=\"postconf.5.html#myhostname\">myhostname</a> ESMTP $<a href=\"postconf.5.html#mail_name\">mail_name</a>)</b>\n-              The text that follows the 220 status code in the  SMTP  greeting\n+              The  text  that follows the 220 status code in the SMTP greeting\n               banner.\n \n        <b><a href=\"postconf.5.html#syslog_facility\">syslog_facility</a> (mail)</b>\n               The syslog facility of Postfix logging.\n \n        <b><a href=\"postconf.5.html#syslog_name\">syslog_name</a> (see 'postconf -d' output)</b>\n-              A  prefix  that  is  prepended  to  the  process  name in syslog\n+              A prefix that  is  prepended  to  the  process  name  in  syslog\n               records, so that, for example, \"smtpd\" becomes \"prefix/smtpd\".\n \n        Available in Postfix version 2.2 and later:\n \n        <b><a href=\"postconf.5.html#smtpd_forbidden_commands\">smtpd_forbidden_commands</a> (CONNECT GET POST <a href=\"regexp_table.5.html\">regexp</a>:{{/^[^A-Z]/ Bogus}})</b>\n-              List of commands that cause the Postfix SMTP server  to  immedi-\n+              List  of  commands that cause the Postfix SMTP server to immedi-\n               ately terminate the session with a 221 code.\n \n        Available in Postfix version 2.5 and later:\n@@ -1402,7 +1413,7 @@\n        Available in Postfix 3.4 and later:\n \n        <b><a href=\"postconf.5.html#smtpd_reject_footer_maps\">smtpd_reject_footer_maps</a> (empty)</b>\n-              Lookup tables, indexed by the complete Postfix SMTP  server  4xx\n+              Lookup  tables,  indexed by the complete Postfix SMTP server 4xx\n               or 5xx response, with reject footer templates.\n \n <b>SEE ALSO</b>"
        },
        {
            "filename": "postfix/man/man5/postconf.5",
            "diff": "@@ -10726,6 +10726,61 @@ The smtpd_expansion_filter value is not subject to Postfix configuration\n parameter $name expansion.\n .PP\n This feature is available in Postfix 2.0 and later.\n+.SH smtpd_forbid_bare_newline (default: Postfix < 3.9: no)\n+Reply with \"Error: bare <LF> received\" and disconnect\n+when a remote SMTP client sends a line ending in <LF>, violating\n+the RFC 5321 requirement that lines must end in <CR><LF>.\n+This feature is disbled by default with Postfix < 3.9. Use\n+smtpd_forbid_bare_newline_exclusions to exclude non\\-standard clients\n+such as netcat. Specify \"smtpd_forbid_bare_newline = no\" to disable\n+(not recommended for an Internet\\-connected MTA).\n+.PP\n+See\n+https://www.postfix.org/smtp\\-smuggling.html for details.\n+.PP\n+Example:\n+.sp\n+.in +4\n+.nf\n+.na\n+.ft C\n+# Disconnect remote SMTP clients that send bare newlines, but allow\n+# local clients with non\\-standard SMTP implementations such as netcat,\n+# fax machines, or load balancer health checks.\n+#\n+smtpd_forbid_bare_newline = yes\n+smtpd_forbid_bare_newline_exclusions = $mynetworks\n+.fi\n+.ad\n+.ft R\n+.in -4\n+.PP\n+This feature is available in Postfix >= 3.9, 3.8.4, 3.7.9,\n+3.6.13, and 3.5.23.\n+.SH smtpd_forbid_bare_newline_exclusions (default: $mynetworks)\n+Exclude the specified clients from smtpd_forbid_bare_newline\n+enforcement. It uses the same syntax and parent\\-domain matching\n+behavior as mynetworks.\n+.PP\n+Example:\n+.sp\n+.in +4\n+.nf\n+.na\n+.ft C\n+# Disconnect remote SMTP clients that send bare newlines, but allow\n+# local clients with non\\-standard SMTP implementations such as netcat,\n+# fax machines, or load balancer health checks.\n+#\n+smtpd_forbid_bare_newline = yes\n+smtpd_forbid_bare_newline_exclusions = $mynetworks\n+.fi\n+.ad\n+.ft R\n+.in -4\n+.PP\n+This feature is available in Postfix >= 3.9, 3.8.4, 3.7.9,\n+3.6.13, and 3.5.23.\n .SH smtpd_forbid_unauth_pipelining (default: Postfix >= 3.9: yes)\n Disconnect remote SMTP clients that violate RFC 2920 (or 5321)\n command pipelining constraints. The server replies with \"554 5.5.0"
        },
        {
            "filename": "postfix/man/man8/smtpd.8",
            "diff": "@@ -861,6 +861,15 @@ Available in Postfix 3.9, 3.8.1, 3.7.6, 3.6.10, 3.5.20 and later:\n .IP \"\\fBsmtpd_forbid_unauth_pipelining (Postfix >= 3.9: yes)\\fR\"\n Disconnect remote SMTP clients that violate RFC 2920 (or 5321)\n command pipelining constraints.\n+.PP\n+Available in Postfix 3.9, 3.8.4, 3.7.9, 3.6.13, 3.5.23 and later:\n+.IP \"\\fBsmtpd_forbid_bare_newline (Postfix < 3.9: no)\\fR\"\n+Reply with \"Error: bare <LF> received\" and disconnect\n+when a remote SMTP client sends a line ending in <LF>, violating\n+the RFC 5321 requirement that lines must end in <CR><LF>.\n+.IP \"\\fBsmtpd_forbid_bare_newline_exclusions ($mynetworks)\\fR\"\n+Exclude the specified clients from smtpd_forbid_bare_newline\n+enforcement.\n .SH \"TARPIT CONTROLS\"\n .na\n .nf"
        },
        {
            "filename": "postfix/mantools/postlink",
            "diff": "@@ -557,6 +557,8 @@ while (<>) {\n     s;\\bsmtpd_etrn_restrictions\\b;<a href=\"postconf.5.html#smtpd_etrn_restrictions\">$&</a>;g;\n     s;\\bsmtpd_expansion_filter\\b;<a href=\"postconf.5.html#smtpd_expansion_filter\">$&</a>;g;\n     s;\\bsmtpd_for[-</bB>]*\\n*[ <bB>]*bidden_commands\\b;<a href=\"postconf.5.html#smtpd_forbidden_commands\">$&</a>;g;\n+    s;\\bsmtpd_for[-</bB>]*\\n*[ <bB>]*bid_bare_newline\\b;<a href=\"postconf.5.html#smtpd_forbid_bare_newline\">$&</a>;g;\n+    s;\\bsmtpd_for[-</bB>]*\\n*[ <bB>]*bid_bare_newline_exclusions\\b;<a href=\"postconf.5.html#smtpd_forbid_bare_newline_exclusions\">$&</a>;g;\n     s;\\bsmtpd_for[-</bB>]*\\n*[ <bB>]*bid_unauth_pipelining\\b;<a href=\"postconf.5.html#smtpd_forbid_unauth_pipelining\">$&</a>;g;\n     s;\\bsmtpd_hard_error_limit\\b;<a href=\"postconf.5.html#smtpd_hard_error_limit\">$&</a>;g;\n     s;\\bsmtpd_helo_required\\b;<a href=\"postconf.5.html#smtpd_helo_required\">$&</a>;g;"
        },
        {
            "filename": "postfix/proto/postconf.proto",
            "diff": "@@ -18719,6 +18719,57 @@ MinProtocol = TLSv1\n <p> This feature is available in Postfix &ge; 3.9, 3.8.1, 3.7.6,\n 3.6.10, and 3.5.20. </p>\n \n+%PARAM smtpd_forbid_bare_newline Postfix &lt; 3.9: no\n+\n+<p> Reply with \"Error: bare &lt;LF&gt; received\" and disconnect\n+when a remote SMTP client sends a line ending in &lt;LF&gt;, violating\n+the RFC 5321 requirement that lines must end in &lt;CR&gt;&lt;LF&gt;.\n+This feature is disbled by default with Postfix &lt; 3.9. Use\n+smtpd_forbid_bare_newline_exclusions to exclude non-standard clients\n+such as netcat. Specify \"smtpd_forbid_bare_newline = no\" to disable\n+(not recommended for an Internet-connected MTA). </p>\n+\n+<p> See <a href=\"https://www.postfix.org/smtp-smuggling.html\">\n+https://www.postfix.org/smtp-smuggling.html</a> for details.\n+\n+<p> Example: </p>\n+\n+<blockquote>\n+<pre>\n+# Disconnect remote SMTP clients that send bare newlines, but allow\n+# local clients with non-standard SMTP implementations such as netcat,\n+# fax machines, or load balancer health checks.\n+#\n+smtpd_forbid_bare_newline = yes\n+smtpd_forbid_bare_newline_exclusions = $mynetworks\n+</pre>\n+</blockquote>\n+\n+<p> This feature is available in Postfix &ge; 3.9, 3.8.4, 3.7.9,\n+3.6.13, and 3.5.23. </p>\n+\n+%PARAM smtpd_forbid_bare_newline_exclusions $mynetworks\n+\n+<p> Exclude the specified clients from smtpd_forbid_bare_newline\n+enforcement. It uses the same syntax and parent-domain matching \n+behavior as mynetworks. </p>\n+\n+<p> Example: </p>\n+\n+<blockquote>\n+<pre>\n+# Disconnect remote SMTP clients that send bare newlines, but allow\n+# local clients with non-standard SMTP implementations such as netcat,\n+# fax machines, or load balancer health checks.\n+#\n+smtpd_forbid_bare_newline = yes\n+smtpd_forbid_bare_newline_exclusions = $mynetworks\n+</pre>\n+</blockquote>\n+\n+<p> This feature is available in Postfix &ge; 3.9, 3.8.4, 3.7.9,\n+3.6.13, and 3.5.23. </p>\n+\n %PARAM smtpd_forbid_unauth_pipelining Postfix &ge; 3.9: yes\n \n <p> Disconnect remote SMTP clients that violate RFC 2920 (or 5321)"
        },
        {
            "filename": "postfix/src/global/mail_params.h",
            "diff": "@@ -4278,6 +4278,15 @@ extern char *var_smtp_dns_re_filter;\n #define DEF_SMTPD_DNS_RE_FILTER\t\t\"\"\n extern char *var_smtpd_dns_re_filter;\n \n+ /*\n+  * Backwards compatibility.\n+  */\n+#define VAR_SMTPD_FORBID_BARE_LF\t\"smtpd_forbid_bare_newline\"\n+#define DEF_SMTPD_FORBID_BARE_LF\t0\n+\n+#define VAR_SMTPD_FORBID_BARE_LF_EXCL\t\"smtpd_forbid_bare_newline_exclusions\"\n+#define DEF_SMTPD_FORBID_BARE_LF_EXCL\t\"$\" VAR_MYNETWORKS\n+\n  /*\n   * Share TLS sessions through tlsproxy(8).\n   */"
        },
        {
            "filename": "postfix/src/global/mail_version.h",
            "diff": "@@ -20,8 +20,8 @@\n   * Patches change both the patchlevel and the release date. Snapshots have no\n   * patchlevel; they change the release date only.\n   */\n-#define MAIL_RELEASE_DATE\t\"20231101\"\n-#define MAIL_VERSION_NUMBER\t\"3.8.3\"\n+#define MAIL_RELEASE_DATE\t\"20231222\"\n+#define MAIL_VERSION_NUMBER\t\"3.8.4\"\n \n #ifdef SNAPSHOT\n #define MAIL_VERSION_DATE\t\"-\" MAIL_RELEASE_DATE"
        },
        {
            "filename": "postfix/src/global/smtp_stream.c",
            "diff": "@@ -52,6 +52,8 @@\n /*\tVSTREAM *stream;\n /*\tchar\t*format;\n /*\tva_list\tap;\n+/*\n+/*\tint\tsmtp_forbid_bare_lf;\n /* AUXILIARY API\n /*\tint\tsmtp_get_noexcept(vp, stream, maxlen, flags)\n /*\tVSTRING\t*vp;\n@@ -131,11 +133,16 @@\n /*\tsmtp_vprintf() is the machine underneath smtp_printf().\n /*\n /*\tsmtp_get_noexcept() implements the subset of smtp_get()\n-/*\twithout timeouts and without making long jumps. Instead,\n+/*\twithout long jumps for timeout or EOF errors. Instead,\n /*\tquery the stream status with vstream_feof() etc.\n+/*\tThis function will make a VSTREAM long jump (error code\n+/*\tSMTP_ERR_LF) when rejecting input with a bare newline byte.\n /*\n /*\tsmtp_timeout_setup() is a backwards-compatibility interface\n /*\tfor programs that don't require deadline or data-rate support.\n+/*\n+/*\tsmtp_forbid_bare_lf controls whether smtp_get_noexcept()\n+/*\twill reject input with a bare newline byte.\n /* DIAGNOSTICS\n /* .fi\n /* .ad\n@@ -214,6 +221,7 @@\n   * the buffer. Such system calls would really hurt when receiving or sending\n   * body content one line at a time.\n   */\n+int     smtp_forbid_bare_lf;\n \n /* smtp_timeout_reset - reset per-stream error flags */\n \n@@ -418,6 +426,9 @@ int     smtp_get_noexcept(VSTRING *vp, VSTREAM *stream, ssize_t bound, int flags\n \t */\n     case '\\n':\n \tvstring_truncate(vp, VSTRING_LEN(vp) - 1);\n+\tif (smtp_forbid_bare_lf\n+\t    && (VSTRING_LEN(vp) == 0 || vstring_end(vp)[-1] != '\\r'))\n+\t    vstream_longjmp(stream, SMTP_ERR_LF);\n \twhile (VSTRING_LEN(vp) > 0 && vstring_end(vp)[-1] == '\\r')\n \t    vstring_truncate(vp, VSTRING_LEN(vp) - 1);\n \tVSTRING_TERMINATE(vp);"
        },
        {
            "filename": "postfix/src/global/smtp_stream.h",
            "diff": "@@ -32,6 +32,7 @@\n #define SMTP_ERR_QUIET\t3\t\t/* silent cleanup (application) */\n #define SMTP_ERR_NONE\t4\t\t/* non-error case */\n #define SMTP_ERR_DATA\t5\t\t/* application data error */\n+#define SMTP_ERR_LF\t6\t\t/* bare <LF> protocol error */\n \n extern void smtp_stream_setup(VSTREAM *, int, int, int);\n extern void PRINTFLIKE(2, 3) smtp_printf(VSTREAM *, const char *,...);\n@@ -43,6 +44,7 @@ extern void smtp_fputs(const char *, ssize_t len, VSTREAM *);\n extern void smtp_fwrite(const char *, ssize_t len, VSTREAM *);\n extern void smtp_fread_buf(VSTRING *, ssize_t len, VSTREAM *);\n extern void smtp_fputc(int, VSTREAM *);\n+extern int smtp_forbid_bare_lf;\n \n extern void smtp_vprintf(VSTREAM *, const char *, va_list);\n "
        },
        {
            "filename": "postfix/src/smtpd/smtpd.c",
            "diff": "@@ -815,6 +815,15 @@\n /* .IP \"\\fBsmtpd_forbid_unauth_pipelining (Postfix >= 3.9: yes)\\fR\"\n /*\tDisconnect remote SMTP clients that violate RFC 2920 (or 5321)\n /*\tcommand pipelining constraints.\n+/* .PP\n+/*\tAvailable in Postfix 3.9, 3.8.4, 3.7.9, 3.6.13, 3.5.23 and later:\n+/* .IP \"\\fBsmtpd_forbid_bare_newline (Postfix < 3.9: no)\\fR\"\n+/*\tReply with \"Error: bare <LF> received\" and disconnect\n+/*\twhen a remote SMTP client sends a line ending in <LF>, violating\n+/*\tthe RFC 5321 requirement that lines must end in <CR><LF>.\n+/* .IP \"\\fBsmtpd_forbid_bare_newline_exclusions ($mynetworks)\\fR\"\n+/*\tExclude the specified clients from smtpd_forbid_bare_newline\n+/*\tenforcement.\n /* TARPIT CONTROLS\n /* .ad\n /* .fi\n@@ -1525,6 +1534,9 @@ bool    var_relay_before_rcpt_checks;\n bool    var_smtpd_req_deadline;\n int     var_smtpd_min_data_rate;\n char   *var_hfrom_format;\n+bool    var_smtpd_forbid_bare_lf;\n+char   *var_smtpd_forbid_bare_lf_excl;\n+static NAMADR_LIST *bare_lf_excl;\n \n  /*\n   * Silly little macros.\n@@ -1600,6 +1612,7 @@ static void tls_reset(SMTPD_STATE *);\n #define REASON_TIMEOUT\t\t\"timeout\"\n #define REASON_LOST_CONNECTION\t\"lost connection\"\n #define REASON_ERROR_LIMIT\t\"too many errors\"\n+#define REASON_BARE_LF\t\t\"bare <LF> received\"\n \n #ifdef USE_TLS\n \n@@ -4045,6 +4058,7 @@ static int bdat_cmd(SMTPD_STATE *state, int argc, SMTPD_TOKEN *argv)\n      */\n     done = 0;\n     do {\n+\tint     payload_err;\n \n \t/*\n \t * Do not skip the smtp_fread_buf() call if read_len == 0. We still\n@@ -4058,6 +4072,10 @@ static int bdat_cmd(SMTPD_STATE *state, int argc, SMTPD_TOKEN *argv)\n \tsmtp_fread_buf(state->buffer, read_len, state->client);\n \tstate->bdat_get_stream = vstream_memreopen(\n \t\t\t   state->bdat_get_stream, state->buffer, O_RDONLY);\n+\tvstream_control(state->bdat_get_stream, CA_VSTREAM_CTL_EXCEPT,\n+\t\t\tCA_VSTREAM_CTL_END);\n+\tif ((payload_err = vstream_setjmp(state->bdat_get_stream)) != 0)\n+\t    vstream_longjmp(state->client, payload_err);\n \n \t/*\n \t * Read lines from the fragment. The last line may continue in the\n@@ -4733,6 +4751,9 @@ static int xclient_cmd(SMTPD_STATE *state, int argc, SMTPD_TOKEN *argv)\n      */\n     xclient_allowed =\n \tnamadr_list_match(xclient_hosts, state->name, state->addr);\n+    smtp_forbid_bare_lf = SMTPD_STAND_ALONE((state)) == 0\n+\t&& var_smtpd_forbid_bare_lf\n+\t&& !namadr_list_match(bare_lf_excl, state->name, state->addr);\n     /* NOT: tls_reset() */\n     if (got_helo == 0)\n \thelo_reset(state);\n@@ -5554,6 +5575,13 @@ static void smtpd_proto(SMTPD_STATE *state)\n \t\t\t     var_myhostname);\n \tbreak;\n \n+    case SMTP_ERR_LF:\n+\tstate->reason = REASON_BARE_LF;\n+\tif (vstream_setjmp(state->client) == 0)\n+\t    smtpd_chat_reply(state, \"521 5.5.2 %s Error: bare <LF> received\",\n+\t\t\t     var_myhostname);\n+\tbreak;\n+\n     case 0:\n \n \t/*\n@@ -6121,6 +6149,13 @@ static void smtpd_service(VSTREAM *stream, char *service, char **argv)\n     xforward_allowed = SMTPD_STAND_ALONE((&state)) == 0 &&\n \tnamadr_list_match(xforward_hosts, state.name, state.addr);\n \n+    /*\n+     * Enforce strict SMTP line endings, with compatibility exclusions.\n+     */\n+    smtp_forbid_bare_lf = SMTPD_STAND_ALONE((&state)) == 0\n+\t&& var_smtpd_forbid_bare_lf\n+\t&& !namadr_list_match(bare_lf_excl, state.name, state.addr);\n+\n     /*\n      * See if we need to turn on verbose logging for this client.\n      */\n@@ -6182,6 +6217,10 @@ static void pre_jail_init(char *unused_name, char **unused_argv)\n     hogger_list = namadr_list_init(VAR_SMTPD_HOGGERS, MATCH_FLAG_RETURN\n \t\t\t\t   | match_parent_style(VAR_SMTPD_HOGGERS),\n \t\t\t\t   var_smtpd_hoggers);\n+    bare_lf_excl = namadr_list_init(VAR_SMTPD_FORBID_BARE_LF_EXCL,\n+\t\t\t\t    MATCH_FLAG_RETURN\n+\t\t\t\t    | match_parent_style(VAR_MYNETWORKS),\n+\t\t\t\t    var_smtpd_forbid_bare_lf_excl);\n \n     /*\n      * Open maps before dropping privileges so we can read passwords etc.\n@@ -6548,6 +6587,7 @@ int     main(int argc, char **argv)\n \tVAR_SMTPD_DELAY_OPEN, DEF_SMTPD_DELAY_OPEN, &var_smtpd_delay_open,\n \tVAR_SMTPD_CLIENT_PORT_LOG, DEF_SMTPD_CLIENT_PORT_LOG, &var_smtpd_client_port_log,\n \tVAR_SMTPD_FORBID_UNAUTH_PIPE, DEF_SMTPD_FORBID_UNAUTH_PIPE, &var_smtpd_forbid_unauth_pipe,\n+\tVAR_SMTPD_FORBID_BARE_LF, DEF_SMTPD_FORBID_BARE_LF, &var_smtpd_forbid_bare_lf,\n \t0,\n     };\n     static const CONFIG_NBOOL_TABLE nbool_table[] = {\n@@ -6664,6 +6704,7 @@ int     main(int argc, char **argv)\n \tVAR_SMTPD_DNS_RE_FILTER, DEF_SMTPD_DNS_RE_FILTER, &var_smtpd_dns_re_filter, 0, 0,\n \tVAR_SMTPD_REJ_FTR_MAPS, DEF_SMTPD_REJ_FTR_MAPS, &var_smtpd_rej_ftr_maps, 0, 0,\n \tVAR_HFROM_FORMAT, DEF_HFROM_FORMAT, &var_hfrom_format, 1, 0,\n+\tVAR_SMTPD_FORBID_BARE_LF_EXCL, DEF_SMTPD_FORBID_BARE_LF_EXCL, &var_smtpd_forbid_bare_lf_excl, 0, 0,\n \t0,\n     };\n     static const CONFIG_RAW_TABLE raw_table[] = {"
        }
    ],
    "commitTime": "2023-12-22 20:35:00"
}