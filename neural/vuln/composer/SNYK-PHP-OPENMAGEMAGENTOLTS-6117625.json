{
    "CVSSv3": {
        "CVSS": "3.1",
        "attackVector": "NETWORK",
        "attackComplexity": "LOW",
        "privilegesRequired": "HIGH",
        "userInteraction": "REQUIRED",
        "scope": "CHANGED",
        "confidentiality": "HIGH",
        "integrity": "LOW",
        "availability": "LOW"
    },
    "credit": [
        "hltakydn"
    ],
    "cvssDetails": [],
    "cvssScore": 7.5,
    "disclosureTime": "2023-12-08 15:15:14",
    "epssDetails": null,
    "exploitMaturity": "Not Defined",
    "id": "SNYK-PHP-OPENMAGEMAGENTOLTS-6117625",
    "identifiers": {
        "CVE": [],
        "CWE": [
            "CWE-79"
        ]
    },
    "language": "php",
    "malicious": false,
    "packageManager": "composer",
    "publicationTime": "2023-12-14 08:47:23",
    "remediation": "Upgrade openmage/magento-lts to version 20.2.0 or higher. ",
    "severity": "high",
    "socialTrendAlert": false,
    "title": "Cross-site Scripting (XSS)",
    "vulnDescription": {
        "Details": "A cross-site scripting attack occurs when the attacker tricks a legitimate web-based application or site to accept a request as originating from a trusted source. This is done by escaping the context of the web application; the web application then delivers that data to its users along with other trusted dynamic content, without validating it. The browser unknowingly executes malicious script on the client side (through client-side languages; usually JavaScript or HTML) in order to perform actions that are otherwise typically blocked by the browser\u2019s Same Origin Policy. Injecting malicious code is the most prevalent manner by which XSS is exploited; for this reason, escaping characters in order to prevent this manipulation is the top method for securing code against this vulnerability. Escaping means that the application is coded to mark key characters, and particularly key characters included in user input, to prevent those characters from being interpreted in a dangerous context. For example, in HTML, < can be coded as &lt ; and > can be coded as &gt ; in order to be interpreted and displayed as themselves in text, while within the code itself, they are used for HTML tags. If malicious content is injected into an application that escapes special characters and that malicious content uses < and > as HTML tags, those characters are nonetheless not interpreted as HTML tags by the browser if they\u2019ve been correctly escaped in the application code and in this way the attempted attack is diverted. The most prominent use of XSS is to steal cookies (source: OWASP HttpOnly) and hijack user sessions, but XSS exploits have been used to expose sensitive information, enable access to privileged services and functionality and deliver malware. Types of attacks There are a few methods by which XSS can be manipulated: Type Origin Description Stored Server The malicious code is inserted in the application (usually as a link) by the attacker. The code is activated every time a user clicks the link. Reflected Server The attacker delivers a malicious link externally from the vulnerable web site application to a user. When clicked, malicious code is sent to the vulnerable web site, which reflects the attack back to the user\u2019s browser. DOM-based Client The attacker forces the user\u2019s browser to render a malicious page. The data in the page itself delivers the cross-site scripting data. Mutated The attacker injects code that appears safe, but is then rewritten and modified by the browser, while parsing the markup. An example is rebalancing unclosed quotation marks or even adding quotation marks to unquoted parameters. Affected environments The following environments are susceptible to an XSS attack: Web servers Application servers Web application environments How to prevent This section describes the top best practices designed to specifically protect your code: Sanitize data input in an HTTP request before reflecting it back, ensuring all data is validated, filtered or escaped before echoing anything back to the user, such as the values of query parameters during searches. Convert special characters such as ? , & , / , < , > and spaces to their respective HTML or URL encoded equivalents. Give users the option to disable client-side scripts. Redirect invalid requests. Detect simultaneous logins, including those from two separate IP addresses, and invalidate those sessions. Use and enforce a Content Security Policy (source: Wikipedia) to disable any features that might be manipulated for an XSS attack. Read the documentation for any of the libraries referenced in your code to understand which elements allow for embedded HTML. ",
        "Overview": "openmage/magento-lts is a This repository is the home of an unofficial community-driven project. Affected versions of this package are vulnerable to Cross-site Scripting (XSS) due to failed scripts filtering in TinyMCE WYSIWYG editor when rendering the HTML in specially crafted HTML tags. Note: The attack is simply an exploit of the onmouseover attribute of an img element, as described on: OWASP XSS Filter Evasion ",
        "Workaround": "This vulnerability can be mitigated by disabling the WYSIWYG editor features in the configuration or employing WAF appliances that filter such attacks. "
    },
    "source_code": [
        {
            "filename": "app/code/core/Mage/Adminhtml/Block/Catalog/Helper/Form/Wysiwyg/Content.php",
            "diff": "@@ -41,7 +41,7 @@ protected function _prepareForm()\n \n         $form->addField($this->getData('editor_element_id'), 'editor', [\n             'name'      => 'content',\n-            'style'     => 'width:725px;height:460px',\n+            'style'     => 'height:460px',\n             'required'  => true,\n             'force_load' => true,\n             'config'    => Mage::getSingleton('cms/wysiwyg_config')->getConfig($config)"
        },
        {
            "filename": "app/code/core/Mage/Adminhtml/Block/Cms/Block/Edit.php",
            "diff": "@@ -39,11 +39,7 @@ public function __construct()\n \n         $this->_formScripts[] = \"\n             function toggleEditor() {\n-                if (tinyMCE.getInstanceById('block_content') == null) {\n-                    tinyMCE.execCommand('mceAddControl', false, 'block_content');\n-                } else {\n-                    tinyMCE.execCommand('mceRemoveControl', false, 'block_content');\n-                }\n+                tinymce.execCommand('mceToggleEditor', false, wysiwygblock_content);\n             }\n \n             function saveAndContinueEdit(){"
        },
        {
            "filename": "app/code/core/Mage/Adminhtml/Block/Cms/Page/Edit.php",
            "diff": "@@ -105,11 +105,7 @@ protected function _prepareLayout()\n \n         $this->_formScripts[] = \"\n             function toggleEditor() {\n-                if (tinyMCE.getInstanceById('page_content') == null) {\n-                    tinyMCE.execCommand('mceAddControl', false, 'page_content');\n-                } else {\n-                    tinyMCE.execCommand('mceRemoveControl', false, 'page_content');\n-                }\n+                tinymce.execCommand('mceToggleEditor', false, wysiwygpage_content);\n             }\n \n             function saveAndContinueEdit(urlTemplate) {"
        },
        {
            "filename": "app/code/core/Mage/Adminhtml/Model/System/Config/Source/Cms/Wysiwyg/Skin.php",
            "diff": "@@ -0,0 +1,44 @@\n+<?php\n+/**\n+ * OpenMage\n+ *\n+ * This source file is subject to the Open Software License (OSL 3.0)\n+ * that is bundled with this package in the file LICENSE.txt.\n+ * It is also available at https://opensource.org/license/osl-3-0-php\n+ *\n+ * @category   Mage\n+ * @package    Mage_Adminhtml\n+ * @copyright  Copyright (c) 2023 The OpenMage Contributors (https://www.openmage.org)\n+ * @license    https://opensource.org/licenses/osl-3.0.php  Open Software License (OSL 3.0)\n+ */\n+\n+/**\n+ * Configuration source model for Wysiwyg skin\n+ *\n+ * @category   Mage\n+ * @package    Mage_Adminhtml\n+ */\n+class Mage_Adminhtml_Model_System_Config_Source_Cms_Wysiwyg_Skin\n+{\n+    public function toOptionArray()\n+    {\n+        return [\n+            [\n+                'value' => 'oxide',\n+                'label' => 'Oxide'\n+            ],\n+            [\n+                'value' => 'oxide-dark',\n+                'label' => 'Oxide Dark'\n+            ],\n+            [\n+                'value' => 'tinymce-5',\n+                'label' => 'Tinymce 5'\n+            ],\n+            [\n+                'value' => 'tinymce-5-dark',\n+                'label' => 'Tinymce 5 Dark'\n+            ]\n+        ];\n+    }\n+}"
        },
        {
            "filename": "app/code/core/Mage/Cms/Model/Wysiwyg/Config.php",
            "diff": "@@ -49,6 +49,8 @@ class Mage_Cms_Model_Wysiwyg_Config extends Varien_Object\n      */\n     public const WYSIWYG_SKIN_IMAGE_PLACEHOLDER_FILE = 'images/wysiwyg/skin_image.png';\n \n+    public const WYSIWYG_LOCALES = ['ar','az','be','bg_BG','bn_BD','ca','cs','cy','da','de','dv','el','eo','es','es_MX','et','eu','fa','fi','fr_FR','ga','gl','he_IL','hi','hr','hu_HU','hy','id','is_IS','it','ja','ka_GE','kab','kk','ko_KR','ku','lt','lv','nb_NO','ne','nl','nl_BE','oc','pl','pt_BR','ro','ru','sk','sl_SI','sq','sr','sv_SE','ta','tg','th_TH','tr','ug','uk','uz','vi','zh-Hans','zh-Hant','zh_HK','zh_MO','zh_SG'];\n+\n     /**\n      * Return Wysiwyg config as Varien_Object\n      *\n@@ -69,25 +71,23 @@ public function getConfig($data = [])\n     {\n         $config = new Varien_Object();\n \n+        $locale = Mage::app()->getLocale()->getLocaleCode();\n+        $lang = in_array($locale, self::WYSIWYG_LOCALES) ? $locale : substr($locale, 0, 2);\n         $config->setData([\n             'enabled'                       => $this->isEnabled(),\n             'hidden'                        => $this->isHidden(),\n+            'skin'                          => Mage::getStoreConfig('cms/wysiwyg/skin'),\n             'use_container'                 => false,\n             'add_variables'                 => Mage::getSingleton('admin/session')->isAllowed('system/variable'),\n             'add_widgets'                   => Mage::getSingleton('admin/session')->isAllowed('cms/widget_instance'),\n             'no_display'                    => false,\n             'translator'                    => Mage::helper('cms'),\n             'encode_directives'             => true,\n             'directives_url'                => Mage::getSingleton('adminhtml/url')->getUrl('*/cms_wysiwyg/directive'),\n-            'popup_css'                     =>\n-                Mage::getBaseUrl('js') . 'mage/adminhtml/wysiwyg/tiny_mce/themes/advanced/skins/default/dialog.css',\n-            'content_css'                   =>\n-                Mage::getBaseUrl('js') . 'mage/adminhtml/wysiwyg/tiny_mce/themes/advanced/skins/default/content.css',\n             'width'                         => '100%',\n             'plugins'                       => [],\n-            'media_disable_flash'           => true\n+            'lang'                          => $lang\n         ]);\n-\n         $config->setData('directives_url_quoted', preg_quote($config->getData('directives_url')));\n \n         if (Mage::getSingleton('admin/session')->isAllowed('cms/media_gallery')) {"
        },
        {
            "filename": "app/code/core/Mage/Cms/etc/config.xml",
            "diff": "@@ -201,6 +201,7 @@\n         <cms>\n             <wysiwyg>\n                 <enabled>enabled</enabled>\n+                <skin>oxide</skin>\n             </wysiwyg>\n         </cms>\n         <system>"
        },
        {
            "filename": "app/code/core/Mage/Cms/etc/system.xml",
            "diff": "@@ -84,6 +84,20 @@\n                             <show_in_website>1</show_in_website>\n                             <show_in_store>1</show_in_store>\n                         </enabled>\n+                        <skin translate=\"label\">\n+                            <label>Skin WYSIWYG Editor</label>\n+                            <frontend_type>select</frontend_type>\n+                            <source_model>adminhtml/system_config_source_cms_wysiwyg_skin</source_model>\n+                            <sort_order>1</sort_order>\n+                            <show_in_default>1</show_in_default>\n+                            <show_in_website>1</show_in_website>\n+                            <show_in_store>1</show_in_store>\n+                            <depends>\n+                                <enabled separator=\"|\">\n+                                    <value>enabled|hidden</value>\n+                                </enabled>\n+                            </depends>\n+                        </skin>\n                     </fields>\n                 </wysiwyg>\n             </groups>"
        },
        {
            "filename": "app/code/core/Mage/Core/Model/Variable/Config.php",
            "diff": "@@ -32,9 +32,9 @@ public function getWysiwygPluginSettings($config)\n         $variableConfig = [];\n         $onclickParts = [\n             'search' => ['html_id'],\n-            'subject' => 'MagentovariablePlugin.loadChooser(\\'' . $this->getVariablesWysiwygActionUrl() . '\\', \\'{{html_id}}\\');'\n+            'subject' => 'OpenmagevariablePlugin.loadChooser(\\'' . $this->getVariablesWysiwygActionUrl() . '\\', \\'{{html_id}}\\');'\n         ];\n-        $variableWysiwygPlugin = [['name' => 'magentovariable',\n+        $variableWysiwygPlugin = [['name' => 'openmagevariable',\n             'src' => $this->getWysiwygJsPluginSrc(),\n             'options' => [\n                 'title' => Mage::helper('adminhtml')->__('Insert Variable...'),\n@@ -54,7 +54,7 @@ public function getWysiwygPluginSettings($config)\n      */\n     public function getWysiwygJsPluginSrc()\n     {\n-        return Mage::getBaseUrl('js') . 'mage/adminhtml/wysiwyg/tiny_mce/plugins/magentovariable/editor_plugin.js';\n+        return Mage::getBaseUrl('js') . 'mage/adminhtml/wysiwyg/tinymce/plugins/openmagevariable.js';\n     }\n \n     /**"
        },
        {
            "filename": "app/code/core/Mage/Widget/Model/Widget/Config.php",
            "diff": "@@ -30,7 +30,7 @@ class Mage_Widget_Model_Widget_Config extends Varien_Object\n     public function getPluginSettings($config)\n     {\n         return [\n-            'widget_plugin_src'   => Mage::getBaseUrl('js') . 'mage/adminhtml/wysiwyg/tiny_mce/plugins/magentowidget/editor_plugin.js',\n+            'widget_plugin_src'   => Mage::getBaseUrl('js') . 'mage/adminhtml/wysiwyg/tinymce/plugins/openmagewidget.js',\n             'widget_images_url'   => $this->getPlaceholderImagesBaseUrl(),\n             'widget_placeholders' => $this->getAvailablePlaceholderFilenames(),\n             'widget_window_url'   => $this->getWidgetWindowUrl($config)"
        },
        {
            "filename": "app/code/core/Mage/Widget/controllers/Adminhtml/WidgetController.php",
            "diff": "@@ -34,10 +34,11 @@ public function indexAction()\n     {\n         // save extra params for widgets insertion form\n         $skipped = $this->getRequest()->getParam('skip_widgets');\n-        $skipped = Mage::getSingleton('widget/widget_config')->decodeWidgetsFromQuery($skipped);\n+        if (is_string($skipped)) {\n+            $skipped = Mage::getSingleton('widget/widget_config')->decodeWidgetsFromQuery($skipped);\n+        }\n \n         Mage::register('skip_widgets', $skipped);\n-\n         $this->loadLayout('empty')->renderLayout();\n     }\n "
        },
        {
            "filename": "app/design/adminhtml/default/default/layout/main.xml",
            "diff": "@@ -86,7 +86,7 @@ Default layout, loads most of the pages\n \n                 <action method=\"addItem\"><type>js</type><name>mage/adminhtml/rules.js</name><params/><if/><condition>can_load_rules_js</condition></action>\n \n-                <action method=\"addItem\"><type>js</type><name>mage/adminhtml/wysiwyg/tiny_mce/setup.js</name><params/><if/><condition>can_load_tiny_mce</condition></action>\n+                <action method=\"addItem\"><type>js</type><name>mage/adminhtml/wysiwyg/tinymce/setup.js</name><params/><if/><condition>can_load_tiny_mce</condition></action>\n \n                 <block type=\"core/html_calendar\" name=\"head.calendar\" as=\"calendar\" template=\"page/js/calendar.phtml\"/>\n             </block>"
        },
        {
            "filename": "app/design/adminhtml/default/default/layout/oauth.xml",
            "diff": "@@ -84,7 +84,7 @@\n             <action method=\"removeItem\"><type>js</type><name>mage/adminhtml/uploader.js</name></action>\n             <action method=\"removeItem\"><type>js</type><name>mage/adminhtml/product.js</name></action>\n             <action method=\"removeItem\"><type>js</type><name>mage/adminhtml/rules.js</name></action>\n-            <action method=\"removeItem\"><type>js</type><name>mage/adminhtml/wysiwyg/tiny_mce/setup.js</name></action>\n+            <action method=\"removeItem\"><type>js</type><name>mage/adminhtml/wysiwyg/tinymce/setup.js</name></action>\n \n             <action method=\"removeItem\"><type>css</type><name>print.css</name></action>\n             <action method=\"removeItem\"><type>js_css</type><name>calendar/calendar-win2k-1.css</name></action>"
        },
        {
            "filename": "app/design/adminhtml/default/default/template/catalog/wysiwyg/js.phtml",
            "diff": "@@ -73,8 +73,8 @@ var catalogWysiwygEditor = {\n         if (dialogWindow.options.firedElementId) {\n             wysiwygObj = eval('wysiwyg'+dialogWindow.options.firedElementId+'_editor');\n             wysiwygObj.turnOff();\n-            if (tinyMCE.get(wysiwygObj.id)) {\n-                $(dialogWindow.options.firedElementId).value = tinyMCE.get(wysiwygObj.id).getContent();\n+            if (tinymce.get(wysiwygObj.id)) {\n+                $(dialogWindow.options.firedElementId).value = tinymce.get(wysiwygObj.id).getContent();\n             } else {\n                 if ($(dialogWindow.options.firedElementId+'_editor')) {\n                     $(dialogWindow.options.firedElementId).value = $(dialogWindow.options.firedElementId+'_editor').value;\n@@ -94,8 +94,8 @@ var catalogWysiwygEditor = {\n \n         //destroy the instance of editor\n         wysiwygObj = eval('wysiwyg'+dialogWindow.options.firedElementId+'_editor');\n-        if (tinyMCE.get(wysiwygObj.id)) {\n-           tinyMCE.execCommand('mceRemoveControl', true, wysiwygObj.id);\n+        if (tinymce.get(wysiwygObj.id)) {\n+            tinymce.get(wysiwygObj.id).remove();\n         }\n \n         dialogWindow.close();"
        },
        {
            "filename": "app/design/adminhtml/default/default/template/newsletter/queue/edit.phtml",
            "diff": "@@ -60,10 +60,10 @@ var queueControl = {\n         queueForm.submit();\n     },\n     preview: function() {\n-        if (this.isEditor() && tinyMCE.get(this.id)) {\n-            tinyMCE.triggerSave();\n+        if (this.isEditor() && tinymce.get(this.id)) {\n+            tinymce.triggerSave();\n             $('preview_text').value = $(this.id).value;\n-            tinyMCE.triggerSave();\n+            tinymce.triggerSave();\n         } else {\n             $('preview_text').value = $(this.id).value;\n         }\n@@ -77,7 +77,7 @@ var queueControl = {\n         return false;\n     },\n     isEditor: function() {\n-        return (typeof tinyMceEditors != 'undefined' && tinyMceEditors.get(this.id) != undefined)\n+        return (typeof tinyMceEditors != 'undefined' && tinyMceEditors[this.id] != undefined)\n     },\n     resume: function() {\n         $('_resume_flag').value = '1';"
        },
        {
            "filename": "app/design/adminhtml/default/default/template/newsletter/template/edit.phtml",
            "diff": "@@ -102,7 +102,7 @@\n                 $('change_flag_element').value = '1';\n             }\n             if(this.isEditor()) {\n-                tinyMCE.triggerSave();\n+                tinymce.triggerSave();\n             }\n             templateForm.submit();\n             return false;\n@@ -129,7 +129,7 @@\n             $('save_as_flag').value = '1';\n \n             if(this.isEditor()) {\n-                tinyMCE.triggerSave();\n+                tinymce.triggerSave();\n             }\n             templateForm.submit();\n             return false;\n@@ -141,10 +141,10 @@\n             } else {\n                 $('preview_type').value = 2;\n             }\n-            if (this.isEditor() && tinyMCE.get(this.id)) {\n-                tinyMCE.triggerSave();\n+            if (this.isEditor() && tinymce.get(this.id)) {\n+                tinymce.triggerSave();\n                 $('preview_text').value = $(this.id).value;\n-                tinyMCE.triggerSave();\n+                tinymce.triggerSave();\n             } else {\n                 $('preview_text').value = $(this.id).value;\n             }\n@@ -165,11 +165,11 @@\n         },\n \n         isEditor: function() {\n-            return (typeof tinyMceEditors != 'undefined' && tinyMceEditors.get(this.id) != undefined)\n+            return (typeof tinyMceEditors != 'undefined' && tinyMceEditors[this.id] != undefined)\n         },\n \n         getEditor: function() {\n-            return tinyMceEditors.get(this.id);\n+            return tinyMceEditors[this.id];\n         }\n     };\n "
        },
        {
            "filename": "app/design/adminhtml/default/default/template/page/head.phtml",
            "diff": "@@ -42,7 +42,7 @@\n <?php endif ?>\n \n <?php if ($this->getCanLoadTinyMce()): // TinyMCE is broken when loaded through index.php?>\n-<script type=\"text/javascript\" src=\"<?php echo $this->getJsUrl() ?>tiny_mce/tiny_mce.js\"></script>\n+<script type=\"text/javascript\" src=\"<?php echo $this->getJsUrl() ?>tinymce/tinymce.min.js\"></script>\n <?php endif ?>\n \n <script type=\"text/javascript\">"
        },
        {
            "filename": "app/design/adminhtml/default/default/template/system/email/template/edit.phtml",
            "diff": "@@ -155,10 +155,10 @@\n             } else {\n                 $('preview_type').value = 2;\n             }\n-            if (typeof tinyMCE == 'undefined' || !tinyMCE.getInstanceById('template_text')) {\n+            if (typeof tinymce == 'undefined' || !tinymce.get('template_text')) {\n                 $('preview_text').value = $('template_text').value;\n             } else {\n-                $('preview_text').value = tinyMCE.getInstanceById('template_text').getHTML();\n+                $('preview_text').value = tinymce.get('template_text').getContent();\n             }\n \n             if ($('template_styles') != undefined) {"
        },
        {
            "filename": "app/design/adminhtml/default/default/template/widget/form/element.phtml",
            "diff": "@@ -67,7 +67,7 @@\n     case 'wysiwyg': ?>\n     <span class=\"form_row\">\n       <label for=\"<?php echo $element->getHtmlId() ?>\"><?php echo $element->getLabel() ?>:</label>\n-        <script type=\"text/javascript\" src=\"<?php echo Mage::getBaseUrl('js') ?>tiny_mce/tiny_mce.js\"></script>\n+        <script type=\"text/javascript\" src=\"<?php echo Mage::getBaseUrl('js') ?>tinymce/tinymce.min.js\"></script>\n         <script type=\"text/javascript\">\n         //<![CDATA[\n         tinyMCE.init({"
        },
        {
            "filename": "js/mage/adminhtml/browser.js",
            "diff": "@@ -166,15 +166,14 @@ Mediabrowser.prototype = {\n             return false;\n         }\n         var targetEl = this.getTargetElement();\n-        if (! targetEl) {\n+        if (!targetEl) {\n             alert(\"Target element not found for content update\");\n             Windows.close('browser_window');\n             return;\n         }\n \n         var params = {filename:div.id, node:this.currentNode.id, store:this.storeId};\n-\n-        if (targetEl.tagName.toLowerCase() == 'textarea') {\n+        if (targetEl.tagName && targetEl.tagName.toLowerCase() == 'textarea') {\n             params.as_is = 1;\n         }\n \n@@ -183,17 +182,16 @@ Mediabrowser.prototype = {\n             onSuccess: function(transport) {\n                 try {\n                     this.onAjaxSuccess(transport);\n-                    if (this.getMediaBrowserOpener()) {\n+                    if (this.getMediaBrowserCallback()) {\n                         self.blur();\n                     }\n                     Windows.close('browser_window');\n-                    if (targetEl.tagName.toLowerCase() == 'input') {\n+                    if (targetEl.tagName && targetEl.tagName.toLowerCase() == 'input') {\n                         targetEl.value = transport.responseText;\n-                    } else {\n+                    } else if (targetEl.tagName && targetEl.tagName.toLowerCase() == 'textarea') {\n                         updateElementAtCursor(targetEl, transport.responseText);\n-                        if (varienGlobalEvents) {\n-                            varienGlobalEvents.fireEvent('tinymceChange');\n-                        }\n+                    } else {\n+                        targetEl(transport.responseText);\n                     }\n                 } catch (e) {\n                     alert(e.message);\n@@ -214,9 +212,8 @@ Mediabrowser.prototype = {\n      */\n     getTargetElement: function() {\n         if (typeof(tinyMCE) != 'undefined' && tinyMCE.get(this.targetElementId)) {\n-            if ((opener = this.getMediaBrowserOpener())) {\n-                var targetElementId = tinyMceEditors.get(this.targetElementId).getMediaBrowserTargetElementId();\n-                return opener.document.getElementById(targetElementId);\n+            if ((callbak = this.getMediaBrowserCallback())) {\n+                return callbak;\n             } else {\n                 return null;\n             }\n@@ -226,19 +223,13 @@ Mediabrowser.prototype = {\n     },\n \n     /**\n-     * Return opener Window object if it exists, not closed and editor is active\n-     *\n-     * return object | null\n+     * return object|null\n      */\n-    getMediaBrowserOpener: function() {\n-         if (typeof(tinyMCE) != 'undefined'\n-             && tinyMCE.get(this.targetElementId)\n-             && typeof(tinyMceEditors) != 'undefined'\n-             && ! tinyMceEditors.get(this.targetElementId).getMediaBrowserOpener().closed) {\n-             return tinyMceEditors.get(this.targetElementId).getMediaBrowserOpener();\n-         } else {\n-             return null;\n-         }\n+    getMediaBrowserCallback: function() {\n+        if (typeof(tinyMCE) != 'undefined' && tinyMCE.get(this.targetElementId) && typeof(tinyMceEditors) != 'undefined') {\n+            return tinyMceEditors.get(this.targetElementId).getMediaBrowserCallback();\n+        }\n+        return null;\n     },\n \n     newFolder: function() {"
        },
        {
            "filename": "js/mage/adminhtml/events.js",
            "diff": "@@ -11,7 +11,6 @@\n  * @copyright   Copyright (c) 2022 The OpenMage Contributors (https://www.openmage.org)\n  * @license     https://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)\n  */\n-// from http://www.someelement.com/2007/03/eventpublisher-custom-events-la-pubsub.html\n varienEvents = Class.create();\n \n varienEvents.prototype = {"
        },
        {
            "filename": "js/mage/adminhtml/variables.js",
            "diff": "@@ -112,7 +112,7 @@ var Variables = {\n     }\n };\n \n-MagentovariablePlugin = {\n+OpenmagevariablePlugin = {\n     editor: null,\n     variables: null,\n     textareaId: null,\n@@ -126,7 +126,7 @@ MagentovariablePlugin = {\n                 parameters: {},\n                 onComplete: function (transport) {\n                     if (transport.responseText.isJSON()) {\n-                        Variables.init(null, 'MagentovariablePlugin.insertVariable');\n+                        Variables.init(null, 'OpenmagevariablePlugin.insertVariable');\n                         this.variables = transport.responseText.evalJSON();\n                         this.openChooser(this.variables);\n                     }"
        },
        {
            "filename": "js/mage/adminhtml/wysiwyg/tiny_mce/plugins/magentovariable/editor_plugin.js",
            "diff": "@@ -1,56 +0,0 @@\n-/**\n- * OpenMage\n- *\n- * This source file is subject to the Academic Free License (AFL 3.0)\n- * that is bundled with this package in the file LICENSE_AFL.txt.\n- * It is also available at https://opensource.org/license/afl-3-0-php\n- *\n- * @category    Mage\n- * @package     Mage_Adminhtml\n- * @copyright   Copyright (c) 2006-2020 Magento, Inc. (https://www.magento.com)\n- * @copyright   Copyright (c) 2022 The OpenMage Contributors (https://www.openmage.org)\n- * @license     https://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)\n- */\n-\n-tinyMCE.addI18n({en:{\n-    magentovariable:\n-    {\n-        insert_variable : \"Insert Variable\"\n-    }\n-}});\n-\n-(function() {\n-    tinymce.create('tinymce.plugins.MagentovariablePlugin', {\n-        /**\n-         * @param {tinymce.Editor} ed Editor instance that the plugin is initialized in.\n-         * @param {string} url Absolute URL to where the plugin is located.\n-         */\n-        init : function(ed, url) {\n-            ed.addCommand('mceMagentovariable', function() {\n-                var pluginSettings = ed.settings.magentoPluginsOptions.get('magentovariable');\n-                MagentovariablePlugin.setEditor(ed);\n-                MagentovariablePlugin.loadChooser(pluginSettings.url, null);\n-            });\n-\n-            // Register Widget plugin button\n-            ed.addButton('magentovariable', {\n-                title : 'magentovariable.insert_variable',\n-                cmd : 'mceMagentovariable',\n-                image : url + '/img/icon.gif'\n-            });\n-        },\n-\n-        getInfo : function() {\n-            return {\n-                longname : 'Magento Variable Manager Plugin for TinyMCE 3.x',\n-                author : 'Magento Core Team',\n-                authorurl : 'http://magentocommerce.com',\n-                infourl : 'https://www.openmage.org',\n-                version : \"1.0\"\n-            };\n-        }\n-    });\n-\n-    // Register plugin\n-    tinymce.PluginManager.add('magentovariable', tinymce.plugins.MagentovariablePlugin);\n-})();"
        },
        {
            "filename": "js/mage/adminhtml/wysiwyg/tiny_mce/plugins/magentowidget/editor_plugin.js",
            "diff": "@@ -1,79 +0,0 @@\n-/**\n- * OpenMage\n- *\n- * This source file is subject to the Academic Free License (AFL 3.0)\n- * that is bundled with this package in the file LICENSE_AFL.txt.\n- * It is also available at https://opensource.org/license/afl-3-0-php\n- *\n- * @category    Mage\n- * @package     Mage_Adminhtml\n- * @copyright   Copyright (c) 2006-2020 Magento, Inc. (https://www.magento.com)\n- * @copyright   Copyright (c) 2022 The OpenMage Contributors (https://www.openmage.org)\n- * @license     https://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)\n- */\n-tinyMCE.addI18n({en:{\n-    magentowidget:\n-    {\n-        insert_widget : \"Insert Widget\"\n-    }\n-}});\n-\n-/*\n-    TODO: Apply JStrim to reduce file size\n-*/\n-\n-(function() {\n-    tinymce.create('tinymce.plugins.MagentowidgetPlugin', {\n-        /**\n-         * @param {tinymce.Editor} ed Editor instance that the plugin is initialized in.\n-         * @param {string} url Absolute URL to where the plugin is located.\n-         */\n-        init : function(ed, url) {\n-            ed.addCommand('mceMagentowidget', function() {\n-                widgetTools.openDialog(ed.settings.magentowidget_url + 'widget_target_id/' + ed.getElement().id + '/');\n-            });\n-\n-            // Register Widget plugin button\n-            ed.addButton('magentowidget', {\n-                title : 'magentowidget.insert_widget',\n-                cmd : 'mceMagentowidget',\n-                image : url + '/img/icon.gif'\n-            });\n-\n-            // Add a node change handler, selects the button in the UI when a image is selected\n-            ed.onNodeChange.add(function(ed, cm, n) {\n-                cm.setActive('magentowidget', false);\n-                if (n.id && n.nodeName == 'IMG') {\n-                    var widgetCode = Base64.idDecode(n.id);\n-                    if (widgetCode.indexOf('{{widget') != -1) {\n-                        cm.setActive('magentowidget', true);\n-                    }\n-                }\n-            });\n-\n-            // Add a widget placeholder image double click callback\n-            ed.onDblClick.add(function(ed, e) {\n-                var n = e.target;\n-                if (n.id && n.nodeName == 'IMG') {\n-                    var widgetCode = Base64.idDecode(n.id);\n-                    if (widgetCode.indexOf('{{widget') != -1) {\n-                        ed.execCommand('mceMagentowidget');\n-                    }\n-                }\n-            });\n-        },\n-\n-        getInfo : function() {\n-            return {\n-                longname : 'Magento Widget Manager Plugin for TinyMCE 3.x',\n-                author : 'Magento Core Team',\n-                authorurl : 'http://magentocommerce.com',\n-                infourl : 'https://www.openmage.org',\n-                version : \"1.0\"\n-            };\n-        }\n-    });\n-\n-    // Register plugin\n-    tinymce.PluginManager.add('magentowidget', tinymce.plugins.MagentowidgetPlugin);\n-})();"
        },
        {
            "filename": "js/mage/adminhtml/wysiwyg/tiny_mce/setup.js",
            "diff": "@@ -1,601 +0,0 @@\n-/**\n- * OpenMage\n- *\n- * This source file is subject to the Academic Free License (AFL 3.0)\n- * that is bundled with this package in the file LICENSE_AFL.txt.\n- * It is also available at https://opensource.org/license/afl-3-0-php\n- *\n- * @category    Mage\n- * @package     Mage_Adminhtml\n- * @copyright   Copyright (c) 2006-2020 Magento, Inc. (https://www.magento.com)\n- * @copyright   Copyright (c) 2018-2023 The OpenMage Contributors (https://www.openmage.org)\n- * @license     https://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)\n- */\n-\n-var tinyMceWysiwygSetup = Class.create();\n-tinyMceWysiwygSetup.prototype =\n-{\n-    mediaBrowserOpener: null,\n-    mediaBrowserTargetElementId: null,\n-\n-    initialize: function(htmlId, config)\n-    {\n-        this.id = htmlId;\n-        this.config = config;\n-        varienGlobalEvents.attachEventHandler('tinymceChange', this.onChangeContent.bind(this));\n-        this.notifyFirebug();\n-        if(typeof tinyMceEditors == 'undefined') {\n-            tinyMceEditors = $H({});\n-        }\n-        tinyMceEditors.set(this.id, this);\n-    },\n-\n-    notifyFirebug: function() {\n-        if (firebugEnabled() && $('fb' + this.id) == undefined) {\n-            var noticeHtml = '<ul class=\"messages message-firebug\" id=\"fb' + this.id + '\"><li class=\"notice-msg\">';\n-                noticeHtml+= '<ul><li>';\n-                noticeHtml+= '<b>' + this.config.firebug_warning_title + ':</b> ';\n-                noticeHtml+= this.config.firebug_warning_text;\n-                noticeHtml+= ' <a id=\"hidefb' + this.id + '\" href=\"\">' + this.config.firebug_warning_anchor + '</a>';\n-                noticeHtml+= '</li></ul>';\n-                noticeHtml+= '</li></ul>';\n-            $('buttons' + this.id).insert({before: noticeHtml});\n-            Event.observe($('hidefb' + this.id), \"click\", function(e) {\n-                $('fb' + this.id).remove();\n-                Event.stop(e);\n-            }.bind(this));\n-        }\n-    },\n-\n-    setup: function(mode)\n-    {\n-        if (this.config.widget_plugin_src) {\n-            tinymce.PluginManager.load('magentowidget', this.config.widget_plugin_src);\n-        }\n-\n-        if (this.config.plugins) {\n-            (this.config.plugins).each(function(plugin){\n-                tinymce.PluginManager.load(plugin.name, plugin.src);\n-            });\n-        }\n-\n-        tinyMCE.init(this.getSettings(mode));\n-    },\n-\n-    getSettings: function(mode)\n-    {\n-        var plugins = 'inlinepopups,safari,pagebreak,style,layer,table,advhr,advimage,emotions,iespell,media,searchreplace,contextmenu,paste,directionality,fullscreen,noneditable,visualchars,nonbreaking,xhtmlxtras';\n-\n-        if (this.config.widget_plugin_src) {\n-            plugins = 'magentowidget,' + plugins;\n-        }\n-\n-        var magentoPluginsOptions = $H({});\n-        var magentoPlugins = '';\n-\n-        if (this.config.plugins) {\n-            (this.config.plugins).each(function(plugin){\n-                magentoPlugins = plugin.name + ',' + magentoPlugins;\n-                magentoPluginsOptions.set(plugin.name, plugin.options);\n-            });\n-            if (magentoPlugins) {\n-                plugins = '-' + magentoPlugins + plugins;\n-            }\n-        }\n-\n-        var settings = {\n-            schema : 'html5',\n-            valid_elements : \"\"\n-                +\"a[accesskey|charset|class|coords|dir<ltr?rtl|href|hreflang|id|lang|name\"\n-                +\"|onblur|onclick|ondblclick|onfocus|onkeydown|onkeypress|onkeyup\"\n-                +\"|onmousedown|onmousemove|onmouseout|onmouseover|onmouseup|rel|rev\"\n-                +\"|shape<circle?default?poly?rect|style|tabindex|title|target|type],\"\n-                +\"abbr[class|dir<ltr?rtl|id|lang|onclick|ondblclick|onkeydown|onkeypress\"\n-                +\"|onkeyup|onmousedown|onmousemove|onmouseout|onmouseover|onmouseup|style\"\n-                +\"|title],\"\n-                +\"acronym[class|dir<ltr?rtl|id|id|lang|onclick|ondblclick|onkeydown|onkeypress\"\n-                +\"|onkeyup|onmousedown|onmousemove|onmouseout|onmouseover|onmouseup|style\"\n-                +\"|title],\"\n-                +\"address[class|align|dir<ltr?rtl|id|lang|onclick|ondblclick|onkeydown\"\n-                +\"|onkeypress|onkeyup|onmousedown|onmousemove|onmouseout|onmouseover\"\n-                +\"|onmouseup|style|title],\"\n-                +\"applet[align<bottom?left?middle?right?top|alt|archive|class|code|codebase\"\n-                +\"|height|hspace|id|name|object|style|title|vspace|width],\"\n-                +\"area[accesskey|alt|class|coords|dir<ltr?rtl|href|id|lang|nohref<nohref\"\n-                +\"|onblur|onclick|ondblclick|onfocus|onkeydown|onkeypress|onkeyup\"\n-                +\"|onmousedown|onmousemove|onmouseout|onmouseover|onmouseup\"\n-                +\"|shape<circle?default?poly?rect|style|tabindex|title|target],\"\n-                +\"base[href|target],\"\n-                +\"basefont[color|face|id|size],\"\n-                +\"bdo[class|dir<ltr?rtl|id|lang|style|title],\"\n-                +\"big[class|dir<ltr?rtl|id|lang|onclick|ondblclick|onkeydown|onkeypress\"\n-                +\"|onkeyup|onmousedown|onmousemove|onmouseout|onmouseover|onmouseup|style\"\n-                +\"|title],\"\n-                +\"blockquote[cite|class|dir<ltr?rtl|id|lang|onclick|ondblclick\"\n-                +\"|onkeydown|onkeypress|onkeyup|onmousedown|onmousemove|onmouseout\"\n-                +\"|onmouseover|onmouseup|style|title],\"\n-                +\"body[alink|background|bgcolor|class|dir<ltr?rtl|id|lang|link|onclick\"\n-                +\"|ondblclick|onkeydown|onkeypress|onkeyup|onload|onmousedown|onmousemove\"\n-                +\"|onmouseout|onmouseover|onmouseup|onunload|style|title|text|vlink],\"\n-                +\"br[class|clear<all?left?none?right|id|style|title],\"\n-                +\"button[accesskey|class|dir<ltr?rtl|disabled<disabled|id|lang|name|onblur\"\n-                +\"|onclick|ondblclick|onfocus|onkeydown|onkeypress|onkeyup|onmousedown\"\n-                +\"|onmousemove|onmouseout|onmouseover|onmouseup|style|tabindex|title|type\"\n-                +\"|value],\"\n-                +\"caption[align<bottom?left?right?top|class|dir<ltr?rtl|id|lang|onclick\"\n-                +\"|ondblclick|onkeydown|onkeypress|onkeyup|onmousedown|onmousemove\"\n-                +\"|onmouseout|onmouseover|onmouseup|style|title],\"\n-                +\"center[class|dir<ltr?rtl|id|lang|onclick|ondblclick|onkeydown|onkeypress\"\n-                +\"|onkeyup|onmousedown|onmousemove|onmouseout|onmouseover|onmouseup|style\"\n-                +\"|title],\"\n-                +\"cite[class|dir<ltr?rtl|id|lang|onclick|ondblclick|onkeydown|onkeypress\"\n-                +\"|onkeyup|onmousedown|onmousemove|onmouseout|onmouseover|onmouseup|style\"\n-                +\"|title],\"\n-                +\"code[class|dir<ltr?rtl|id|lang|onclick|ondblclick|onkeydown|onkeypress\"\n-                +\"|onkeyup|onmousedown|onmousemove|onmouseout|onmouseover|onmouseup|style\"\n-                +\"|title],\"\n-                +\"col[align<center?char?justify?left?right|char|charoff|class|dir<ltr?rtl|id\"\n-                +\"|lang|onclick|ondblclick|onkeydown|onkeypress|onkeyup|onmousedown\"\n-                +\"|onmousemove|onmouseout|onmouseover|onmouseup|span|style|title\"\n-                +\"|valign<baseline?bottom?middle?top|width],\"\n-                +\"colgroup[align<center?char?justify?left?right|char|charoff|class|dir<ltr?rtl\"\n-                +\"|id|lang|onclick|ondblclick|onkeydown|onkeypress|onkeyup|onmousedown\"\n-                +\"|onmousemove|onmouseout|onmouseover|onmouseup|span|style|title\"\n-                +\"|valign<baseline?bottom?middle?top|width],\"\n-                +\"dd[class|dir<ltr?rtl|id|lang|onclick|ondblclick|onkeydown|onkeypress|onkeyup\"\n-                +\"|onmousedown|onmousemove|onmouseout|onmouseover|onmouseup|style|title],\"\n-                +\"del[cite|class|datetime|dir<ltr?rtl|id|lang|onclick|ondblclick|onkeydown\"\n-                +\"|onkeypress|onkeyup|onmousedown|onmousemove|onmouseout|onmouseover\"\n-                +\"|onmouseup|style|title],\"\n-                +\"dfn[class|dir<ltr?rtl|id|lang|onclick|ondblclick|onkeydown|onkeypress\"\n-                +\"|onkeyup|onmousedown|onmousemove|onmouseout|onmouseover|onmouseup|style\"\n-                +\"|title],\"\n-                +\"dir[class|compact<compact|dir<ltr?rtl|id|lang|onclick|ondblclick|onkeydown\"\n-                +\"|onkeypress|onkeyup|onmousedown|onmousemove|onmouseout|onmouseover\"\n-                +\"|onmouseup|style|title],\"\n-                +\"div[align<center?justify?left?right|class|dir<ltr?rtl|id|lang|onclick\"\n-                +\"|ondblclick|onkeydown|onkeypress|onkeyup|onmousedown|onmousemove\"\n-                +\"|onmouseout|onmouseover|onmouseup|style|title],\"\n-                +\"dl[class|compact<compact|dir<ltr?rtl|id|lang|onclick|ondblclick|onkeydown\"\n-                +\"|onkeypress|onkeyup|onmousedown|onmousemove|onmouseout|onmouseover\"\n-                +\"|onmouseup|style|title],\"\n-                +\"dt[class|dir<ltr?rtl|id|lang|onclick|ondblclick|onkeydown|onkeypress|onkeyup\"\n-                +\"|onmousedown|onmousemove|onmouseout|onmouseover|onmouseup|style|title],\"\n-                +\"em/i[class|dir<ltr?rtl|id|lang|onclick|ondblclick|onkeydown|onkeypress\"\n-                +\"|onkeyup|onmousedown|onmousemove|onmouseout|onmouseover|onmouseup|style\"\n-                +\"|title],\"\n-                +\"fieldset[class|dir<ltr?rtl|id|lang|onclick|ondblclick|onkeydown|onkeypress\"\n-                +\"|onkeyup|onmousedown|onmousemove|onmouseout|onmouseover|onmouseup|style\"\n-                +\"|title],\"\n-                +\"font[class|color|dir<ltr?rtl|face|id|lang|size|style|title],\"\n-                +\"form[accept|accept-charset|action|class|dir<ltr?rtl|enctype|id|lang\"\n-                +\"|method<get?post|name|onclick|ondblclick|onkeydown|onkeypress|onkeyup\"\n-                +\"|onmousedown|onmousemove|onmouseout|onmouseover|onmouseup|onreset|onsubmit\"\n-                +\"|style|title|target],\"\n-                +\"frame[class|frameborder|id|longdesc|marginheight|marginwidth|name\"\n-                +\"|noresize<noresize|scrolling<auto?no?yes|src|style|title],\"\n-                +\"frameset[class|cols|id|onload|onunload|rows|style|title],\"\n-                +\"h1[align<center?justify?left?right|class|dir<ltr?rtl|id|lang|onclick\"\n-                +\"|ondblclick|onkeydown|onkeypress|onkeyup|onmousedown|onmousemove\"\n-                +\"|onmouseout|onmouseover|onmouseup|style|title],\"\n-                +\"h2[align<center?justify?left?right|class|dir<ltr?rtl|id|lang|onclick\"\n-                +\"|ondblclick|onkeydown|onkeypress|onkeyup|onmousedown|onmousemove\"\n-                +\"|onmouseout|onmouseover|onmouseup|style|title],\"\n-                +\"h3[align<center?justify?left?right|class|dir<ltr?rtl|id|lang|onclick\"\n-                +\"|ondblclick|onkeydown|onkeypress|onkeyup|onmousedown|onmousemove\"\n-                +\"|onmouseout|onmouseover|onmouseup|style|title],\"\n-                +\"h4[align<center?justify?left?right|class|dir<ltr?rtl|id|lang|onclick\"\n-                +\"|ondblclick|onkeydown|onkeypress|onkeyup|onmousedown|onmousemove\"\n-                +\"|onmouseout|onmouseover|onmouseup|style|title],\"\n-                +\"h5[align<center?justify?left?right|class|dir<ltr?rtl|id|lang|onclick\"\n-                +\"|ondblclick|onkeydown|onkeypress|onkeyup|onmousedown|onmousemove\"\n-                +\"|onmouseout|onmouseover|onmouseup|style|title],\"\n-                +\"h6[align<center?justify?left?right|class|dir<ltr?rtl|id|lang|onclick\"\n-                +\"|ondblclick|onkeydown|onkeypress|onkeyup|onmousedown|onmousemove\"\n-                +\"|onmouseout|onmouseover|onmouseup|style|title],\"\n-                +\"head[dir<ltr?rtl|lang|profile],\"\n-                +\"hr[align<center?left?right|class|dir<ltr?rtl|id|lang|noshade<noshade|onclick\"\n-                +\"|ondblclick|onkeydown|onkeypress|onkeyup|onmousedown|onmousemove\"\n-                +\"|onmouseout|onmouseover|onmouseup|size|style|title|width],\"\n-                +\"html[dir<ltr?rtl|lang|version],\"\n-                +\"iframe[align<bottom?left?middle?right?top|class|frameborder|height|id\"\n-                +\"|longdesc|marginheight|marginwidth|name|scrolling<auto?no?yes|src|style\"\n-                +\"|title|width],\"\n-                +\"img[align<bottom?left?middle?right?top|alt|border|class|dir<ltr?rtl|height\"\n-                +\"|hspace|id|ismap<ismap|lang|longdesc|name|onclick|ondblclick|onkeydown\"\n-                +\"|onkeypress|onkeyup|onmousedown|onmousemove|onmouseout|onmouseover\"\n-                +\"|onmouseup|sizes|src|srcset|style|title|usemap|vspace|width],\"\n-                +\"input[accept|accesskey|align<bottom?left?middle?right?top|alt\"\n-                +\"|checked<checked|class|dir<ltr?rtl|disabled<disabled|id|ismap<ismap|lang\"\n-                +\"|maxlength|name|onblur|onclick|ondblclick|onfocus|onkeydown|onkeypress\"\n-                +\"|onkeyup|onmousedown|onmousemove|onmouseout|onmouseover|onmouseup|onselect\"\n-                +\"|readonly<readonly|size|src|style|tabindex|title\"\n-                +\"|type<button?checkbox?file?hidden?image?password?radio?reset?submit?text\"\n-                +\"|usemap|value],\"\n-                +\"ins[cite|class|datetime|dir<ltr?rtl|id|lang|onclick|ondblclick|onkeydown\"\n-                +\"|onkeypress|onkeyup|onmousedown|onmousemove|onmouseout|onmouseover\"\n-                +\"|onmouseup|style|title],\"\n-                +\"isindex[class|dir<ltr?rtl|id|lang|prompt|style|title],\"\n-                +\"kbd[class|dir<ltr?rtl|id|lang|onclick|ondblclick|onkeydown|onkeypress\"\n-                +\"|onkeyup|onmousedown|onmousemove|onmouseout|onmouseover|onmouseup|style\"\n-                +\"|title],\"\n-                +\"label[accesskey|class|dir<ltr?rtl|for|id|lang|onblur|onclick|ondblclick\"\n-                +\"|onfocus|onkeydown|onkeypress|onkeyup|onmousedown|onmousemove|onmouseout\"\n-                +\"|onmouseover|onmouseup|style|title],\"\n-                +\"legend[align<bottom?left?right?top|accesskey|class|dir<ltr?rtl|id|lang\"\n-                +\"|onclick|ondblclick|onkeydown|onkeypress|onkeyup|onmousedown|onmousemove\"\n-                +\"|onmouseout|onmouseover|onmouseup|style|title],\"\n-                +\"li[class|dir<ltr?rtl|id|lang|onclick|ondblclick|onkeydown|onkeypress|onkeyup\"\n-                +\"|onmousedown|onmousemove|onmouseout|onmouseover|onmouseup|style|title|type\"\n-                +\"|value],\"\n-                +\"link[charset|class|dir<ltr?rtl|href|hreflang|id|lang|media|onclick\"\n-                +\"|ondblclick|onkeydown|onkeypress|onkeyup|onmousedown|onmousemove\"\n-                +\"|onmouseout|onmouseover|onmouseup|rel|rev|style|title|target|type],\"\n-                +\"map[class|dir<ltr?rtl|id|lang|name|onclick|ondblclick|onkeydown|onkeypress\"\n-                +\"|onkeyup|onmousedown|onmousemove|onmouseout|onmouseover|onmouseup|style\"\n-                +\"|title],\"\n-                +\"menu[class|compact<compact|dir<ltr?rtl|id|lang|onclick|ondblclick|onkeydown\"\n-                +\"|onkeypress|onkeyup|onmousedown|onmousemove|onmouseout|onmouseover\"\n-                +\"|onmouseup|style|title],\"\n-                +\"meta[content|dir<ltr?rtl|http-equiv|lang|name|scheme],\"\n-                +\"noframes[class|dir<ltr?rtl|id|lang|onclick|ondblclick|onkeydown|onkeypress\"\n-                +\"|onkeyup|onmousedown|onmousemove|onmouseout|onmouseover|onmouseup|style\"\n-                +\"|title],\"\n-                +\"noscript[class|dir<ltr?rtl|id|lang|style|title],\"\n-                +\"object[align<bottom?left?middle?right?top|archive|border|class|classid\"\n-                +\"|codebase|codetype|data|declare|dir<ltr?rtl|height|hspace|id|lang|name\"\n-                +\"|onclick|ondblclick|onkeydown|onkeypress|onkeyup|onmousedown|onmousemove\"\n-                +\"|onmouseout|onmouseover|onmouseup|standby|style|tabindex|title|type|usemap\"\n-                +\"|vspace|width],\"\n-                +\"ol[class|compact<compact|dir<ltr?rtl|id|lang|onclick|ondblclick|onkeydown\"\n-                +\"|onkeypress|onkeyup|onmousedown|onmousemove|onmouseout|onmouseover\"\n-                +\"|onmouseup|start|style|title|type],\"\n-                +\"optgroup[class|dir<ltr?rtl|disabled<disabled|id|label|lang|onclick\"\n-                +\"|ondblclick|onkeydown|onkeypress|onkeyup|onmousedown|onmousemove\"\n-                +\"|onmouseout|onmouseover|onmouseup|style|title],\"\n-                +\"option[class|dir<ltr?rtl|disabled<disabled|id|label|lang|onclick|ondblclick\"\n-                +\"|onkeydown|onkeypress|onkeyup|onmousedown|onmousemove|onmouseout\"\n-                +\"|onmouseover|onmouseup|selected<selected|style|title|value],\"\n-                +\"p[align<center?justify?left?right|class|dir<ltr?rtl|id|lang|onclick\"\n-                +\"|ondblclick|onkeydown|onkeypress|onkeyup|onmousedown|onmousemove\"\n-                +\"|onmouseout|onmouseover|onmouseup|style|title],\"\n-                +\"param[id|name|type|value|valuetype<DATA?OBJECT?REF],\"\n-                +\"pre/listing/plaintext/xmp[align|class|dir<ltr?rtl|id|lang|onclick|ondblclick\"\n-                +\"|onkeydown|onkeypress|onkeyup|onmousedown|onmousemove|onmouseout\"\n-                +\"|onmouseover|onmouseup|style|title|width],\"\n-                +\"q[cite|class|dir<ltr?rtl|id|lang|onclick|ondblclick|onkeydown|onkeypress\"\n-                +\"|onkeyup|onmousedown|onmousemove|onmouseout|onmouseover|onmouseup|style\"\n-                +\"|title],\"\n-                +\"s[class|dir<ltr?rtl|id|lang|onclick|ondblclick|onkeydown|onkeypress|onkeyup\"\n-                +\"|onmousedown|onmousemove|onmouseout|onmouseover|onmouseup|style|title],\"\n-                +\"samp[class|dir<ltr?rtl|id|lang|onclick|ondblclick|onkeydown|onkeypress\"\n-                +\"|onkeyup|onmousedown|onmousemove|onmouseout|onmouseover|onmouseup|style\"\n-                +\"|title],\"\n-                +\"script[charset|defer|language|src|type],\"\n-                +\"select[class|dir<ltr?rtl|disabled<disabled|id|lang|multiple<multiple|name\"\n-                +\"|onblur|onchange|onclick|ondblclick|onfocus|onkeydown|onkeypress|onkeyup\"\n-                +\"|onmousedown|onmousemove|onmouseout|onmouseover|onmouseup|size|style\"\n-                +\"|tabindex|title],\"\n-                +\"small[class|dir<ltr?rtl|id|lang|onclick|ondblclick|onkeydown|onkeypress\"\n-                +\"|onkeyup|onmousedown|onmousemove|onmouseout|onmouseover|onmouseup|style\"\n-                +\"|title],\"\n-                +\"span[align<center?justify?left?right|class|dir<ltr?rtl|id|lang|onclick|ondblclick|onkeydown\"\n-                +\"|onkeypress|onkeyup|onmousedown|onmousemove|onmouseout|onmouseover\"\n-                +\"|onmouseup|style|title],\"\n-                +\"strike[class|class|dir<ltr?rtl|id|lang|onclick|ondblclick|onkeydown\"\n-                +\"|onkeypress|onkeyup|onmousedown|onmousemove|onmouseout|onmouseover\"\n-                +\"|onmouseup|style|title],\"\n-                +\"strong/b[class|dir<ltr?rtl|id|lang|onclick|ondblclick|onkeydown|onkeypress\"\n-                +\"|onkeyup|onmousedown|onmousemove|onmouseout|onmouseover|onmouseup|style\"\n-                +\"|title],\"\n-                +\"style[dir<ltr?rtl|lang|media|title|type],\"\n-                +\"sub[class|dir<ltr?rtl|id|lang|onclick|ondblclick|onkeydown|onkeypress\"\n-                +\"|onkeyup|onmousedown|onmousemove|onmouseout|onmouseover|onmouseup|style\"\n-                +\"|title],\"\n-                +\"sup[class|dir<ltr?rtl|id|lang|onclick|ondblclick|onkeydown|onkeypress\"\n-                +\"|onkeyup|onmousedown|onmousemove|onmouseout|onmouseover|onmouseup|style\"\n-                +\"|title],\"\n-                +\"table[align<center?left?right|bgcolor|border|cellpadding|cellspacing|class\"\n-                +\"|dir<ltr?rtl|frame|height|id|lang|onclick|ondblclick|onkeydown|onkeypress\"\n-                +\"|onkeyup|onmousedown|onmousemove|onmouseout|onmouseover|onmouseup|rules\"\n-                +\"|style|summary|title|width],\"\n-                +\"tbody[align<center?char?justify?left?right|char|class|charoff|dir<ltr?rtl|id\"\n-                +\"|lang|onclick|ondblclick|onkeydown|onkeypress|onkeyup|onmousedown\"\n-                +\"|onmousemove|onmouseout|onmouseover|onmouseup|style|title\"\n-                +\"|valign<baseline?bottom?middle?top],\"\n-                +\"td[abbr|align<center?char?justify?left?right|axis|bgcolor|char|charoff|class\"\n-                +\"|colspan|dir<ltr?rtl|headers|height|id|lang|nowrap<nowrap|onclick\"\n-                +\"|ondblclick|onkeydown|onkeypress|onkeyup|onmousedown|onmousemove\"\n-                +\"|onmouseout|onmouseover|onmouseup|rowspan|scope<col?colgroup?row?rowgroup\"\n-                +\"|style|title|valign<baseline?bottom?middle?top|width],\"\n-                +\"textarea[accesskey|class|cols|dir<ltr?rtl|disabled<disabled|id|lang|name\"\n-                +\"|onblur|onclick|ondblclick|onfocus|onkeydown|onkeypress|onkeyup\"\n-                +\"|onmousedown|onmousemove|onmouseout|onmouseover|onmouseup|onselect\"\n-                +\"|readonly<readonly|rows|style|tabindex|title],\"\n-                +\"tfoot[align<center?char?justify?left?right|char|charoff|class|dir<ltr?rtl|id\"\n-                +\"|lang|onclick|ondblclick|onkeydown|onkeypress|onkeyup|onmousedown\"\n-                +\"|onmousemove|onmouseout|onmouseover|onmouseup|style|title\"\n-                +\"|valign<baseline?bottom?middle?top],\"\n-                +\"th[abbr|align<center?char?justify?left?right|axis|bgcolor|char|charoff|class\"\n-                +\"|colspan|dir<ltr?rtl|headers|height|id|lang|nowrap<nowrap|onclick\"\n-                +\"|ondblclick|onkeydown|onkeypress|onkeyup|onmousedown|onmousemove\"\n-                +\"|onmouseout|onmouseover|onmouseup|rowspan|scope<col?colgroup?row?rowgroup\"\n-                +\"|style|title|valign<baseline?bottom?middle?top|width],\"\n-                +\"thead[align<center?char?justify?left?right|char|charoff|class|dir<ltr?rtl|id\"\n-                +\"|lang|onclick|ondblclick|onkeydown|onkeypress|onkeyup|onmousedown\"\n-                +\"|onmousemove|onmouseout|onmouseover|onmouseup|style|title\"\n-                +\"|valign<baseline?bottom?middle?top],\"\n-                +\"title[dir<ltr?rtl|lang],\"\n-                +\"tr[abbr|align<center?char?justify?left?right|bgcolor|char|charoff|class\"\n-                +\"|rowspan|dir<ltr?rtl|id|lang|onclick|ondblclick|onkeydown|onkeypress\"\n-                +\"|onkeyup|onmousedown|onmousemove|onmouseout|onmouseover|onmouseup|style\"\n-                +\"|title|valign<baseline?bottom?middle?top],\"\n-                +\"tt[class|dir<ltr?rtl|id|lang|onclick|ondblclick|onkeydown|onkeypress|onkeyup\"\n-                +\"|onmousedown|onmousemove|onmouseout|onmouseover|onmouseup|style|title],\"\n-                +\"u[class|dir<ltr?rtl|id|lang|onclick|ondblclick|onkeydown|onkeypress|onkeyup\"\n-                +\"|onmousedown|onmousemove|onmouseout|onmouseover|onmouseup|style|title],\"\n-                +\"ul[class|compact<compact|dir<ltr?rtl|id|lang|onclick|ondblclick|onkeydown\"\n-                +\"|onkeypress|onkeyup|onmousedown|onmousemove|onmouseout|onmouseover\"\n-                +\"|onmouseup|style|title|type],\"\n-                +\"var[class|dir<ltr?rtl|id|lang|onclick|ondblclick|onkeydown|onkeypress\"\n-                +\"|onkeyup|onmousedown|onmousemove|onmouseout|onmouseover|onmouseup|style\"\n-                +\"|title]\",\n-            mode : (mode != undefined ? mode : 'none'),\n-            elements : this.id,\n-            theme : 'advanced',\n-            plugins : plugins,\n-            theme_advanced_buttons1 : magentoPlugins + 'magentowidget,bold,italic,underline,strikethrough,|,justifyleft,justifycenter,justifyright,justifyfull,|,styleselect,formatselect,fontselect,fontsizeselect',\n-            theme_advanced_buttons2 : 'cut,copy,paste,pastetext,pasteword,|,search,replace,|,bullist,numlist,|,outdent,indent,blockquote,|,undo,redo,|,link,unlink,anchor,image,cleanup,help,code,|,forecolor,backcolor',\n-            theme_advanced_buttons3 : 'tablecontrols,|,hr,removeformat,visualaid,|,sub,sup,|,charmap,iespell,media,advhr,|,ltr,rtl,|,fullscreen',\n-            theme_advanced_buttons4 : 'insertlayer,moveforward,movebackward,absolute,|,styleprops,|,cite,abbr,acronym,del,ins,attribs,|,visualchars,nonbreaking,pagebreak',\n-            theme_advanced_toolbar_location : 'top',\n-            theme_advanced_toolbar_align : 'left',\n-            theme_advanced_statusbar_location : 'bottom',\n-            theme_advanced_resizing : true,\n-            convert_urls : false,\n-            relative_urls : false,\n-            media_disable_flash : this.config.media_disable_flash,\n-            content_css: this.config.content_css,\n-            custom_popup_css: this.config.popup_css,\n-            magentowidget_url: this.config.widget_window_url,\n-            magentoPluginsOptions: magentoPluginsOptions,\n-            doctype : '<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Strict//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd\">',\n-\n-            setup : function(ed) {\n-                ed.onSubmit.add(function(ed, e) {\n-                    varienGlobalEvents.fireEvent('tinymceSubmit', e);\n-                });\n-\n-                ed.onPaste.add(function(ed, e, o) {\n-                    varienGlobalEvents.fireEvent('tinymcePaste', o);\n-                });\n-\n-                ed.onBeforeSetContent.add(function(ed, o) {\n-                    varienGlobalEvents.fireEvent('tinymceBeforeSetContent', o);\n-                });\n-\n-                ed.onSetContent.add(function(ed, o) {\n-                    varienGlobalEvents.fireEvent('tinymceSetContent', o);\n-                });\n-\n-                ed.onSaveContent.add(function(ed, o) {\n-                    varienGlobalEvents.fireEvent('tinymceSaveContent', o);\n-                });\n-\n-                ed.onChange.add(function(ed, l) {\n-                    varienGlobalEvents.fireEvent('tinymceChange', l);\n-                });\n-\n-                ed.onExecCommand.add(function(ed, cmd, ui, val) {\n-                    varienGlobalEvents.fireEvent('tinymceExecCommand', cmd);\n-                });\n-            }\n-        };\n-\n-        // Set the document base URL\n-        if (this.config.document_base_url) {\n-            settings.document_base_url = this.config.document_base_url;\n-        }\n-\n-        if (this.config.files_browser_window_url) {\n-            settings.file_browser_callback = function(fieldName, url, objectType, w) {\n-                varienGlobalEvents.fireEvent(\"open_browser_callback\", {win:w, type:objectType, field:fieldName});\n-            };\n-        }\n-\n-        if (this.config.width) {\n-            settings.width = this.config.width;\n-        }\n-\n-        if (this.config.height) {\n-            settings.height = this.config.height;\n-        }\n-\n-        return settings;\n-    },\n-\n-    openFileBrowser: function(o) {\n-        var typeTitle;\n-        var storeId = this.config.store_id !== null ? this.config.store_id : 0;\n-        var wUrl = this.config.files_browser_window_url +\n-                   'target_element_id/' + this.id + '/' +\n-                   'store/' + storeId + '/';\n-\n-        this.mediaBrowserOpener = o.win;\n-        this.mediaBrowserTargetElementId = o.field;\n-\n-        if (typeof(o.type) != 'undefined' && o.type != \"\") {\n-            typeTitle = 'image' == o.type ? this.translate('Insert Image...') : this.translate('Insert Media...');\n-            wUrl = wUrl + \"type/\" + o.type + \"/\";\n-        } else {\n-            typeTitle = this.translate('Insert File...');\n-        }\n-\n-        MediabrowserUtility.openDialog(wUrl, false, false, typeTitle, {\n-            onBeforeShow: function(win) {\n-                win.element.setStyle({zIndex: 300200});\n-            }\n-        });\n-    },\n-\n-    translate: function(string) {\n-        return 'undefined' != typeof(Translator) ? Translator.translate(string) : string;\n-    },\n-\n-    getMediaBrowserOpener: function() {\n-        return this.mediaBrowserOpener;\n-    },\n-\n-    getMediaBrowserTargetElementId: function() {\n-        return this.mediaBrowserTargetElementId;\n-    },\n-\n-    getToggleButton: function() {\n-        return $('toggle' + this.id);\n-    },\n-\n-    getPluginButtons: function() {\n-        return $$('#buttons' + this.id + ' > button.plugin');\n-    },\n-\n-    turnOn: function() {\n-        this.closePopups();\n-        this.setup();\n-        tinyMCE.execCommand('mceAddControl', false, this.id);\n-        this.getPluginButtons().each(function(e) {\n-            e.hide();\n-        });\n-    },\n-\n-    turnOff: function() {\n-        this.closePopups();\n-        tinyMCE.execCommand('mceRemoveControl', false, this.id);\n-        this.getPluginButtons().each(function(e) {\n-            e.show();\n-        });\n-    },\n-\n-    closePopups: function() {\n-        // close all popups to avoid problems with updating parent content area\n-        closeEditorPopup('widget_window' + this.id);\n-        closeEditorPopup('browser_window' + this.id);\n-    },\n-\n-    toggle: function() {\n-        if (!tinyMCE.get(this.id)) {\n-            this.turnOn();\n-            return true;\n-        } else {\n-            this.turnOff();\n-            return false;\n-        }\n-    },\n-\n-    onFormValidation: function() {\n-        if (tinyMCE.get(this.id)) {\n-            $(this.id).value = tinyMCE.get(this.id).getContent();\n-        }\n-    },\n-\n-    onChangeContent: function() {\n-        // Add \"changed\" to tab class if it exists\n-        if(this.config.tab_id) {\n-            var tab = $$('a[id$=' + this.config.tab_id + ']')[0];\n-            if ($(tab) != undefined && $(tab).hasClassName('tab-item-link')) {\n-                $(tab).addClassName('changed');\n-            }\n-        }\n-    },\n-\n-    // retrieve directives URL with substituted directive value\n-    makeDirectiveUrl: function(directive) {\n-        return this.config.directives_url.replace('directive', 'directive/___directive/' + directive);\n-    },\n-\n-    encodeDirectives: function(content) {\n-        // collect all HTML tags with attributes that contain directives\n-        return content.gsub(/<([a-z0-9\\-\\_]+.+?)([a-z0-9\\-\\_]+=\".*?\\{\\{.+?\\}\\}.*?\".+?)>/i, function(match) {\n-            var attributesString = match[2];\n-            // process tag attributes string\n-            attributesString = attributesString.gsub(/([a-z0-9\\-\\_]+)=\"(.*?)(\\{\\{.+?\\}\\})(.*?)\"/i, function(m) {\n-                return m[1] + '=\"' + m[2] + this.makeDirectiveUrl(Base64.mageEncode(m[3])) + m[4] + '\"';\n-            }.bind(this));\n-\n-            return '<' + match[1] + attributesString + '>';\n-\n-        }.bind(this));\n-    },\n-\n-    encodeWidgets: function(content) {\n-        return content.gsub(/\\{\\{widget(.*?)\\}\\}/i, function(match){\n-            var attributes = this.parseAttributesString(match[1]);\n-            if (attributes.type) {\n-                var placeholderFilename = attributes.type.replace(/\\//g, \"__\") + \".gif\";\n-                if (!this.widgetPlaceholderExist(placeholderFilename)) {\n-                    placeholderFilename = 'default.gif';\n-                }\n-                var imageSrc = this.config.widget_images_url + placeholderFilename;\n-                var imageHtml = '<img';\n-                    imageHtml+= ' id=\"' + Base64.idEncode(match[0]) + '\"';\n-                    imageHtml+= ' src=\"' + imageSrc + '\"';\n-                    imageHtml+= ' title=\"' + match[0].replace(/\\{\\{/g, '{').replace(/\\}\\}/g, '}').replace(/\\\"/g, '&quot;') + '\"';\n-                    imageHtml+= '>';\n-\n-                return imageHtml;\n-            }\n-        }.bind(this));\n-    },\n-\n-    decodeDirectives: function(content) {\n-        // escape special chars in directives url to use it in regular expression\n-        var url = this.makeDirectiveUrl('%directive%').replace(/([$^.?*!+:=()\\[\\]{}|\\\\])/g, '\\\\$1');\n-        var reg = new RegExp(url.replace('%directive%', '([a-zA-Z0-9,_-]+)'));\n-        return content.gsub(reg, function(match) {\n-            return Base64.mageDecode(match[1]);\n-        }.bind(this));\n-    },\n-\n-    decodeWidgets: function(content) {\n-        return content.gsub(/<img([^>]+id=\\\"[^>]+)>/i, function(match) {\n-            var attributes = this.parseAttributesString(match[1]);\n-            if(attributes.id) {\n-                var widgetCode = Base64.idDecode(attributes.id);\n-                if (widgetCode.indexOf('{{widget') != -1) {\n-                    return widgetCode;\n-                }\n-                return match[0];\n-            }\n-            return match[0];\n-        }.bind(this));\n-    },\n-\n-    parseAttributesString: function(attributes) {\n-        var result = {};\n-        attributes.gsub(/(\\w+)(?:\\s*=\\s*(?:(?:\"((?:\\\\.|[^\"])*)\")|(?:'((?:\\\\.|[^'])*)')|([^>\\s]+)))?/, function(match){\n-            result[match[1]] = match[2];\n-        });\n-        return result;\n-    },\n-\n-    beforeSetContent: function(o) {\n-        if (this.config.add_widgets) {\n-            o.content = this.encodeWidgets(o.content);\n-            o.content = this.encodeDirectives(o.content);\n-        } else if (this.config.add_directives) {\n-            o.content = this.encodeDirectives(o.content);\n-        }\n-    },\n-\n-    saveContent: function(o) {\n-        if (this.config.add_widgets) {\n-            o.content = this.decodeWidgets(o.content);\n-            o.content = this.decodeDirectives(o.content);\n-        } else if (this.config.add_directives) {\n-            o.content = this.decodeDirectives(o.content);\n-        }\n-    },\n-\n-    widgetPlaceholderExist: function(filename) {\n-        return this.config.widget_placeholders.indexOf(filename) != -1;\n-    }\n-};"
        },
        {
            "filename": "js/mage/adminhtml/wysiwyg/tiny_mce/themes/advanced/skins/default/content.css",
            "diff": "@@ -1,32 +0,0 @@\n-/**\n- * OpenMage\n- *\n- * This source file is subject to the Academic Free License (AFL 3.0)\n- * that is bundled with this package in the file LICENSE_AFL.txt.\n- * It is also available at https://opensource.org/license/afl-3-0-php\n- *\n- * @category    Mage\n- * @package     Mage_Adminhtml\n- * @copyright   Copyright (c) 2006-2020 Magento, Inc. (https://www.magento.com)\n- * @copyright   Copyright (c) 2022-2023 The OpenMage Contributors (https://www.openmage.org)\n- * @license     https://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)\n- */\n-\n-body, td, pre { color:#2f2f2f; font-family:Arial, Helvetica, sans-serif; font-size:12px; margin:8px; }\n-body { background:#fff; }\n-body.mceForceColors { background:#fff; color:#2f2f2f; }\n-h1 {font-size: 2em}\n-h2 {font-size: 1.5em}\n-h3 {font-size: 1.17em}\n-h4 {font-size: 1em}\n-h5 {font-size: .83em}\n-h6 {font-size: .75em}\n-.mceItemTable, .mceItemTable td, .mceItemTable th, .mceItemTable caption, .mceItemVisualAid {border: 1px dashed #BBB;}\n-img {border:0; vertical-align:middle; }\n-table {cursor:default}\n-table td, table th {cursor:text}\n-ins {border-bottom:1px solid green; text-decoration: none; color:green}\n-del {color:red; text-decoration:line-through}\n-cite {border-bottom:1px dashed blue}\n-acronym {border-bottom:1px dotted #CCC; cursor:help}\n-abbr, html\\:abbr {border-bottom:1px dashed #CCC; cursor:help}"
        },
        {
            "filename": "js/mage/adminhtml/wysiwyg/tiny_mce/themes/advanced/skins/default/dialog.css",
            "diff": "@@ -1,76 +0,0 @@\n-/**\n- * OpenMage\n- *\n- * This source file is subject to the Academic Free License (AFL 3.0)\n- * that is bundled with this package in the file LICENSE_AFL.txt.\n- * It is also available at https://opensource.org/license/afl-3-0-php\n- *\n- * @category    Mage\n- * @package     Mage_Adminhtml\n- * @copyright   Copyright (c) 2006-2020 Magento, Inc. (https://www.magento.com)\n- * @copyright   Copyright (c) 2021-2022 The OpenMage Contributors (https://www.openmage.org)\n- * @license     https://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)\n- */\n-\n-/* Browse */\n-a.pickcolor, a.browse {text-decoration:none}\n-a.browse span {display:block; width:20px; height:18px; background:url(../../img/icons.gif) -860px 0; border:1px solid #FFF; margin-left:1px;}\n-.mceOldBoxModel a.browse span {width:22px; height:20px;}\n-a.browse:hover span {border:1px solid #0A246A; background-color:#B2BBD0;}\n-a.browse span.disabled {border:1px solid white; opacity:0.3;}\n-a.browse:hover span.disabled {border:1px solid white; background-color:transparent;}\n-a.pickcolor span {display:block; width:20px; height:16px; background:url(../../img/icons.gif) -840px 0; margin-left:2px;}\n-.mceOldBoxModel a.pickcolor span {width:21px; height:17px;}\n-a.pickcolor:hover span {background-color:#B2BBD0;}\n-a.pickcolor:hover span.disabled {}\n-\n-/* Charmap */\n-table.charmap {border:1px solid #AAA; text-align:center}\n-td.charmap, #charmap a {width:18px; height:18px; color:#000; border:1px solid #AAA; text-align:center; font-size:12px; vertical-align:middle; line-height: 18px;}\n-#charmap a {display:block; color:#000; text-decoration:none; border:0}\n-#charmap a:hover {background:#CCC;color:#2B6FB6}\n-#charmap #codeN {font-size:10px; font-family:Arial,Helvetica,sans-serif; text-align:center}\n-#charmap #codeV {font-size:40px; height:80px; border:1px solid #AAA; text-align:center}\n-\n-/* Source */\n-.wordWrapCode {vertical-align:middle; border:1px none #000000; background:transparent;}\n-.mceActionPanel {margin-top:5px;}\n-\n-/* Tabs classes */\n-.tabs {width:100%; height:18px; line-height:normal; background:url(img/tabs.gif) repeat-x 0 -72px;}\n-.tabs ul {margin:0; padding:0; list-style:none;}\n-.tabs li {float:left; background:url(img/tabs.gif) no-repeat 0 0; margin:0 2px 0 0; padding:0 0 0 10px; line-height:17px; height:18px; display:block;}\n-.tabs li.current {background:url(img/tabs.gif) no-repeat 0 -18px; margin-right:2px;}\n-.tabs span {float:left; display:block; background:url(img/tabs.gif) no-repeat right -36px; padding:0px 10px 0 0;}\n-.tabs .current span {background:url(img/tabs.gif) no-repeat right -54px;}\n-.tabs a {text-decoration:none; font-family:Verdana, Arial; font-size:10px;}\n-.tabs a:link, .tabs a:visited, .tabs a:hover {color:black;}\n-\n-/* Panels */\n-.panel_wrapper div.panel {display:none;}\n-.panel_wrapper div.current {display:block; width:100%; height:300px; overflow:visible;}\n-.panel_wrapper {border:1px solid #919B9C; border-top:0px; padding:10px; padding-top:5px; clear:both; background:white;}\n-\n-/* Columns */\n-.column {float:left;}\n-.properties {width:100%;}\n-.properties .column1 {}\n-.properties .column2 {text-align:left;}\n-\n-/* Dialog specific */\n-#link .panel_wrapper, #link div.current {height:125px;}\n-#image .panel_wrapper, #image div.current {height:200px;}\n-#plugintable thead {font-weight:bold; background:#DDD;}\n-#plugintable, #about #plugintable td {border:1px solid #919B9C;}\n-#plugintable {width:96%; margin-top:10px;}\n-#pluginscontainer {height:290px; overflow:auto;}\n-#colorpicker #preview {float:right; width:50px; height:14px;line-height:1px; border:1px solid black; margin-left:5px;}\n-#colorpicker #colors {float:left; border:1px solid gray; cursor:crosshair;}\n-#colorpicker #light {border:1px solid gray; margin-left:5px; float:left;width:15px; height:150px; cursor:crosshair;}\n-#colorpicker #light div {overflow:hidden;}\n-#colorpicker #previewblock {float:right; padding-left:10px; height:20px;}\n-#colorpicker .panel_wrapper div.current {height:175px;}\n-#colorpicker #namedcolors {width:150px;}\n-#colorpicker #namedcolors a {display:block; float:left; width:10px; height:10px; margin:1px 1px 0 0; overflow:hidden;}\n-#colorpicker #colornamecontainer {margin-top:5px;}\n-#colorpicker #picker_panel fieldset {margin:auto;width:325px;}"
        },
        {
            "filename": "js/mage/adminhtml/wysiwyg/tinymce/plugins/openmagevariable.js",
            "diff": "@@ -0,0 +1,59 @@\n+/**\n+ * OpenMage\n+ *\n+ * This source file is subject to the Academic Free License (AFL 3.0)\n+ * that is bundled with this package in the file LICENSE_AFL.txt.\n+ * It is also available at https://opensource.org/license/afl-3-0-php\n+ *\n+ * @category    Mage\n+ * @package     Mage_Adminhtml\n+ * @copyright   Copyright (c) 2006-2020 Magento, Inc. (https://www.magento.com)\n+ * @copyright   Copyright (c) 2022 The OpenMage Contributors (https://www.openmage.org)\n+ * @license     https://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)\n+ */\n+\n+tinymce.PluginManager.add('openmagevariable', (ed, url) => {\n+    return {        \n+        init: function (editor) {\n+            editor.addCommand('openVariablesPopup', function (commandConfig) {\n+                var config = tinyMceEditors.get(tinymce.activeEditor.id).openmagePluginsOptions.get('openmagevariable');\n+                OpenmagevariablePlugin.setEditor(editor);\n+                OpenmagevariablePlugin.loadChooser(\n+                    config.url,\n+                    null,\n+                    tinymce.activeEditor.selection.getNode()\n+                );\n+            });\n+\n+            editor.ui.registry.addIcon(\n+                'openmagevariable',\n+                '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"18\" height=\"18\" viewBox=\"0 0 18 18\">' +\n+                '<path d=\"M3.9298,0C2.37414,0,1.113,2.37414,1.113,3.9298V7.17695A1.47489,1.47489,0,0,1,.307,8.49146a0.56355,0.56355,0,0,0,0,1.017A1.475,1.475,0,0,1,1.113,10.823V14.0702C1.113,15.62585,2.37414,18,3.9298,18a0.56336,0.56336,0,0,0,0-1.12671c-0.9334,0-1.69007-1.86972-1.69007-2.80309V10.823A2.60153,2.60153,0,0,0,1.49423,9a2.60148,2.60148,0,0,0,.7455-1.82305V3.9298c0-.9334.75667-2.80309,1.69007-2.80309A0.56336,0.56336,0,0,0,3.9298,0ZM14.0702,0C15.62585,0,16.887,2.37414,16.887,3.9298V7.17695A1.47492,1.47492,0,0,0,17.693,8.49146a0.56354,0.56354,0,0,1,0,1.017A1.475,1.475,0,0,0,16.887,10.823V14.0702C16.887,15.62585,15.62585,18,14.0702,18a0.56336,0.56336,0,0,1,0-1.12671c0.93337,0,1.69007-1.86972,1.69007-2.80309V10.823A2.60114,2.60114,0,0,1,16.50581,9a2.60113,2.60113,0,0,1-.74554-1.82305V3.9298c0-.9334-0.7567-2.80309-1.69007-2.80309A0.56336,0.56336,0,1,1,14.0702,0ZM6.64169,4.72911a0.56336,0.56336,0,1,0-.91685.65489L8.30774,9l-2.5829,3.61607a0.56338,0.56338,0,0,0,.91685.655L9,9.96931,11.35843,13.271a0.56336,0.56336,0,1,0,.91681-0.655L9.69236,9l2.58287-3.616a0.56334,0.56334,0,1,0-.91681-0.65489L9,8.03081Z\" />' +\n+                '</svg>'\n+            );\n+\n+            let onAction = function () {\n+                editor.execCommand('openVariablesPopup');\n+            }\n+\n+            editor.ui.registry.addToggleButton('openmagevariable', {\n+                icon: 'openmagevariable',\n+                tooltip: Translator.translate('OpenMage Variable'),\n+                onAction: onAction\n+            });\n+\n+            editor.ui.registry.addMenuItem('openmagevariable', {\n+                icon: 'openmagevariable',\n+                text: Translator.translate('OpenMage Variable'),\n+                onAction: onAction\n+            });\n+        },\n+\n+        getMetadata: function () {\n+            return {\n+                name: 'OpenMage Variable Manager Plugin',\n+                url: 'https://www.openmage.org'\n+            };\n+        }\n+    }\n+});"
        },
        {
            "filename": "js/mage/adminhtml/wysiwyg/tinymce/plugins/openmagewidget.js",
            "diff": "@@ -0,0 +1,90 @@\n+/**\n+ * OpenMage\n+ *\n+ * This source file is subject to the Academic Free License (AFL 3.0)\n+ * that is bundled with this package in the file LICENSE_AFL.txt.\n+ * It is also available at https://opensource.org/license/afl-3-0-php\n+ *\n+ * @category    Mage\n+ * @package     Mage_Adminhtml\n+ * @copyright   Copyright (c) 2006-2020 Magento, Inc. (https://www.magento.com)\n+ * @copyright   Copyright (c) 2022 The OpenMage Contributors (https://www.openmage.org)\n+ * @license     https://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)\n+ */\n+\n+tinymce.PluginManager.add('openmagewidget', (ed, url) => {\n+    return {\n+        init: function (editor) {\n+            var self = this;\n+            this.activePlaceholder = null;\n+\n+            editor.addCommand('mceOpenmagewidget', function (img) {\n+                if (self.activePlaceholder) {\n+                    img = self.activePlaceholder;\n+                }\n+                var config = tinyMceEditors.get(tinymce.activeEditor.id).openmagePluginsOptions.get('openmagewidget');\n+                widgetTools.openDialog(\n+                    config.widget_window_url + 'widget_target_id/' + editor.getElement().id + '/'\n+                );\n+            });\n+\n+            editor.ui.registry.addIcon(\n+                'openmagewidget',\n+                '<svg width=\"18\" height=\"18\" viewBox=\"0 0 122.88 121.92\" xmlns=\"http://www.w3.org/2000/svg\">' +\n+                '<path d=\"M6.6,121.92H47.51a6.56,6.56,0,0,0,2.83-.64,6.68,6.68,0,0,0,2.27-1.79,6.63,6.63,0,0,0,1.5-4.17V74.58A6.56,6.56,0,0,0,53.58,72,6.62,6.62,0,0,0,50,68.47,6.56,6.56,0,0,0,47.51,68H6.6a6.5,6.5,0,0,0-2.43.48,6.44,6.44,0,0,0-2.11,1.34A6.6,6.6,0,0,0,.55,72,6.3,6.3,0,0,0,0,74.58v40.74a6.54,6.54,0,0,0,.43,2.32,6.72,6.72,0,0,0,1.2,2l.26.27a6.88,6.88,0,0,0,2,1.39,6.71,6.71,0,0,0,2.73.6ZM59.3,28.44,86,1.77A6.19,6.19,0,0,1,88.22.34,6.24,6.24,0,0,1,90.87,0a6,6,0,0,1,3.69,1.74l26.55,26.55a6,6,0,0,1,1.33,2,6.13,6.13,0,0,1-1.33,6.58L94.45,63.58a6,6,0,0,1-1.9,1.27,5.92,5.92,0,0,1-2.24.5,6.11,6.11,0,0,1-2.41-.43,5.74,5.74,0,0,1-2.05-1.34L59.3,37a6.09,6.09,0,0,1-1.76-3.88V32.8a6.14,6.14,0,0,1,1.77-4.36ZM6.6,59.64H47.51a6.56,6.56,0,0,0,5.1-2.43,6.46,6.46,0,0,0,1.11-2,6.59,6.59,0,0,0,.39-2.21V12.31a6.61,6.61,0,0,0-.53-2.58A6.62,6.62,0,0,0,50,6.19a6.56,6.56,0,0,0-2.45-.48H6.6a6.5,6.5,0,0,0-2.43.48A6.44,6.44,0,0,0,2.06,7.53,6.6,6.6,0,0,0,.55,9.71,6.31,6.31,0,0,0,0,12.31V53.05a6.48,6.48,0,0,0,.43,2.31,6.6,6.6,0,0,0,1.2,2l.26.27a6.88,6.88,0,0,0,2,1.39,6.71,6.71,0,0,0,2.73.6Zm40.92-6.57H6.6l0,0V12.28c3.51,0,40.93,0,41,0,0,3.44,0,40.75,0,40.77Zm22.23,68.85h40.91a6.56,6.56,0,0,0,2.83-.64,6.68,6.68,0,0,0,2.27-1.79,6.63,6.63,0,0,0,1.5-4.17V74.58a6.56,6.56,0,0,0-.53-2.57,6.62,6.62,0,0,0-3.62-3.54,6.56,6.56,0,0,0-2.45-.48H69.75a6.75,6.75,0,0,0-4.54,1.82A6.6,6.6,0,0,0,63.7,72a6.3,6.3,0,0,0-.55,2.59v40.74a6.54,6.54,0,0,0,.43,2.32,6.72,6.72,0,0,0,1.2,2l.26.27a6.88,6.88,0,0,0,2,1.39,6.71,6.71,0,0,0,2.73.6Zm40.92-6.57H69.75l0,0,0-40.77c3.51,0,40.93,0,41,0,0,3.44,0,40.75,0,40.77Zm-63.15,0H6.6l0,0V74.56c3.51,0,40.93,0,41,0,0,3.44,0,40.75,0,40.77Z\"/>' +\n+                '</svg>'\n+            );\n+\n+            let onAction = function () {\n+                editor.execCommand('mceOpenmagewidget');\n+            }\n+\n+            let onSetup = function (api) {\n+                // Add a node change handler, selects the button in the UI when a image is selected\n+                editor.on('NodeChange', function (e) {\n+                    if (api.setActive) api.setActive(false);\n+                    var n = e.target;\n+                    if (n.id && n.nodeName == 'IMG') {\n+                        var widgetCode = Base64.idDecode(n.id);\n+                        if (widgetCode.indexOf('{{widget') != -1) {\n+                            if (api.setActive) api.setActive(true);\n+                        }\n+                    }\n+                });\n+            }\n+\n+            editor.ui.registry.addToggleButton('openmagewidget', {\n+                icon: 'openmagewidget',\n+                tooltip: Translator.translate('OpenMage Widget'),\n+                onAction: onAction,\n+                onSetup: onSetup\n+            });\n+\n+            editor.ui.registry.addMenuItem('openmagewidget', {\n+                icon: 'openmagewidget',\n+                text: Translator.translate('OpenMage Widget'),\n+                onAction: onAction,\n+                onSetup: onSetup\n+            });\n+\n+            // Add a widget placeholder image double click callback\n+            editor.on('dblClick', function (e) {\n+                var n = e.target;\n+                if (n.id && n.nodeName == 'IMG') {\n+                    var widgetCode = Base64.idDecode(n.id);\n+                    if (widgetCode.indexOf('{{widget') != -1) {\n+                        this.execCommand('mceOpenmagewidget', null);\n+                    }\n+                }\n+            });\n+        },\n+\n+        getMetadata: function () {\n+            return {\n+                name: 'OpenMage Widget Manager Plugin',\n+                url: 'https://www.openmage.org'\n+            };\n+        }\n+    }\n+    \n+});"
        },
        {
            "filename": "js/mage/adminhtml/wysiwyg/tinymce/setup.js",
            "diff": "@@ -0,0 +1,363 @@\n+/**\n+ * OpenMage\n+ *\n+ * This source file is subject to the Academic Free License (AFL 3.0)\n+ * that is bundled with this package in the file LICENSE_AFL.txt.\n+ * It is also available at https://opensource.org/license/afl-3-0-php\n+ *\n+ * @category    Mage\n+ * @package     Mage_Adminhtml\n+ * @copyright   Copyright (c) 2006-2020 Magento, Inc. (https://www.magento.com)\n+ * @copyright   Copyright (c) 2018 The OpenMage Contributors (https://www.openmage.org)\n+ * @license     https://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)\n+ */\n+\n+var tinyMceWysiwygSetup = Class.create();\n+tinyMceWysiwygSetup.prototype =\n+{\n+    mediaBrowserCallback: null,\n+    mediaBrowserMetal: null,\n+    mediaBrowserValue: null,\n+\n+    openmagePluginsOptions: $H({}),\n+\n+    initialize: function (htmlId, config) {\n+        this.id = htmlId;\n+        this.selector = 'textarea#' + htmlId;\n+        this.config = config;\n+        varienGlobalEvents.attachEventHandler('tinymceChange', this.onChangeContent.bind(this));\n+\n+        if (typeof tinyMceEditors === 'undefined') {\n+            window.tinyMceEditors = $H({});\n+        }\n+        tinyMceEditors.set(this.id, this);\n+    },\n+\n+    setup: function (mode) {\n+        var self = this;\n+\n+        if (this.config.widget_plugin_src) {\n+            tinymce.PluginManager.load('openmagewidget', this.config.widget_plugin_src);\n+            this.openmagePluginsOptions.set('openmagewidget', {\n+                'widget_window_url': this.config.widget_window_url\n+            });\n+        }\n+\n+        if (this.config.plugins) {\n+            (this.config.plugins).each(function (plugin) {\n+                tinymce.PluginManager.load(plugin.name, plugin.src);\n+                self.openmagePluginsOptions.set(plugin.name, plugin.options);\n+            });\n+        }\n+\n+        tinymce.init(this.getSettings(mode));\n+    },\n+\n+\n+    getSettings: function (mode) {\n+        var plugins = 'autoresize accordion searchreplace visualblocks visualchars anchor code lists advlist fullscreen pagebreak table wordcount directionality image charmap link media nonbreaking help';\n+        var toolbar = 'undo redo | bold italic underline strikethrough | insertfile image media template link anchor codesample | alignleft aligncenter alignright alignjustify | outdent indent |  numlist bullist | forecolor backcolor removeformat | fontfamily fontsize blocks | pagebreak | charmap | fullscreen preview save print | ltr rtl'\n+\n+        // load and add to toolbar openmagePlugins\n+        if (this.openmagePluginsOptions) {\n+            var openmageToolbarButtons = '';\n+            this.openmagePluginsOptions.each(function (plugin, key) {\n+                plugins = plugin.key + ' ' + plugins;\n+                openmageToolbarButtons = plugin.key + ' ' + openmageToolbarButtons;\n+            });\n+            toolbar = openmageToolbarButtons + ' | ' + toolbar;\n+        }\n+\n+        var settings = {\n+            selector: this.selector,\n+            config: this.config,\n+            menu: {\n+                insert: {\n+                    title: 'Insert',\n+                    items: 'image link media addcomment pageembed template codesample inserttable | openmagevariable openmagewidget | charmap emoticons hr | pagebreak nonbreaking anchor tableofcontents | insertdatetime'\n+                }\n+            },\n+            menubar: 'file edit view insert format tools table help',\n+            plugins: plugins,\n+            toolbar: toolbar,\n+            language: this.config.lang,\n+            paste_as_text: true,\n+            file_picker_types: 'file image media',\n+            automatic_uploads: false,\n+            branding: false,\n+            promotion: false,\n+            convert_urls: false,\n+            relative_urls: true,\n+            skin: this.config.skin,\n+            min_height: 460,\n+            urlconverter_callback: (url, node, on_save, name) => {\n+                // some callback here to convert urls\n+                //url = this.decodeContent(url);\n+                return url;\n+            },\n+            setup: (editor) => {\n+                var onChange;\n+\n+                editor.on('BeforeSetContent', function (evt) {\n+                    varienGlobalEvents.fireEvent('tinymceBeforeSetContent', evt);\n+                });\n+\n+                editor.on('SaveContent', function (evt) {\n+                    varienGlobalEvents.fireEvent('tinymceSaveContent', evt);\n+                });\n+\n+                editor.on('Paste', function (ed, e, o) {\n+                    varienGlobalEvents.fireEvent('tinymcePaste', o);\n+                });\n+\n+                editor.on('PostProcess', function (evt) {\n+                    varienGlobalEvents.fireEvent('tinymceSaveContent', evt);\n+                });\n+\n+                editor.on('setContent', function (evt) {\n+                    varienGlobalEvents.fireEvent('tinymceSetContent', evt);\n+                });\n+\n+                onChange = function (evt) {\n+                    varienGlobalEvents.fireEvent('tinymceChange', evt);\n+                };\n+\n+                editor.on('Change', onChange);\n+                editor.on('keyup', onChange);\n+\n+                editor.on('ExecCommand', function (cmd, ui, val) {\n+                    varienGlobalEvents.fireEvent('tinymceExecCommand', cmd);\n+                });\n+\n+                editor.on('init', function (args) {\n+                    varienGlobalEvents.fireEvent('wysiwygEditorInitialized', args.target);\n+                });\n+            }\n+        }\n+\n+        // Set the document base URL\n+        if (this.config.document_base_url) {\n+            settings.document_base_url = this.config.document_base_url;\n+        }\n+\n+        if (this.config.files_browser_window_url) {\n+            settings.file_picker_callback = (callback, value, meta) => {\n+                varienGlobalEvents.fireEvent(\"open_browser_callback\", { callback: callback, value: value, meta: meta });\n+            };\n+        }\n+        return settings;\n+    },\n+\n+    openFileBrowser: function (o) {\n+        var typeTitle;\n+        var storeId = this.config.store_id !== null ? this.config.store_id : 0;\n+        var wUrl = this.config.files_browser_window_url +\n+            'target_element_id/' + this.id + '/' +\n+            'store/' + storeId + '/';\n+\n+        this.mediaBrowserCallback = o.callback;\n+        this.mediaBrowserMeta = o.meta;\n+        this.mediaBrowserValue = o.value;\n+\n+        if (typeof (o.meta.filetype) != 'undefined' && o.meta.filetype == \"image\") {\n+            typeTitle = 'image' == o.meta.filetype ? this.translate('Insert Image...') : this.translate('Insert Media...');\n+            wUrl = wUrl + \"type/\" + o.meta.filetype + \"/\";\n+        } else {\n+            typeTitle = this.translate('Insert File...');\n+        }\n+\n+        MediabrowserUtility.openDialog(wUrl, false, false, typeTitle, {\n+            onBeforeShow: function (win) {\n+                win.element.setStyle({ zIndex: 300200 });\n+            }\n+        });\n+    },\n+\n+    translate: function (string) {\n+        return 'undefined' != typeof (Translator) ? Translator.translate(string) : string;\n+    },\n+\n+    getToggleButton: function () {\n+        return document.getElementById('toggle' + this.id);\n+    },\n+\n+    getPluginButtons: function () {\n+        return document.querySelectorAll('#buttons' + this.id + ' > button.plugin');\n+    },\n+\n+    turnOn: function () {\n+        this.closePopups();\n+        this.setup();\n+        this.getPluginButtons().forEach(function (e) {\n+            e.hide();\n+        });\n+    },\n+\n+    turnOff: function () {\n+        this.closePopups();\n+        if (tinymce.get(this.id)) {\n+            tinymce.get(this.id).destroy();\n+        }\n+        this.getPluginButtons().forEach(function (e) {\n+            e.show();\n+        });\n+    },\n+\n+    closePopups: function () {\n+        closeEditorPopup('widget_window' + this.id);\n+        closeEditorPopup('browser_window' + this.id);\n+    },\n+\n+    toggle: function () {\n+        if (tinymce.get(this.id) === null) {\n+            this.turnOn();\n+            return true;\n+        } else {\n+            this.turnOff();\n+            return false;\n+        }\n+    },\n+\n+    onFormValidation: function () {\n+        if (tinymce.get(this.id)) {\n+            document.getElementById(this.id).value = tinymce.get(this.id).getContent();\n+        }\n+    },\n+\n+    onChangeContent: function () {\n+        if (this.config.tab_id) {\n+            var tab = document.querySelector('a[id$=' + this.config.tab_id + ']');\n+            if ($(tab) != undefined && $(tab).hasClassName('tab-item-link')) {\n+                $(tab).addClassName('changed');\n+            }\n+        }\n+    },\n+\n+    beforeSetContent: function (o) {\n+        o.content = this.encodeContent(o.content);\n+    },\n+\n+    saveContent: function (o) {\n+        o.content = this.decodeContent(o.content);\n+    },\n+\n+    updateTextArea: function () {\n+        content = tinymce.get(this.id).getContent();\n+        content = this.decodeContent(content);\n+        this.getTextArea().value = content;\n+        this.triggerChange(this.getTextArea());\n+    },\n+\n+    getTextArea: function () {\n+        return document.getElementById(this.id);\n+    },\n+\n+    triggerChange: function (element) {\n+        if (\"createEvent\" in document) {\n+            var evt = document.createEvent(\"HTMLEvents\");\n+            evt.initEvent(\"change\", false, true);\n+            element.dispatchEvent(evt);\n+        } else {\n+            element.fireEvent(\"onchange\");\n+        }\n+        return element;\n+    },\n+\n+    encodeContent: function (content) {\n+        if (this.config.add_widgets) {\n+            content = this.encodeWidgets(content);\n+            content = this.encodeDirectives(content);\n+        } else if (this.config.add_directives) {\n+            content = this.encodeDirectives(content);\n+        }\n+        return content;\n+    },\n+\n+    decodeContent: function (content) {\n+        if (this.config.add_widgets) {\n+            content = this.decodeWidgets(content);\n+            content = this.decodeDirectives(content);\n+        } else if (this.config.add_directives) {\n+            content = this.decodeDirectives(content);\n+        }\n+        return content;\n+    },\n+\n+    // retrieve directives URL with substituted directive value\n+    makeDirectiveUrl: function (directive) {\n+        return this.config.directives_url.replace('directive', 'directive/___directive/' + directive);\n+    },\n+\n+    encodeDirectives: function (content) {\n+        // collect all HTML tags with attributes that contain directives\n+        return content.gsub(/<([a-z0-9\\-\\_]+.+?)([a-z0-9\\-\\_]+=\".*?\\{\\{.+?\\}\\}.*?\".+?)>/i, function (match) {\n+            var attributesString = match[2];\n+            // process tag attributes string\n+            attributesString = attributesString.gsub(/([a-z0-9\\-\\_]+)=\"(.*?)(\\{\\{.+?\\}\\})(.*?)\"/i, function (m) {\n+                return m[1] + '=\"' + m[2] + this.makeDirectiveUrl(Base64.mageEncode(m[3])) + m[4] + '\"';\n+            }.bind(this));\n+\n+            return '<' + match[1] + attributesString + '>';\n+\n+        }.bind(this));\n+    },\n+\n+    encodeWidgets: function (content) {\n+        return content.gsub(/\\{\\{widget(.*?)\\}\\}/i, function (match) {\n+            var attributes = this.parseAttributesString(match[1]);\n+            if (attributes.type) {\n+                var placeholderFilename = attributes.type.replace(/\\//g, \"__\") + \".gif\";\n+                if (!this.widgetPlaceholderExist(placeholderFilename)) {\n+                    placeholderFilename = 'default.gif';\n+                }\n+                var imageSrc = this.config.widget_images_url + placeholderFilename;\n+                var imageHtml = '<img';\n+                imageHtml += ' id=\"' + Base64.idEncode(match[0]) + '\"';\n+                imageHtml += ' src=\"' + imageSrc + '\"';\n+                imageHtml += ' title=\"' + match[0].replace(/\\{\\{/g, '{').replace(/\\}\\}/g, '}').replace(/\\\"/g, '&quot;') + '\"';\n+                imageHtml += '>';\n+\n+                return imageHtml;\n+            }\n+        }.bind(this));\n+    },\n+\n+    decodeDirectives: function (content) {\n+        // escape special chars in directives url to use it in regular expression\n+        var url = this.makeDirectiveUrl('%directive%').replace(/([$^.?*!+:=()\\[\\]{}|\\\\])/g, '\\\\$1');\n+        var reg = new RegExp(url.replace('%directive%', '([a-zA-Z0-9,_-]+)'));\n+        return content.gsub(reg, function (match) {\n+            return Base64.mageDecode(match[1]);\n+        }.bind(this));\n+    },\n+\n+    decodeWidgets: function (content) {\n+        return content.gsub(/<img([^>]+id=\\\"[^>]+)>/i, function (match) {\n+            var attributes = this.parseAttributesString(match[1]);\n+            if (attributes.id) {\n+                var widgetCode = Base64.idDecode(attributes.id);\n+                if (widgetCode.indexOf('{{widget') != -1) {\n+                    return widgetCode;\n+                }\n+                return match[0];\n+            }\n+            return match[0];\n+        }.bind(this));\n+    },\n+\n+    parseAttributesString: function (attributes) {\n+        var result = {};\n+        attributes.gsub(/(\\w+)(?:\\s*=\\s*(?:(?:\"((?:\\\\.|[^\"])*)\")|(?:'((?:\\\\.|[^'])*)')|([^>\\s]+)))?/, function (match) {\n+            result[match[1]] = match[2];\n+        });\n+        return result;\n+    },\n+\n+    widgetPlaceholderExist: function (filename) {\n+        return this.config.widget_placeholders.indexOf(filename) != -1;\n+    },\n+\n+    getMediaBrowserCallback: function () {\n+        return this.mediaBrowserCallback;\n+    }\n+};"
        },
        {
            "filename": "js/prototype/prototype.js",
            "diff": "@@ -2173,7 +2173,9 @@ Ajax.PeriodicalUpdater = Class.create(Ajax.Base, {\n \n   function remove(element) {\n     element = $(element);\n-    element.parentNode.removeChild(element);\n+    if (element.parentNode) {\n+      element.parentNode.removeChild(element);\n+    }\n     return element;\n   }\n "
        },
        {
            "filename": "js/tiny_mce/classes/AddOnManager.js",
            "diff": "@@ -1,358 +0,0 @@\n-/**\n- * AddOnManager.js\n- *\n- * Copyright, Moxiecode Systems AB\n- * Released under LGPL License.\n- *\n- * License: http://www.tinymce.com/license\n- * Contributing: http://www.tinymce.com/contributing\n- */\n-\n-(function(tinymce) {\n-\tvar Dispatcher = tinymce.util.Dispatcher, each = tinymce.each;\n-\n-\t/**\n-\t * This class handles the loading of themes/plugins or other add-ons and their language packs.\n-\t *\n-\t * @class tinymce.AddOnManager\n-\t */\n-\ttinymce.create('tinymce.AddOnManager', {\n-\t\tAddOnManager : function() {\n-\t\t\tvar self = this;\n-\n-\t\t\tself.items = [];\n-\t\t\tself.urls = {};\n-\t\t\tself.lookup = {};\n-\t\t\tself.onAdd = new Dispatcher(self);\n-\t\t},\n-\n-\t\t/**\n-\t\t * Fires when a item is added.\n-\t\t *\n-\t\t * @event onAdd\n-\t\t */\n-\n-\t\t/**\n-\t\t * Returns the specified add on by the short name.\n-\t\t *\n-\t\t * @method get\n-\t\t * @param {String} n Add-on to look for.\n-\t\t * @return {tinymce.Theme/tinymce.Plugin} Theme or plugin add-on instance or undefined.\n-\t\t */\n-\t\tget : function(n) {\n-\t\t\tif (this.lookup[n]) {\n-\t\t\t\treturn this.lookup[n].instance;\n-\t\t\t} else {\n-\t\t\t\treturn undefined;\n-\t\t\t}\n-\t\t},\n-\n-\t\tdependencies : function(n) {\n-\t\t\tvar result;\n-\t\t\tif (this.lookup[n]) {\n-\t\t\t\tresult = this.lookup[n].dependencies;\n-\t\t\t}\n-\t\t\treturn result || [];\n-\t\t},\n-\n-\t\t/**\n-\t\t * Loads a language pack for the specified add-on.\n-\t\t *\n-\t\t * @method requireLangPack\n-\t\t * @param {String} n Short name of the add-on.\n-\t\t */\n-\t\trequireLangPack : function(n) {\n-\t\t\tvar s = tinymce.settings;\n-\n-\t\t\tif (s && s.language && s.language_load !== false)\n-\t\t\t\ttinymce.ScriptLoader.add(this.urls[n] + '/langs/' + s.language + '.js');\n-\t\t},\n-\n-\t\t/**\n-\t\t * Adds a instance of the add-on by it's short name.\n-\t\t *\n-\t\t * @method add\n-\t\t * @param {String} id Short name/id for the add-on.\n-\t\t * @param {tinymce.Theme/tinymce.Plugin} o Theme or plugin to add.\n-\t\t * @return {tinymce.Theme/tinymce.Plugin} The same theme or plugin instance that got passed in.\n-\t\t * @example\n-\t\t * // Create a simple plugin\n-\t\t * tinymce.create('tinymce.plugins.TestPlugin', {\n-\t\t *     TestPlugin : function(ed, url) {\n-\t\t *         ed.onClick.add(function(ed, e) {\n-\t\t *             ed.windowManager.alert('Hello World!');\n-\t\t *         });\n-\t\t *     }\n-\t\t * });\n-\t\t * \n-\t\t * // Register plugin using the add method\n-\t\t * tinymce.PluginManager.add('test', tinymce.plugins.TestPlugin);\n-\t\t * \n-\t\t * // Initialize TinyMCE\n-\t\t * tinyMCE.init({\n-\t\t *    ...\n-\t\t *    plugins : '-test' // Init the plugin but don't try to load it\n-\t\t * });\n-\t\t */\n-\t\tadd : function(id, o, dependencies) {\n-\t\t\tthis.items.push(o);\n-\t\t\tthis.lookup[id] = {instance:o, dependencies:dependencies};\n-\t\t\tthis.onAdd.dispatch(this, id, o);\n-\n-\t\t\treturn o;\n-\t\t},\n-\t\tcreateUrl: function(baseUrl, dep) {\n-\t\t\tif (typeof dep === \"object\") {\n-\t\t\t\treturn dep\n-\t\t\t} else {\n-\t\t\t\treturn {prefix: baseUrl.prefix, resource: dep, suffix: baseUrl.suffix};\n-\t\t\t}\n-\t\t},\n-\n-\t\t/**\n-\t\t * Add a set of components that will make up the add-on. Using the url of the add-on name as the base url.\n-\t\t * This should be used in development mode.  A new compressor/javascript munger process will ensure that the \n-\t\t * components are put together into the editor_plugin.js file and compressed correctly.\n-\t\t * @param pluginName {String} name of the plugin to load scripts from (will be used to get the base url for the plugins).\n-\t\t * @param scripts {Array} Array containing the names of the scripts to load.\n-\t\t */\n-\t\taddComponents: function(pluginName, scripts) {\n-\t\t\tvar pluginUrl = this.urls[pluginName];\n-\t\t\ttinymce.each(scripts, function(script){\n-\t\t\t\ttinymce.ScriptLoader.add(pluginUrl+\"/\"+script);\t\n-\t\t\t});\n-\t\t},\n-\n-\t\t/**\n-\t\t * Loads an add-on from a specific url.\n-\t\t *\n-\t\t * @method load\n-\t\t * @param {String} n Short name of the add-on that gets loaded.\n-\t\t * @param {String} u URL to the add-on that will get loaded.\n-\t\t * @param {function} cb Optional callback to execute ones the add-on is loaded.\n-\t\t * @param {Object} s Optional scope to execute the callback in.\n-\t\t * @example\n-\t\t * // Loads a plugin from an external URL\n-\t\t * tinymce.PluginManager.load('myplugin', '/some/dir/someplugin/editor_plugin.js');\n-\t\t *\n-\t\t * // Initialize TinyMCE\n-\t\t * tinyMCE.init({\n-\t\t *    ...\n-\t\t *    plugins : '-myplugin' // Don't try to load it again\n-\t\t * });\n-\t\t */\n-\t\tload : function(n, u, cb, s) {\n-\t\t\tvar t = this, url = u;\n-\n-\t\t\tfunction loadDependencies() {\n-\t\t\t\tvar dependencies = t.dependencies(n);\n-\t\t\t\ttinymce.each(dependencies, function(dep) {\n-\t\t\t\t\tvar newUrl = t.createUrl(u, dep);\n-\t\t\t\t\tt.load(newUrl.resource, newUrl, undefined, undefined);\n-\t\t\t\t});\n-\t\t\t\tif (cb) {\n-\t\t\t\t\tif (s) {\n-\t\t\t\t\t\tcb.call(s);\n-\t\t\t\t\t} else {\n-\t\t\t\t\t\tcb.call(tinymce.ScriptLoader);\n-\t\t\t\t\t}\n-\t\t\t\t}\n-\t\t\t}\n-\n-\t\t\tif (t.urls[n])\n-\t\t\t\treturn;\n-\t\t\tif (typeof u === \"object\")\n-\t\t\t\turl = u.prefix + u.resource + u.suffix;\n-\n-\t\t\tif (url.indexOf('/') !== 0 && url.indexOf('://') == -1)\n-\t\t\t\turl = tinymce.baseURL + '/' + url;\n-\n-\t\t\tt.urls[n] = url.substring(0, url.lastIndexOf('/'));\n-\n-\t\t\tif (t.lookup[n]) {\n-\t\t\t\tloadDependencies();\n-\t\t\t} else {\n-\t\t\t\ttinymce.ScriptLoader.add(url, loadDependencies, s);\n-\t\t\t}\n-\t\t}\n-\t});\n-\n-\t// Create plugin and theme managers\n-\ttinymce.PluginManager = new tinymce.AddOnManager();\n-\ttinymce.ThemeManager = new tinymce.AddOnManager();\n-}(tinymce));\n-\n-/**\n- * TinyMCE theme class.\n- *\n- * @class tinymce.Theme\n- */\n-\n-/**\n- * Initializes the theme.\n- *\n- * @method init\n- * @param {tinymce.Editor} editor Editor instance that created the theme instance.\n- * @param {String} url Absolute URL where the theme is located. \n- */\n-\n-/**\n- * Meta info method, this method gets executed when TinyMCE wants to present information about the theme for example in the about/help dialog.\n- *\n- * @method getInfo\n- * @return {Object} Returns an object with meta information about the theme the current items are longname, author, authorurl, infourl and version.\n- */\n-\n-/**\n- * This method is responsible for rendering/generating the overall user interface with toolbars, buttons, iframe containers etc.\n- *\n- * @method renderUI\n- * @param {Object} obj Object parameter containing the targetNode DOM node that will be replaced visually with an editor instance. \n- * @return {Object} an object with items like iframeContainer, editorContainer, sizeContainer, deltaWidth, deltaHeight. \n- */\n-\n-/**\n- * Plugin base class, this is a pseudo class that describes how a plugin is to be created for TinyMCE. The methods below are all optional.\n- *\n- * @class tinymce.Plugin\n- * @example\n- * // Create a new plugin class\n- * tinymce.create('tinymce.plugins.ExamplePlugin', {\n- *     init : function(ed, url) {\n- *         // Register an example button\n- *         ed.addButton('example', {\n- *             title : 'example.desc',\n- *             onclick : function() {\n- *                  // Display an alert when the user clicks the button\n- *                  ed.windowManager.alert('Hello world!');\n- *             },\n- *             'class' : 'bold' // Use the bold icon from the theme\n- *         });\n- *     }\n- * });\n- * \n- * // Register plugin with a short name\n- * tinymce.PluginManager.add('example', tinymce.plugins.ExamplePlugin);\n- * \n- * // Initialize TinyMCE with the new plugin and button\n- * tinyMCE.init({\n- *    ...\n- *    plugins : '-example', // - means TinyMCE will not try to load it\n- *    theme_advanced_buttons1 : 'example' // Add the new example button to the toolbar\n- * });\n- */\n-\n-/**\n- * Initialization function for the plugin. This will be called when the plugin is created. \n- *\n- * @method init\n- * @param {tinymce.Editor} editor Editor instance that created the plugin instance. \n- * @param {String} url Absolute URL where the plugin is located. \n- * @example\n- * // Creates a new plugin class\n- * tinymce.create('tinymce.plugins.ExamplePlugin', {\n- *     init : function(ed, url) {\n- *         // Register the command so that it can be invoked by using tinyMCE.activeEditor.execCommand('mceExample');\n- *         ed.addCommand('mceExample', function() {\n- *             ed.windowManager.open({\n- *                 file : url + '/dialog.htm',\n- *                 width : 320 + ed.getLang('example.delta_width', 0),\n- *                 height : 120 + ed.getLang('example.delta_height', 0),\n- *                 inline : 1\n- *             }, {\n- *                 plugin_url : url, // Plugin absolute URL\n- *                 some_custom_arg : 'custom arg' // Custom argument\n- *             });\n- *         });\n- * \n- *         // Register example button\n- *         ed.addButton('example', {\n- *             title : 'example.desc',\n- *             cmd : 'mceExample',\n- *             image : url + '/img/example.gif'\n- *         });\n- * \n- *         // Add a node change handler, selects the button in the UI when a image is selected\n- *         ed.onNodeChange.add(function(ed, cm, n) {\n- *             cm.setActive('example', n.nodeName == 'IMG');\n- *         });\n- *     }\n- * });\n- * \n- * // Register plugin\n- * tinymce.PluginManager.add('example', tinymce.plugins.ExamplePlugin);\n- */\n-\n-/**\n- * Meta info method, this method gets executed when TinyMCE wants to present information about the plugin for example in the about/help dialog.\n- *\n- * @method getInfo\n- * @return {Object} Returns an object with meta information about the plugin the current items are longname, author, authorurl, infourl and version.\n- * @example \n- * // Creates a new plugin class\n- * tinymce.create('tinymce.plugins.ExamplePlugin', {\n- *     // Meta info method\n- *     getInfo : function() {\n- *         return {\n- *             longname : 'Example plugin',\n- *             author : 'Some author',\n- *             authorurl : 'http://www.tinymce.com',\n- *             infourl : 'http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/example',\n- *             version : \"1.0\"\n- *         };\n- *     }\n- * });\n- * \n- * // Register plugin\n- * tinymce.PluginManager.add('example', tinymce.plugins.ExamplePlugin);\n- * \n- * // Initialize TinyMCE with the new plugin\n- * tinyMCE.init({\n- *    ...\n- *    plugins : '-example' // - means TinyMCE will not try to load it\n- * });\n- */\n-\n-/**\n- * Gets called when a new control instance is created.\n- *\n- * @method createControl\n- * @param {String} name Control name to create for example \"mylistbox\" \n- * @param {tinymce.ControlManager} controlman Control manager/factory to use to create the control. \n- * @return {tinymce.ui.Control} Returns a new control instance or null.\n- * @example \n- * // Creates a new plugin class\n- * tinymce.create('tinymce.plugins.ExamplePlugin', {\n- *     createControl: function(n, cm) {\n- *         switch (n) {\n- *             case 'mylistbox':\n- *                 var mlb = cm.createListBox('mylistbox', {\n- *                      title : 'My list box',\n- *                      onselect : function(v) {\n- *                          tinyMCE.activeEditor.windowManager.alert('Value selected:' + v);\n- *                      }\n- *                 });\n- * \n- *                 // Add some values to the list box\n- *                 mlb.add('Some item 1', 'val1');\n- *                 mlb.add('some item 2', 'val2');\n- *                 mlb.add('some item 3', 'val3');\n- * \n- *                 // Return the new listbox instance\n- *                 return mlb;\n- *         }\n- * \n- *         return null;\n- *     }\n- * });\n- * \n- * // Register plugin\n- * tinymce.PluginManager.add('example', tinymce.plugins.ExamplePlugin);\n- * \n- * // Initialize TinyMCE with the new plugin and button\n- * tinyMCE.init({\n- *    ...\n- *    plugins : '-example', // - means TinyMCE will not try to load it\n- *    theme_advanced_buttons1 : 'mylistbox' // Add the new mylistbox control to the toolbar\n- * });\n- */"
        },
        {
            "filename": "js/tiny_mce/classes/ControlManager.js",
            "diff": "@@ -1,538 +0,0 @@\n-/**\n- * ControlManager.js\n- *\n- * Copyright, Moxiecode Systems AB\n- * Released under LGPL License.\n- *\n- * License: http://www.tinymce.com/license\n- * Contributing: http://www.tinymce.com/contributing\n- */\n-\n-(function(tinymce) {\n-\t// Shorten names\n-\tvar DOM = tinymce.DOM, Event = tinymce.dom.Event, each = tinymce.each, extend = tinymce.extend;\n-\n-\t/**\n-\t * This class is responsible for managing UI control instances. It's both a factory and a collection for the controls.\n-\t * @class tinymce.ControlManager\n-\t */\n-\ttinymce.create('tinymce.ControlManager', {\n-\t\t/**\n-\t\t * Constructs a new control manager instance.\n-\t\t * Consult the Wiki for more details on this class.\n-\t\t *\n-\t\t * @constructor\n-\t\t * @method ControlManager\n-\t\t * @param {tinymce.Editor} ed TinyMCE editor instance to add the control to.\n-\t\t * @param {Object} s Optional settings object for the control manager.\n-\t\t */\n-\t\tControlManager : function(ed, s) {\n-\t\t\tvar t = this, i;\n-\n-\t\t\ts = s || {};\n-\t\t\tt.editor = ed;\n-\t\t\tt.controls = {};\n-\t\t\tt.onAdd = new tinymce.util.Dispatcher(t);\n-\t\t\tt.onPostRender = new tinymce.util.Dispatcher(t);\n-\t\t\tt.prefix = s.prefix || ed.id + '_';\n-\t\t\tt._cls = {};\n-\n-\t\t\tt.onPostRender.add(function() {\n-\t\t\t\teach(t.controls, function(c) {\n-\t\t\t\t\tc.postRender();\n-\t\t\t\t});\n-\t\t\t});\n-\t\t},\n-\n-\t\t/**\n-\t\t * Returns a control by id or undefined it it wasn't found.\n-\t\t *\n-\t\t * @method get\n-\t\t * @param {String} id Control instance name.\n-\t\t * @return {tinymce.ui.Control} Control instance or undefined.\n-\t\t */\n-\t\tget : function(id) {\n-\t\t\treturn this.controls[this.prefix + id] || this.controls[id];\n-\t\t},\n-\n-\t\t/**\n-\t\t * Sets the active state of a control by id.\n-\t\t *\n-\t\t * @method setActive\n-\t\t * @param {String} id Control id to set state on.\n-\t\t * @param {Boolean} s Active state true/false.\n-\t\t * @return {tinymce.ui.Control} Control instance that got activated or null if it wasn't found.\n-\t\t */\n-\t\tsetActive : function(id, s) {\n-\t\t\tvar c = null;\n-\n-\t\t\tif (c = this.get(id))\n-\t\t\t\tc.setActive(s);\n-\n-\t\t\treturn c;\n-\t\t},\n-\n-\t\t/**\n-\t\t * Sets the dsiabled state of a control by id.\n-\t\t *\n-\t\t * @method setDisabled\n-\t\t * @param {String} id Control id to set state on.\n-\t\t * @param {Boolean} s Active state true/false.\n-\t\t * @return {tinymce.ui.Control} Control instance that got disabled or null if it wasn't found.\n-\t\t */\n-\t\tsetDisabled : function(id, s) {\n-\t\t\tvar c = null;\n-\n-\t\t\tif (c = this.get(id))\n-\t\t\t\tc.setDisabled(s);\n-\n-\t\t\treturn c;\n-\t\t},\n-\n-\t\t/**\n-\t\t * Adds a control to the control collection inside the manager.\n-\t\t *\n-\t\t * @method add\n-\t\t * @param {tinymce.ui.Control} Control instance to add to collection.\n-\t\t * @return {tinymce.ui.Control} Control instance that got passed in.\n-\t\t */\n-\t\tadd : function(c) {\n-\t\t\tvar t = this;\n-\n-\t\t\tif (c) {\n-\t\t\t\tt.controls[c.id] = c;\n-\t\t\t\tt.onAdd.dispatch(c, t);\n-\t\t\t}\n-\n-\t\t\treturn c;\n-\t\t},\n-\n-\t\t/**\n-\t\t * Creates a control by name, when a control is created it will automatically add it to the control collection.\n-\t\t * It first ask all plugins for the specified control if the plugins didn't return a control then the default behavior\n-\t\t * will be used.\n-\t\t *\n-\t\t * @method createControl\n-\t\t * @param {String} name Control name to create for example \"separator\".\n-\t\t * @return {tinymce.ui.Control} Control instance that got created and added.\n-\t\t */\n-\t\tcreateControl : function(name) {\n-\t\t\tvar ctrl, i, l, self = this, editor = self.editor, factories, ctrlName;\n-\n-\t\t\t// Build control factory cache\n-\t\t\tif (!self.controlFactories) {\n-\t\t\t\tself.controlFactories = [];\n-\t\t\t\teach(editor.plugins, function(plugin) {\n-\t\t\t\t\tif (plugin.createControl) {\n-\t\t\t\t\t\tself.controlFactories.push(plugin);\n-\t\t\t\t\t}\n-\t\t\t\t});\n-\t\t\t}\n-\n-\t\t\t// Create controls by asking cached factories\n-\t\t\tfactories = self.controlFactories;\n-\t\t\tfor (i = 0, l = factories.length; i < l; i++) {\n-\t\t\t\tctrl = factories[i].createControl(name, self);\n-\n-\t\t\t\tif (ctrl) {\n-\t\t\t\t\treturn self.add(ctrl);\n-\t\t\t\t}\n-\t\t\t}\n-\n-\t\t\t// Create sepearator\n-\t\t\tif (name === \"|\" || name === \"separator\") {\n-\t\t\t\treturn self.createSeparator();\n-\t\t\t}\n-\n-\t\t\t// Create control from button collection\n-\t\t\tif (editor.buttons && (ctrl = editor.buttons[name])) {\n-\t\t\t\treturn self.createButton(name, ctrl);\n-\t\t\t}\n-\n-\t\t\treturn self.add(ctrl);\n-\t\t},\n-\n-\t\t/**\n-\t\t * Creates a drop menu control instance by id.\n-\t\t *\n-\t\t * @method createDropMenu\n-\t\t * @param {String} id Unique id for the new dropdown instance. For example \"some menu\".\n-\t\t * @param {Object} s Optional settings object for the control.\n-\t\t * @param {Object} cc Optional control class to use instead of the default one.\n-\t\t * @return {tinymce.ui.Control} Control instance that got created and added.\n-\t\t */\n-\t\tcreateDropMenu : function(id, s, cc) {\n-\t\t\tvar t = this, ed = t.editor, c, bm, v, cls;\n-\n-\t\t\ts = extend({\n-\t\t\t\t'class' : 'mceDropDown',\n-\t\t\t\tconstrain : ed.settings.constrain_menus\n-\t\t\t}, s);\n-\n-\t\t\ts['class'] = s['class'] + ' ' + ed.getParam('skin') + 'Skin';\n-\t\t\tif (v = ed.getParam('skin_variant'))\n-\t\t\t\ts['class'] += ' ' + ed.getParam('skin') + 'Skin' + v.substring(0, 1).toUpperCase() + v.substring(1);\n-\n-\t\t\ts['class'] += ed.settings.directionality == \"rtl\" ? ' mceRtl' : '';\n-\n-\t\t\tid = t.prefix + id;\n-\t\t\tcls = cc || t._cls.dropmenu || tinymce.ui.DropMenu;\n-\t\t\tc = t.controls[id] = new cls(id, s);\n-\t\t\tc.onAddItem.add(function(c, o) {\n-\t\t\t\tvar s = o.settings;\n-\n-\t\t\t\ts.title = ed.getLang(s.title, s.title);\n-\n-\t\t\t\tif (!s.onclick) {\n-\t\t\t\t\ts.onclick = function(v) {\n-\t\t\t\t\t\tif (s.cmd)\n-\t\t\t\t\t\t\ted.execCommand(s.cmd, s.ui || false, s.value);\n-\t\t\t\t\t};\n-\t\t\t\t}\n-\t\t\t});\n-\n-\t\t\ted.onRemove.add(function() {\n-\t\t\t\tc.destroy();\n-\t\t\t});\n-\n-\t\t\t// Fix for bug #1897785, #1898007\n-\t\t\tif (tinymce.isIE) {\n-\t\t\t\tc.onShowMenu.add(function() {\n-\t\t\t\t\t// IE 8 needs focus in order to store away a range with the current collapsed caret location\n-\t\t\t\t\ted.focus();\n-\n-\t\t\t\t\tbm = ed.selection.getBookmark(1);\n-\t\t\t\t});\n-\n-\t\t\t\tc.onHideMenu.add(function() {\n-\t\t\t\t\tif (bm) {\n-\t\t\t\t\t\ted.selection.moveToBookmark(bm);\n-\t\t\t\t\t\tbm = 0;\n-\t\t\t\t\t}\n-\t\t\t\t});\n-\t\t\t}\n-\n-\t\t\treturn t.add(c);\n-\t\t},\n-\n-\t\t/**\n-\t\t * Creates a list box control instance by id. A list box is either a native select element or a DOM/JS based list box control. This\n-\t\t * depends on the use_native_selects settings state.\n-\t\t *\n-\t\t * @method createListBox\n-\t\t * @param {String} id Unique id for the new listbox instance. For example \"styles\".\n-\t\t * @param {Object} s Optional settings object for the control.\n-\t\t * @param {Object} cc Optional control class to use instead of the default one.\n-\t\t * @return {tinymce.ui.Control} Control instance that got created and added.\n-\t\t */\n-\t\tcreateListBox : function(id, s, cc) {\n-\t\t\tvar t = this, ed = t.editor, cmd, c, cls;\n-\n-\t\t\tif (t.get(id))\n-\t\t\t\treturn null;\n-\n-\t\t\ts.title = ed.translate(s.title);\n-\t\t\ts.scope = s.scope || ed;\n-\n-\t\t\tif (!s.onselect) {\n-\t\t\t\ts.onselect = function(v) {\n-\t\t\t\t\ted.execCommand(s.cmd, s.ui || false, v || s.value);\n-\t\t\t\t};\n-\t\t\t}\n-\n-\t\t\ts = extend({\n-\t\t\t\ttitle : s.title,\n-\t\t\t\t'class' : 'mce_' + id,\n-\t\t\t\tscope : s.scope,\n-\t\t\t\tcontrol_manager : t\n-\t\t\t}, s);\n-\n-\t\t\tid = t.prefix + id;\n-\n-\n-\t\t\tfunction useNativeListForAccessibility(ed) {\n-\t\t\t\treturn ed.settings.use_accessible_selects && !tinymce.isGecko\n-\t\t\t}\n-\n-\t\t\tif (ed.settings.use_native_selects || useNativeListForAccessibility(ed))\n-\t\t\t\tc = new tinymce.ui.NativeListBox(id, s);\n-\t\t\telse {\n-\t\t\t\tcls = cc || t._cls.listbox || tinymce.ui.ListBox;\n-\t\t\t\tc = new cls(id, s, ed);\n-\t\t\t}\n-\n-\t\t\tt.controls[id] = c;\n-\n-\t\t\t// Fix focus problem in Safari\n-\t\t\tif (tinymce.isWebKit) {\n-\t\t\t\tc.onPostRender.add(function(c, n) {\n-\t\t\t\t\t// Store bookmark on mousedown\n-\t\t\t\t\tEvent.add(n, 'mousedown', function() {\n-\t\t\t\t\t\ted.bookmark = ed.selection.getBookmark(1);\n-\t\t\t\t\t});\n-\n-\t\t\t\t\t// Restore on focus, since it might be lost\n-\t\t\t\t\tEvent.add(n, 'focus', function() {\n-\t\t\t\t\t\ted.selection.moveToBookmark(ed.bookmark);\n-\t\t\t\t\t\ted.bookmark = null;\n-\t\t\t\t\t});\n-\t\t\t\t});\n-\t\t\t}\n-\n-\t\t\tif (c.hideMenu)\n-\t\t\t\ted.onMouseDown.add(c.hideMenu, c);\n-\n-\t\t\treturn t.add(c);\n-\t\t},\n-\n-\t\t/**\n-\t\t * Creates a button control instance by id.\n-\t\t *\n-\t\t * @method createButton\n-\t\t * @param {String} id Unique id for the new button instance. For example \"bold\".\n-\t\t * @param {Object} s Optional settings object for the control.\n-\t\t * @param {Object} cc Optional control class to use instead of the default one.\n-\t\t * @return {tinymce.ui.Control} Control instance that got created and added.\n-\t\t */\n-\t\tcreateButton : function(id, s, cc) {\n-\t\t\tvar t = this, ed = t.editor, o, c, cls;\n-\n-\t\t\tif (t.get(id))\n-\t\t\t\treturn null;\n-\n-\t\t\ts.title = ed.translate(s.title);\n-\t\t\ts.label = ed.translate(s.label);\n-\t\t\ts.scope = s.scope || ed;\n-\n-\t\t\tif (!s.onclick && !s.menu_button) {\n-\t\t\t\ts.onclick = function() {\n-\t\t\t\t\ted.execCommand(s.cmd, s.ui || false, s.value);\n-\t\t\t\t};\n-\t\t\t}\n-\n-\t\t\ts = extend({\n-\t\t\t\ttitle : s.title,\n-\t\t\t\t'class' : 'mce_' + id,\n-\t\t\t\tunavailable_prefix : ed.getLang('unavailable', ''),\n-\t\t\t\tscope : s.scope,\n-\t\t\t\tcontrol_manager : t\n-\t\t\t}, s);\n-\n-\t\t\tid = t.prefix + id;\n-\n-\t\t\tif (s.menu_button) {\n-\t\t\t\tcls = cc || t._cls.menubutton || tinymce.ui.MenuButton;\n-\t\t\t\tc = new cls(id, s, ed);\n-\t\t\t\ted.onMouseDown.add(c.hideMenu, c);\n-\t\t\t} else {\n-\t\t\t\tcls = t._cls.button || tinymce.ui.Button;\n-\t\t\t\tc = new cls(id, s, ed);\n-\t\t\t}\n-\n-\t\t\treturn t.add(c);\n-\t\t},\n-\n-\t\t/**\n-\t\t * Creates a menu button control instance by id.\n-\t\t *\n-\t\t * @method createMenuButton\n-\t\t * @param {String} id Unique id for the new menu button instance. For example \"menu1\".\n-\t\t * @param {Object} s Optional settings object for the control.\n-\t\t * @param {Object} cc Optional control class to use instead of the default one.\n-\t\t * @return {tinymce.ui.Control} Control instance that got created and added.\n-\t\t */\n-\t\tcreateMenuButton : function(id, s, cc) {\n-\t\t\ts = s || {};\n-\t\t\ts.menu_button = 1;\n-\n-\t\t\treturn this.createButton(id, s, cc);\n-\t\t},\n-\n-\t\t/**\n-\t\t * Creates a split button control instance by id.\n-\t\t *\n-\t\t * @method createSplitButton\n-\t\t * @param {String} id Unique id for the new split button instance. For example \"spellchecker\".\n-\t\t * @param {Object} s Optional settings object for the control.\n-\t\t * @param {Object} cc Optional control class to use instead of the default one.\n-\t\t * @return {tinymce.ui.Control} Control instance that got created and added.\n-\t\t */\n-\t\tcreateSplitButton : function(id, s, cc) {\n-\t\t\tvar t = this, ed = t.editor, cmd, c, cls;\n-\n-\t\t\tif (t.get(id))\n-\t\t\t\treturn null;\n-\n-\t\t\ts.title = ed.translate(s.title);\n-\t\t\ts.scope = s.scope || ed;\n-\n-\t\t\tif (!s.onclick) {\n-\t\t\t\ts.onclick = function(v) {\n-\t\t\t\t\ted.execCommand(s.cmd, s.ui || false, v || s.value);\n-\t\t\t\t};\n-\t\t\t}\n-\n-\t\t\tif (!s.onselect) {\n-\t\t\t\ts.onselect = function(v) {\n-\t\t\t\t\ted.execCommand(s.cmd, s.ui || false, v || s.value);\n-\t\t\t\t};\n-\t\t\t}\n-\n-\t\t\ts = extend({\n-\t\t\t\ttitle : s.title,\n-\t\t\t\t'class' : 'mce_' + id,\n-\t\t\t\tscope : s.scope,\n-\t\t\t\tcontrol_manager : t\n-\t\t\t}, s);\n-\n-\t\t\tid = t.prefix + id;\n-\t\t\tcls = cc || t._cls.splitbutton || tinymce.ui.SplitButton;\n-\t\t\tc = t.add(new cls(id, s, ed));\n-\t\t\ted.onMouseDown.add(c.hideMenu, c);\n-\n-\t\t\treturn c;\n-\t\t},\n-\n-\t\t/**\n-\t\t * Creates a color split button control instance by id.\n-\t\t *\n-\t\t * @method createColorSplitButton\n-\t\t * @param {String} id Unique id for the new color split button instance. For example \"forecolor\".\n-\t\t * @param {Object} s Optional settings object for the control.\n-\t\t * @param {Object} cc Optional control class to use instead of the default one.\n-\t\t * @return {tinymce.ui.Control} Control instance that got created and added.\n-\t\t */\n-\t\tcreateColorSplitButton : function(id, s, cc) {\n-\t\t\tvar t = this, ed = t.editor, cmd, c, cls, bm;\n-\n-\t\t\tif (t.get(id))\n-\t\t\t\treturn null;\n-\n-\t\t\ts.title = ed.translate(s.title);\n-\t\t\ts.scope = s.scope || ed;\n-\n-\t\t\tif (!s.onclick) {\n-\t\t\t\ts.onclick = function(v) {\n-\t\t\t\t\tif (tinymce.isIE)\n-\t\t\t\t\t\tbm = ed.selection.getBookmark(1);\n-\n-\t\t\t\t\ted.execCommand(s.cmd, s.ui || false, v || s.value);\n-\t\t\t\t};\n-\t\t\t}\n-\n-\t\t\tif (!s.onselect) {\n-\t\t\t\ts.onselect = function(v) {\n-\t\t\t\t\ted.execCommand(s.cmd, s.ui || false, v || s.value);\n-\t\t\t\t};\n-\t\t\t}\n-\n-\t\t\ts = extend({\n-\t\t\t\ttitle : s.title,\n-\t\t\t\t'class' : 'mce_' + id,\n-\t\t\t\t'menu_class' : ed.getParam('skin') + 'Skin',\n-\t\t\t\tscope : s.scope,\n-\t\t\t\tmore_colors_title : ed.getLang('more_colors')\n-\t\t\t}, s);\n-\n-\t\t\tid = t.prefix + id;\n-\t\t\tcls = cc || t._cls.colorsplitbutton || tinymce.ui.ColorSplitButton;\n-\t\t\tc = new cls(id, s, ed);\n-\t\t\ted.onMouseDown.add(c.hideMenu, c);\n-\n-\t\t\t// Remove the menu element when the editor is removed\n-\t\t\ted.onRemove.add(function() {\n-\t\t\t\tc.destroy();\n-\t\t\t});\n-\n-\t\t\t// Fix for bug #1897785, #1898007\n-\t\t\tif (tinymce.isIE) {\n-\t\t\t\tc.onShowMenu.add(function() {\n-\t\t\t\t\t// IE 8 needs focus in order to store away a range with the current collapsed caret location\n-\t\t\t\t\ted.focus();\n-\t\t\t\t\tbm = ed.selection.getBookmark(1);\n-\t\t\t\t});\n-\n-\t\t\t\tc.onHideMenu.add(function() {\n-\t\t\t\t\tif (bm) {\n-\t\t\t\t\t\ted.selection.moveToBookmark(bm);\n-\t\t\t\t\t\tbm = 0;\n-\t\t\t\t\t}\n-\t\t\t\t});\n-\t\t\t}\n-\n-\t\t\treturn t.add(c);\n-\t\t},\n-\n-\t\t/**\n-\t\t * Creates a toolbar container control instance by id.\n-\t\t *\n-\t\t * @method createToolbar\n-\t\t * @param {String} id Unique id for the new toolbar container control instance. For example \"toolbar1\".\n-\t\t * @param {Object} s Optional settings object for the control.\n-\t\t * @param {Object} cc Optional control class to use instead of the default one.\n-\t\t * @return {tinymce.ui.Control} Control instance that got created and added.\n-\t\t */\n-\t\tcreateToolbar : function(id, s, cc) {\n-\t\t\tvar c, t = this, cls;\n-\n-\t\t\tid = t.prefix + id;\n-\t\t\tcls = cc || t._cls.toolbar || tinymce.ui.Toolbar;\n-\t\t\tc = new cls(id, s, t.editor);\n-\n-\t\t\tif (t.get(id))\n-\t\t\t\treturn null;\n-\n-\t\t\treturn t.add(c);\n-\t\t},\n-\t\t\n-\t\tcreateToolbarGroup : function(id, s, cc) {\n-\t\t\tvar c, t = this, cls;\n-\t\t\tid = t.prefix + id;\n-\t\t\tcls = cc || this._cls.toolbarGroup || tinymce.ui.ToolbarGroup;\n-\t\t\tc = new cls(id, s, t.editor);\n-\t\t\t\n-\t\t\tif (t.get(id))\n-\t\t\t\treturn null;\n-\t\t\t\n-\t\t\treturn t.add(c);\n-\t\t},\n-\n-\t\t/**\n-\t\t * Creates a separator control instance.\n-\t\t *\n-\t\t * @method createSeparator\n-\t\t * @param {Object} cc Optional control class to use instead of the default one.\n-\t\t * @return {tinymce.ui.Control} Control instance that got created and added.\n-\t\t */\n-\t\tcreateSeparator : function(cc) {\n-\t\t\tvar cls = cc || this._cls.separator || tinymce.ui.Separator;\n-\n-\t\t\treturn new cls();\n-\t\t},\n-\n-\t\t/**\n-\t\t * Overrides a specific control type with a custom class.\n-\t\t *\n-\t\t * @method setControlType\n-\t\t * @param {string} n Name of the control to override for example button or dropmenu.\n-\t\t * @param {function} c Class reference to use instead of the default one.\n-\t\t * @return {function} Same as the class reference.\n-\t\t */\n-\t\tsetControlType : function(n, c) {\n-\t\t\treturn this._cls[n.toLowerCase()] = c;\n-\t\t},\n-\t\n-\t\t/**\n-\t\t * Destroy.\n-\t\t *\n-\t\t * @method destroy\n-\t\t */\n-\t\tdestroy : function() {\n-\t\t\teach(this.controls, function(c) {\n-\t\t\t\tc.destroy();\n-\t\t\t});\n-\n-\t\t\tthis.controls = null;\n-\t\t}\n-\t});\n-})(tinymce);"
        },
        {
            "filename": "js/tiny_mce/classes/Editor.Events.js",
            "diff": "@@ -1,932 +0,0 @@\n-/**\n- * Editor.Events.js\n- *\n- * Copyright, Moxiecode Systems AB\n- * Released under LGPL License.\n- *\n- * License: http://www.tinymce.com/license\n- * Contributing: http://www.tinymce.com/contributing\n- */\n-\n-(function(tinymce) {\n-\tvar each = tinymce.each;\n-\n-\t/**\n-\t * Creates all event dispatcher instances for the editor instance and also adds\n-\t * passthoughs for legacy callback handlers.\n-\t */\n-\ttinymce.Editor.prototype.setupEvents = function() {\n-\t\tvar self = this, settings = self.settings;\n-\n-\t\t// Add events to the editor\n-\t\teach([\n-\t\t\t/**\n-\t\t\t * Fires before the initialization of the editor.\n-\t\t\t *\n-\t\t\t * @event onPreInit\n-\t\t\t * @param {tinymce.Editor} sender Editor instance.\n-\t\t\t * @see #onInit\n-\t\t\t * @example\n-\t\t\t * // Adds an observer to the onPreInit event using tinyMCE.init\n-\t\t\t * tinyMCE.init({\n-\t\t\t *    ...\n-\t\t\t *    setup : function(ed) {\n-\t\t\t *       ed.onPreInit.add(function(ed) {\n-\t\t\t *           console.debug('PreInit: ' + ed.id);\n-\t\t\t *       });\n-\t\t\t *    }\n-\t\t\t * });\n-\t\t\t */\n-\t\t\t'onPreInit',\n-\n-\t\t\t/**\n-\t\t\t * Fires before the initialization of the editor.\n-\t\t\t *\n-\t\t\t * @event onBeforeRenderUI\n-\t\t\t * @param {tinymce.Editor} sender Editor instance.\n-\t\t\t * @example\n-\t\t\t * // Adds an observer to the onBeforeRenderUI event using tinyMCE.init\n-\t\t\t * tinyMCE.init({\n-\t\t\t *    ...\n-\t\t\t *    setup : function(ed) {\n-\t\t\t *      ed.onBeforeRenderUI.add(function(ed, cm) {\n-\t\t\t *          console.debug('Before render: ' + ed.id);\n-\t\t\t *      });\n-\t\t\t *    }\n-\t\t\t * });\n-\t\t\t */\n-\t\t\t'onBeforeRenderUI',\n-\n-\t\t\t/**\n-\t\t\t * Fires after the rendering has completed.\n-\t\t\t *\n-\t\t\t * @event onPostRender\n-\t\t\t * @param {tinymce.Editor} sender Editor instance.\n-\t\t\t * @example\n-\t\t\t * // Adds an observer to the onPostRender event using tinyMCE.init\n-\t\t\t * tinyMCE.init({\n-\t\t\t *    ...\n-\t\t\t *    setup : function(ed) {\n-\t\t\t *       ed.onPostRender.add(function(ed, cm) {\n-\t\t\t *           console.debug('After render: ' + ed.id);\n-\t\t\t *       });\n-\t\t\t *    }\n-\t\t\t * });\n-\t\t\t */\n-\t\t\t'onPostRender',\n-\n-\t\t\t/**\n-\t\t\t * Fires when the onload event on the body occurs.\n-\t\t\t *\n-\t\t\t * @event onLoad\n-\t\t\t * @param {tinymce.Editor} sender Editor instance.\n-\t\t\t * @example\n-\t\t\t * // Adds an observer to the onLoad event using tinyMCE.init\n-\t\t\t * tinyMCE.init({\n-\t\t\t *    ...\n-\t\t\t *    setup : function(ed) {\n-\t\t\t *       ed.onLoad.add(function(ed, cm) {\n-\t\t\t *           console.debug('Document loaded: ' + ed.id);\n-\t\t\t *       });\n-\t\t\t *    }\n-\t\t\t * });\n-\t\t\t */\n-\t\t\t'onLoad',\n-\n-\t\t\t/**\n-\t\t\t * Fires after the initialization of the editor is done.\n-\t\t\t *\n-\t\t\t * @event onInit\n-\t\t\t * @param {tinymce.Editor} sender Editor instance.\n-\t\t\t * @see #onPreInit\n-\t\t\t * @example\n-\t\t\t * // Adds an observer to the onInit event using tinyMCE.init\n-\t\t\t * tinyMCE.init({\n-\t\t\t *    ...\n-\t\t\t *    setup : function(ed) {\n-\t\t\t *       ed.onInit.add(function(ed) {\n-\t\t\t *           console.debug('Editor is done: ' + ed.id);\n-\t\t\t *       });\n-\t\t\t *    }\n-\t\t\t * });\n-\t\t\t */\n-\t\t\t'onInit',\n-\n-\t\t\t/**\n-\t\t\t * Fires when the editor instance is removed from page.\n-\t\t\t *\n-\t\t\t * @event onRemove\n-\t\t\t * @param {tinymce.Editor} sender Editor instance.\n-\t\t\t * @example\n-\t\t\t * // Adds an observer to the onRemove event using tinyMCE.init\n-\t\t\t * tinyMCE.init({\n-\t\t\t *    ...\n-\t\t\t *    setup : function(ed) {\n-\t\t\t *       ed.onRemove.add(function(ed) {\n-\t\t\t *           console.debug('Editor was removed: ' + ed.id);\n-\t\t\t *       });\n-\t\t\t *    }\n-\t\t\t * });\n-\t\t\t */\n-\t\t\t'onRemove',\n-\n-\t\t\t/**\n-\t\t\t * Fires when the editor is activated.\n-\t\t\t *\n-\t\t\t * @event onActivate\n-\t\t\t * @param {tinymce.Editor} sender Editor instance.\n-\t\t\t * @example\n-\t\t\t * // Adds an observer to the onActivate event using tinyMCE.init\n-\t\t\t * tinyMCE.init({\n-\t\t\t *    ...\n-\t\t\t *    setup : function(ed) {\n-\t\t\t *       ed.onActivate.add(function(ed) {\n-\t\t\t *           console.debug('Editor was activated: ' + ed.id);\n-\t\t\t *       });\n-\t\t\t *    }\n-\t\t\t * });\n-\t\t\t */\n-\t\t\t'onActivate',\n-\n-\t\t\t/**\n-\t\t\t * Fires when the editor is deactivated.\n-\t\t\t *\n-\t\t\t * @event onDeactivate\n-\t\t\t * @param {tinymce.Editor} sender Editor instance.\n-\t\t\t * @example\n-\t\t\t * // Adds an observer to the onDeactivate event using tinyMCE.init\n-\t\t\t * tinyMCE.init({\n-\t\t\t *    ...\n-\t\t\t *    setup : function(ed) {\n-\t\t\t *       ed.onDeactivate.add(function(ed) {\n-\t\t\t *           console.debug('Editor was deactivated: ' + ed.id);\n-\t\t\t *       });\n-\t\t\t *    }\n-\t\t\t * });\n-\t\t\t */\n-\t\t\t'onDeactivate',\n-\n-\t\t\t/**\n-\t\t\t * Fires when something in the body of the editor is clicked.\n-\t\t\t *\n-\t\t\t * @event onClick\n-\t\t\t * @param {tinymce.Editor} sender Editor instance.\n-\t\t\t * @param {Event} evt W3C DOM Event instance.\n-\t\t\t * @example\n-\t\t\t * // Adds an observer to the onClick event using tinyMCE.init\n-\t\t\t * tinyMCE.init({\n-\t\t\t *    ...\n-\t\t\t *    setup : function(ed) {\n-\t\t\t *       ed.onClick.add(function(ed, e) {\n-\t\t\t *           console.debug('Editor was clicked: ' + e.target.nodeName);\n-\t\t\t *       });\n-\t\t\t *    }\n-\t\t\t * });\n-\t\t\t */\n-\t\t\t'onClick',\n-\n-\t\t\t/**\n-\t\t\t * Fires when a registered event is intercepted.\n-\t\t\t *\n-\t\t\t * @event onEvent\n-\t\t\t * @param {tinymce.Editor} sender Editor instance.\n-\t\t\t * @param {Event} evt W3C DOM Event instance.\n-\t\t\t * @example\n-\t\t\t * // Adds an observer to the onEvent event using tinyMCE.init\n-\t\t\t * tinyMCE.init({\n-\t\t\t *    ...\n-\t\t\t *    setup : function(ed) {\n-\t\t\t *       ed.onEvent.add(function(ed, e) {\n-\t\t\t *          console.debug('Editor event occurred: ' + e.target.nodeName);\n-\t\t\t *       });\n-\t\t\t *    }\n-\t\t\t * });\n-\t\t\t */\n-\t\t\t'onEvent',\n-\n-\t\t\t/**\n-\t\t\t * Fires when a mouseup event is intercepted inside the editor.\n-\t\t\t *\n-\t\t\t * @event onMouseUp\n-\t\t\t * @param {tinymce.Editor} sender Editor instance.\n-\t\t\t * @param {Event} evt W3C DOM Event instance.\n-\t\t\t * @example\n-\t\t\t * // Adds an observer to the onMouseUp event using tinyMCE.init\n-\t\t\t * tinyMCE.init({\n-\t\t\t *    ...\n-\t\t\t *    setup : function(ed) {\n-\t\t\t *       ed.onMouseUp.add(function(ed, e) {\n-\t\t\t *           console.debug('Mouse up event: ' + e.target.nodeName);\n-\t\t\t *       });\n-\t\t\t *    }\n-\t\t\t * });\n-\t\t\t */\n-\t\t\t'onMouseUp',\n-\n-\t\t\t/**\n-\t\t\t * Fires when a mousedown event is intercepted inside the editor.\n-\t\t\t *\n-\t\t\t * @event onMouseDown\n-\t\t\t * @param {tinymce.Editor} sender Editor instance.\n-\t\t\t * @param {Event} evt W3C DOM Event instance.\n-\t\t\t * @example\n-\t\t\t * // Adds an observer to the onMouseDown event using tinyMCE.init\n-\t\t\t * tinyMCE.init({\n-\t\t\t *    ...\n-\t\t\t *    setup : function(ed) {\n-\t\t\t *       ed.onMouseDown.add(function(ed, e) {\n-\t\t\t *           console.debug('Mouse down event: ' + e.target.nodeName);\n-\t\t\t *       });\n-\t\t\t *    }\n-\t\t\t * });\n-\t\t\t */\n-\t\t\t'onMouseDown',\n-\n-\t\t\t/**\n-\t\t\t * Fires when a dblclick event is intercepted inside the editor.\n-\t\t\t *\n-\t\t\t * @event onDblClick\n-\t\t\t * @param {tinymce.Editor} sender Editor instance.\n-\t\t\t * @param {Event} evt W3C DOM Event instance.\n-\t\t\t * @example\n-\t\t\t * // Adds an observer to the onDblClick event using tinyMCE.init\n-\t\t\t * tinyMCE.init({\n-\t\t\t *    ...\n-\t\t\t *    setup : function(ed) {\n-\t\t\t *       ed.onDblClick.add(function(ed, e) {\n-\t\t\t *          console.debug('Double click event: ' + e.target.nodeName);\n-\t\t\t *       });\n-\t\t\t *    }\n-\t\t\t * });\n-\t\t\t */\n-\t\t\t'onDblClick',\n-\n-\t\t\t/**\n-\t\t\t * Fires when a keydown event is intercepted inside the editor.\n-\t\t\t *\n-\t\t\t * @event onKeyDown\n-\t\t\t * @param {tinymce.Editor} sender Editor instance.\n-\t\t\t * @param {Event} evt W3C DOM Event instance.\n-\t\t\t * @example\n-\t\t\t * // Adds an observer to the onKeyDown event using tinyMCE.init\n-\t\t\t * tinyMCE.init({\n-\t\t\t *    ...\n-\t\t\t *    setup : function(ed) {\n-\t\t\t *       ed.onKeyDown.add(function(ed, e) {\n-\t\t\t *           console.debug('Key down event: ' + e.keyCode);\n-\t\t\t *       });\n-\t\t\t *    }\n-\t\t\t * });\n-\t\t\t */\n-\t\t\t'onKeyDown',\n-\n-\t\t\t/**\n-\t\t\t * Fires when a keydown event is intercepted inside the editor.\n-\t\t\t *\n-\t\t\t * @event onKeyUp\n-\t\t\t * @param {tinymce.Editor} sender Editor instance.\n-\t\t\t * @param {Event} evt W3C DOM Event instance.\n-\t\t\t * @example\n-\t\t\t * // Adds an observer to the onKeyUp event using tinyMCE.init\n-\t\t\t * tinyMCE.init({\n-\t\t\t *    ...\n-\t\t\t *    setup : function(ed) {\n-\t\t\t *       ed.onKeyUp.add(function(ed, e) {\n-\t\t\t *           console.debug('Key up event: ' + e.keyCode);\n-\t\t\t *       });\n-\t\t\t *    }\n-\t\t\t * });\n-\t\t\t */\n-\t\t\t'onKeyUp',\n-\n-\t\t\t/**\n-\t\t\t * Fires when a keypress event is intercepted inside the editor.\n-\t\t\t *\n-\t\t\t * @event onKeyPress\n-\t\t\t * @param {tinymce.Editor} sender Editor instance.\n-\t\t\t * @param {Event} evt W3C DOM Event instance.\n-\t\t\t * @example\n-\t\t\t * // Adds an observer to the onKeyPress event using tinyMCE.init\n-\t\t\t * tinyMCE.init({\n-\t\t\t *    ...\n-\t\t\t *    setup : function(ed) {\n-\t\t\t *       ed.onKeyPress.add(function(ed, e) {\n-\t\t\t *           console.debug('Key press event: ' + e.keyCode);\n-\t\t\t *       });\n-\t\t\t *    }\n-\t\t\t * });\n-\t\t\t */\n-\t\t\t'onKeyPress',\n-\n-\t\t\t/**\n-\t\t\t * Fires when a contextmenu event is intercepted inside the editor.\n-\t\t\t *\n-\t\t\t * @event onContextMenu\n-\t\t\t * @param {tinymce.Editor} sender Editor instance.\n-\t\t\t * @param {Event} evt W3C DOM Event instance.\n-\t\t\t * @example\n-\t\t\t * // Adds an observer to the onContextMenu event using tinyMCE.init\n-\t\t\t * tinyMCE.init({\n-\t\t\t *    ...\n-\t\t\t *    setup : function(ed) {\n-\t\t\t *       ed.onContextMenu.add(function(ed, e) {\n-\t\t\t *            console.debug('Context menu event:' + e.target);\n-\t\t\t *       });\n-\t\t\t *    }\n-\t\t\t * });\n-\t\t\t */\n-\t\t\t'onContextMenu',\n-\n-\t\t\t/**\n-\t\t\t * Fires when a form submit event is intercepted.\n-\t\t\t *\n-\t\t\t * @event onSubmit\n-\t\t\t * @param {tinymce.Editor} sender Editor instance.\n-\t\t\t * @param {Event} evt W3C DOM Event instance.\n-\t\t\t * @example\n-\t\t\t * // Adds an observer to the onSubmit event using tinyMCE.init\n-\t\t\t * tinyMCE.init({\n-\t\t\t *    ...\n-\t\t\t *    setup : function(ed) {\n-\t\t\t *       ed.onSubmit.add(function(ed, e) {\n-\t\t\t *            console.debug('Form submit:' + e.target);\n-\t\t\t *       });\n-\t\t\t *    }\n-\t\t\t * });\n-\t\t\t */\n-\t\t\t'onSubmit',\n-\n-\t\t\t/**\n-\t\t\t * Fires when a form reset event is intercepted.\n-\t\t\t *\n-\t\t\t * @event onReset\n-\t\t\t * @param {tinymce.Editor} sender Editor instance.\n-\t\t\t * @param {Event} evt W3C DOM Event instance.\n-\t\t\t * @example\n-\t\t\t * // Adds an observer to the onReset event using tinyMCE.init\n-\t\t\t * tinyMCE.init({\n-\t\t\t *    ...\n-\t\t\t *    setup : function(ed) {\n-\t\t\t *       ed.onReset.add(function(ed, e) {\n-\t\t\t *            console.debug('Form reset:' + e.target);\n-\t\t\t *       });\n-\t\t\t *    }\n-\t\t\t * });\n-\t\t\t */\n-\t\t\t'onReset',\n-\n-\t\t\t/**\n-\t\t\t * Fires when a paste event is intercepted inside the editor.\n-\t\t\t *\n-\t\t\t * @event onPaste\n-\t\t\t * @param {tinymce.Editor} sender Editor instance.\n-\t\t\t * @param {Event} evt W3C DOM Event instance.\n-\t\t\t * @example\n-\t\t\t * // Adds an observer to the onPaste event using tinyMCE.init\n-\t\t\t * tinyMCE.init({\n-\t\t\t *    ...\n-\t\t\t *    setup : function(ed) {\n-\t\t\t *       ed.onPaste.add(function(ed, e) {\n-\t\t\t *            console.debug('Pasted plain text');\n-\t\t\t *       });\n-\t\t\t *    }\n-\t\t\t * });\n-\t\t\t */\n-\t\t\t'onPaste',\n-\n-\t\t\t/**\n-\t\t\t * Fires when the Serializer does a preProcess on the contents.\n-\t\t\t *\n-\t\t\t * @event onPreProcess\n-\t\t\t * @param {tinymce.Editor} sender Editor instance.\n-\t\t\t * @param {Object} obj PreProcess object.\n-\t\t\t * @option {Node} node DOM node for the item being serialized.\n-\t\t\t * @option {String} format The specified output format normally \"html\".\n-\t\t\t * @option {Boolean} get Is true if the process is on a getContent operation.\n-\t\t\t * @option {Boolean} set Is true if the process is on a setContent operation.\n-\t\t\t * @option {Boolean} cleanup Is true if the process is on a cleanup operation.\n-\t\t\t * @example\n-\t\t\t * // Adds an observer to the onPreProcess event using tinyMCE.init\n-\t\t\t * tinyMCE.init({\n-\t\t\t *    ...\n-\t\t\t *    setup : function(ed) {\n-\t\t\t *       ed.onPreProcess.add(function(ed, o) {\n-\t\t\t *            // Add a class to each paragraph in the editor\n-\t\t\t *            ed.dom.addClass(ed.dom.select('p', o.node), 'myclass');\n-\t\t\t *       });\n-\t\t\t *    }\n-\t\t\t * });\n-\t\t\t */\n-\t\t\t'onPreProcess',\n-\n-\t\t\t/**\n-\t\t\t * Fires when the Serializer does a postProcess on the contents.\n-\t\t\t *\n-\t\t\t * @event onPostProcess\n-\t\t\t * @param {tinymce.Editor} sender Editor instance.\n-\t\t\t * @param {Object} obj PreProcess object.\n-\t\t\t * @example\n-\t\t\t * // Adds an observer to the onPostProcess event using tinyMCE.init\n-\t\t\t * tinyMCE.init({\n-\t\t\t *    ...\n-\t\t\t *    setup : function(ed) {\n-\t\t\t *       ed.onPostProcess.add(function(ed, o) {\n-\t\t\t *            // Remove all paragraphs and replace with BR\n-\t\t\t *            o.content = o.content.replace(/<p[^>]+>|<p>/g, '');\n-\t\t\t *            o.content = o.content.replace(/<\\/p>/g, '<br />');\n-\t\t\t *       });\n-\t\t\t *    }\n-\t\t\t * });\n-\t\t\t */\n-\t\t\t'onPostProcess',\n-\n-\t\t\t/**\n-\t\t\t * Fires before new contents is added to the editor. Using for example setContent.\n-\t\t\t *\n-\t\t\t * @event onBeforeSetContent\n-\t\t\t * @param {tinymce.Editor} sender Editor instance.\n-\t\t\t * @example\n-\t\t\t * // Adds an observer to the onBeforeSetContent event using tinyMCE.init\n-\t\t\t * tinyMCE.init({\n-\t\t\t *    ...\n-\t\t\t *    setup : function(ed) {\n-\t\t\t *       ed.onBeforeSetContent.add(function(ed, o) {\n-\t\t\t *            // Replaces all a characters with b characters\n-\t\t\t *            o.content = o.content.replace(/a/g, 'b');\n-\t\t\t *       });\n-\t\t\t *    }\n-\t\t\t * });\n-\t\t\t */\n-\t\t\t'onBeforeSetContent',\n-\n-\t\t\t/**\n-\t\t\t * Fires before contents is extracted from the editor using for example getContent.\n-\t\t\t *\n-\t\t\t * @event onBeforeGetContent\n-\t\t\t * @param {tinymce.Editor} sender Editor instance.\n-\t\t\t * @param {Event} evt W3C DOM Event instance.\n-\t\t\t * @example\n-\t\t\t * // Adds an observer to the onBeforeGetContent event using tinyMCE.init\n-\t\t\t * tinyMCE.init({\n-\t\t\t *    ...\n-\t\t\t *    setup : function(ed) {\n-\t\t\t *       ed.onBeforeGetContent.add(function(ed, o) {\n-\t\t\t *            console.debug('Before get content.');\n-\t\t\t *       });\n-\t\t\t *    }\n-\t\t\t * });\n-\t\t\t */\n-\t\t\t'onBeforeGetContent',\n-\n-\t\t\t/**\n-\t\t\t * Fires after the contents has been added to the editor using for example onSetContent.\n-\t\t\t *\n-\t\t\t * @event onSetContent\n-\t\t\t * @param {tinymce.Editor} sender Editor instance.\n-\t\t\t * @example\n-\t\t\t * // Adds an observer to the onSetContent event using tinyMCE.init\n-\t\t\t * tinyMCE.init({\n-\t\t\t *    ...\n-\t\t\t *    setup : function(ed) {\n-\t\t\t *       ed.onSetContent.add(function(ed, o) {\n-\t\t\t *            // Replaces all a characters with b characters\n-\t\t\t *            o.content = o.content.replace(/a/g, 'b');\n-\t\t\t *       });\n-\t\t\t *    }\n-\t\t\t * });\n-\t\t\t */\n-\t\t\t'onSetContent',\n-\n-\t\t\t/**\n-\t\t\t * Fires after the contents has been extracted from the editor using for example getContent.\n-\t\t\t *\n-\t\t\t * @event onGetContent\n-\t\t\t * @param {tinymce.Editor} sender Editor instance.\n-\t\t\t * @example\n-\t\t\t * // Adds an observer to the onGetContent event using tinyMCE.init\n-\t\t\t * tinyMCE.init({\n-\t\t\t *    ...\n-\t\t\t *    setup : function(ed) {\n-\t\t\t *       ed.onGetContent.add(function(ed, o) {\n-\t\t\t *           // Replace all a characters with b\n-\t\t\t *           o.content = o.content.replace(/a/g, 'b');\n-\t\t\t *       });\n-\t\t\t *    }\n-\t\t\t * });\n-\t\t\t */\n-\t\t\t'onGetContent',\n-\n-\t\t\t/**\n-\t\t\t * Fires when the editor gets loaded with contents for example when the load method is executed.\n-\t\t\t *\n-\t\t\t * @event onLoadContent\n-\t\t\t * @param {tinymce.Editor} sender Editor instance.\n-\t\t\t * @example\n-\t\t\t * // Adds an observer to the onLoadContent event using tinyMCE.init\n-\t\t\t * tinyMCE.init({\n-\t\t\t *    ...\n-\t\t\t *    setup : function(ed) {\n-\t\t\t *       ed.onLoadContent.add(function(ed, o) {\n-\t\t\t *           // Output the element name\n-\t\t\t *           console.debug(o.element.nodeName);\n-\t\t\t *       });\n-\t\t\t *    }\n-\t\t\t * });\n-\t\t\t */\n-\t\t\t'onLoadContent',\n-\n-\t\t\t/**\n-\t\t\t * Fires when the editor contents gets saved for example when the save method is executed.\n-\t\t\t *\n-\t\t\t * @event onSaveContent\n-\t\t\t * @param {tinymce.Editor} sender Editor instance.\n-\t\t\t * @example\n-\t\t\t * // Adds an observer to the onSaveContent event using tinyMCE.init\n-\t\t\t * tinyMCE.init({\n-\t\t\t *    ...\n-\t\t\t *    setup : function(ed) {\n-\t\t\t *       ed.onSaveContent.add(function(ed, o) {\n-\t\t\t *           // Output the element name\n-\t\t\t *           console.debug(o.element.nodeName);\n-\t\t\t *       });\n-\t\t\t *    }\n-\t\t\t * });\n-\t\t\t */\n-\t\t\t'onSaveContent',\n-\n-\t\t\t/**\n-\t\t\t * Fires when the user changes node location using the mouse or keyboard.\n-\t\t\t *\n-\t\t\t * @event onNodeChange\n-\t\t\t * @param {tinymce.Editor} sender Editor instance.\n-\t\t\t * @example\n-\t\t\t * // Adds an observer to the onNodeChange event using tinyMCE.init\n-\t\t\t * tinyMCE.init({\n-\t\t\t *    ...\n-\t\t\t *    setup : function(ed) {\n-\t\t\t *       ed.onNodeChange.add(function(ed, cm, e) {\n-\t\t\t *           // Activates the link button when the caret is placed in a anchor element\n-\t\t\t *           if (e.nodeName == 'A')\n-\t\t\t *              cm.setActive('link', true);\n-\t\t\t *       });\n-\t\t\t *    }\n-\t\t\t * });\n-\t\t\t */\n-\t\t\t'onNodeChange',\n-\n-\t\t\t/**\n-\t\t\t * Fires when a new undo level is added to the editor.\n-\t\t\t *\n-\t\t\t * @event onChange\n-\t\t\t * @param {tinymce.Editor} sender Editor instance.\n-\t\t\t * @example\n-\t\t\t * // Adds an observer to the onChange event using tinyMCE.init\n-\t\t\t * tinyMCE.init({\n-\t\t\t *    ...\n-\t\t\t *    setup : function(ed) {\n-\t\t\t *       ed.onChange.add(function(ed, l) {\n-\t\t\t *          console.debug('Editor contents was modified. Contents: ' + l.content);\n-\t\t\t *       });\n-\t\t\t *    }\n-\t\t\t * });\n-\t\t\t */\n-\t\t\t'onChange',\n-\n-\t\t\t/**\n-\t\t\t * Fires before a command gets executed for example \"Bold\".\n-\t\t\t *\n-\t\t\t * @event onBeforeExecCommand\n-\t\t\t * @param {tinymce.Editor} sender Editor instance.\n-\t\t\t * @example\n-\t\t\t * // Adds an observer to the onBeforeExecCommand event using tinyMCE.init\n-\t\t\t * tinyMCE.init({\n-\t\t\t *    ...\n-\t\t\t *    setup : function(ed) {\n-\t\t\t *       ed.onBeforeExecCommand.add(function(ed, cmd, ui, val) {\n-\t\t\t *           console.debug('Command is to be executed: ' + cmd);\n-\t\t\t *       });\n-\t\t\t *    }\n-\t\t\t * });\n-\t\t\t */\n-\t\t\t'onBeforeExecCommand',\n-\n-\t\t\t/**\n-\t\t\t * Fires after a command is executed for example \"Bold\".\n-\t\t\t *\n-\t\t\t * @event onExecCommand\n-\t\t\t * @param {tinymce.Editor} sender Editor instance.\n-\t\t\t * @example\n-\t\t\t * // Adds an observer to the onExecCommand event using tinyMCE.init\n-\t\t\t * tinyMCE.init({\n-\t\t\t *    ...\n-\t\t\t *    setup : function(ed) {\n-\t\t\t *       ed.onExecCommand.add(function(ed, cmd, ui, val) {\n-\t\t\t *           console.debug('Command was executed: ' + cmd);\n-\t\t\t *       });\n-\t\t\t *    }\n-\t\t\t * });\n-\t\t\t */\n-\t\t\t'onExecCommand',\n-\n-\t\t\t/**\n-\t\t\t * Fires when the contents is undo:ed.\n-\t\t\t *\n-\t\t\t * @event onUndo\n-\t\t\t * @param {tinymce.Editor} sender Editor instance.\n-\t\t\t * @param {Object} level Undo level object.\n-\t\t\t * @ example\n-\t\t\t * // Adds an observer to the onUndo event using tinyMCE.init\n-\t\t\t * tinyMCE.init({\n-\t\t\t *    ...\n-\t\t\t *    setup : function(ed) {\n-\t\t\t *       ed.onUndo.add(function(ed, level) {\n-\t\t\t *           console.debug('Undo was performed: ' + level.content);\n-\t\t\t *       });\n-\t\t\t *    }\n-\t\t\t * });\n-\t\t\t */\n-\t\t\t'onUndo',\n-\n-\t\t\t/**\n-\t\t\t * Fires when the contents is redo:ed.\n-\t\t\t *\n-\t\t\t * @event onRedo\n-\t\t\t * @param {tinymce.Editor} sender Editor instance.\n-\t\t\t * @param {Object} level Undo level object.\n-\t\t\t * @example\n-\t\t\t * // Adds an observer to the onRedo event using tinyMCE.init\n-\t\t\t * tinyMCE.init({\n-\t\t\t *    ...\n-\t\t\t *    setup : function(ed) {\n-\t\t\t *       ed.onRedo.add(function(ed, level) {\n-\t\t\t *           console.debug('Redo was performed: ' +level.content);\n-\t\t\t *       });\n-\t\t\t *    }\n-\t\t\t * });\n-\t\t\t */\n-\t\t\t'onRedo',\n-\n-\t\t\t/**\n-\t\t\t * Fires when visual aids is enabled/disabled.\n-\t\t\t *\n-\t\t\t * @event onVisualAid\n-\t\t\t * @param {tinymce.Editor} sender Editor instance.\n-\t\t\t * @example\n-\t\t\t * // Adds an observer to the onVisualAid event using tinyMCE.init\n-\t\t\t * tinyMCE.init({\n-\t\t\t *    ...\n-\t\t\t *    setup : function(ed) {\n-\t\t\t *       ed.onVisualAid.add(function(ed, e, s) {\n-\t\t\t *           console.debug('onVisualAid event: ' + ed.id + \", State: \" + s);\n-\t\t\t *       });\n-\t\t\t *    }\n-\t\t\t * });\n-\t\t\t */\n-\t\t\t'onVisualAid',\n-\n-\t\t\t/**\n-\t\t\t * Fires when the progress throbber is shown above the editor.\n-\t\t\t *\n-\t\t\t * @event onSetProgressState\n-\t\t\t * @param {tinymce.Editor} sender Editor instance.\n-\t\t\t * @example\n-\t\t\t * // Adds an observer to the onSetProgressState event using tinyMCE.init\n-\t\t\t * tinyMCE.init({\n-\t\t\t *    ...\n-\t\t\t *    setup : function(ed) {\n-\t\t\t *       ed.onSetProgressState.add(function(ed, b) {\n-\t\t\t *            if (b)\n-\t\t\t *                 console.debug('SHOW!');\n-\t\t\t *            else\n-\t\t\t *                 console.debug('HIDE!');\n-\t\t\t *       });\n-\t\t\t *    }\n-\t\t\t * });\n-\t\t\t */\n-\t\t\t'onSetProgressState',\n-\n-\t\t\t/**\n-\t\t\t * Fires after an attribute is set using setAttrib.\n-\t\t\t *\n-\t\t\t * @event onSetAttrib\n-\t\t\t * @param {tinymce.Editor} sender Editor instance.\n-\t\t\t * @example\n-\t\t\t * // Adds an observer to the onSetAttrib event using tinyMCE.init\n-\t\t\t *tinyMCE.init({\n-\t\t\t *    ...\n-\t\t\t *    setup : function(ed) {\n-\t\t\t *       ed.onSetAttrib.add(function(ed, node, attribute, attributeValue) {\n-\t\t\t *            console.log('onSetAttrib tag');\n-\t\t\t *       });\n-\t\t\t *    }\n-\t\t\t * });\n-\t\t\t */\n-\t\t\t'onSetAttrib'\n-\t\t], function(name) {\n-\t\t\tself[name] = new tinymce.util.Dispatcher(self);\n-\t\t});\n-\n-\t\t// Handle legacy cleanup_callback option\n-\t\tif (settings.cleanup_callback) {\n-\t\t\tself.onBeforeSetContent.add(function(ed, o) {\n-\t\t\t\to.content = ed.execCallback('cleanup_callback', 'insert_to_editor', o.content, o);\n-\t\t\t});\n-\n-\t\t\tself.onPreProcess.add(function(ed, o) {\n-\t\t\t\tif (o.set)\n-\t\t\t\t\ted.execCallback('cleanup_callback', 'insert_to_editor_dom', o.node, o);\n-\n-\t\t\t\tif (o.get)\n-\t\t\t\t\ted.execCallback('cleanup_callback', 'get_from_editor_dom', o.node, o);\n-\t\t\t});\n-\n-\t\t\tself.onPostProcess.add(function(ed, o) {\n-\t\t\t\tif (o.set)\n-\t\t\t\t\to.content = ed.execCallback('cleanup_callback', 'insert_to_editor', o.content, o);\n-\n-\t\t\t\tif (o.get)\t\t\t\t\t\t\n-\t\t\t\t\to.content = ed.execCallback('cleanup_callback', 'get_from_editor', o.content, o);\n-\t\t\t});\n-\t\t}\n-\n-\t\t// Handle legacy save_callback option\n-\t\tif (settings.save_callback) {\n-\t\t\tself.onGetContent.add(function(ed, o) {\n-\t\t\t\tif (o.save)\n-\t\t\t\t\to.content = ed.execCallback('save_callback', ed.id, o.content, ed.getBody());\n-\t\t\t});\n-\t\t}\n-\n-\t\t// Handle legacy handle_event_callback option\n-\t\tif (settings.handle_event_callback) {\n-\t\t\tself.onEvent.add(function(ed, e, o) {\n-\t\t\t\tif (self.execCallback('handle_event_callback', e, ed, o) === false) {\n-\t\t\t\t\te.preventDefault();\n-\t\t\t\t\te.stopPropagation();\n-\t\t\t\t}\n-\t\t\t});\n-\t\t}\n-\n-\t\t// Handle legacy handle_node_change_callback option\n-\t\tif (settings.handle_node_change_callback) {\n-\t\t\tself.onNodeChange.add(function(ed, cm, n) {\n-\t\t\t\ted.execCallback('handle_node_change_callback', ed.id, n, -1, -1, true, ed.selection.isCollapsed());\n-\t\t\t});\n-\t\t}\n-\n-\t\t// Handle legacy save_callback option\n-\t\tif (settings.save_callback) {\n-\t\t\tself.onSaveContent.add(function(ed, o) {\n-\t\t\t\tvar h = ed.execCallback('save_callback', ed.id, o.content, ed.getBody());\n-\n-\t\t\t\tif (h)\n-\t\t\t\t\to.content = h;\n-\t\t\t});\n-\t\t}\n-\n-\t\t// Handle legacy onchange_callback option\n-\t\tif (settings.onchange_callback) {\n-\t\t\tself.onChange.add(function(ed, l) {\n-\t\t\t\ted.execCallback('onchange_callback', ed, l);\n-\t\t\t});\n-\t\t}\n-\t};\n-\n-\t/**\n-\t * Binds native DOM events and sends these out to the dispatchers.\n-\t */\n-\ttinymce.Editor.prototype.bindNativeEvents = function() {\n-\t\t// 'focus', 'blur', 'dblclick', 'beforedeactivate', submit, reset\n-\t\tvar self = this, i, settings = self.settings, dom = self.dom, nativeToDispatcherMap;\n-\n-\t\tnativeToDispatcherMap = {\n-\t\t\tmouseup : 'onMouseUp',\n-\t\t\tmousedown : 'onMouseDown',\n-\t\t\tclick : 'onClick',\n-\t\t\tkeyup : 'onKeyUp',\n-\t\t\tkeydown : 'onKeyDown',\n-\t\t\tkeypress : 'onKeyPress',\n-\t\t\tsubmit : 'onSubmit',\n-\t\t\treset : 'onReset',\n-\t\t\tcontextmenu : 'onContextMenu',\n-\t\t\tdblclick : 'onDblClick',\n-\t\t\tpaste : 'onPaste' // Doesn't work in all browsers yet\n-\t\t};\n-\n-\t\t// Handler that takes a native event and sends it out to a dispatcher like onKeyDown\n-\t\tfunction eventHandler(evt, args) {\n-\t\t\tvar type = evt.type;\n-\n-\t\t\t// Don't fire events when it's removed\n-\t\t\tif (self.removed)\n-\t\t\t\treturn;\n-\n-\t\t\t// Sends the native event out to a global dispatcher then to the specific event dispatcher\n-\t\t\tif (self.onEvent.dispatch(self, evt, args) !== false) {\n-\t\t\t\tself[nativeToDispatcherMap[evt.fakeType || evt.type]].dispatch(self, evt, args);\n-\t\t\t}\n-\t\t};\n-\n-\t\t// Opera doesn't support focus event for contentEditable elements so we need to fake it\n-\t\tfunction doOperaFocus(e) {\n-\t\t\tself.focus(true);\n-\t\t};\n-\n-\t\tfunction nodeChanged(ed, e) {\n-\t\t\t// Normalize selection for example <b>a</b><i>|a</i> becomes <b>a|</b><i>a</i> except for Ctrl+A since it selects everything\n-\t\t\tif (e.keyCode != 65 || !tinymce.VK.metaKeyPressed(e)) {\n-\t\t\t\tself.selection.normalize();\n-\t\t\t}\n-\n-\t\t\tself.nodeChanged();\n-\t\t}\n-\n-\t\t// Add DOM events\n-\t\teach(nativeToDispatcherMap, function(dispatcherName, nativeName) {\n-\t\t\tvar root = settings.content_editable ? self.getBody() : self.getDoc();\n-\n-\t\t\tswitch (nativeName) {\n-\t\t\t\tcase 'contextmenu':\n-\t\t\t\t\tdom.bind(root, nativeName, eventHandler);\n-\t\t\t\t\tbreak;\n-\n-\t\t\t\tcase 'paste':\n-\t\t\t\t\tdom.bind(self.getBody(), nativeName, eventHandler);\n-\t\t\t\t\tbreak;\n-\n-\t\t\t\tcase 'submit':\n-\t\t\t\tcase 'reset':\n-\t\t\t\t\tdom.bind(self.getElement().form || tinymce.DOM.getParent(self.id, 'form'), nativeName, eventHandler);\n-\t\t\t\t\tbreak;\n-\n-\t\t\t\tdefault:\n-\t\t\t\t\tdom.bind(root, nativeName, eventHandler);\n-\t\t\t}\n-\t\t});\n-\n-\t\t// Set the editor as active when focused\n-\t\tdom.bind(settings.content_editable ? self.getBody() : (tinymce.isGecko ? self.getDoc() : self.getWin()), 'focus', function(e) {\n-\t\t\tself.focus(true);\n-\t\t});\n-\n-\t\tif (settings.content_editable && tinymce.isOpera) {\n-\t\t\tdom.bind(self.getBody(), 'click', doOperaFocus);\n-\t\t\tdom.bind(self.getBody(), 'keydown', doOperaFocus);\n-\t\t}\n-\n-\t\t// Add node change handler\n-\t\tself.onMouseUp.add(nodeChanged);\n-\n-\t\tself.onKeyUp.add(function(ed, e) {\n-\t\t\tvar keyCode = e.keyCode;\n-\n-\t\t\tif ((keyCode >= 33 && keyCode <= 36) || (keyCode >= 37 && keyCode <= 40) || keyCode == 13 || keyCode == 45 || keyCode == 46 || keyCode == 8 || (tinymce.isMac && (keyCode == 91 || keyCode == 93)) || e.ctrlKey)\n-\t\t\t\tnodeChanged(ed, e);\n-\t\t});\n-\n-\t\t// Add reset handler\n-\t\tself.onReset.add(function() {\n-\t\t\tself.setContent(self.startContent, {format : 'raw'});\n-\t\t});\n-\n-\t\t// Add shortcuts\n-\t\tfunction handleShortcut(e, execute) {\n-\t\t\tif (e.altKey || e.ctrlKey || e.metaKey) {\n-\t\t\t\teach(self.shortcuts, function(shortcut) {\n-\t\t\t\t\tvar ctrlState = tinymce.isMac ? e.metaKey : e.ctrlKey;\n-\n-\t\t\t\t\tif (shortcut.ctrl != ctrlState || shortcut.alt != e.altKey || shortcut.shift != e.shiftKey)\n-\t\t\t\t\t\treturn;\n-\n-\t\t\t\t\tif (e.keyCode == shortcut.keyCode || (e.charCode && e.charCode == shortcut.charCode)) {\n-\t\t\t\t\t\te.preventDefault();\n-\n-\t\t\t\t\t\tif (execute) {\n-\t\t\t\t\t\t\tshortcut.func.call(shortcut.scope);\n-\t\t\t\t\t\t}\n-\n-\t\t\t\t\t\treturn true;\n-\t\t\t\t\t}\n-\t\t\t\t});\n-\t\t\t}\n-\t\t};\n-\n-\t\tself.onKeyUp.add(function(ed, e) {\n-\t\t\thandleShortcut(e);\n-\t\t});\n-\n-\t\tself.onKeyPress.add(function(ed, e) {\n-\t\t\thandleShortcut(e);\n-\t\t});\n-\n-\t\tself.onKeyDown.add(function(ed, e) {\n-\t\t\thandleShortcut(e, true);\n-\t\t});\n-\n-\t\tif (tinymce.isOpera) {\n-\t\t\tself.onClick.add(function(ed, e) {\n-\t\t\t\te.preventDefault();\n-\t\t\t});\n-\t\t}\n-\t};\n-})(tinymce);\n\\ No newline at end of file"
        },
        {
            "filename": "js/tiny_mce/classes/Editor.js",
            "diff": "@@ -1,1971 +0,0 @@\n-/**\n- * Editor.js\n- *\n- * Copyright, Moxiecode Systems AB\n- * Released under LGPL License.\n- *\n- * License: http://www.tinymce.com/license\n- * Contributing: http://www.tinymce.com/contributing\n- */\n-\n-(function(tinymce) {\n-\t// Shorten these names\n-\tvar DOM = tinymce.DOM, Event = tinymce.dom.Event, extend = tinymce.extend,\n-\t\teach = tinymce.each, isGecko = tinymce.isGecko,\n-\t\tisIE = tinymce.isIE, isWebKit = tinymce.isWebKit, is = tinymce.is,\n-\t\tThemeManager = tinymce.ThemeManager, PluginManager = tinymce.PluginManager,\n-\t\texplode = tinymce.explode;\n-\n-\t/**\n-\t * This class contains the core logic for a TinyMCE editor.\n-\t *\n-\t * @class tinymce.Editor\n-\t * @example\n-\t * // Add a class to all paragraphs in the editor.\n-\t * tinyMCE.activeEditor.dom.addClass(tinyMCE.activeEditor.dom.select('p'), 'someclass');\n-\t * \n-\t * // Gets the current editors selection as text\n-\t * tinyMCE.activeEditor.selection.getContent({format : 'text'});\n-\t * \n-\t * // Creates a new editor instance\n-\t * var ed = new tinymce.Editor('textareaid', {\n-\t *     some_setting : 1\n-\t * });\n-\t * \n-\t * // Select each item the user clicks on\n-\t * ed.onClick.add(function(ed, e) {\n-\t *     ed.selection.select(e.target);\n-\t * });\n-\t * \n-\t * ed.render();\n-\t */\n-\ttinymce.create('tinymce.Editor', {\n-\t\t/**\n-\t\t * Constructs a editor instance by id.\n-\t\t *\n-\t\t * @constructor\n-\t\t * @method Editor\n-\t\t * @param {String} id Unique id for the editor.\n-\t\t * @param {Object} settings Optional settings string for the editor.\n-\t\t * @author Moxiecode\n-\t\t */\n-\t\tEditor : function(id, settings) {\n-\t\t\tvar self = this, TRUE = true;\n-\n-\t\t\t/**\n-\t\t\t * Name/value collection with editor settings.\n-\t\t\t *\n-\t\t\t * @property settings\n-\t\t\t * @type Object\n-\t\t\t * @example\n-\t\t\t * // Get the value of the theme setting\n-\t\t\t * tinyMCE.activeEditor.windowManager.alert(\"You are using the \" + tinyMCE.activeEditor.settings.theme + \" theme\");\n-\t\t\t */\n-\t\t\tself.settings = settings = extend({\n-\t\t\t\tid : id,\n-\t\t\t\tlanguage : 'en',\n-\t\t\t\ttheme : 'advanced',\n-\t\t\t\tskin : 'default',\n-\t\t\t\tdelta_width : 0,\n-\t\t\t\tdelta_height : 0,\n-\t\t\t\tpopup_css : '',\n-\t\t\t\tplugins : '',\n-\t\t\t\tdocument_base_url : tinymce.documentBaseURL,\n-\t\t\t\tadd_form_submit_trigger : TRUE,\n-\t\t\t\tsubmit_patch : TRUE,\n-\t\t\t\tadd_unload_trigger : TRUE,\n-\t\t\t\tconvert_urls : TRUE,\n-\t\t\t\trelative_urls : TRUE,\n-\t\t\t\tremove_script_host : TRUE,\n-\t\t\t\ttable_inline_editing : false,\n-\t\t\t\tobject_resizing : TRUE,\n-\t\t\t\taccessibility_focus : TRUE,\n-\t\t\t\tdoctype : tinymce.isIE6 ? '<!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\">' : '<!DOCTYPE>', // Use old doctype on IE 6 to avoid horizontal scroll\n-\t\t\t\tvisual : TRUE,\n-\t\t\t\tfont_size_style_values : 'xx-small,x-small,small,medium,large,x-large,xx-large',\n-\t\t\t\tfont_size_legacy_values : 'xx-small,small,medium,large,x-large,xx-large,300%', // See: http://www.w3.org/TR/CSS2/fonts.html#propdef-font-size\n-\t\t\t\tapply_source_formatting : TRUE,\n-\t\t\t\tdirectionality : 'ltr',\n-\t\t\t\tforced_root_block : 'p',\n-\t\t\t\thidden_input : TRUE,\n-\t\t\t\tpadd_empty_editor : TRUE,\n-\t\t\t\trender_ui : TRUE,\n-\t\t\t\tindentation : '30px',\n-\t\t\t\tfix_table_elements : TRUE,\n-\t\t\t\tinline_styles : TRUE,\n-\t\t\t\tconvert_fonts_to_spans : TRUE,\n-\t\t\t\tindent : 'simple',\n-\t\t\t\tindent_before : 'p,h1,h2,h3,h4,h5,h6,blockquote,div,title,style,pre,script,td,ul,li,area,table,thead,tfoot,tbody,tr,section,article,hgroup,aside,figure,option,optgroup,datalist',\n-\t\t\t\tindent_after : 'p,h1,h2,h3,h4,h5,h6,blockquote,div,title,style,pre,script,td,ul,li,area,table,thead,tfoot,tbody,tr,section,article,hgroup,aside,figure,option,optgroup,datalist',\n-\t\t\t\tvalidate : TRUE,\n-\t\t\t\tentity_encoding : 'named',\n-\t\t\t\turl_converter : self.convertURL,\n-\t\t\t\turl_converter_scope : self,\n-\t\t\t\tie7_compat : TRUE\n-\t\t\t}, settings);\n-\n-\t\t\t/**\n-\t\t\t * Editor instance id, normally the same as the div/textarea that was replaced. \n-\t\t\t *\n-\t\t\t * @property id\n-\t\t\t * @type String\n-\t\t\t */\n-\t\t\tself.id = self.editorId = id;\n-\n-\t\t\t/**\n-\t\t\t * State to force the editor to return false on a isDirty call. \n-\t\t\t *\n-\t\t\t * @property isNotDirty\n-\t\t\t * @type Boolean\n-\t\t\t * @example\n-\t\t\t * function ajaxSave() {\n-\t\t\t *     var ed = tinyMCE.get('elm1');\n-\t\t\t *\n-\t\t\t *     // Save contents using some XHR call\n-\t\t\t *     alert(ed.getContent());\n-\t\t\t *\n-\t\t\t *     ed.isNotDirty = 1; // Force not dirty state\n-\t\t\t * }\n-\t\t\t */\n-\t\t\tself.isNotDirty = false;\n-\n-\t\t\t/**\n-\t\t\t * Name/Value object containting plugin instances.\n-\t\t\t *\n-\t\t\t * @property plugins\n-\t\t\t * @type Object\n-\t\t\t * @example\n-\t\t\t * // Execute a method inside a plugin directly\n-\t\t\t * tinyMCE.activeEditor.plugins.someplugin.someMethod();\n-\t\t\t */\n-\t\t\tself.plugins = {};\n-\n-\t\t\t/**\n-\t\t\t * URI object to document configured for the TinyMCE instance.\n-\t\t\t *\n-\t\t\t * @property documentBaseURI\n-\t\t\t * @type tinymce.util.URI\n-\t\t\t * @example\n-\t\t\t * // Get relative URL from the location of document_base_url\n-\t\t\t * tinyMCE.activeEditor.documentBaseURI.toRelative('/somedir/somefile.htm');\n-\t\t\t * \n-\t\t\t * // Get absolute URL from the location of document_base_url\n-\t\t\t * tinyMCE.activeEditor.documentBaseURI.toAbsolute('somefile.htm');\n-\t\t\t */\n-\t\t\tself.documentBaseURI = new tinymce.util.URI(settings.document_base_url || tinymce.documentBaseURL, {\n-\t\t\t\tbase_uri : tinyMCE.baseURI\n-\t\t\t});\n-\n-\t\t\t/**\n-\t\t\t * URI object to current document that holds the TinyMCE editor instance.\n-\t\t\t *\n-\t\t\t * @property baseURI\n-\t\t\t * @type tinymce.util.URI\n-\t\t\t * @example\n-\t\t\t * // Get relative URL from the location of the API\n-\t\t\t * tinyMCE.activeEditor.baseURI.toRelative('/somedir/somefile.htm');\n-\t\t\t * \n-\t\t\t * // Get absolute URL from the location of the API\n-\t\t\t * tinyMCE.activeEditor.baseURI.toAbsolute('somefile.htm');\n-\t\t\t */\n-\t\t\tself.baseURI = tinymce.baseURI;\n-\n-\t\t\t/**\n-\t\t\t * Array with CSS files to load into the iframe.\n-\t\t\t *\n-\t\t\t * @property contentCSS\n-\t\t\t * @type Array\n-\t\t\t */\t\t\t\n-\t\t\tself.contentCSS = [];\n-\n-\t\t\t/**\n-\t\t\t * Array of CSS styles to add to head of document when the editor loads.\n-\t\t\t *\n-\t\t\t * @property contentStyles\n-\t\t\t * @type Array\n-\t\t\t */\n-\t\t\tself.contentStyles = [];\n-\n-\t\t\t// Creates all events like onClick, onSetContent etc see Editor.Events.js for the actual logic\n-\t\t\tself.setupEvents();\n-\n-\t\t\t// Internal command handler objects\n-\t\t\tself.execCommands = {};\n-\t\t\tself.queryStateCommands = {};\n-\t\t\tself.queryValueCommands = {};\n-\n-\t\t\t// Call setup\n-\t\t\tself.execCallback('setup', self);\n-\t\t},\n-\n-\t\t/**\n-\t\t * Renderes the editor/adds it to the page.\n-\t\t *\n-\t\t * @method render\n-\t\t */\n-\t\trender : function(nst) {\n-\t\t\tvar t = this, s = t.settings, id = t.id, sl = tinymce.ScriptLoader;\n-\n-\t\t\t// Page is not loaded yet, wait for it\n-\t\t\tif (!Event.domLoaded) {\n-\t\t\t\tEvent.add(window, 'ready', function() {\n-\t\t\t\t\tt.render();\n-\t\t\t\t});\n-\t\t\t\treturn;\n-\t\t\t}\n-\n-\t\t\ttinyMCE.settings = s;\n-\n-\t\t\t// Element not found, then skip initialization\n-\t\t\tif (!t.getElement())\n-\t\t\t\treturn;\n-\n-\t\t\t// Is a iPad/iPhone and not on iOS5, then skip initialization. We need to sniff \n-\t\t\t// here since the browser says it has contentEditable support but there is no visible caret.\n-\t\t\tif (tinymce.isIDevice && !tinymce.isIOS5)\n-\t\t\t\treturn;\n-\n-\t\t\t// Add hidden input for non input elements inside form elements\n-\t\t\tif (!/TEXTAREA|INPUT/i.test(t.getElement().nodeName) && s.hidden_input && DOM.getParent(id, 'form'))\n-\t\t\t\tDOM.insertAfter(DOM.create('input', {type : 'hidden', name : id}), id);\n-\n-\t\t\t// Hide target element early to prevent content flashing\n-\t\t\tif (!s.content_editable) {\n-\t\t\t\tt.orgVisibility = t.getElement().style.visibility;\n-\t\t\t\tt.getElement().style.visibility = 'hidden';\n-\t\t\t}\n-\n-\t\t\t/**\n-\t\t\t * Window manager reference, use this to open new windows and dialogs.\n-\t\t\t *\n-\t\t\t * @property windowManager\n-\t\t\t * @type tinymce.WindowManager\n-\t\t\t * @example\n-\t\t\t * // Shows an alert message\n-\t\t\t * tinyMCE.activeEditor.windowManager.alert('Hello world!');\n-\t\t\t * \n-\t\t\t * // Opens a new dialog with the file.htm file and the size 320x240\n-\t\t\t * // It also adds a custom parameter this can be retrieved by using tinyMCEPopup.getWindowArg inside the dialog.\n-\t\t\t * tinyMCE.activeEditor.windowManager.open({\n-\t\t\t *    url : 'file.htm',\n-\t\t\t *    width : 320,\n-\t\t\t *    height : 240\n-\t\t\t * }, {\n-\t\t\t *    custom_param : 1\n-\t\t\t * });\n-\t\t\t */\n-\t\t\tif (tinymce.WindowManager)\n-\t\t\t\tt.windowManager = new tinymce.WindowManager(t);\n-\n-\t\t\tif (s.encoding == 'xml') {\n-\t\t\t\tt.onGetContent.add(function(ed, o) {\n-\t\t\t\t\tif (o.save)\n-\t\t\t\t\t\to.content = DOM.encode(o.content);\n-\t\t\t\t});\n-\t\t\t}\n-\n-\t\t\tif (s.add_form_submit_trigger) {\n-\t\t\t\tt.onSubmit.addToTop(function() {\n-\t\t\t\t\tif (t.initialized) {\n-\t\t\t\t\t\tt.save();\n-\t\t\t\t\t\tt.isNotDirty = 1;\n-\t\t\t\t\t}\n-\t\t\t\t});\n-\t\t\t}\n-\n-\t\t\tif (s.add_unload_trigger) {\n-\t\t\t\tt._beforeUnload = tinyMCE.onBeforeUnload.add(function() {\n-\t\t\t\t\tif (t.initialized && !t.destroyed && !t.isHidden())\n-\t\t\t\t\t\tt.save({format : 'raw', no_events : true});\n-\t\t\t\t});\n-\t\t\t}\n-\n-\t\t\ttinymce.addUnload(t.destroy, t);\n-\n-\t\t\tif (s.submit_patch) {\n-\t\t\t\tt.onBeforeRenderUI.add(function() {\n-\t\t\t\t\tvar n = t.getElement().form;\n-\n-\t\t\t\t\tif (!n)\n-\t\t\t\t\t\treturn;\n-\n-\t\t\t\t\t// Already patched\n-\t\t\t\t\tif (n._mceOldSubmit)\n-\t\t\t\t\t\treturn;\n-\n-\t\t\t\t\t// Check page uses id=\"submit\" or name=\"submit\" for it's submit button\n-\t\t\t\t\tif (!n.submit.nodeType && !n.submit.length) {\n-\t\t\t\t\t\tt.formElement = n;\n-\t\t\t\t\t\tn._mceOldSubmit = n.submit;\n-\t\t\t\t\t\tn.submit = function() {\n-\t\t\t\t\t\t\t// Save all instances\n-\t\t\t\t\t\t\ttinymce.triggerSave();\n-\t\t\t\t\t\t\tt.isNotDirty = 1;\n-\n-\t\t\t\t\t\t\treturn t.formElement._mceOldSubmit(t.formElement);\n-\t\t\t\t\t\t};\n-\t\t\t\t\t}\n-\n-\t\t\t\t\tn = null;\n-\t\t\t\t});\n-\t\t\t}\n-\n-\t\t\t// Load scripts\n-\t\t\tfunction loadScripts() {\n-\t\t\t\tif (s.language && s.language_load !== false)\n-\t\t\t\t\tsl.add(tinymce.baseURL + '/langs/' + s.language + '.js');\n-\n-\t\t\t\tif (s.theme && typeof s.theme != \"function\" && s.theme.charAt(0) != '-' && !ThemeManager.urls[s.theme])\n-\t\t\t\t\tThemeManager.load(s.theme, 'themes/' + s.theme + '/editor_template' + tinymce.suffix + '.js');\n-\n-\t\t\t\teach(explode(s.plugins), function(p) {\n-\t\t\t\t\tif (p &&!PluginManager.urls[p]) {\n-\t\t\t\t\t\tif (p.charAt(0) == '-') {\n-\t\t\t\t\t\t\tp = p.substr(1, p.length);\n-\t\t\t\t\t\t\tvar dependencies = PluginManager.dependencies(p);\n-\t\t\t\t\t\t\teach(dependencies, function(dep) {\n-\t\t\t\t\t\t\t\tvar defaultSettings = {prefix:'plugins/', resource: dep, suffix:'/editor_plugin' + tinymce.suffix + '.js'};\n-\t\t\t\t\t\t\t\tdep = PluginManager.createUrl(defaultSettings, dep);\n-\t\t\t\t\t\t\t\tPluginManager.load(dep.resource, dep);\n-\t\t\t\t\t\t\t});\n-\t\t\t\t\t\t} else {\n-\t\t\t\t\t\t\t// Skip safari plugin, since it is removed as of 3.3b1\n-\t\t\t\t\t\t\tif (p == 'safari') {\n-\t\t\t\t\t\t\t\treturn;\n-\t\t\t\t\t\t\t}\n-\t\t\t\t\t\t\tPluginManager.load(p, {prefix:'plugins/', resource: p, suffix:'/editor_plugin' + tinymce.suffix + '.js'});\n-\t\t\t\t\t\t}\n-\t\t\t\t\t}\n-\t\t\t\t});\n-\n-\t\t\t\t// Init when que is loaded\n-\t\t\t\tsl.loadQueue(function() {\n-\t\t\t\t\tif (!t.removed)\n-\t\t\t\t\t\tt.init();\n-\t\t\t\t});\n-\t\t\t};\n-\n-\t\t\tloadScripts();\n-\t\t},\n-\n-\t\t/**\n-\t\t * Initializes the editor this will be called automatically when\n-\t\t * all plugins/themes and language packs are loaded by the rendered method.\n-\t\t * This method will setup the iframe and create the theme and plugin instances.\n-\t\t *\n-\t\t * @method init\n-\t\t */\n-\t\tinit : function() {\n-\t\t\tvar n, t = this, s = t.settings, w, h, mh, e = t.getElement(), o, ti, u, bi, bc, re, i, initializedPlugins = [];\n-\n-\t\t\ttinymce.add(t);\n-\n-\t\t\ts.aria_label = s.aria_label || DOM.getAttrib(e, 'aria-label', t.getLang('aria.rich_text_area'));\n-\n-\t\t\t/**\n-\t\t\t * Reference to the theme instance that was used to generate the UI. \n-\t\t\t *\n-\t\t\t * @property theme\n-\t\t\t * @type tinymce.Theme\n-\t\t\t * @example\n-\t\t\t * // Executes a method on the theme directly\n-\t\t\t * tinyMCE.activeEditor.theme.someMethod();\n-\t\t\t */\n-\t\t\tif (s.theme) {\n-\t\t\t\tif (typeof s.theme != \"function\") {\n-\t\t\t\t\ts.theme = s.theme.replace(/-/, '');\n-\t\t\t\t\to = ThemeManager.get(s.theme);\n-\t\t\t\t\tt.theme = new o();\n-\n-\t\t\t\t\tif (t.theme.init)\n-\t\t\t\t\t\tt.theme.init(t, ThemeManager.urls[s.theme] || tinymce.documentBaseURL.replace(/\\/$/, ''));\n-\t\t\t\t} else {\n-\t\t\t\t\tt.theme = s.theme;\n-\t\t\t\t}\n-\t\t\t}\n-\n-\t\t\tfunction initPlugin(p) {\n-\t\t\t\tvar c = PluginManager.get(p), u = PluginManager.urls[p] || tinymce.documentBaseURL.replace(/\\/$/, ''), po;\n-\t\t\t\tif (c && tinymce.inArray(initializedPlugins,p) === -1) {\n-\t\t\t\t\teach(PluginManager.dependencies(p), function(dep){\n-\t\t\t\t\t\tinitPlugin(dep);\n-\t\t\t\t\t});\n-\t\t\t\t\tpo = new c(t, u);\n-\n-\t\t\t\t\tt.plugins[p] = po;\n-\n-\t\t\t\t\tif (po.init) {\n-\t\t\t\t\t\tpo.init(t, u);\n-\t\t\t\t\t\tinitializedPlugins.push(p);\n-\t\t\t\t\t}\n-\t\t\t\t}\n-\t\t\t}\n-\t\t\t\n-\t\t\t// Create all plugins\n-\t\t\teach(explode(s.plugins.replace(/\\-/g, '')), initPlugin);\n-\n-\t\t\t// Setup popup CSS path(s)\n-\t\t\tif (s.popup_css !== false) {\n-\t\t\t\tif (s.popup_css)\n-\t\t\t\t\ts.popup_css = t.documentBaseURI.toAbsolute(s.popup_css);\n-\t\t\t\telse\n-\t\t\t\t\ts.popup_css = t.baseURI.toAbsolute(\"themes/\" + s.theme + \"/skins/\" + s.skin + \"/dialog.css\");\n-\t\t\t}\n-\n-\t\t\tif (s.popup_css_add)\n-\t\t\t\ts.popup_css += ',' + t.documentBaseURI.toAbsolute(s.popup_css_add);\n-\n-\t\t\t/**\n-\t\t\t * Control manager instance for the editor. Will enables you to create new UI elements and change their states etc.\n-\t\t\t *\n-\t\t\t * @property controlManager\n-\t\t\t * @type tinymce.ControlManager\n-\t\t\t * @example\n-\t\t\t * // Disables the bold button\n-\t\t\t * tinyMCE.activeEditor.controlManager.setDisabled('bold', true);\n-\t\t\t */\n-\t\t\tt.controlManager = new tinymce.ControlManager(t);\n-\n-\t\t\t// Enables users to override the control factory\n-\t\t\tt.onBeforeRenderUI.dispatch(t, t.controlManager);\n-\n-\t\t\t// Measure box\n-\t\t\tif (s.render_ui && t.theme) {\n-\t\t\t\tt.orgDisplay = e.style.display;\n-\n-\t\t\t\tif (typeof s.theme != \"function\") {\n-\t\t\t\t\tw = s.width || e.style.width || e.offsetWidth;\n-\t\t\t\t\th = s.height || e.style.height || e.offsetHeight;\n-\t\t\t\t\tmh = s.min_height || 100;\n-\t\t\t\t\tre = /^[0-9\\.]+(|px)$/i;\n-\n-\t\t\t\t\tif (re.test('' + w))\n-\t\t\t\t\t\tw = Math.max(parseInt(w, 10) + (o.deltaWidth || 0), 100);\n-\n-\t\t\t\t\tif (re.test('' + h))\n-\t\t\t\t\t\th = Math.max(parseInt(h, 10) + (o.deltaHeight || 0), mh);\n-\n-\t\t\t\t\t// Render UI\n-\t\t\t\t\to = t.theme.renderUI({\n-\t\t\t\t\t\ttargetNode : e,\n-\t\t\t\t\t\twidth : w,\n-\t\t\t\t\t\theight : h,\n-\t\t\t\t\t\tdeltaWidth : s.delta_width,\n-\t\t\t\t\t\tdeltaHeight : s.delta_height\n-\t\t\t\t\t});\n-\n-\t\t\t\t\t// Resize editor\n-\t\t\t\t\tDOM.setStyles(o.sizeContainer || o.editorContainer, {\n-\t\t\t\t\t\twidth : w,\n-\t\t\t\t\t\theight : h\n-\t\t\t\t\t});\n-\n-\t\t\t\t\th = (o.iframeHeight || h) + (typeof(h) == 'number' ? (o.deltaHeight || 0) : '');\n-\t\t\t\t\tif (h < mh)\n-\t\t\t\t\t\th = mh;\n-\t\t\t\t} else {\n-\t\t\t\t\to = s.theme(t, e);\n-\n-\t\t\t\t\t// Convert element type to id:s\n-\t\t\t\t\tif (o.editorContainer.nodeType) {\n-\t\t\t\t\t\to.editorContainer = o.editorContainer.id = o.editorContainer.id || t.id + \"_parent\";\n-\t\t\t\t\t}\n-\n-\t\t\t\t\t// Convert element type to id:s\n-\t\t\t\t\tif (o.iframeContainer.nodeType) {\n-\t\t\t\t\t\to.iframeContainer = o.iframeContainer.id = o.iframeContainer.id || t.id + \"_iframecontainer\";\n-\t\t\t\t\t}\n-\n-\t\t\t\t\t// Use specified iframe height or the targets offsetHeight\n-\t\t\t\t\th = o.iframeHeight || e.offsetHeight;\n-\n-\t\t\t\t\t// Store away the selection when it's changed to it can be restored later with a editor.focus() call\n-\t\t\t\t\tif (isIE) {\n-\t\t\t\t\t\tt.onInit.add(function(ed) {\n-\t\t\t\t\t\t\ted.dom.bind(ed.getBody(), 'beforedeactivate keydown keyup', function() {\n-\t\t\t\t\t\t\t\ted.bookmark = ed.selection.getBookmark(1);\n-\t\t\t\t\t\t\t});\n-\t\t\t\t\t\t});\n-\n-\t\t\t\t\t\tt.onNodeChange.add(function(ed) {\n-\t\t\t\t\t\t\tif (document.activeElement.id == ed.id + \"_ifr\") {\n-\t\t\t\t\t\t\t\ted.bookmark = ed.selection.getBookmark(1);\n-\t\t\t\t\t\t\t}\n-\t\t\t\t\t\t});\n-\t\t\t\t\t}\n-\t\t\t\t}\n-\n-\t\t\t\tt.editorContainer = o.editorContainer;\n-\t\t\t}\n-\n-\t\t\t// Load specified content CSS last\n-\t\t\tif (s.content_css) {\n-\t\t\t\teach(explode(s.content_css), function(u) {\n-\t\t\t\t\tt.contentCSS.push(t.documentBaseURI.toAbsolute(u));\n-\t\t\t\t});\n-\t\t\t}\n-\n-\t\t\t// Load specified content CSS last\n-\t\t\tif (s.content_style) {\n-\t\t\t\tt.contentStyles.push(s.content_style);\n-\t\t\t}\n-\n-\t\t\t// Content editable mode ends here\n-\t\t\tif (s.content_editable) {\n-\t\t\t\te = n = o = null; // Fix IE leak\n-\t\t\t\treturn t.initContentBody();\n-\t\t\t}\n-\n-\t\t\t// User specified a document.domain value\n-\t\t\tif (document.domain && location.hostname != document.domain)\n-\t\t\t\ttinymce.relaxedDomain = document.domain;\n-\n-\t\t\tt.iframeHTML = s.doctype + '<html><head xmlns=\"http://www.w3.org/1999/xhtml\">';\n-\n-\t\t\t// We only need to override paths if we have to\n-\t\t\t// IE has a bug where it remove site absolute urls to relative ones if this is specified\n-\t\t\tif (s.document_base_url != tinymce.documentBaseURL)\n-\t\t\t\tt.iframeHTML += '<base href=\"' + t.documentBaseURI.getURI() + '\" />';\n-\n-\t\t\t// IE8 doesn't support carets behind images setting ie7_compat would force IE8+ to run in IE7 compat mode.\n-\t\t\tif (tinymce.isIE8) {\n-\t\t\t\tif (s.ie7_compat)\n-\t\t\t\t\tt.iframeHTML += '<meta http-equiv=\"X-UA-Compatible\" content=\"IE=7\" />';\n-\t\t\t\telse\n-\t\t\t\t\tt.iframeHTML += '<meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\" />';\n-\t\t\t}\n-\n-\t\t\tt.iframeHTML += '<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />';\n-\n-\t\t\t// Load the CSS by injecting them into the HTML this will reduce \"flicker\"\n-\t\t\tfor (i = 0; i < t.contentCSS.length; i++) {\n-\t\t\t\tt.iframeHTML += '<link type=\"text/css\" rel=\"stylesheet\" href=\"' + t.contentCSS[i] + '\" />';\n-\t\t\t}\n-\n-\t\t\tt.contentCSS = [];\n-\n-\t\t\tbi = s.body_id || 'tinymce';\n-\t\t\tif (bi.indexOf('=') != -1) {\n-\t\t\t\tbi = t.getParam('body_id', '', 'hash');\n-\t\t\t\tbi = bi[t.id] || bi;\n-\t\t\t}\n-\n-\t\t\tbc = s.body_class || '';\n-\t\t\tif (bc.indexOf('=') != -1) {\n-\t\t\t\tbc = t.getParam('body_class', '', 'hash');\n-\t\t\t\tbc = bc[t.id] || '';\n-\t\t\t}\n-\n-\t\t\tt.iframeHTML += '</head><body id=\"' + bi + '\" class=\"mceContentBody ' + bc + '\" onload=\"window.parent.tinyMCE.get(\\'' + t.id + '\\').onLoad.dispatch();\"><br></body></html>';\n-\n-\t\t\t// Domain relaxing enabled, then set document domain\n-\t\t\tif (tinymce.relaxedDomain && (isIE || (tinymce.isOpera && parseFloat(opera.version()) < 11))) {\n-\t\t\t\t// We need to write the contents here in IE since multiple writes messes up refresh button and back button\n-\t\t\t\tu = 'javascript:(function(){document.open();document.domain=\"' + document.domain + '\";var ed = window.parent.tinyMCE.get(\"' + t.id + '\");document.write(ed.iframeHTML);document.close();ed.initContentBody();})()';\n-\t\t\t}\n-\n-\t\t\t// Create iframe\n-\t\t\t// TODO: ACC add the appropriate description on this.\n-\t\t\tn = DOM.add(o.iframeContainer, 'iframe', { \n-\t\t\t\tid : t.id + \"_ifr\",\n-\t\t\t\tsrc : u || 'javascript:\"\"', // Workaround for HTTPS warning in IE6/7\n-\t\t\t\tframeBorder : '0',\n-\t\t\t\tallowTransparency : \"true\",\n-\t\t\t\ttitle : s.aria_label,\n-\t\t\t\tstyle : {\n-\t\t\t\t\twidth : '100%',\n-\t\t\t\t\theight : h,\n-\t\t\t\t\tdisplay : 'block' // Important for Gecko to render the iframe correctly\n-\t\t\t\t}\n-\t\t\t});\n-\n-\t\t\tt.contentAreaContainer = o.iframeContainer;\n-\n-\t\t\tif (o.editorContainer) {\n-\t\t\t\tDOM.get(o.editorContainer).style.display = t.orgDisplay;\n-\t\t\t}\n-\n-\t\t\t// Restore visibility on target element\n-\t\t\te.style.visibility = t.orgVisibility;\n-\n-\t\t\tDOM.get(t.id).style.display = 'none';\n-\t\t\tDOM.setAttrib(t.id, 'aria-hidden', true);\n-\n-\t\t\tif (!tinymce.relaxedDomain || !u)\n-\t\t\t\tt.initContentBody();\n-\n-\t\t\te = n = o = null; // Cleanup\n-\t\t},\n-\n-\t\t/**\n-\t\t * This method get called by the init method ones the iframe is loaded.\n-\t\t * It will fill the iframe with contents, setups DOM and selection objects for the iframe.\n-\t\t * This method should not be called directly.\n-\t\t *\n-\t\t * @method initContentBody\n-\t\t */\n-\t\tinitContentBody : function() {\n-\t\t\tvar self = this, settings = self.settings, targetElm = DOM.get(self.id), doc = self.getDoc(), html, body, contentCssText;\n-\n-\t\t\t// Setup iframe body\n-\t\t\tif ((!isIE || !tinymce.relaxedDomain) && !settings.content_editable) {\n-\t\t\t\tdoc.open();\n-\t\t\t\tdoc.write(self.iframeHTML);\n-\t\t\t\tdoc.close();\n-\n-\t\t\t\tif (tinymce.relaxedDomain)\n-\t\t\t\t\tdoc.domain = tinymce.relaxedDomain;\n-\t\t\t}\n-\n-\t\t\tif (settings.content_editable) {\n-\t\t\t\tDOM.addClass(targetElm, 'mceContentBody');\n-\t\t\t\tself.contentDocument = doc = settings.content_document || document;\n-\t\t\t\tself.contentWindow = settings.content_window || window;\n-\t\t\t\tself.bodyElement = targetElm;\n-\n-\t\t\t\t// Prevent leak in IE\n-\t\t\t\tsettings.content_document = settings.content_window = null;\n-\t\t\t}\n-\n-\t\t\t// It will not steal focus while setting contentEditable\n-\t\t\tbody = self.getBody();\n-\t\t\tbody.disabled = true;\n-\n-\t\t\tif (!settings.readonly)\n-\t\t\t\tbody.contentEditable = self.getParam('content_editable_state', true);\n-\n-\t\t\tbody.disabled = false;\n-\n-\t\t\t/**\n-\t\t\t * Schema instance, enables you to validate elements and it's children.\n-\t\t\t *\n-\t\t\t * @property schema\n-\t\t\t * @type tinymce.html.Schema\n-\t\t\t */\n-\t\t\tself.schema = new tinymce.html.Schema(settings);\n-\n-\t\t\t/**\n-\t\t\t * DOM instance for the editor.\n-\t\t\t *\n-\t\t\t * @property dom\n-\t\t\t * @type tinymce.dom.DOMUtils\n-\t\t\t * @example\n-\t\t\t * // Adds a class to all paragraphs within the editor\n-\t\t\t * tinyMCE.activeEditor.dom.addClass(tinyMCE.activeEditor.dom.select('p'), 'someclass');\n-\t\t\t */\n-\t\t\tself.dom = new tinymce.dom.DOMUtils(doc, {\n-\t\t\t\tkeep_values : true,\n-\t\t\t\turl_converter : self.convertURL,\n-\t\t\t\turl_converter_scope : self,\n-\t\t\t\thex_colors : settings.force_hex_style_colors,\n-\t\t\t\tclass_filter : settings.class_filter,\n-\t\t\t\tupdate_styles : true,\n-\t\t\t\troot_element : settings.content_editable ? self.id : null,\n-\t\t\t\tschema : self.schema\n-\t\t\t});\n-\n-\t\t\t/**\n-\t\t\t * HTML parser will be used when contents is inserted into the editor.\n-\t\t\t *\n-\t\t\t * @property parser\n-\t\t\t * @type tinymce.html.DomParser\n-\t\t\t */\n-\t\t\tself.parser = new tinymce.html.DomParser(settings, self.schema);\n-\n-\t\t\t// Convert src and href into data-mce-src, data-mce-href and data-mce-style\n-\t\t\tself.parser.addAttributeFilter('src,href,style', function(nodes, name) {\n-\t\t\t\tvar i = nodes.length, node, dom = self.dom, value, internalName;\n-\n-\t\t\t\twhile (i--) {\n-\t\t\t\t\tnode = nodes[i];\n-\t\t\t\t\tvalue = node.attr(name);\n-\t\t\t\t\tinternalName = 'data-mce-' + name;\n-\n-\t\t\t\t\t// Add internal attribute if we need to we don't on a refresh of the document\n-\t\t\t\t\tif (!node.attributes.map[internalName]) {\t\n-\t\t\t\t\t\tif (name === \"style\")\n-\t\t\t\t\t\t\tnode.attr(internalName, dom.serializeStyle(dom.parseStyle(value), node.name));\n-\t\t\t\t\t\telse\n-\t\t\t\t\t\t\tnode.attr(internalName, self.convertURL(value, name, node.name));\n-\t\t\t\t\t}\n-\t\t\t\t}\n-\t\t\t});\n-\n-\t\t\t// Keep scripts from executing\n-\t\t\tself.parser.addNodeFilter('script', function(nodes, name) {\n-\t\t\t\tvar i = nodes.length, node;\n-\n-\t\t\t\twhile (i--) {\n-\t\t\t\t\tnode = nodes[i];\n-\t\t\t\t\tnode.attr('type', 'mce-' + (node.attr('type') || 'text/javascript'));\n-\t\t\t\t}\n-\t\t\t});\n-\n-\t\t\tself.parser.addNodeFilter('#cdata', function(nodes, name) {\n-\t\t\t\tvar i = nodes.length, node;\n-\n-\t\t\t\twhile (i--) {\n-\t\t\t\t\tnode = nodes[i];\n-\t\t\t\t\tnode.type = 8;\n-\t\t\t\t\tnode.name = '#comment';\n-\t\t\t\t\tnode.value = '[CDATA[' + node.value + ']]';\n-\t\t\t\t}\n-\t\t\t});\n-\n-\t\t\tself.parser.addNodeFilter('p,h1,h2,h3,h4,h5,h6,div', function(nodes, name) {\n-\t\t\t\tvar i = nodes.length, node, nonEmptyElements = self.schema.getNonEmptyElements();\n-\n-\t\t\t\twhile (i--) {\n-\t\t\t\t\tnode = nodes[i];\n-\n-\t\t\t\t\tif (node.isEmpty(nonEmptyElements))\n-\t\t\t\t\t\tnode.empty().append(new tinymce.html.Node('br', 1)).shortEnded = true;\n-\t\t\t\t}\n-\t\t\t});\n-\n-\t\t\t/**\n-\t\t\t * DOM serializer for the editor. Will be used when contents is extracted from the editor.\n-\t\t\t *\n-\t\t\t * @property serializer\n-\t\t\t * @type tinymce.dom.Serializer\n-\t\t\t * @example\n-\t\t\t * // Serializes the first paragraph in the editor into a string\n-\t\t\t * tinyMCE.activeEditor.serializer.serialize(tinyMCE.activeEditor.dom.select('p')[0]);\n-\t\t\t */\n-\t\t\tself.serializer = new tinymce.dom.Serializer(settings, self.dom, self.schema);\n-\n-\t\t\t/**\n-\t\t\t * Selection instance for the editor.\n-\t\t\t *\n-\t\t\t * @property selection\n-\t\t\t * @type tinymce.dom.Selection\n-\t\t\t * @example\n-\t\t\t * // Sets some contents to the current selection in the editor\n-\t\t\t * tinyMCE.activeEditor.selection.setContent('Some contents');\n-\t\t\t *\n-\t\t\t * // Gets the current selection\n-\t\t\t * alert(tinyMCE.activeEditor.selection.getContent());\n-\t\t\t *\n-\t\t\t * // Selects the first paragraph found\n-\t\t\t * tinyMCE.activeEditor.selection.select(tinyMCE.activeEditor.dom.select('p')[0]);\n-\t\t\t */\n-\t\t\tself.selection = new tinymce.dom.Selection(self.dom, self.getWin(), self.serializer, self);\n-\n-\t\t\t/**\n-\t\t\t * Formatter instance.\n-\t\t\t *\n-\t\t\t * @property formatter\n-\t\t\t * @type tinymce.Formatter\n-\t\t\t */\n-\t\t\tself.formatter = new tinymce.Formatter(self);\n-\n-\t\t\t/**\n-\t\t\t * Undo manager instance, responsible for handling undo levels. \n-\t\t\t *\n-\t\t\t * @property undoManager\n-\t\t\t * @type tinymce.UndoManager\n-\t\t\t * @example\n-\t\t\t * // Undoes the last modification to the editor\n-\t\t\t * tinyMCE.activeEditor.undoManager.undo();\n-\t\t\t */\n-\t\t\tself.undoManager = new tinymce.UndoManager(self);\n-\n-\t\t\tself.forceBlocks = new tinymce.ForceBlocks(self);\n-\t\t\tself.enterKey = new tinymce.EnterKey(self);\n-\t\t\tself.editorCommands = new tinymce.EditorCommands(self);\n-\n-\t\t\tself.onExecCommand.add(function(editor, command) {\n-\t\t\t\t// Don't refresh the select lists until caret move\n-\t\t\t\tif (!/^(FontName|FontSize)$/.test(command))\n-\t\t\t\t\tself.nodeChanged();\n-\t\t\t});\n-\n-\t\t\t// Pass through\n-\t\t\tself.serializer.onPreProcess.add(function(se, o) {\n-\t\t\t\treturn self.onPreProcess.dispatch(self, o, se);\n-\t\t\t});\n-\n-\t\t\tself.serializer.onPostProcess.add(function(se, o) {\n-\t\t\t\treturn self.onPostProcess.dispatch(self, o, se);\n-\t\t\t});\n-\n-\t\t\tself.onPreInit.dispatch(self);\n-\n-\t\t\tif (!settings.browser_spellcheck && !settings.gecko_spellcheck)\n-\t\t\t\tdoc.body.spellcheck = false;\n-\n-\t\t\tif (!settings.readonly) {\n-\t\t\t\tself.bindNativeEvents();\n-\t\t\t}\n-\n-\t\t\tself.controlManager.onPostRender.dispatch(self, self.controlManager);\n-\t\t\tself.onPostRender.dispatch(self);\n-\n-\t\t\tself.quirks = tinymce.util.Quirks(self);\n-\n-\t\t\tif (settings.directionality)\n-\t\t\t\tbody.dir = settings.directionality;\n-\n-\t\t\tif (settings.nowrap)\n-\t\t\t\tbody.style.whiteSpace = \"nowrap\";\n-\n-\t\t\tif (settings.protect) {\n-\t\t\t\tself.onBeforeSetContent.add(function(ed, o) {\n-\t\t\t\t\teach(settings.protect, function(pattern) {\n-\t\t\t\t\t\to.content = o.content.replace(pattern, function(str) {\n-\t\t\t\t\t\t\treturn '<!--mce:protected ' + escape(str) + '-->';\n-\t\t\t\t\t\t});\n-\t\t\t\t\t});\n-\t\t\t\t});\n-\t\t\t}\n-\n-\t\t\t// Add visual aids when new contents is added\n-\t\t\tself.onSetContent.add(function() {\n-\t\t\t\tself.addVisual(self.getBody());\n-\t\t\t});\n-\n-\t\t\t// Remove empty contents\n-\t\t\tif (settings.padd_empty_editor) {\n-\t\t\t\tself.onPostProcess.add(function(ed, o) {\n-\t\t\t\t\to.content = o.content.replace(/^(<p[^>]*>(&nbsp;|&#160;|\\s|\\u00a0|)<\\/p>[\\r\\n]*|<br \\/>[\\r\\n]*)$/, '');\n-\t\t\t\t});\n-\t\t\t}\n-\n-\t\t\tself.load({initial : true, format : 'html'});\n-\t\t\tself.startContent = self.getContent({format : 'raw'});\n-\n-\t\t\t/**\n-\t\t\t * Is set to true after the editor instance has been initialized\n-\t\t\t *\n-\t\t\t * @property initialized\n-\t\t\t * @type Boolean\n-\t\t\t * @example\n-\t\t\t * function isEditorInitialized(editor) {\n-\t\t\t *     return editor && editor.initialized;\n-\t\t\t * }\n-\t\t\t */\n-\t\t\tself.initialized = true;\n-\n-\t\t\tself.onInit.dispatch(self);\n-\t\t\tself.execCallback('setupcontent_callback', self.id, body, doc);\n-\t\t\tself.execCallback('init_instance_callback', self);\n-\t\t\tself.focus(true);\n-\t\t\tself.nodeChanged({initial : true});\n-\n-\t\t\t// Add editor specific CSS styles\n-\t\t\tif (self.contentStyles.length > 0) {\n-\t\t\t\tcontentCssText = '';\n-\n-\t\t\t\teach(self.contentStyles, function(style) {\n-\t\t\t\t\tcontentCssText += style + \"\\r\\n\";\n-\t\t\t\t});\n-\n-\t\t\t\tself.dom.addStyle(contentCssText);\n-\t\t\t}\n-\n-\t\t\t// Load specified content CSS last\n-\t\t\teach(self.contentCSS, function(url) {\n-\t\t\t\tself.dom.loadCSS(url);\n-\t\t\t});\n-\n-\t\t\t// Handle auto focus\n-\t\t\tif (settings.auto_focus) {\n-\t\t\t\tsetTimeout(function () {\n-\t\t\t\t\tvar ed = tinymce.get(settings.auto_focus);\n-\n-\t\t\t\t\ted.selection.select(ed.getBody(), 1);\n-\t\t\t\t\ted.selection.collapse(1);\n-\t\t\t\t\ted.getBody().focus();\n-\t\t\t\t\ted.getWin().focus();\n-\t\t\t\t}, 100);\n-\t\t\t}\n-\n-\t\t\t// Clean up references for IE\n-\t\t\ttargetElm = doc = body = null;\n-\t\t},\n-\n-\t\t/**\n-\t\t * Focuses/activates the editor. This will set this editor as the activeEditor in the tinymce collection\n-\t\t * it will also place DOM focus inside the editor.\n-\t\t *\n-\t\t * @method focus\n-\t\t * @param {Boolean} skip_focus Skip DOM focus. Just set is as the active editor.\n-\t\t */\n-\t\tfocus : function(skip_focus) {\n-\t\t\tvar oed, self = this, selection = self.selection, contentEditable = self.settings.content_editable, ieRng, controlElm, doc = self.getDoc(), body;\n-\n-\t\t\tif (!skip_focus) {\n-\t\t\t\tif (self.bookmark) {\n-\t\t\t\t\tselection.moveToBookmark(self.bookmark);\n-\t\t\t\t\tself.bookmark = null;\n-\t\t\t\t}\n-\n-\t\t\t\t// Get selected control element\n-\t\t\t\tieRng = selection.getRng();\n-\t\t\t\tif (ieRng.item) {\n-\t\t\t\t\tcontrolElm = ieRng.item(0);\n-\t\t\t\t}\n-\n-\t\t\t\tself._refreshContentEditable();\n-\n-\t\t\t\t// Focus the window iframe\n-\t\t\t\tif (!contentEditable) {\n-\t\t\t\t\tself.getWin().focus();\n-\t\t\t\t}\n-\n-\t\t\t\t// Focus the body as well since it's contentEditable\n-\t\t\t\tif (tinymce.isGecko || contentEditable) {\n-\t\t\t\t\tbody = self.getBody();\n-\n-\t\t\t\t\t// Check for setActive since it doesn't scroll to the element\n-\t\t\t\t\tif (body.setActive && ! tinymce.isIE11) {\n-\t\t\t\t\t\tbody.setActive();\n-\t\t\t\t\t} else {\n-\t\t\t\t\t\tbody.focus();\n-\t\t\t\t\t}\n-\n-\t\t\t\t\tif (contentEditable) {\n-\t\t\t\t\t\tselection.normalize();\n-\t\t\t\t\t}\n-\t\t\t\t}\n-\n-\t\t\t\t// Restore selected control element\n-\t\t\t\t// This is needed when for example an image is selected within a\n-\t\t\t\t// layer a call to focus will then remove the control selection\n-\t\t\t\tif (controlElm && controlElm.ownerDocument == doc) {\n-\t\t\t\t\tieRng = doc.body.createControlRange();\n-\t\t\t\t\tieRng.addElement(controlElm);\n-\t\t\t\t\tieRng.select();\n-\t\t\t\t}\n-\t\t\t}\n-\n-\t\t\tif (tinymce.activeEditor != self) {\n-\t\t\t\tif ((oed = tinymce.activeEditor) != null)\n-\t\t\t\t\toed.onDeactivate.dispatch(oed, self);\n-\n-\t\t\t\tself.onActivate.dispatch(self, oed);\n-\t\t\t}\n-\n-\t\t\ttinymce._setActive(self);\n-\t\t},\n-\n-\t\t/**\n-\t\t * Executes a legacy callback. This method is useful to call old 2.x option callbacks.\n-\t\t * There new event model is a better way to add callback so this method might be removed in the future.\n-\t\t *\n-\t\t * @method execCallback\n-\t\t * @param {String} n Name of the callback to execute.\n-\t\t * @return {Object} Return value passed from callback function.\n-\t\t */\n-\t\texecCallback : function(n) {\n-\t\t\tvar t = this, f = t.settings[n], s;\n-\n-\t\t\tif (!f)\n-\t\t\t\treturn;\n-\n-\t\t\t// Look through lookup\n-\t\t\tif (t.callbackLookup && (s = t.callbackLookup[n])) {\n-\t\t\t\tf = s.func;\n-\t\t\t\ts = s.scope;\n-\t\t\t}\n-\n-\t\t\tif (is(f, 'string')) {\n-\t\t\t\ts = f.replace(/\\.\\w+$/, '');\n-\t\t\t\ts = s ? tinymce.resolve(s) : 0;\n-\t\t\t\tf = tinymce.resolve(f);\n-\t\t\t\tt.callbackLookup = t.callbackLookup || {};\n-\t\t\t\tt.callbackLookup[n] = {func : f, scope : s};\n-\t\t\t}\n-\n-\t\t\treturn f.apply(s || t, Array.prototype.slice.call(arguments, 1));\n-\t\t},\n-\n-\t\t/**\n-\t\t * Translates the specified string by replacing variables with language pack items it will also check if there is\n-\t\t * a key mathcin the input.\n-\t\t *\n-\t\t * @method translate\n-\t\t * @param {String} s String to translate by the language pack data.\n-\t\t * @return {String} Translated string.\n-\t\t */\n-\t\ttranslate : function(s) {\n-\t\t\tvar c = this.settings.language || 'en', i18n = tinymce.i18n;\n-\n-\t\t\tif (!s)\n-\t\t\t\treturn '';\n-\n-\t\t\treturn i18n[c + '.' + s] || s.replace(/\\{\\#([^\\}]+)\\}/g, function(a, b) {\n-\t\t\t\treturn i18n[c + '.' + b] || '{#' + b + '}';\n-\t\t\t});\n-\t\t},\n-\n-\t\t/**\n-\t\t * Returns a language pack item by name/key.\n-\t\t *\n-\t\t * @method getLang\n-\t\t * @param {String} n Name/key to get from the language pack.\n-\t\t * @param {String} dv Optional default value to retrieve.\n-\t\t */\n-\t\tgetLang : function(n, dv) {\n-\t\t\treturn tinymce.i18n[(this.settings.language || 'en') + '.' + n] || (is(dv) ? dv : '{#' + n + '}');\n-\t\t},\n-\n-\t\t/**\n-\t\t * Returns a configuration parameter by name.\n-\t\t *\n-\t\t * @method getParam\n-\t\t * @param {String} n Configruation parameter to retrieve.\n-\t\t * @param {String} dv Optional default value to return.\n-\t\t * @param {String} ty Optional type parameter.\n-\t\t * @return {String} Configuration parameter value or default value.\n-\t\t * @example\n-\t\t * // Returns a specific config value from the currently active editor\n-\t\t * var someval = tinyMCE.activeEditor.getParam('myvalue');\n-\t\t * \n-\t\t * // Returns a specific config value from a specific editor instance by id\n-\t\t * var someval2 = tinyMCE.get('my_editor').getParam('myvalue');\n-\t\t */\n-\t\tgetParam : function(n, dv, ty) {\n-\t\t\tvar tr = tinymce.trim, v = is(this.settings[n]) ? this.settings[n] : dv, o;\n-\n-\t\t\tif (ty === 'hash') {\n-\t\t\t\to = {};\n-\n-\t\t\t\tif (is(v, 'string')) {\n-\t\t\t\t\teach(v.indexOf('=') > 0 ? v.split(/[;,](?![^=;,]*(?:[;,]|$))/) : v.split(','), function(v) {\n-\t\t\t\t\t\tv = v.split('=');\n-\n-\t\t\t\t\t\tif (v.length > 1)\n-\t\t\t\t\t\t\to[tr(v[0])] = tr(v[1]);\n-\t\t\t\t\t\telse\n-\t\t\t\t\t\t\to[tr(v[0])] = tr(v);\n-\t\t\t\t\t});\n-\t\t\t\t} else\n-\t\t\t\t\to = v;\n-\n-\t\t\t\treturn o;\n-\t\t\t}\n-\n-\t\t\treturn v;\n-\t\t},\n-\n-\t\t/**\n-\t\t * Distpaches out a onNodeChange event to all observers. This method should be called when you\n-\t\t * need to update the UI states or element path etc.\n-\t\t *\n-\t\t * @method nodeChanged\n-\t\t * @param {Object} o Optional object to pass along for the node changed event.\n-\t\t */\n-\t\tnodeChanged : function(o) {\n-\t\t\tvar self = this, selection = self.selection, node;\n-\n-\t\t\t// Fix for bug #1896577 it seems that this can not be fired while the editor is loading\n-\t\t\tif (self.initialized) {\n-\t\t\t\to = o || {};\n-\n-\t\t\t\t// Get start node\n-\t\t\t\tnode = selection.getStart() || self.getBody();\n-\t\t\t\tnode = isIE && node.ownerDocument != self.getDoc() ? self.getBody() : node; // Fix for IE initial state\n-\n-\t\t\t\t// Get parents and add them to object\n-\t\t\t\to.parents = [];\n-\t\t\t\tself.dom.getParent(node, function(node) {\n-\t\t\t\t\tif (node.nodeName == 'BODY')\n-\t\t\t\t\t\treturn true;\n-\n-\t\t\t\t\to.parents.push(node);\n-\t\t\t\t});\n-\n-\t\t\t\tself.onNodeChange.dispatch(\n-\t\t\t\t\tself,\n-\t\t\t\t\to ? o.controlManager || self.controlManager : self.controlManager,\n-\t\t\t\t\tnode,\n-\t\t\t\t\tselection.isCollapsed(),\n-\t\t\t\t\to\n-\t\t\t\t);\n-\t\t\t}\n-\t\t},\n-\n-\t\t/**\n-\t\t * Adds a button that later gets created by the ControlManager. This is a shorter and easier method\n-\t\t * of adding buttons without the need to deal with the ControlManager directly. But it's also less\n-\t\t * powerfull if you need more control use the ControlManagers factory methods instead.\n-\t\t *\n-\t\t * @method addButton\n-\t\t * @param {String} name Button name to add.\n-\t\t * @param {Object} settings Settings object with title, cmd etc.\n-\t\t * @example\n-\t\t * // Adds a custom button to the editor and when a user clicks the button it will open\n-\t\t * // an alert box with the selected contents as plain text.\n-\t\t * tinyMCE.init({\n-\t\t *    ...\n-\t\t * \n-\t\t *    theme_advanced_buttons1 : 'example,..'\n-\t\t * \n-\t\t *    setup : function(ed) {\n-\t\t *       // Register example button\n-\t\t *       ed.addButton('example', {\n-\t\t *          title : 'example.desc',\n-\t\t *          image : '../jscripts/tiny_mce/plugins/example/img/example.gif',\n-\t\t *          onclick : function() {\n-\t\t *             ed.windowManager.alert('Hello world!! Selection: ' + ed.selection.getContent({format : 'text'}));\n-\t\t *          }\n-\t\t *       });\n-\t\t *    }\n-\t\t * });\n-\t\t */\n-\t\taddButton : function(name, settings) {\n-\t\t\tvar self = this;\n-\n-\t\t\tself.buttons = self.buttons || {};\n-\t\t\tself.buttons[name] = settings;\n-\t\t},\n-\n-\t\t/**\n-\t\t * Adds a custom command to the editor, you can also override existing commands with this method.\n-\t\t * The command that you add can be executed with execCommand.\n-\t\t *\n-\t\t * @method addCommand\n-\t\t * @param {String} name Command name to add/override.\n-\t\t * @param {addCommandCallback} callback Function to execute when the command occurs.\n-\t\t * @param {Object} scope Optional scope to execute the function in.\n-\t\t * @example\n-\t\t * // Adds a custom command that later can be executed using execCommand\n-\t\t * tinyMCE.init({\n-\t\t *    ...\n-\t\t * \n-\t\t *    setup : function(ed) {\n-\t\t *       // Register example command\n-\t\t *       ed.addCommand('mycommand', function(ui, v) {\n-\t\t *          ed.windowManager.alert('Hello world!! Selection: ' + ed.selection.getContent({format : 'text'}));\n-\t\t *       });\n-\t\t *    }\n-\t\t * });\n-\t\t */\n-\t\taddCommand : function(name, callback, scope) {\n-\t\t\t/**\n-\t\t\t * Callback function that gets called when a command is executed.\n-\t\t\t *\n-\t\t\t * @callback addCommandCallback\n-\t\t\t * @param {Boolean} ui Display UI state true/false.\n-\t\t\t * @param {Object} value Optional value for command.\n-\t\t\t * @return {Boolean} True/false state if the command was handled or not.\n-\t\t\t */\n-\t\t\tthis.execCommands[name] = {func : callback, scope : scope || this};\n-\t\t},\n-\n-\t\t/**\n-\t\t * Adds a custom query state command to the editor, you can also override existing commands with this method.\n-\t\t * The command that you add can be executed with queryCommandState function.\n-\t\t *\n-\t\t * @method addQueryStateHandler\n-\t\t * @param {String} name Command name to add/override.\n-\t\t * @param {addQueryStateHandlerCallback} callback Function to execute when the command state retrival occurs.\n-\t\t * @param {Object} scope Optional scope to execute the function in.\n-\t\t */\n-\t\taddQueryStateHandler : function(name, callback, scope) {\n-\t\t\t/**\n-\t\t\t * Callback function that gets called when a queryCommandState is executed.\n-\t\t\t *\n-\t\t\t * @callback addQueryStateHandlerCallback\n-\t\t\t * @return {Boolean} True/false state if the command is enabled or not like is it bold.\n-\t\t\t */\n-\t\t\tthis.queryStateCommands[name] = {func : callback, scope : scope || this};\n-\t\t},\n-\n-\t\t/**\n-\t\t * Adds a custom query value command to the editor, you can also override existing commands with this method.\n-\t\t * The command that you add can be executed with queryCommandValue function.\n-\t\t *\n-\t\t * @method addQueryValueHandler\n-\t\t * @param {String} name Command name to add/override.\n-\t\t * @param {addQueryValueHandlerCallback} callback Function to execute when the command value retrival occurs.\n-\t\t * @param {Object} scope Optional scope to execute the function in.\n-\t\t */\n-\t\taddQueryValueHandler : function(name, callback, scope) {\n-\t\t\t/**\n-\t\t\t * Callback function that gets called when a queryCommandValue is executed.\n-\t\t\t *\n-\t\t\t * @callback addQueryValueHandlerCallback\n-\t\t\t * @return {Object} Value of the command or undefined.\n-\t\t\t */\n-\t\t\tthis.queryValueCommands[name] = {func : callback, scope : scope || this};\n-\t\t},\n-\n-\t\t/**\n-\t\t * Adds a keyboard shortcut for some command or function.\n-\t\t *\n-\t\t * @method addShortcut\n-\t\t * @param {String} pa Shortcut pattern. Like for example: ctrl+alt+o.\n-\t\t * @param {String} desc Text description for the command.\n-\t\t * @param {String/Function} cmd_func Command name string or function to execute when the key is pressed.\n-\t\t * @param {Object} sc Optional scope to execute the function in.\n-\t\t * @return {Boolean} true/false state if the shortcut was added or not.\n-\t\t */\n-\t\taddShortcut : function(pa, desc, cmd_func, sc) {\n-\t\t\tvar t = this, c;\n-\n-\t\t\tif (t.settings.custom_shortcuts === false)\n-\t\t\t\treturn false;\n-\n-\t\t\tt.shortcuts = t.shortcuts || {};\n-\n-\t\t\tif (is(cmd_func, 'string')) {\n-\t\t\t\tc = cmd_func;\n-\n-\t\t\t\tcmd_func = function() {\n-\t\t\t\t\tt.execCommand(c, false, null);\n-\t\t\t\t};\n-\t\t\t}\n-\n-\t\t\tif (is(cmd_func, 'object')) {\n-\t\t\t\tc = cmd_func;\n-\n-\t\t\t\tcmd_func = function() {\n-\t\t\t\t\tt.execCommand(c[0], c[1], c[2]);\n-\t\t\t\t};\n-\t\t\t}\n-\n-\t\t\teach(explode(pa), function(pa) {\n-\t\t\t\tvar o = {\n-\t\t\t\t\tfunc : cmd_func,\n-\t\t\t\t\tscope : sc || this,\n-\t\t\t\t\tdesc : t.translate(desc),\n-\t\t\t\t\talt : false,\n-\t\t\t\t\tctrl : false,\n-\t\t\t\t\tshift : false\n-\t\t\t\t};\n-\n-\t\t\t\teach(explode(pa, '+'), function(v) {\n-\t\t\t\t\tswitch (v) {\n-\t\t\t\t\t\tcase 'alt':\n-\t\t\t\t\t\tcase 'ctrl':\n-\t\t\t\t\t\tcase 'shift':\n-\t\t\t\t\t\t\to[v] = true;\n-\t\t\t\t\t\t\tbreak;\n-\n-\t\t\t\t\t\tdefault:\n-\t\t\t\t\t\t\to.charCode = v.charCodeAt(0);\n-\t\t\t\t\t\t\to.keyCode = v.toUpperCase().charCodeAt(0);\n-\t\t\t\t\t}\n-\t\t\t\t});\n-\n-\t\t\t\tt.shortcuts[(o.ctrl ? 'ctrl' : '') + ',' + (o.alt ? 'alt' : '') + ',' + (o.shift ? 'shift' : '') + ',' + o.keyCode] = o;\n-\t\t\t});\n-\n-\t\t\treturn true;\n-\t\t},\n-\n-\t\t/**\n-\t\t * Executes a command on the current instance. These commands can be TinyMCE internal commands prefixed with \"mce\" or\n-\t\t * they can be build in browser commands such as \"Bold\". A compleate list of browser commands is available on MSDN or Mozilla.org.\n-\t\t * This function will dispatch the execCommand function on each plugin, theme or the execcommand_callback option if none of these\n-\t\t * return true it will handle the command as a internal browser command.\n-\t\t *\n-\t\t * @method execCommand\n-\t\t * @param {String} cmd Command name to execute, for example mceLink or Bold.\n-\t\t * @param {Boolean} ui True/false state if a UI (dialog) should be presented or not.\n-\t\t * @param {mixed} val Optional command value, this can be anything.\n-\t\t * @param {Object} a Optional arguments object.\n-\t\t * @return {Boolean} True/false if the command was executed or not.\n-\t\t */\n-\t\texecCommand : function(cmd, ui, val, a) {\n-\t\t\tvar t = this, s = 0, o, st;\n-\n-\t\t\tif (!/^(mceAddUndoLevel|mceEndUndoLevel|mceBeginUndoLevel|mceRepaint|SelectAll)$/.test(cmd) && (!a || !a.skip_focus))\n-\t\t\t\tt.focus();\n-\n-\t\t\ta = extend({}, a);\n-\t\t\tt.onBeforeExecCommand.dispatch(t, cmd, ui, val, a);\n-\t\t\tif (a.terminate)\n-\t\t\t\treturn false;\n-\n-\t\t\t// Command callback\n-\t\t\tif (t.execCallback('execcommand_callback', t.id, t.selection.getNode(), cmd, ui, val)) {\n-\t\t\t\tt.onExecCommand.dispatch(t, cmd, ui, val, a);\n-\t\t\t\treturn true;\n-\t\t\t}\n-\n-\t\t\t// Registred commands\n-\t\t\tif (o = t.execCommands[cmd]) {\n-\t\t\t\tst = o.func.call(o.scope, ui, val);\n-\n-\t\t\t\t// Fall through on true\n-\t\t\t\tif (st !== true) {\n-\t\t\t\t\tt.onExecCommand.dispatch(t, cmd, ui, val, a);\n-\t\t\t\t\treturn st;\n-\t\t\t\t}\n-\t\t\t}\n-\n-\t\t\t// Plugin commands\n-\t\t\teach(t.plugins, function(p) {\n-\t\t\t\tif (p.execCommand && p.execCommand(cmd, ui, val)) {\n-\t\t\t\t\tt.onExecCommand.dispatch(t, cmd, ui, val, a);\n-\t\t\t\t\ts = 1;\n-\t\t\t\t\treturn false;\n-\t\t\t\t}\n-\t\t\t});\n-\n-\t\t\tif (s)\n-\t\t\t\treturn true;\n-\n-\t\t\t// Theme commands\n-\t\t\tif (t.theme && t.theme.execCommand && t.theme.execCommand(cmd, ui, val)) {\n-\t\t\t\tt.onExecCommand.dispatch(t, cmd, ui, val, a);\n-\t\t\t\treturn true;\n-\t\t\t}\n-\n-\t\t\t// Editor commands\n-\t\t\tif (t.editorCommands.execCommand(cmd, ui, val)) {\n-\t\t\t\tt.onExecCommand.dispatch(t, cmd, ui, val, a);\n-\t\t\t\treturn true;\n-\t\t\t}\n-\n-\t\t\t// Browser commands\n-\t\t\tt.getDoc().execCommand(cmd, ui, val);\n-\t\t\tt.onExecCommand.dispatch(t, cmd, ui, val, a);\n-\t\t},\n-\n-\t\t/**\n-\t\t * Returns a command specific state, for example if bold is enabled or not.\n-\t\t *\n-\t\t * @method queryCommandState\n-\t\t * @param {string} cmd Command to query state from.\n-\t\t * @return {Boolean} Command specific state, for example if bold is enabled or not.\n-\t\t */\n-\t\tqueryCommandState : function(cmd) {\n-\t\t\tvar t = this, o, s;\n-\n-\t\t\t// Is hidden then return undefined\n-\t\t\tif (t._isHidden())\n-\t\t\t\treturn;\n-\n-\t\t\t// Registred commands\n-\t\t\tif (o = t.queryStateCommands[cmd]) {\n-\t\t\t\ts = o.func.call(o.scope);\n-\n-\t\t\t\t// Fall though on true\n-\t\t\t\tif (s !== true)\n-\t\t\t\t\treturn s;\n-\t\t\t}\n-\n-\t\t\t// Registred commands\n-\t\t\to = t.editorCommands.queryCommandState(cmd);\n-\t\t\tif (o !== -1)\n-\t\t\t\treturn o;\n-\n-\t\t\t// Browser commands\n-\t\t\ttry {\n-\t\t\t\treturn this.getDoc().queryCommandState(cmd);\n-\t\t\t} catch (ex) {\n-\t\t\t\t// Fails sometimes see bug: 1896577\n-\t\t\t}\n-\t\t},\n-\n-\t\t/**\n-\t\t * Returns a command specific value, for example the current font size.\n-\t\t *\n-\t\t * @method queryCommandValue\n-\t\t * @param {string} c Command to query value from.\n-\t\t * @return {Object} Command specific value, for example the current font size.\n-\t\t */\n-\t\tqueryCommandValue : function(c) {\n-\t\t\tvar t = this, o, s;\n-\n-\t\t\t// Is hidden then return undefined\n-\t\t\tif (t._isHidden())\n-\t\t\t\treturn;\n-\n-\t\t\t// Registred commands\n-\t\t\tif (o = t.queryValueCommands[c]) {\n-\t\t\t\ts = o.func.call(o.scope);\n-\n-\t\t\t\t// Fall though on true\n-\t\t\t\tif (s !== true)\n-\t\t\t\t\treturn s;\n-\t\t\t}\n-\n-\t\t\t// Registred commands\n-\t\t\to = t.editorCommands.queryCommandValue(c);\n-\t\t\tif (is(o))\n-\t\t\t\treturn o;\n-\n-\t\t\t// Browser commands\n-\t\t\ttry {\n-\t\t\t\treturn this.getDoc().queryCommandValue(c);\n-\t\t\t} catch (ex) {\n-\t\t\t\t// Fails sometimes see bug: 1896577\n-\t\t\t}\n-\t\t},\n-\n-\t\t/**\n-\t\t * Shows the editor and hides any textarea/div that the editor is supposed to replace.\n-\t\t *\n-\t\t * @method show\n-\t\t */\n-\t\tshow : function() {\n-\t\t\tvar self = this;\n-\n-\t\t\tDOM.show(self.getContainer());\n-\t\t\tDOM.hide(self.id);\n-\t\t\tself.load();\n-\t\t},\n-\n-\t\t/**\n-\t\t * Hides the editor and shows any textarea/div that the editor is supposed to replace.\n-\t\t *\n-\t\t * @method hide\n-\t\t */\n-\t\thide : function() {\n-\t\t\tvar self = this, doc = self.getDoc();\n-\n-\t\t\t// Fixed bug where IE has a blinking cursor left from the editor\n-\t\t\tif (isIE && doc)\n-\t\t\t\tdoc.execCommand('SelectAll');\n-\n-\t\t\t// We must save before we hide so Safari doesn't crash\n-\t\t\tself.save();\n-\n-\t\t\t// defer the call to hide to prevent an IE9 crash #4921\n-\t\t\tDOM.hide(self.getContainer());\n-\t\t\tDOM.setStyle(self.id, 'display', self.orgDisplay);\n-\t\t},\n-\n-\t\t/**\n-\t\t * Returns true/false if the editor is hidden or not.\n-\t\t *\n-\t\t * @method isHidden\n-\t\t * @return {Boolean} True/false if the editor is hidden or not.\n-\t\t */\n-\t\tisHidden : function() {\n-\t\t\treturn !DOM.isHidden(this.id);\n-\t\t},\n-\n-\t\t/**\n-\t\t * Sets the progress state, this will display a throbber/progess for the editor.\n-\t\t * This is ideal for asycronous operations like an AJAX save call.\n-\t\t *\n-\t\t * @method setProgressState\n-\t\t * @param {Boolean} b Boolean state if the progress should be shown or hidden.\n-\t\t * @param {Number} ti Optional time to wait before the progress gets shown.\n-\t\t * @param {Object} o Optional object to pass to the progress observers.\n-\t\t * @return {Boolean} Same as the input state.\n-\t\t * @example\n-\t\t * // Show progress for the active editor\n-\t\t * tinyMCE.activeEditor.setProgressState(true);\n-\t\t * \n-\t\t * // Hide progress for the active editor\n-\t\t * tinyMCE.activeEditor.setProgressState(false);\n-\t\t * \n-\t\t * // Show progress after 3 seconds\n-\t\t * tinyMCE.activeEditor.setProgressState(true, 3000);\n-\t\t */\n-\t\tsetProgressState : function(b, ti, o) {\n-\t\t\tthis.onSetProgressState.dispatch(this, b, ti, o);\n-\n-\t\t\treturn b;\n-\t\t},\n-\n-\t\t/**\n-\t\t * Loads contents from the textarea or div element that got converted into an editor instance.\n-\t\t * This method will move the contents from that textarea or div into the editor by using setContent\n-\t\t * so all events etc that method has will get dispatched as well.\n-\t\t *\n-\t\t * @method load\n-\t\t * @param {Object} o Optional content object, this gets passed around through the whole load process.\n-\t\t * @return {String} HTML string that got set into the editor.\n-\t\t */\n-\t\tload : function(o) {\n-\t\t\tvar t = this, e = t.getElement(), h;\n-\n-\t\t\tif (e) {\n-\t\t\t\to = o || {};\n-\t\t\t\to.load = true;\n-\n-\t\t\t\t// Double encode existing entities in the value\n-\t\t\t\th = t.setContent(is(e.value) ? e.value : e.innerHTML, o);\n-\t\t\t\to.element = e;\n-\n-\t\t\t\tif (!o.no_events)\n-\t\t\t\t\tt.onLoadContent.dispatch(t, o);\n-\n-\t\t\t\to.element = e = null;\n-\n-\t\t\t\treturn h;\n-\t\t\t}\n-\t\t},\n-\n-\t\t/**\n-\t\t * Saves the contents from a editor out to the textarea or div element that got converted into an editor instance.\n-\t\t * This method will move the HTML contents from the editor into that textarea or div by getContent\n-\t\t * so all events etc that method has will get dispatched as well.\n-\t\t *\n-\t\t * @method save\n-\t\t * @param {Object} o Optional content object, this gets passed around through the whole save process.\n-\t\t * @return {String} HTML string that got set into the textarea/div.\n-\t\t */\n-\t\tsave : function(o) {\n-\t\t\tvar t = this, e = t.getElement(), h, f;\n-\n-\t\t\tif (!e || !t.initialized)\n-\t\t\t\treturn;\n-\n-\t\t\to = o || {};\n-\t\t\to.save = true;\n-\n-\t\t\to.element = e;\n-\t\t\th = o.content = t.getContent(o);\n-\n-\t\t\tif (!o.no_events)\n-\t\t\t\tt.onSaveContent.dispatch(t, o);\n-\n-\t\t\th = o.content;\n-\n-\t\t\tif (!/TEXTAREA|INPUT/i.test(e.nodeName)) {\n-\t\t\t\te.innerHTML = h;\n-\n-\t\t\t\t// Update hidden form element\n-\t\t\t\tif (f = DOM.getParent(t.id, 'form')) {\n-\t\t\t\t\teach(f.elements, function(e) {\n-\t\t\t\t\t\tif (e.name == t.id) {\n-\t\t\t\t\t\t\te.value = h;\n-\t\t\t\t\t\t\treturn false;\n-\t\t\t\t\t\t}\n-\t\t\t\t\t});\n-\t\t\t\t}\n-\t\t\t} else\n-\t\t\t\te.value = h;\n-\n-\t\t\to.element = e = null;\n-\n-\t\t\treturn h;\n-\t\t},\n-\n-\t\t/**\n-\t\t * Sets the specified content to the editor instance, this will cleanup the content before it gets set using\n-\t\t * the different cleanup rules options.\n-\t\t *\n-\t\t * @method setContent\n-\t\t * @param {String} content Content to set to editor, normally HTML contents but can be other formats as well.\n-\t\t * @param {Object} args Optional content object, this gets passed around through the whole set process.\n-\t\t * @return {String} HTML string that got set into the editor.\n-\t\t * @example\n-\t\t * // Sets the HTML contents of the activeEditor editor\n-\t\t * tinyMCE.activeEditor.setContent('<span>some</span> html');\n-\t\t * \n-\t\t * // Sets the raw contents of the activeEditor editor\n-\t\t * tinyMCE.activeEditor.setContent('<span>some</span> html', {format : 'raw'});\n-\t\t * \n-\t\t * // Sets the content of a specific editor (my_editor in this example)\n-\t\t * tinyMCE.get('my_editor').setContent(data);\n-\t\t * \n-\t\t * // Sets the bbcode contents of the activeEditor editor if the bbcode plugin was added\n-\t\t * tinyMCE.activeEditor.setContent('[b]some[/b] html', {format : 'bbcode'});\n-\t\t */\n-\t\tsetContent : function(content, args) {\n-\t\t\tvar self = this, rootNode, body = self.getBody(), forcedRootBlockName;\n-\n-\t\t\t// Setup args object\n-\t\t\targs = args || {};\n-\t\t\targs.format = args.format || 'html';\n-\t\t\targs.set = true;\n-\t\t\targs.content = content;\n-\n-\t\t\t// Do preprocessing\n-\t\t\tif (!args.no_events)\n-\t\t\t\tself.onBeforeSetContent.dispatch(self, args);\n-\n-\t\t\tcontent = args.content;\n-\n-\t\t\t// Padd empty content in Gecko and Safari. Commands will otherwise fail on the content\n-\t\t\t// It will also be impossible to place the caret in the editor unless there is a BR element present\n-\t\t\tif (!tinymce.isIE && (content.length === 0 || /^\\s+$/.test(content))) {\n-\t\t\t\tforcedRootBlockName = self.settings.forced_root_block;\n-\t\t\t\tif (forcedRootBlockName)\n-\t\t\t\t\tcontent = '<' + forcedRootBlockName + '><br data-mce-bogus=\"1\"></' + forcedRootBlockName + '>';\n-\t\t\t\telse\n-\t\t\t\t\tcontent = '<br data-mce-bogus=\"1\">';\n-\n-\t\t\t\tbody.innerHTML = content;\n-\t\t\t\tself.selection.select(body, true);\n-\t\t\t\tself.selection.collapse(true);\n-\t\t\t\treturn;\n-\t\t\t}\n-\n-\t\t\t// Parse and serialize the html\n-\t\t\tif (args.format !== 'raw') {\n-\t\t\t\tcontent = new tinymce.html.Serializer({}, self.schema).serialize(\n-\t\t\t\t\tself.parser.parse(content)\n-\t\t\t\t);\n-\t\t\t}\n-\n-\t\t\t// Set the new cleaned contents to the editor\n-\t\t\targs.content = tinymce.trim(content);\n-\t\t\tself.dom.setHTML(body, args.content);\n-\n-\t\t\t// Do post processing\n-\t\t\tif (!args.no_events)\n-\t\t\t\tself.onSetContent.dispatch(self, args);\n-\n-\t\t\t// Don't normalize selection if the focused element isn't the body in content editable mode since it will steal focus otherwise\n-\t\t\tif (!self.settings.content_editable || document.activeElement === self.getBody()) {\n-\t\t\t\tself.selection.normalize();\n-\t\t\t}\n-\n-\t\t\treturn args.content;\n-\t\t},\n-\n-\t\t/**\n-\t\t * Gets the content from the editor instance, this will cleanup the content before it gets returned using\n-\t\t * the different cleanup rules options.\n-\t\t *\n-\t\t * @method getContent\n-\t\t * @param {Object} args Optional content object, this gets passed around through the whole get process.\n-\t\t * @return {String} Cleaned content string, normally HTML contents.\n-\t\t * @example\n-\t\t * // Get the HTML contents of the currently active editor\n-\t\t * console.debug(tinyMCE.activeEditor.getContent());\n-\t\t * \n-\t\t * // Get the raw contents of the currently active editor\n-\t\t * tinyMCE.activeEditor.getContent({format : 'raw'});\n-\t\t * \n-\t\t * // Get content of a specific editor:\n-\t\t * tinyMCE.get('content id').getContent()\n-\t\t */\n-\t\tgetContent : function(args) {\n-\t\t\tvar self = this, content, body = self.getBody();\n-\n-\t\t\t// Setup args object\n-\t\t\targs = args || {};\n-\t\t\targs.format = args.format || 'html';\n-\t\t\targs.get = true;\n-\t\t\targs.getInner = true;\n-\n-\t\t\t// Do preprocessing\n-\t\t\tif (!args.no_events)\n-\t\t\t\tself.onBeforeGetContent.dispatch(self, args);\n-\n-\t\t\t// Get raw contents or by default the cleaned contents\n-\t\t\tif (args.format == 'raw')\n-\t\t\t\tcontent = body.innerHTML;\n-\t\t\telse if (args.format == 'text')\n-\t\t\t\tcontent = body.innerText || body.textContent;\n-\t\t\telse\n-\t\t\t\tcontent = self.serializer.serialize(body, args);\n-\n-\t\t\t// Trim whitespace in beginning/end of HTML\n-\t\t\tif (args.format != 'text') {\n-\t\t\t\targs.content = tinymce.trim(content);\n-\t\t\t} else {\n-\t\t\t\targs.content = content;\n-\t\t\t}\n-\n-\t\t\t// Do post processing\n-\t\t\tif (!args.no_events)\n-\t\t\t\tself.onGetContent.dispatch(self, args);\n-\n-\t\t\treturn args.content;\n-\t\t},\n-\n-\t\t/**\n-\t\t * Returns true/false if the editor is dirty or not. It will get dirty if the user has made modifications to the contents.\n-\t\t *\n-\t\t * @method isDirty\n-\t\t * @return {Boolean} True/false if the editor is dirty or not. It will get dirty if the user has made modifications to the contents.\n-\t\t * @example\n-\t\t * if (tinyMCE.activeEditor.isDirty())\n-\t\t *     alert(\"You must save your contents.\");\n-\t\t */\n-\t\tisDirty : function() {\n-\t\t\tvar self = this;\n-\n-\t\t\treturn tinymce.trim(self.startContent) != tinymce.trim(self.getContent({format : 'raw', no_events : 1})) && !self.isNotDirty;\n-\t\t},\n-\n-\t\t/**\n-\t\t * Returns the editors container element. The container element wrappes in\n-\t\t * all the elements added to the page for the editor. Such as UI, iframe etc.\n-\t\t *\n-\t\t * @method getContainer\n-\t\t * @return {Element} HTML DOM element for the editor container.\n-\t\t */\n-\t\tgetContainer : function() {\n-\t\t\tvar self = this;\n-\n-\t\t\tif (!self.container)\n-\t\t\t\tself.container = DOM.get(self.editorContainer || self.id + '_parent');\n-\n-\t\t\treturn self.container;\n-\t\t},\n-\n-\t\t/**\n-\t\t * Returns the editors content area container element. The this element is the one who\n-\t\t * holds the iframe or the editable element.\n-\t\t *\n-\t\t * @method getContentAreaContainer\n-\t\t * @return {Element} HTML DOM element for the editor area container.\n-\t\t */\n-\t\tgetContentAreaContainer : function() {\n-\t\t\treturn this.contentAreaContainer;\n-\t\t},\n-\n-\t\t/**\n-\t\t * Returns the target element/textarea that got replaced with a TinyMCE editor instance.\n-\t\t *\n-\t\t * @method getElement\n-\t\t * @return {Element} HTML DOM element for the replaced element.\n-\t\t */\n-\t\tgetElement : function() {\n-\t\t\treturn DOM.get(this.settings.content_element || this.id);\n-\t\t},\n-\n-\t\t/**\n-\t\t * Returns the iframes window object.\n-\t\t *\n-\t\t * @method getWin\n-\t\t * @return {Window} Iframe DOM window object.\n-\t\t */\n-\t\tgetWin : function() {\n-\t\t\tvar self = this, elm;\n-\n-\t\t\tif (!self.contentWindow) {\n-\t\t\t\telm = DOM.get(self.id + \"_ifr\");\n-\n-\t\t\t\tif (elm)\n-\t\t\t\t\tself.contentWindow = elm.contentWindow;\n-\t\t\t}\n-\n-\t\t\treturn self.contentWindow;\n-\t\t},\n-\n-\t\t/**\n-\t\t * Returns the iframes document object.\n-\t\t *\n-\t\t * @method getDoc\n-\t\t * @return {Document} Iframe DOM document object.\n-\t\t */\n-\t\tgetDoc : function() {\n-\t\t\tvar self = this, win;\n-\n-\t\t\tif (!self.contentDocument) {\n-\t\t\t\twin = self.getWin();\n-\n-\t\t\t\tif (win)\n-\t\t\t\t\tself.contentDocument = win.document;\n-\t\t\t}\n-\n-\t\t\treturn self.contentDocument;\n-\t\t},\n-\n-\t\t/**\n-\t\t * Returns the iframes body element.\n-\t\t *\n-\t\t * @method getBody\n-\t\t * @return {Element} Iframe body element.\n-\t\t */\n-\t\tgetBody : function() {\n-\t\t\treturn this.bodyElement || this.getDoc().body;\n-\t\t},\n-\n-\t\t/**\n-\t\t * URL converter function this gets executed each time a user adds an img, a or\n-\t\t * any other element that has a URL in it. This will be called both by the DOM and HTML\n-\t\t * manipulation functions.\n-\t\t *\n-\t\t * @method convertURL\n-\t\t * @param {string} url URL to convert.\n-\t\t * @param {string} name Attribute name src, href etc.\n-\t\t * @param {string/HTMLElement} elm Tag name or HTML DOM element depending on HTML or DOM insert.\n-\t\t * @return {string} Converted URL string.\n-\t\t */\n-\t\tconvertURL : function(url, name, elm) {\n-\t\t\tvar self = this, settings = self.settings;\n-\n-\t\t\t// Use callback instead\n-\t\t\tif (settings.urlconverter_callback)\n-\t\t\t\treturn self.execCallback('urlconverter_callback', url, elm, true, name);\n-\n-\t\t\t// Don't convert link href since thats the CSS files that gets loaded into the editor also skip local file URLs\n-\t\t\tif (!settings.convert_urls || (elm && elm.nodeName == 'LINK') || url.indexOf('file:') === 0)\n-\t\t\t\treturn url;\n-\n-\t\t\t// Convert to relative\n-\t\t\tif (settings.relative_urls)\n-\t\t\t\treturn self.documentBaseURI.toRelative(url);\n-\n-\t\t\t// Convert to absolute\n-\t\t\turl = self.documentBaseURI.toAbsolute(url, settings.remove_script_host);\n-\n-\t\t\treturn url;\n-\t\t},\n-\n-\t\t/**\n-\t\t * Adds visual aid for tables, anchors etc so they can be more easily edited inside the editor.\n-\t\t *\n-\t\t * @method addVisual\n-\t\t * @param {Element} elm Optional root element to loop though to find tables etc that needs the visual aid.\n-\t\t */\n-\t\taddVisual : function(elm) {\n-\t\t\tvar self = this, settings = self.settings, dom = self.dom, cls;\n-\n-\t\t\telm = elm || self.getBody();\n-\n-\t\t\tif (!is(self.hasVisual))\n-\t\t\t\tself.hasVisual = settings.visual;\n-\n-\t\t\teach(dom.select('table,a', elm), function(elm) {\n-\t\t\t\tvar value;\n-\n-\t\t\t\tswitch (elm.nodeName) {\n-\t\t\t\t\tcase 'TABLE':\n-\t\t\t\t\t\tcls = settings.visual_table_class || 'mceItemTable';\n-\t\t\t\t\t\tvalue = dom.getAttrib(elm, 'border');\n-\n-\t\t\t\t\t\tif (!value || value == '0') {\n-\t\t\t\t\t\t\tif (self.hasVisual)\n-\t\t\t\t\t\t\t\tdom.addClass(elm, cls);\n-\t\t\t\t\t\t\telse\n-\t\t\t\t\t\t\t\tdom.removeClass(elm, cls);\n-\t\t\t\t\t\t}\n-\n-\t\t\t\t\t\treturn;\n-\n-\t\t\t\t\tcase 'A':\n-\t\t\t\t\t\tif (!dom.getAttrib(elm, 'href', false)) {\n-\t\t\t\t\t\t\tvalue = dom.getAttrib(elm, 'name') || elm.id;\n-\t\t\t\t\t\t\tcls = 'mceItemAnchor';\n-\n-\t\t\t\t\t\t\tif (value) {\n-\t\t\t\t\t\t\t\tif (self.hasVisual)\n-\t\t\t\t\t\t\t\t\tdom.addClass(elm, cls);\n-\t\t\t\t\t\t\t\telse\n-\t\t\t\t\t\t\t\t\tdom.removeClass(elm, cls);\n-\t\t\t\t\t\t\t}\n-\t\t\t\t\t\t}\n-\n-\t\t\t\t\t\treturn;\n-\t\t\t\t}\n-\t\t\t});\n-\n-\t\t\tself.onVisualAid.dispatch(self, elm, self.hasVisual);\n-\t\t},\n-\n-\t\t/**\n-\t\t * Removes the editor from the dom and tinymce collection.\n-\t\t *\n-\t\t * @method remove\n-\t\t */\n-\t\tremove : function() {\n-\t\t\tvar self = this, elm = self.getContainer(), doc = self.getDoc();\n-\n-\t\t\tif (!self.removed) {\n-\t\t\t\tself.removed = 1; // Cancels post remove event execution\n-\n-\t\t\t\t// Fixed bug where IE has a blinking cursor left from the editor\n-\t\t\t\tif (isIE && doc)\n-\t\t\t\t\tdoc.execCommand('SelectAll');\n-\n-\t\t\t\t// We must save before we hide so Safari doesn't crash\n-\t\t\t\tself.save();\n-\n-\t\t\t\tDOM.setStyle(self.id, 'display', self.orgDisplay);\n-\n-\t\t\t\t// Don't clear the window or document if content editable\n-\t\t\t\t// is enabled since other instances might still be present\n-\t\t\t\tif (!self.settings.content_editable) {\n-\t\t\t\t\tEvent.unbind(self.getWin());\n-\t\t\t\t\tEvent.unbind(self.getDoc());\n-\t\t\t\t}\n-\n-\t\t\t\tEvent.unbind(self.getBody());\n-\t\t\t\tEvent.clear(elm);\n-\n-\t\t\t\tself.execCallback('remove_instance_callback', self);\n-\t\t\t\tself.onRemove.dispatch(self);\n-\n-\t\t\t\t// Clear all execCommand listeners this is required to avoid errors if the editor was removed inside another command\n-\t\t\t\tself.onExecCommand.listeners = [];\n-\n-\t\t\t\ttinymce.remove(self);\n-\t\t\t\tDOM.remove(elm);\n-\t\t\t}\n-\t\t},\n-\n-\t\t/**\n-\t\t * Destroys the editor instance by removing all events, element references or other resources\n-\t\t * that could leak memory. This method will be called automatically when the page is unloaded\n-\t\t * but you can also call it directly if you know what you are doing.\n-\t\t *\n-\t\t * @method destroy\n-\t\t * @param {Boolean} s Optional state if the destroy is an automatic destroy or user called one.\n-\t\t */\n-\t\tdestroy : function(s) {\n-\t\t\tvar t = this;\n-\n-\t\t\t// One time is enough\n-\t\t\tif (t.destroyed)\n-\t\t\t\treturn;\n-\n-\t\t\t// We must unbind on Gecko since it would otherwise produce the pesky \"attempt to run compile-and-go script on a cleared scope\" message\n-\t\t\tif (isGecko) {\n-\t\t\t\tEvent.unbind(t.getDoc());\n-\t\t\t\tEvent.unbind(t.getWin());\n-\t\t\t\tEvent.unbind(t.getBody());\n-\t\t\t}\n-\n-\t\t\tif (!s) {\n-\t\t\t\ttinymce.removeUnload(t.destroy);\n-\t\t\t\ttinyMCE.onBeforeUnload.remove(t._beforeUnload);\n-\n-\t\t\t\t// Manual destroy\n-\t\t\t\tif (t.theme && t.theme.destroy)\n-\t\t\t\t\tt.theme.destroy();\n-\n-\t\t\t\t// Destroy controls, selection and dom\n-\t\t\t\tt.controlManager.destroy();\n-\t\t\t\tt.selection.destroy();\n-\t\t\t\tt.dom.destroy();\n-\t\t\t}\n-\n-\t\t\tif (t.formElement) {\n-\t\t\t\tt.formElement.submit = t.formElement._mceOldSubmit;\n-\t\t\t\tt.formElement._mceOldSubmit = null;\n-\t\t\t}\n-\n-\t\t\tt.contentAreaContainer = t.formElement = t.container = t.settings.content_element = t.bodyElement = t.contentDocument = t.contentWindow = null;\n-\n-\t\t\tif (t.selection)\n-\t\t\t\tt.selection = t.selection.win = t.selection.dom = t.selection.dom.doc = null;\n-\n-\t\t\tt.destroyed = 1;\n-\t\t},\n-\n-\t\t// Internal functions\n-\n-\t\t_refreshContentEditable : function() {\n-\t\t\tvar self = this, body, parent;\n-\n-\t\t\t// Check if the editor was hidden and the re-initalize contentEditable mode by removing and adding the body again\n-\t\t\tif (self._isHidden()) {\n-\t\t\t\tbody = self.getBody();\n-\t\t\t\tparent = body.parentNode;\n-\n-\t\t\t\tparent.removeChild(body);\n-\t\t\t\tparent.appendChild(body);\n-\n-\t\t\t\tbody.focus();\n-\t\t\t}\n-\t\t},\n-\n-\t\t_isHidden : function() {\n-\t\t\tvar s;\n-\n-\t\t\tif (!isGecko)\n-\t\t\t\treturn 0;\n-\n-\t\t\t// Weird, wheres that cursor selection?\n-\t\t\ts = this.selection.getSel();\n-\t\t\treturn (!s || !s.rangeCount || s.rangeCount === 0);\n-\t\t}\n-\t});\n-})(tinymce);\n\\ No newline at end of file"
        },
        {
            "filename": "js/tiny_mce/classes/EditorCommands.js",
            "diff": "@@ -1,599 +0,0 @@\n-/**\n- * EditorCommands.js\n- *\n- * Copyright, Moxiecode Systems AB\n- * Released under LGPL License.\n- *\n- * License: http://www.tinymce.com/license\n- * Contributing: http://www.tinymce.com/contributing\n- */\n-\n-(function(tinymce) {\n-\t// Added for compression purposes\n-\tvar each = tinymce.each, undef, TRUE = true, FALSE = false;\n-\n-\t/**\n-\t * This class enables you to add custom editor commands and it contains\n-\t * overrides for native browser commands to address various bugs and issues.\n-\t *\n-\t * @class tinymce.EditorCommands\n-\t */\n-\ttinymce.EditorCommands = function(editor) {\n-\t\tvar dom = editor.dom,\n-\t\t\tselection = editor.selection,\n-\t\t\tcommands = {state: {}, exec : {}, value : {}},\n-\t\t\tsettings = editor.settings,\n-\t\t\tformatter = editor.formatter,\n-\t\t\tbookmark;\n-\n-\t\t/**\n-\t\t * Executes the specified command.\n-\t\t *\n-\t\t * @method execCommand\n-\t\t * @param {String} command Command to execute.\n-\t\t * @param {Boolean} ui Optional user interface state.\n-\t\t * @param {Object} value Optional value for command.\n-\t\t * @return {Boolean} true/false if the command was found or not.\n-\t\t */\n-\t\tfunction execCommand(command, ui, value) {\n-\t\t\tvar func;\n-\n-\t\t\tcommand = command.toLowerCase();\n-\t\t\tif (func = commands.exec[command]) {\n-\t\t\t\tfunc(command, ui, value);\n-\t\t\t\treturn TRUE;\n-\t\t\t}\n-\n-\t\t\treturn FALSE;\n-\t\t};\n-\n-\t\t/**\n-\t\t * Queries the current state for a command for example if the current selection is \"bold\".\n-\t\t *\n-\t\t * @method queryCommandState\n-\t\t * @param {String} command Command to check the state of.\n-\t\t * @return {Boolean/Number} true/false if the selected contents is bold or not, -1 if it's not found.\n-\t\t */\n-\t\tfunction queryCommandState(command) {\n-\t\t\tvar func;\n-\n-\t\t\tcommand = command.toLowerCase();\n-\t\t\tif (func = commands.state[command])\n-\t\t\t\treturn func(command);\n-\n-\t\t\treturn -1;\n-\t\t};\n-\n-\t\t/**\n-\t\t * Queries the command value for example the current fontsize.\n-\t\t *\n-\t\t * @method queryCommandValue\n-\t\t * @param {String} command Command to check the value of.\n-\t\t * @return {Object} Command value of false if it's not found.\n-\t\t */\n-\t\tfunction queryCommandValue(command) {\n-\t\t\tvar func;\n-\n-\t\t\tcommand = command.toLowerCase();\n-\t\t\tif (func = commands.value[command])\n-\t\t\t\treturn func(command);\n-\n-\t\t\treturn FALSE;\n-\t\t};\n-\n-\t\t/**\n-\t\t * Adds commands to the command collection.\n-\t\t *\n-\t\t * @method addCommands\n-\t\t * @param {Object} command_list Name/value collection with commands to add, the names can also be comma separated.\n-\t\t * @param {String} type Optional type to add, defaults to exec. Can be value or state as well.\n-\t\t */\n-\t\tfunction addCommands(command_list, type) {\n-\t\t\ttype = type || 'exec';\n-\n-\t\t\teach(command_list, function(callback, command) {\n-\t\t\t\teach(command.toLowerCase().split(','), function(command) {\n-\t\t\t\t\tcommands[type][command] = callback;\n-\t\t\t\t});\n-\t\t\t});\n-\t\t};\n-\n-\t\t// Expose public methods\n-\t\ttinymce.extend(this, {\n-\t\t\texecCommand : execCommand,\n-\t\t\tqueryCommandState : queryCommandState,\n-\t\t\tqueryCommandValue : queryCommandValue,\n-\t\t\taddCommands : addCommands\n-\t\t});\n-\n-\t\t// Private methods\n-\n-\t\tfunction execNativeCommand(command, ui, value) {\n-\t\t\tif (ui === undef)\n-\t\t\t\tui = FALSE;\n-\n-\t\t\tif (value === undef)\n-\t\t\t\tvalue = null;\n-\n-\t\t\treturn editor.getDoc().execCommand(command, ui, value);\n-\t\t};\n-\n-\t\tfunction isFormatMatch(name) {\n-\t\t\treturn formatter.match(name);\n-\t\t};\n-\n-\t\tfunction toggleFormat(name, value) {\n-\t\t\tformatter.toggle(name, value ? {value : value} : undef);\n-\t\t};\n-\n-\t\tfunction storeSelection(type) {\n-\t\t\tbookmark = selection.getBookmark(type);\n-\t\t};\n-\n-\t\tfunction restoreSelection() {\n-\t\t\tselection.moveToBookmark(bookmark);\n-\t\t};\n-\n-\t\t// Add execCommand overrides\n-\t\taddCommands({\n-\t\t\t// Ignore these, added for compatibility\n-\t\t\t'mceResetDesignMode,mceBeginUndoLevel' : function() {},\n-\n-\t\t\t// Add undo manager logic\n-\t\t\t'mceEndUndoLevel,mceAddUndoLevel' : function() {\n-\t\t\t\teditor.undoManager.add();\n-\t\t\t},\n-\n-\t\t\t'Cut,Copy,Paste' : function(command) {\n-\t\t\t\tvar doc = editor.getDoc(), failed;\n-\n-\t\t\t\t// Try executing the native command\n-\t\t\t\ttry {\n-\t\t\t\t\texecNativeCommand(command);\n-\t\t\t\t} catch (ex) {\n-\t\t\t\t\t// Command failed\n-\t\t\t\t\tfailed = TRUE;\n-\t\t\t\t}\n-\n-\t\t\t\t// Present alert message about clipboard access not being available\n-\t\t\t\tif (failed || !doc.queryCommandSupported(command)) {\n-\t\t\t\t\tif (tinymce.isGecko) {\n-\t\t\t\t\t\teditor.windowManager.confirm(editor.getLang('clipboard_msg'), function(state) {\n-\t\t\t\t\t\t\tif (state)\n-\t\t\t\t\t\t\t\topen('http://www.mozilla.org/editor/midasdemo/securityprefs.html', '_blank');\n-\t\t\t\t\t\t});\n-\t\t\t\t\t} else\n-\t\t\t\t\t\teditor.windowManager.alert(editor.getLang('clipboard_no_support'));\n-\t\t\t\t}\n-\t\t\t},\n-\n-\t\t\t// Override unlink command\n-\t\t\tunlink : function(command) {\n-\t\t\t\tif (selection.isCollapsed())\n-\t\t\t\t\tselection.select(selection.getNode());\n-\n-\t\t\t\texecNativeCommand(command);\n-\t\t\t\tselection.collapse(FALSE);\n-\t\t\t},\n-\n-\t\t\t// Override justify commands to use the text formatter engine\n-\t\t\t'JustifyLeft,JustifyCenter,JustifyRight,JustifyFull' : function(command) {\n-\t\t\t\tvar align = command.substring(7);\n-\n-\t\t\t\t// Remove all other alignments first\n-\t\t\t\teach('left,center,right,full'.split(','), function(name) {\n-\t\t\t\t\tif (align != name)\n-\t\t\t\t\t\tformatter.remove('align' + name);\n-\t\t\t\t});\n-\n-\t\t\t\ttoggleFormat('align' + align);\n-\t\t\t\texecCommand('mceRepaint');\n-\t\t\t},\n-\n-\t\t\t// Override list commands to fix WebKit bug\n-\t\t\t'InsertUnorderedList,InsertOrderedList' : function(command) {\n-\t\t\t\tvar listElm, listParent;\n-\n-\t\t\t\texecNativeCommand(command);\n-\n-\t\t\t\t// WebKit produces lists within block elements so we need to split them\n-\t\t\t\t// we will replace the native list creation logic to custom logic later on\n-\t\t\t\t// TODO: Remove this when the list creation logic is removed\n-\t\t\t\tlistElm = dom.getParent(selection.getNode(), 'ol,ul');\n-\t\t\t\tif (listElm) {\n-\t\t\t\t\tlistParent = listElm.parentNode;\n-\n-\t\t\t\t\t// If list is within a text block then split that block\n-\t\t\t\t\tif (/^(H[1-6]|P|ADDRESS|PRE)$/.test(listParent.nodeName)) {\n-\t\t\t\t\t\tstoreSelection();\n-\t\t\t\t\t\tdom.split(listParent, listElm);\n-\t\t\t\t\t\trestoreSelection();\n-\t\t\t\t\t}\n-\t\t\t\t}\n-\t\t\t},\n-\n-\t\t\t// Override commands to use the text formatter engine\n-\t\t\t'Bold,Italic,Underline,Strikethrough,Superscript,Subscript' : function(command) {\n-\t\t\t\ttoggleFormat(command);\n-\t\t\t},\n-\n-\t\t\t// Override commands to use the text formatter engine\n-\t\t\t'ForeColor,HiliteColor,FontName' : function(command, ui, value) {\n-\t\t\t\ttoggleFormat(command, value);\n-\t\t\t},\n-\n-\t\t\tFontSize : function(command, ui, value) {\n-\t\t\t\tvar fontClasses, fontSizes;\n-\n-\t\t\t\t// Convert font size 1-7 to styles\n-\t\t\t\tif (value >= 1 && value <= 7) {\n-\t\t\t\t\tfontSizes = tinymce.explode(settings.font_size_style_values);\n-\t\t\t\t\tfontClasses = tinymce.explode(settings.font_size_classes);\n-\n-\t\t\t\t\tif (fontClasses)\n-\t\t\t\t\t\tvalue = fontClasses[value - 1] || value;\n-\t\t\t\t\telse\n-\t\t\t\t\t\tvalue = fontSizes[value - 1] || value;\n-\t\t\t\t}\n-\n-\t\t\t\ttoggleFormat(command, value);\n-\t\t\t},\n-\n-\t\t\tRemoveFormat : function(command) {\n-\t\t\t\tformatter.remove(command);\n-\t\t\t},\n-\n-\t\t\tmceBlockQuote : function(command) {\n-\t\t\t\ttoggleFormat('blockquote');\n-\t\t\t},\n-\n-\t\t\tFormatBlock : function(command, ui, value) {\n-\t\t\t\treturn toggleFormat(value || 'p');\n-\t\t\t},\n-\n-\t\t\tmceCleanup : function() {\n-\t\t\t\tvar bookmark = selection.getBookmark();\n-\n-\t\t\t\teditor.setContent(editor.getContent({cleanup : TRUE}), {cleanup : TRUE});\n-\n-\t\t\t\tselection.moveToBookmark(bookmark);\n-\t\t\t},\n-\n-\t\t\tmceRemoveNode : function(command, ui, value) {\n-\t\t\t\tvar node = value || selection.getNode();\n-\n-\t\t\t\t// Make sure that the body node isn't removed\n-\t\t\t\tif (node != editor.getBody()) {\n-\t\t\t\t\tstoreSelection();\n-\t\t\t\t\teditor.dom.remove(node, TRUE);\n-\t\t\t\t\trestoreSelection();\n-\t\t\t\t}\n-\t\t\t},\n-\n-\t\t\tmceSelectNodeDepth : function(command, ui, value) {\n-\t\t\t\tvar counter = 0;\n-\n-\t\t\t\tdom.getParent(selection.getNode(), function(node) {\n-\t\t\t\t\tif (node.nodeType == 1 && counter++ == value) {\n-\t\t\t\t\t\tselection.select(node);\n-\t\t\t\t\t\treturn FALSE;\n-\t\t\t\t\t}\n-\t\t\t\t}, editor.getBody());\n-\t\t\t},\n-\n-\t\t\tmceSelectNode : function(command, ui, value) {\n-\t\t\t\tselection.select(value);\n-\t\t\t},\n-\n-\t\t\tmceInsertContent : function(command, ui, value) {\n-\t\t\t\tvar parser, serializer, parentNode, rootNode, fragment, args,\n-\t\t\t\t\tmarker, nodeRect, viewPortRect, rng, node, node2, bookmarkHtml, viewportBodyElement;\n-\n-\t\t\t\t//selection.normalize();\n-\n-\t\t\t\t// Setup parser and serializer\n-\t\t\t\tparser = editor.parser;\n-\t\t\t\tserializer = new tinymce.html.Serializer({}, editor.schema);\n-\t\t\t\tbookmarkHtml = '<span id=\"mce_marker\" data-mce-type=\"bookmark\">\\uFEFF</span>';\n-\n-\t\t\t\t// Run beforeSetContent handlers on the HTML to be inserted\n-\t\t\t\targs = {content: value, format: 'html'};\n-\t\t\t\tselection.onBeforeSetContent.dispatch(selection, args);\n-\t\t\t\tvalue = args.content;\n-\n-\t\t\t\t// Add caret at end of contents if it's missing\n-\t\t\t\tif (value.indexOf('{$caret}') == -1)\n-\t\t\t\t\tvalue += '{$caret}';\n-\n-\t\t\t\t// Replace the caret marker with a span bookmark element\n-\t\t\t\tvalue = value.replace(/\\{\\$caret\\}/, bookmarkHtml);\n-\n-\t\t\t\t// Insert node maker where we will insert the new HTML and get it's parent\n-\t\t\t\tif (!selection.isCollapsed())\n-\t\t\t\t\teditor.getDoc().execCommand('Delete', false, null);\n-\n-\t\t\t\tparentNode = selection.getNode();\n-\n-\t\t\t\t// Parse the fragment within the context of the parent node\n-\t\t\t\targs = {context : parentNode.nodeName.toLowerCase()};\n-\t\t\t\tfragment = parser.parse(value, args);\n-\n-\t\t\t\t// Move the caret to a more suitable location\n-\t\t\t\tnode = fragment.lastChild;\n-\t\t\t\tif (node.attr('id') == 'mce_marker') {\n-\t\t\t\t\tmarker = node;\n-\n-\t\t\t\t\tfor (node = node.prev; node; node = node.walk(true)) {\n-\t\t\t\t\t\tif (node.type == 3 || !dom.isBlock(node.name)) {\n-\t\t\t\t\t\t\tnode.parent.insert(marker, node, node.name === 'br');\n-\t\t\t\t\t\t\tbreak;\n-\t\t\t\t\t\t}\n-\t\t\t\t\t}\n-\t\t\t\t}\n-\n-\t\t\t\t// If parser says valid we can insert the contents into that parent\n-\t\t\t\tif (!args.invalid) {\n-\t\t\t\t\tvalue = serializer.serialize(fragment);\n-\n-\t\t\t\t\t// Check if parent is empty or only has one BR element then set the innerHTML of that parent\n-\t\t\t\t\tnode = parentNode.firstChild;\n-\t\t\t\t\tnode2 = parentNode.lastChild;\n-\t\t\t\t\tif (!node || (node === node2 && node.nodeName === 'BR'))\n-\t\t\t\t\t\tdom.setHTML(parentNode, value);\n-\t\t\t\t\telse\n-\t\t\t\t\t\tselection.setContent(value);\n-\t\t\t\t} else {\n-\t\t\t\t\t// If the fragment was invalid within that context then we need\n-\t\t\t\t\t// to parse and process the parent it's inserted into\n-\n-\t\t\t\t\t// Insert bookmark node and get the parent\n-\t\t\t\t\tselection.setContent(bookmarkHtml);\n-\t\t\t\t\tparentNode = selection.getNode();\n-\t\t\t\t\trootNode = editor.getBody();\n-\n-\t\t\t\t\t// Opera will return the document node when selection is in root\n-\t\t\t\t\tif (parentNode.nodeType == 9)\n-\t\t\t\t\t\tparentNode = node = rootNode;\n-\t\t\t\t\telse\n-\t\t\t\t\t\tnode = parentNode;\n-\n-\t\t\t\t\t// Find the ancestor just before the root element\n-\t\t\t\t\twhile (node !== rootNode) {\n-\t\t\t\t\t\tparentNode = node;\n-\t\t\t\t\t\tnode = node.parentNode;\n-\t\t\t\t\t}\n-\n-\t\t\t\t\t// Get the outer/inner HTML depending on if we are in the root and parser and serialize that\n-\t\t\t\t\tvalue = parentNode == rootNode ? rootNode.innerHTML : dom.getOuterHTML(parentNode);\n-\t\t\t\t\tvalue = serializer.serialize(\n-\t\t\t\t\t\tparser.parse(\n-\t\t\t\t\t\t\t// Need to replace by using a function since $ in the contents would otherwise be a problem\n-\t\t\t\t\t\t\tvalue.replace(/<span (id=\"mce_marker\"|id=mce_marker).+?<\\/span>/i, function() {\n-\t\t\t\t\t\t\t\treturn serializer.serialize(fragment);\n-\t\t\t\t\t\t\t})\n-\t\t\t\t\t\t)\n-\t\t\t\t\t);\n-\n-\t\t\t\t\t// Set the inner/outer HTML depending on if we are in the root or not\n-\t\t\t\t\tif (parentNode == rootNode)\n-\t\t\t\t\t\tdom.setHTML(rootNode, value);\n-\t\t\t\t\telse\n-\t\t\t\t\t\tdom.setOuterHTML(parentNode, value);\n-\t\t\t\t}\n-\n-\t\t\t\tmarker = dom.get('mce_marker');\n-\n-\t\t\t\t// Scroll range into view scrollIntoView on element can't be used since it will scroll the main view port as well\n-\t\t\t\tnodeRect = dom.getRect(marker);\n-\t\t\t\tviewPortRect = dom.getViewPort(editor.getWin());\n-\n-\t\t\t\t// Check if node is out side the viewport if it is then scroll to it\n-\t\t\t\tif ((nodeRect.y + nodeRect.h > viewPortRect.y + viewPortRect.h || nodeRect.y < viewPortRect.y) ||\n-\t\t\t\t\t(nodeRect.x > viewPortRect.x + viewPortRect.w || nodeRect.x < viewPortRect.x)) {\n-\t\t\t\t\tviewportBodyElement = tinymce.isIE ? editor.getDoc().documentElement : editor.getBody();\n-\t\t\t\t\tviewportBodyElement.scrollLeft = nodeRect.x;\n-\t\t\t\t\tviewportBodyElement.scrollTop = nodeRect.y - viewPortRect.h + 25;\n-\t\t\t\t}\n-\n-\t\t\t\t// Move selection before marker and remove it\n-\t\t\t\trng = dom.createRng();\n-\n-\t\t\t\t// If previous sibling is a text node set the selection to the end of that node\n-\t\t\t\tnode = marker.previousSibling;\n-\t\t\t\tif (node && node.nodeType == 3) {\n-\t\t\t\t\trng.setStart(node, node.nodeValue.length);\n-\t\t\t\t} else {\n-\t\t\t\t\t// If the previous sibling isn't a text node or doesn't exist set the selection before the marker node\n-\t\t\t\t\trng.setStartBefore(marker);\n-\t\t\t\t\trng.setEndBefore(marker);\n-\t\t\t\t}\n-\n-\t\t\t\t// Remove the marker node and set the new range\n-\t\t\t\tdom.remove(marker);\n-\t\t\t\tselection.setRng(rng);\n-\n-\t\t\t\t// Dispatch after event and add any visual elements needed\n-\t\t\t\tselection.onSetContent.dispatch(selection, args);\n-\t\t\t\teditor.addVisual();\n-\t\t\t},\n-\n-\t\t\tmceInsertRawHTML : function(command, ui, value) {\n-\t\t\t\tselection.setContent('tiny_mce_marker');\n-\t\t\t\teditor.setContent(editor.getContent().replace(/tiny_mce_marker/g, function() { return value }));\n-\t\t\t},\n-\n-\t\t\tmceToggleFormat : function(command, ui, value) {\n-\t\t\t\ttoggleFormat(value);\n-\t\t\t},\n-\n-\t\t\tmceSetContent : function(command, ui, value) {\n-\t\t\t\teditor.setContent(value);\n-\t\t\t},\n-\n-\t\t\t'Indent,Outdent' : function(command) {\n-\t\t\t\tvar intentValue, indentUnit, value;\n-\n-\t\t\t\t// Setup indent level\n-\t\t\t\tintentValue = settings.indentation;\n-\t\t\t\tindentUnit = /[a-z%]+$/i.exec(intentValue);\n-\t\t\t\tintentValue = parseInt(intentValue);\n-\n-\t\t\t\tif (!queryCommandState('InsertUnorderedList') && !queryCommandState('InsertOrderedList')) {\n-\t\t\t\t\t// If forced_root_blocks is set to false we don't have a block to indent so lets create a div\n-\t\t\t\t\tif (!settings.forced_root_block && !dom.getParent(selection.getNode(), dom.isBlock)) {\n-\t\t\t\t\t\tformatter.apply('div');\n-\t\t\t\t\t}\n-\n-\t\t\t\t\teach(selection.getSelectedBlocks(), function(element) {\n-\t\t\t\t\t\tif (command == 'outdent') {\n-\t\t\t\t\t\t\tvalue = Math.max(0, parseInt(element.style.paddingLeft || 0) - intentValue);\n-\t\t\t\t\t\t\tdom.setStyle(element, 'paddingLeft', value ? value + indentUnit : '');\n-\t\t\t\t\t\t} else\n-\t\t\t\t\t\t\tdom.setStyle(element, 'paddingLeft', (parseInt(element.style.paddingLeft || 0) + intentValue) + indentUnit);\n-\t\t\t\t\t});\n-\t\t\t\t} else\n-\t\t\t\t\texecNativeCommand(command);\n-\t\t\t},\n-\n-\t\t\tmceRepaint : function() {\n-\t\t\t\tvar bookmark;\n-\n-\t\t\t\tif (tinymce.isGecko) {\n-\t\t\t\t\ttry {\n-\t\t\t\t\t\tstoreSelection(TRUE);\n-\n-\t\t\t\t\t\tif (selection.getSel())\n-\t\t\t\t\t\t\tselection.getSel().selectAllChildren(editor.getBody());\n-\n-\t\t\t\t\t\tselection.collapse(TRUE);\n-\t\t\t\t\t\trestoreSelection();\n-\t\t\t\t\t} catch (ex) {\n-\t\t\t\t\t\t// Ignore\n-\t\t\t\t\t}\n-\t\t\t\t}\n-\t\t\t},\n-\n-\t\t\tmceToggleFormat : function(command, ui, value) {\n-\t\t\t\tformatter.toggle(value);\n-\t\t\t},\n-\n-\t\t\tInsertHorizontalRule : function() {\n-\t\t\t\teditor.execCommand('mceInsertContent', false, '<hr />');\n-\t\t\t},\n-\n-\t\t\tmceToggleVisualAid : function() {\n-\t\t\t\teditor.hasVisual = !editor.hasVisual;\n-\t\t\t\teditor.addVisual();\n-\t\t\t},\n-\n-\t\t\tmceReplaceContent : function(command, ui, value) {\n-\t\t\t\teditor.execCommand('mceInsertContent', false, value.replace(/\\{\\$selection\\}/g, selection.getContent({format : 'text'})));\n-\t\t\t},\n-\n-\t\t\tmceInsertLink : function(command, ui, value) {\n-\t\t\t\tvar anchor;\n-\n-\t\t\t\tif (typeof(value) == 'string')\n-\t\t\t\t\tvalue = {href : value};\n-\n-\t\t\t\tanchor = dom.getParent(selection.getNode(), 'a');\n-\n-\t\t\t\t// Spaces are never valid in URLs and it's a very common mistake for people to make so we fix it here.\n-\t\t\t\tvalue.href = value.href.replace(' ', '%20');\n-\n-\t\t\t\t// Remove existing links if there could be child links or that the href isn't specified\n-\t\t\t\tif (!anchor || !value.href) {\n-\t\t\t\t\tformatter.remove('link');\n-\t\t\t\t}\t\t\n-\n-\t\t\t\t// Apply new link to selection\n-\t\t\t\tif (value.href) {\n-\t\t\t\t\tformatter.apply('link', value, anchor);\n-\t\t\t\t}\n-\t\t\t},\n-\n-\t\t\tselectAll : function() {\n-\t\t\t\tvar root = dom.getRoot(), rng = dom.createRng();\n-\n-\t\t\t\t// Old IE does a better job with selectall than new versions\n-\t\t\t\tif (selection.getRng().setStart) {\n-\t\t\t\t\trng.setStart(root, 0);\n-\t\t\t\t\trng.setEnd(root, root.childNodes.length);\n-\n-\t\t\t\t\tselection.setRng(rng);\n-\t\t\t\t} else {\n-\t\t\t\t\texecNativeCommand('SelectAll');\n-\t\t\t\t}\n-\t\t\t}\n-\t\t});\n-\n-\t\t// Add queryCommandState overrides\n-\t\taddCommands({\n-\t\t\t// Override justify commands\n-\t\t\t'JustifyLeft,JustifyCenter,JustifyRight,JustifyFull' : function(command) {\n-\t\t\t\tvar name = 'align' + command.substring(7);\n-\t\t\t\tvar nodes = selection.isCollapsed() ? [dom.getParent(selection.getNode(), dom.isBlock)] : selection.getSelectedBlocks();\n-\t\t\t\tvar matches = tinymce.map(nodes, function(node) {\n-\t\t\t\t\treturn !!formatter.matchNode(node, name);\n-\t\t\t\t});\n-\t\t\t\treturn tinymce.inArray(matches, TRUE) !== -1;\n-\t\t\t},\n-\n-\t\t\t'Bold,Italic,Underline,Strikethrough,Superscript,Subscript' : function(command) {\n-\t\t\t\treturn isFormatMatch(command);\n-\t\t\t},\n-\n-\t\t\tmceBlockQuote : function() {\n-\t\t\t\treturn isFormatMatch('blockquote');\n-\t\t\t},\n-\n-\t\t\tOutdent : function() {\n-\t\t\t\tvar node;\n-\n-\t\t\t\tif (settings.inline_styles) {\n-\t\t\t\t\tif ((node = dom.getParent(selection.getStart(), dom.isBlock)) && parseInt(node.style.paddingLeft) > 0)\n-\t\t\t\t\t\treturn TRUE;\n-\n-\t\t\t\t\tif ((node = dom.getParent(selection.getEnd(), dom.isBlock)) && parseInt(node.style.paddingLeft) > 0)\n-\t\t\t\t\t\treturn TRUE;\n-\t\t\t\t}\n-\n-\t\t\t\treturn queryCommandState('InsertUnorderedList') || queryCommandState('InsertOrderedList') || (!settings.inline_styles && !!dom.getParent(selection.getNode(), 'BLOCKQUOTE'));\n-\t\t\t},\n-\n-\t\t\t'InsertUnorderedList,InsertOrderedList' : function(command) {\n-\t\t\t\tvar list = dom.getParent(selection.getNode(), 'ul,ol');\n-\t\t\t\treturn list && \n-\t\t\t\t     (command === 'insertunorderedlist' && list.tagName === 'UL'\n-\t\t\t\t   || command === 'insertorderedlist' && list.tagName === 'OL');\n-\t\t\t}\n-\t\t}, 'state');\n-\n-\t\t// Add queryCommandValue overrides\n-\t\taddCommands({\n-\t\t\t'FontSize,FontName' : function(command) {\n-\t\t\t\tvar value = 0, parent;\n-\n-\t\t\t\tif (parent = dom.getParent(selection.getNode(), 'span')) {\n-\t\t\t\t\tif (command == 'fontsize')\n-\t\t\t\t\t\tvalue = parent.style.fontSize;\n-\t\t\t\t\telse\n-\t\t\t\t\t\tvalue = parent.style.fontFamily.replace(/, /g, ',').replace(/[\\'\\\"]/g, '').toLowerCase();\n-\t\t\t\t}\n-\n-\t\t\t\treturn value;\n-\t\t\t}\n-\t\t}, 'value');\n-\n-\t\t// Add undo manager logic\n-\t\taddCommands({\n-\t\t\tUndo : function() {\n-\t\t\t\teditor.undoManager.undo();\n-\t\t\t},\n-\n-\t\t\tRedo : function() {\n-\t\t\t\teditor.undoManager.redo();\n-\t\t\t}\n-\t\t});\n-\t};\n-})(tinymce);"
        },
        {
            "filename": "js/tiny_mce/classes/EditorManager.js",
            "diff": "@@ -1,531 +0,0 @@\n-/**\n- * EditorManager.js\n- *\n- * Copyright, Moxiecode Systems AB\n- * Released under LGPL License.\n- *\n- * License: http://www.tinymce.com/license\n- * Contributing: http://www.tinymce.com/contributing\n- */\n-\n-(function(tinymce) {\n-\t/**\n-\t * @class tinymce\n-\t */\n-\n-\t// Shorten names\n-\tvar each = tinymce.each, extend = tinymce.extend,\n-\t\tDOM = tinymce.DOM, Event = tinymce.dom.Event,\n-\t\tThemeManager = tinymce.ThemeManager, PluginManager = tinymce.PluginManager,\n-\t\texplode = tinymce.explode,\n-\t\tDispatcher = tinymce.util.Dispatcher, undef, instanceCounter = 0;\n-\n-\t// Setup some URLs where the editor API is located and where the document is\n-\ttinymce.documentBaseURL = window.location.href.replace(/[\\?#].*$/, '').replace(/[\\/\\\\][^\\/]+$/, '');\n-\tif (!/[\\/\\\\]$/.test(tinymce.documentBaseURL))\n-\t\ttinymce.documentBaseURL += '/';\n-\n-\ttinymce.baseURL = new tinymce.util.URI(tinymce.documentBaseURL).toAbsolute(tinymce.baseURL);\n-\n-\t/**\n-\t * Absolute baseURI for the installation path of TinyMCE.\n-\t *\n-\t * @property baseURI\n-\t * @type tinymce.util.URI\n-\t */\n-\ttinymce.baseURI = new tinymce.util.URI(tinymce.baseURL);\n-\n-\t// Add before unload listener\n-\t// This was required since IE was leaking memory if you added and removed beforeunload listeners\n-\t// with attachEvent/detatchEvent so this only adds one listener and instances can the attach to the onBeforeUnload event\n-\ttinymce.onBeforeUnload = new Dispatcher(tinymce);\n-\n-\t// Must be on window or IE will leak if the editor is placed in frame or iframe\n-\tEvent.add(window, 'beforeunload', function(e) {\n-\t\ttinymce.onBeforeUnload.dispatch(tinymce, e);\n-\t});\n-\n-\t/**\n-\t * Fires when a new editor instance is added to the tinymce collection.\n-\t *\n-\t * @event onAddEditor\n-\t * @param {tinymce} sender TinyMCE root class/namespace.\n-\t * @param {tinymce.Editor} editor Editor instance.\n-\t * @example\n-\t * tinyMCE.execCommand(\"mceAddControl\", false, \"some_textarea\");\n-\t * tinyMCE.onAddEditor.add(function(mgr,ed) {\n-\t *     console.debug('A new editor is available' + ed.id);\n-\t * });\n-\t */\n-\ttinymce.onAddEditor = new Dispatcher(tinymce);\n-\n-\t/**\n-\t * Fires when an editor instance is removed from the tinymce collection.\n-\t *\n-\t * @event onRemoveEditor\n-\t * @param {tinymce} sender TinyMCE root class/namespace.\n-\t * @param {tinymce.Editor} editor Editor instance.\n-\t */\n-\ttinymce.onRemoveEditor = new Dispatcher(tinymce);\n-\n-\ttinymce.EditorManager = extend(tinymce, {\n-\t\t/**\n-\t\t * Collection of editor instances.\n-\t\t *\n-\t\t * @property editors\n-\t\t * @type Object\n-\t\t * @example\n-\t\t * for (edId in tinyMCE.editors)\n-\t\t *     tinyMCE.editors[edId].save();\n-\t\t */\n-\t\teditors : [],\n-\n-\t\t/**\n-\t\t * Collection of language pack data.\n-\t\t *\n-\t\t * @property i18n\n-\t\t * @type Object\n-\t\t */\n-\t\ti18n : {},\n-\n-\t\t/**\n-\t\t * Currently active editor instance.\n-\t\t *\n-\t\t * @property activeEditor\n-\t\t * @type tinymce.Editor\n-\t\t * @example\n-\t\t * tinyMCE.activeEditor.selection.getContent();\n-\t\t * tinymce.EditorManager.activeEditor.selection.getContent();\n-\t\t */\n-\t\tactiveEditor : null,\n-\n-\t\t/**\n-\t\t * Initializes a set of editors. This method will create a bunch of editors based in the input.\n-\t\t *\n-\t\t * @method init\n-\t\t * @param {Object} s Settings object to be passed to each editor instance.\n-\t\t * @example\n-\t\t * // Initializes a editor using the longer method\n-\t\t * tinymce.EditorManager.init({\n-\t\t *    some_settings : 'some value'\n-\t\t * });\n-\t\t * \n-\t\t * // Initializes a editor instance using the shorter version\n-\t\t * tinyMCE.init({\n-\t\t *    some_settings : 'some value'\n-\t\t * });\n-\t\t */\n-\t\tinit : function(s) {\n-\t\t\tvar t = this, pl, sl = tinymce.ScriptLoader, e, el = [], ed;\n-\n-\t\t\tfunction createId(elm) {\n-\t\t\t\tvar id = elm.id;\n-\t\n-\t\t\t\t// Use element id, or unique name or generate a unique id\n-\t\t\t\tif (!id) {\n-\t\t\t\t\tid = elm.name;\n-\t\n-\t\t\t\t\tif (id && !DOM.get(id)) {\n-\t\t\t\t\t\tid = elm.name;\n-\t\t\t\t\t} else {\n-\t\t\t\t\t\t// Generate unique name\n-\t\t\t\t\t\tid = DOM.uniqueId();\n-\t\t\t\t\t}\n-\n-\t\t\t\t\telm.setAttribute('id', id);\n-\t\t\t\t}\n-\n-\t\t\t\treturn id;\n-\t\t\t};\n-\n-\t\t\tfunction execCallback(se, n, s) {\n-\t\t\t\tvar f = se[n];\n-\n-\t\t\t\tif (!f)\n-\t\t\t\t\treturn;\n-\n-\t\t\t\tif (tinymce.is(f, 'string')) {\n-\t\t\t\t\ts = f.replace(/\\.\\w+$/, '');\n-\t\t\t\t\ts = s ? tinymce.resolve(s) : 0;\n-\t\t\t\t\tf = tinymce.resolve(f);\n-\t\t\t\t}\n-\n-\t\t\t\treturn f.apply(s || this, Array.prototype.slice.call(arguments, 2));\n-\t\t\t};\n-\n-\t\t\tfunction hasClass(n, c) {\n-\t\t\t\treturn c.constructor === RegExp ? c.test(n.className) : DOM.hasClass(n, c);\n-\t\t\t};\n-\n-\t\t\tt.settings = s;\n-\n-\t\t\t// Legacy call\n-\t\t\tEvent.bind(window, 'ready', function() {\n-\t\t\t\tvar l, co;\n-\n-\t\t\t\texecCallback(s, 'onpageload');\n-\n-\t\t\t\tswitch (s.mode) {\n-\t\t\t\t\tcase \"exact\":\n-\t\t\t\t\t\tl = s.elements || '';\n-\n-\t\t\t\t\t\tif(l.length > 0) {\n-\t\t\t\t\t\t\teach(explode(l), function(v) {\n-\t\t\t\t\t\t\t\tif (DOM.get(v)) {\n-\t\t\t\t\t\t\t\t\ted = new tinymce.Editor(v, s);\n-\t\t\t\t\t\t\t\t\tel.push(ed);\n-\t\t\t\t\t\t\t\t\ted.render(1);\n-\t\t\t\t\t\t\t\t} else {\n-\t\t\t\t\t\t\t\t\teach(document.forms, function(f) {\n-\t\t\t\t\t\t\t\t\t\teach(f.elements, function(e) {\n-\t\t\t\t\t\t\t\t\t\t\tif (e.name === v) {\n-\t\t\t\t\t\t\t\t\t\t\t\tv = 'mce_editor_' + instanceCounter++;\n-\t\t\t\t\t\t\t\t\t\t\t\tDOM.setAttrib(e, 'id', v);\n-\n-\t\t\t\t\t\t\t\t\t\t\t\ted = new tinymce.Editor(v, s);\n-\t\t\t\t\t\t\t\t\t\t\t\tel.push(ed);\n-\t\t\t\t\t\t\t\t\t\t\t\ted.render(1);\n-\t\t\t\t\t\t\t\t\t\t\t}\n-\t\t\t\t\t\t\t\t\t\t});\n-\t\t\t\t\t\t\t\t\t});\n-\t\t\t\t\t\t\t\t}\n-\t\t\t\t\t\t\t});\n-\t\t\t\t\t\t}\n-\t\t\t\t\t\tbreak;\n-\n-\t\t\t\t\tcase \"textareas\":\n-\t\t\t\t\tcase \"specific_textareas\":\n-\t\t\t\t\t\teach(DOM.select('textarea'), function(elm) {\n-\t\t\t\t\t\t\tif (s.editor_deselector && hasClass(elm, s.editor_deselector))\n-\t\t\t\t\t\t\t\treturn;\n-\n-\t\t\t\t\t\t\tif (!s.editor_selector || hasClass(elm, s.editor_selector)) {\n-\t\t\t\t\t\t\t\ted = new tinymce.Editor(createId(elm), s);\n-\t\t\t\t\t\t\t\tel.push(ed);\n-\t\t\t\t\t\t\t\ted.render(1);\n-\t\t\t\t\t\t\t}\n-\t\t\t\t\t\t});\n-\t\t\t\t\t\tbreak;\n-\t\t\t\t\t\n-\t\t\t\t\tdefault:\n-\t\t\t\t\t\tif (s.types) {\n-\t\t\t\t\t\t\t// Process type specific selector\n-\t\t\t\t\t\t\teach(s.types, function(type) {\n-\t\t\t\t\t\t\t\teach(DOM.select(type.selector), function(elm) {\n-\t\t\t\t\t\t\t\t\tvar editor = new tinymce.Editor(createId(elm), tinymce.extend({}, s, type));\n-\t\t\t\t\t\t\t\t\tel.push(editor);\n-\t\t\t\t\t\t\t\t\teditor.render(1);\n-\t\t\t\t\t\t\t\t});\n-\t\t\t\t\t\t\t});\n-\t\t\t\t\t\t} else if (s.selector) {\n-\t\t\t\t\t\t\t// Process global selector\n-\t\t\t\t\t\t\teach(DOM.select(s.selector), function(elm) {\n-\t\t\t\t\t\t\t\tvar editor = new tinymce.Editor(createId(elm), s);\n-\t\t\t\t\t\t\t\tel.push(editor);\n-\t\t\t\t\t\t\t\teditor.render(1);\n-\t\t\t\t\t\t\t});\n-\t\t\t\t\t\t}\n-\t\t\t\t}\n-\n-\t\t\t\t// Call onInit when all editors are initialized\n-\t\t\t\tif (s.oninit) {\n-\t\t\t\t\tl = co = 0;\n-\n-\t\t\t\t\teach(el, function(ed) {\n-\t\t\t\t\t\tco++;\n-\n-\t\t\t\t\t\tif (!ed.initialized) {\n-\t\t\t\t\t\t\t// Wait for it\n-\t\t\t\t\t\t\ted.onInit.add(function() {\n-\t\t\t\t\t\t\t\tl++;\n-\n-\t\t\t\t\t\t\t\t// All done\n-\t\t\t\t\t\t\t\tif (l == co)\n-\t\t\t\t\t\t\t\t\texecCallback(s, 'oninit');\n-\t\t\t\t\t\t\t});\n-\t\t\t\t\t\t} else\n-\t\t\t\t\t\t\tl++;\n-\n-\t\t\t\t\t\t// All done\n-\t\t\t\t\t\tif (l == co)\n-\t\t\t\t\t\t\texecCallback(s, 'oninit');\t\t\t\t\t\n-\t\t\t\t\t});\n-\t\t\t\t}\n-\t\t\t});\n-\t\t},\n-\n-\t\t/**\n-\t\t * Returns a editor instance by id.\n-\t\t *\n-\t\t * @method get\n-\t\t * @param {String/Number} id Editor instance id or index to return.\n-\t\t * @return {tinymce.Editor} Editor instance to return.\n-\t\t * @example\n-\t\t * // Adds an onclick event to an editor by id (shorter version)\n-\t\t * tinyMCE.get('mytextbox').onClick.add(function(ed, e) {\n-\t\t *    ed.windowManager.alert('Hello world!');\n-\t\t * });\n-\t\t * \n-\t\t * // Adds an onclick event to an editor by id (longer version)\n-\t\t * tinymce.EditorManager.get('mytextbox').onClick.add(function(ed, e) {\n-\t\t *    ed.windowManager.alert('Hello world!');\n-\t\t * });\n-\t\t */\n-\t\tget : function(id) {\n-\t\t\tif (id === undef)\n-\t\t\t\treturn this.editors;\n-\n-\t\t\tif (!this.editors.hasOwnProperty(id))\n-\t\t\t\treturn undef;\n-\n-\t\t\treturn this.editors[id];\n-\t\t},\n-\n-\t\t/**\n-\t\t * Returns a editor instance by id. This method was added for compatibility with the 2.x branch.\n-\t\t *\n-\t\t * @method getInstanceById\n-\t\t * @param {String} id Editor instance id to return.\n-\t\t * @return {tinymce.Editor} Editor instance to return.\n-\t\t * @deprecated Use get method instead.\n-\t\t * @see #get\n-\t\t */\n-\t\tgetInstanceById : function(id) {\n-\t\t\treturn this.get(id);\n-\t\t},\n-\n-\t\t/**\n-\t\t * Adds an editor instance to the editor collection. This will also set it as the active editor.\n-\t\t *\n-\t\t * @method add\n-\t\t * @param {tinymce.Editor} editor Editor instance to add to the collection.\n-\t\t * @return {tinymce.Editor} The same instance that got passed in.\n-\t\t */\n-\t\tadd : function(editor) {\n-\t\t\tvar self = this, editors = self.editors;\n-\n-\t\t\t// Add named and index editor instance\n-\t\t\teditors[editor.id] = editor;\n-\t\t\teditors.push(editor);\n-\n-\t\t\tself._setActive(editor);\n-\t\t\tself.onAddEditor.dispatch(self, editor);\n-\n-\t\t\t// #ifdef jquery\n-\n-\t\t\t// Patch the tinymce.Editor instance with jQuery adapter logic\n-\t\t\tif (tinymce.adapter)\n-\t\t\t\ttinymce.adapter.patchEditor(editor);\n-\n-\t\t\t// #endif\n-\n-\t\t\treturn editor;\n-\t\t},\n-\n-\t\t/**\n-\t\t * Removes a editor instance from the collection.\n-\t\t *\n-\t\t * @method remove\n-\t\t * @param {tinymce.Editor} e Editor instance to remove.\n-\t\t * @return {tinymce.Editor} The editor that got passed in will be return if it was found otherwise null.\n-\t\t */\n-\t\tremove : function(editor) {\n-\t\t\tvar t = this, i, editors = t.editors;\n-\n-\t\t\t// Not in the collection\n-\t\t\tif (!editors[editor.id])\n-\t\t\t\treturn null;\n-\n-\t\t\tdelete editors[editor.id];\n-\n-\t\t\tfor (i = 0; i < editors.length; i++) {\n-\t\t\t\tif (editors[i] == editor) {\n-\t\t\t\t\teditors.splice(i, 1);\n-\t\t\t\t\tbreak;\n-\t\t\t\t}\n-\t\t\t}\n-\n-\t\t\t// Select another editor since the active one was removed\n-\t\t\tif (t.activeEditor == editor)\n-\t\t\t\tt._setActive(editors[0]);\n-\n-\t\t\teditor.destroy();\n-\t\t\tt.onRemoveEditor.dispatch(t, editor);\n-\n-\t\t\treturn editor;\n-\t\t},\n-\n-\t\t/**\n-\t\t * Executes a specific command on the currently active editor.\n-\t\t *\n-\t\t * @method execCommand\n-\t\t * @param {String} c Command to perform for example Bold.\n-\t\t * @param {Boolean} u Optional boolean state if a UI should be presented for the command or not.\n-\t\t * @param {String} v Optional value parameter like for example an URL to a link.\n-\t\t * @return {Boolean} true/false if the command was executed or not.\n-\t\t */\n-\t\texecCommand : function(c, u, v) {\n-\t\t\tvar t = this, ed = t.get(v), w;\n-\n-\t\t\tfunction clr() {\n-\t\t\t\ted.destroy();\n-\t\t\t\tw.detachEvent('onunload', clr);\n-\t\t\t\tw = w.tinyMCE = w.tinymce = null; // IE leak\n-\t\t\t};\n-\n-\t\t\t// Manager commands\n-\t\t\tswitch (c) {\n-\t\t\t\tcase \"mceFocus\":\n-\t\t\t\t\ted.focus();\n-\t\t\t\t\treturn true;\n-\n-\t\t\t\tcase \"mceAddEditor\":\n-\t\t\t\tcase \"mceAddControl\":\n-\t\t\t\t\tif (!t.get(v))\n-\t\t\t\t\t\tnew tinymce.Editor(v, t.settings).render();\n-\n-\t\t\t\t\treturn true;\n-\n-\t\t\t\tcase \"mceAddFrameControl\":\n-\t\t\t\t\tw = v.window;\n-\n-\t\t\t\t\t// Add tinyMCE global instance and tinymce namespace to specified window\n-\t\t\t\t\tw.tinyMCE = tinyMCE;\n-\t\t\t\t\tw.tinymce = tinymce;\n-\n-\t\t\t\t\ttinymce.DOM.doc = w.document;\n-\t\t\t\t\ttinymce.DOM.win = w;\n-\n-\t\t\t\t\ted = new tinymce.Editor(v.element_id, v);\n-\t\t\t\t\ted.render();\n-\n-\t\t\t\t\t// Fix IE memory leaks\n-\t\t\t\t\tif (tinymce.isIE && ! tinymce.isIE11) {\n-\t\t\t\t\t\tw.attachEvent('onunload', clr);\n-\t\t\t\t\t}\n-\n-\t\t\t\t\tv.page_window = null;\n-\n-\t\t\t\t\treturn true;\n-\n-\t\t\t\tcase \"mceRemoveEditor\":\n-\t\t\t\tcase \"mceRemoveControl\":\n-\t\t\t\t\tif (ed)\n-\t\t\t\t\t\ted.remove();\n-\n-\t\t\t\t\treturn true;\n-\n-\t\t\t\tcase 'mceToggleEditor':\n-\t\t\t\t\tif (!ed) {\n-\t\t\t\t\t\tt.execCommand('mceAddControl', 0, v);\n-\t\t\t\t\t\treturn true;\n-\t\t\t\t\t}\n-\n-\t\t\t\t\tif (ed.isHidden())\n-\t\t\t\t\t\ted.show();\n-\t\t\t\t\telse\n-\t\t\t\t\t\ted.hide();\n-\n-\t\t\t\t\treturn true;\n-\t\t\t}\n-\n-\t\t\t// Run command on active editor\n-\t\t\tif (t.activeEditor)\n-\t\t\t\treturn t.activeEditor.execCommand(c, u, v);\n-\n-\t\t\treturn false;\n-\t\t},\n-\n-\t\t/**\n-\t\t * Executes a command on a specific editor by id. This method was added for compatibility with the 2.x branch.\n-\t\t *\n-\t\t * @deprecated Use the execCommand method of a editor instance instead.\n-\t\t * @method execInstanceCommand\n-\t\t * @param {String} id Editor id to perform the command on.\n-\t\t * @param {String} c Command to perform for example Bold.\n-\t\t * @param {Boolean} u Optional boolean state if a UI should be presented for the command or not.\n-\t\t * @param {String} v Optional value parameter like for example an URL to a link.\n-\t\t * @return {Boolean} true/false if the command was executed or not.\n-\t\t */\n-\t\texecInstanceCommand : function(id, c, u, v) {\n-\t\t\tvar ed = this.get(id);\n-\n-\t\t\tif (ed)\n-\t\t\t\treturn ed.execCommand(c, u, v);\n-\n-\t\t\treturn false;\n-\t\t},\n-\n-\t\t/**\n-\t\t * Calls the save method on all editor instances in the collection. This can be useful when a form is to be submitted.\n-\t\t *\n-\t\t * @method triggerSave\n-\t\t * @example\n-\t\t * // Saves all contents\n-\t\t * tinyMCE.triggerSave();\n-\t\t */\n-\t\ttriggerSave : function() {\n-\t\t\teach(this.editors, function(e) {\n-\t\t\t\te.save();\n-\t\t\t});\n-\t\t},\n-\n-\t\t/**\n-\t\t * Adds a language pack, this gets called by the loaded language files like en.js.\n-\t\t *\n-\t\t * @method addI18n\n-\t\t * @param {String} p Prefix for the language items. For example en.myplugin\n-\t\t * @param {Object} o Name/Value collection with items to add to the language group.\n-\t\t */\n-\t\taddI18n : function(p, o) {\n-\t\t\tvar lo, i18n = this.i18n;\n-\n-\t\t\tif (!tinymce.is(p, 'string')) {\n-\t\t\t\teach(p, function(o, lc) {\n-\t\t\t\t\teach(o, function(o, g) {\n-\t\t\t\t\t\teach(o, function(o, k) {\n-\t\t\t\t\t\t\tif (g === 'common')\n-\t\t\t\t\t\t\t\ti18n[lc + '.' + k] = o;\n-\t\t\t\t\t\t\telse\n-\t\t\t\t\t\t\t\ti18n[lc + '.' + g + '.' + k] = o;\n-\t\t\t\t\t\t});\n-\t\t\t\t\t});\n-\t\t\t\t});\n-\t\t\t} else {\n-\t\t\t\teach(o, function(o, k) {\n-\t\t\t\t\ti18n[p + '.' + k] = o;\n-\t\t\t\t});\n-\t\t\t}\n-\t\t},\n-\n-\t\t// Private methods\n-\n-\t\t_setActive : function(editor) {\n-\t\t\tthis.selectedInstance = this.activeEditor = editor;\n-\t\t}\n-\t});\n-})(tinymce);\n-\n-/**\n- * Alternative name for tinymce added for 2.x compatibility.\n- *\n- * @member\n- * @property tinyMCE\n- * @type tinymce\n- * @example\n- * // To initialize editor instances\n- * tinyMCE.init({\n- *    ...\n- * });\n- */\n-\n-/**\n- * Alternative name for tinymce added for compatibility.\n- *\n- * @member tinymce\n- * @property EditorManager\n- * @type tinymce\n- * @example\n- * // To initialize editor instances\n- * tinymce.EditorManager.get('editor');\n- */"
        },
        {
            "filename": "js/tiny_mce/classes/EnterKey.js",
            "diff": "@@ -1,582 +0,0 @@\n-/**\n- * EnterKey.js\n- *\n- * Copyright, Moxiecode Systems AB\n- * Released under LGPL License.\n- *\n- * License: http://www.tinymce.com/license\n- * Contributing: http://www.tinymce.com/contributing\n- */\n-\n-(function(tinymce) {\n-\tvar TreeWalker = tinymce.dom.TreeWalker;\n-\n-\t/**\n-\t * Contains logic for handling the enter key to split/generate block elements.\n-\t */\n-\ttinymce.EnterKey = function(editor) {\n-\t\tvar dom = editor.dom, selection = editor.selection, settings = editor.settings, undoManager = editor.undoManager, nonEmptyElementsMap = editor.schema.getNonEmptyElements();\n-\n-\t\tfunction handleEnterKey(evt) {\n-\t\t\tvar rng = selection.getRng(true), tmpRng, editableRoot, container, offset, parentBlock, documentMode, shiftKey,\n-\t\t\t\tnewBlock, fragment, containerBlock, parentBlockName, containerBlockName, newBlockName, isAfterLastNodeInContainer;\n-\n-\t\t\t// Returns true if the block can be split into two blocks or not\n-\t\t\tfunction canSplitBlock(node) {\n-\t\t\t\treturn node &&\n-\t\t\t\t\tdom.isBlock(node) &&\n-\t\t\t\t\t!/^(TD|TH|CAPTION|FORM)$/.test(node.nodeName) &&\n-\t\t\t\t\t!/^(fixed|absolute)/i.test(node.style.position) && \n-\t\t\t\t\tdom.getContentEditable(node) !== \"true\";\n-\t\t\t};\n-\n-\t\t\t// Renders empty block on IE\n-\t\t\tfunction renderBlockOnIE(block) {\n-\t\t\t\tvar oldRng;\n-\n-\t\t\t\tif (tinymce.isIE && !tinymce.isIE11 && dom.isBlock(block)) {\n-\t\t\t\t\toldRng = selection.getRng();\n-\t\t\t\t\tblock.appendChild(dom.create('span', null, '\\u00a0'));\n-\t\t\t\t\tselection.select(block);\n-\t\t\t\t\tblock.lastChild.outerHTML = '';\n-\t\t\t\t\tselection.setRng(oldRng);\n-\t\t\t\t}\n-\t\t\t};\n-\n-\t\t\t// Remove the first empty inline element of the block so this: <p><b><em></em></b>x</p> becomes this: <p>x</p>\n-\t\t\tfunction trimInlineElementsOnLeftSideOfBlock(block) {\n-\t\t\t\tvar node = block, firstChilds = [], i;\n-\n-\t\t\t\t// Find inner most first child ex: <p><i><b>*</b></i></p>\n-\t\t\t\twhile (node = node.firstChild) {\n-\t\t\t\t\tif (dom.isBlock(node)) {\n-\t\t\t\t\t\treturn;\n-\t\t\t\t\t}\n-\n-\t\t\t\t\tif (node.nodeType == 1 && !nonEmptyElementsMap[node.nodeName.toLowerCase()]) {\n-\t\t\t\t\t\tfirstChilds.push(node);\n-\t\t\t\t\t}\n-\t\t\t\t}\n-\n-\t\t\t\ti = firstChilds.length;\n-\t\t\t\twhile (i--) {\n-\t\t\t\t\tnode = firstChilds[i];\n-\t\t\t\t\tif (!node.hasChildNodes() || (node.firstChild == node.lastChild && node.firstChild.nodeValue === '')) {\n-\t\t\t\t\t\tdom.remove(node);\n-\t\t\t\t\t} else {\n-\t\t\t\t\t\t// Remove <a> </a> see #5381\n-\t\t\t\t\t\tif (node.nodeName == \"A\" && (node.innerText || node.textContent) === ' ') {\n-\t\t\t\t\t\t\tdom.remove(node);\n-\t\t\t\t\t\t}\n-\t\t\t\t\t}\n-\t\t\t\t}\n-\t\t\t};\n-\t\t\t\n-\t\t\t// Moves the caret to a suitable position within the root for example in the first non pure whitespace text node or before an image\n-\t\t\tfunction moveToCaretPosition(root) {\n-\t\t\t\tvar walker, node, rng, y, viewPort, lastNode = root, tempElm;\n-\n-\t\t\t\trng = dom.createRng();\n-\n-\t\t\t\tif (root.hasChildNodes()) {\n-\t\t\t\t\twalker = new TreeWalker(root, root);\n-\n-\t\t\t\t\twhile (node = walker.current()) {\n-\t\t\t\t\t\tif (node.nodeType == 3) {\n-\t\t\t\t\t\t\trng.setStart(node, 0);\n-\t\t\t\t\t\t\trng.setEnd(node, 0);\n-\t\t\t\t\t\t\tbreak;\n-\t\t\t\t\t\t}\n-\n-\t\t\t\t\t\tif (nonEmptyElementsMap[node.nodeName.toLowerCase()]) {\n-\t\t\t\t\t\t\trng.setStartBefore(node);\n-\t\t\t\t\t\t\trng.setEndBefore(node);\n-\t\t\t\t\t\t\tbreak;\n-\t\t\t\t\t\t}\n-\n-\t\t\t\t\t\tlastNode = node;\n-\t\t\t\t\t\tnode = walker.next();\n-\t\t\t\t\t}\n-\n-\t\t\t\t\tif (!node) {\n-\t\t\t\t\t\trng.setStart(lastNode, 0);\n-\t\t\t\t\t\trng.setEnd(lastNode, 0);\n-\t\t\t\t\t}\n-\t\t\t\t} else {\n-\t\t\t\t\tif (root.nodeName == 'BR') {\n-\t\t\t\t\t\tif (root.nextSibling && dom.isBlock(root.nextSibling)) {\n-\t\t\t\t\t\t\t// Trick on older IE versions to render the caret before the BR between two lists\n-\t\t\t\t\t\t\tif (!documentMode || documentMode < 9) {\n-\t\t\t\t\t\t\t\ttempElm = dom.create('br');\n-\t\t\t\t\t\t\t\troot.parentNode.insertBefore(tempElm, root);\n-\t\t\t\t\t\t\t}\n-\n-\t\t\t\t\t\t\trng.setStartBefore(root);\n-\t\t\t\t\t\t\trng.setEndBefore(root);\n-\t\t\t\t\t\t} else {\n-\t\t\t\t\t\t\trng.setStartAfter(root);\n-\t\t\t\t\t\t\trng.setEndAfter(root);\n-\t\t\t\t\t\t}\n-\t\t\t\t\t} else {\n-\t\t\t\t\t\trng.setStart(root, 0);\n-\t\t\t\t\t\trng.setEnd(root, 0);\n-\t\t\t\t\t}\n-\t\t\t\t}\n-\n-\t\t\t\tselection.setRng(rng);\n-\n-\t\t\t\t// Remove tempElm created for old IE:s\n-\t\t\t\tdom.remove(tempElm);\n-\n-\t\t\t\tviewPort = dom.getViewPort(editor.getWin());\n-\n-\t\t\t\t// scrollIntoView seems to scroll the parent window in most browsers now including FF 3.0b4 so it's time to stop using it and do it our selfs\n-\t\t\t\ty = dom.getPos(root).y;\n-\t\t\t\tif (y < viewPort.y || y + 25 > viewPort.y + viewPort.h) {\n-\t\t\t\t\teditor.getWin().scrollTo(0, y < viewPort.y ? y : y - viewPort.h + 25); // Needs to be hardcoded to roughly one line of text if a huge text block is broken into two blocks\n-\t\t\t\t}\n-\t\t\t};\n-\n-\t\t\t// Creates a new block element by cloning the current one or creating a new one if the name is specified\n-\t\t\t// This function will also copy any text formatting from the parent block and add it to the new one\n-\t\t\tfunction createNewBlock(name) {\n-\t\t\t\tvar node = container, block, clonedNode, caretNode;\n-\n-\t\t\t\tblock = name || parentBlockName == \"TABLE\" ? dom.create(name || newBlockName) : parentBlock.cloneNode(false);\n-\t\t\t\tcaretNode = block;\n-\n-\t\t\t\t// Clone any parent styles\n-\t\t\t\tif (settings.keep_styles !== false) {\n-\t\t\t\t\tdo {\n-\t\t\t\t\t\tif (/^(SPAN|STRONG|B|EM|I|FONT|STRIKE|U)$/.test(node.nodeName)) {\n-\t\t\t\t\t\t\t// Never clone a caret containers\n-\t\t\t\t\t\t\tif (node.id == '_mce_caret') {\n-\t\t\t\t\t\t\t\tcontinue;\n-\t\t\t\t\t\t\t}\n-\n-\t\t\t\t\t\t\tclonedNode = node.cloneNode(false);\n-\t\t\t\t\t\t\tdom.setAttrib(clonedNode, 'id', ''); // Remove ID since it needs to be document unique\n-\n-\t\t\t\t\t\t\tif (block.hasChildNodes()) {\n-\t\t\t\t\t\t\t\tclonedNode.appendChild(block.firstChild);\n-\t\t\t\t\t\t\t\tblock.appendChild(clonedNode);\n-\t\t\t\t\t\t\t} else {\n-\t\t\t\t\t\t\t\tcaretNode = clonedNode;\n-\t\t\t\t\t\t\t\tblock.appendChild(clonedNode);\n-\t\t\t\t\t\t\t}\n-\t\t\t\t\t\t}\n-\t\t\t\t\t} while (node = node.parentNode);\n-\t\t\t\t}\n-\n-\t\t\t\t// BR is needed in empty blocks on non IE browsers\n-\t\t\t\tif (!tinymce.isIE || tinymce.isIE11) {\n-\t\t\t\t\tcaretNode.innerHTML = '<br data-mce-bogus=\"1\">';\n-\t\t\t\t}\n-\n-\t\t\t\treturn block;\n-\t\t\t};\n-\n-\t\t\t// Returns true/false if the caret is at the start/end of the parent block element\n-\t\t\tfunction isCaretAtStartOrEndOfBlock(start) {\n-\t\t\t\tvar walker, node, name;\n-\n-\t\t\t\t// Caret is in the middle of a text node like \"a|b\"\n-\t\t\t\tif (container.nodeType == 3 && (start ? offset > 0 : offset < container.nodeValue.length)) {\n-\t\t\t\t\treturn false;\n-\t\t\t\t}\n-\n-\t\t\t\t// If after the last element in block node edge case for #5091\n-\t\t\t\tif (container.parentNode == parentBlock && isAfterLastNodeInContainer && !start) {\n-\t\t\t\t\treturn true;\n-\t\t\t\t}\n-\n-\t\t\t\t// If the caret if before the first element in parentBlock\n-\t\t\t\tif (start && container.nodeType == 1 && container == parentBlock.firstChild) {\n-\t\t\t\t\treturn true;\n-\t\t\t\t}\n-\n-\t\t\t\t// Caret can be before/after a table\n-\t\t\t\tif (container.nodeName === \"TABLE\" || (container.previousSibling && container.previousSibling.nodeName == \"TABLE\")) {\n-\t\t\t\t\treturn (isAfterLastNodeInContainer && !start) || (!isAfterLastNodeInContainer && start);\n-\t\t\t\t}\n-\n-\t\t\t\t// Walk the DOM and look for text nodes or non empty elements\n-\t\t\t\twalker = new TreeWalker(container, parentBlock);\n-\t\n-\t\t\t\t// If caret is in beginning or end of a text block then jump to the next/previous node\n-\t\t\t\tif (container.nodeType == 3) {\n-\t\t\t\t\tif (start && offset == 0) {\n-\t\t\t\t\t\twalker.prev();\n-\t\t\t\t\t} else if (!start && offset == container.nodeValue.length) {\n-\t\t\t\t\t\twalker.next();\n-\t\t\t\t\t}\n-\t\t\t\t}\n-\n-\t\t\t\twhile (node = walker.current()) {\n-\t\t\t\t\tif (node.nodeType === 1) {\n-\t\t\t\t\t\t// Ignore bogus elements\n-\t\t\t\t\t\tif (!node.getAttribute('data-mce-bogus')) {\n-\t\t\t\t\t\t\t// Keep empty elements like <img /> <input /> but not trailing br:s like <p>text|<br></p>\n-\t\t\t\t\t\t\tname = node.nodeName.toLowerCase();\n-\t\t\t\t\t\t\tif (nonEmptyElementsMap[name] && name !== 'br') {\n-\t\t\t\t\t\t\t\treturn false;\n-\t\t\t\t\t\t\t}\n-\t\t\t\t\t\t}\n-\t\t\t\t\t} else if (node.nodeType === 3 && !/^[ \\t\\r\\n]*$/.test(node.nodeValue)) {\n-\t\t\t\t\t\treturn false;\n-\t\t\t\t\t}\n-\n-\t\t\t\t\tif (start) {\n-\t\t\t\t\t\twalker.prev();\n-\t\t\t\t\t} else {\n-\t\t\t\t\t\twalker.next();\n-\t\t\t\t\t}\n-\t\t\t\t}\n-\n-\t\t\t\treturn true;\n-\t\t\t};\n-\n-\t\t\t// Wraps any text nodes or inline elements in the specified forced root block name\n-\t\t\tfunction wrapSelfAndSiblingsInDefaultBlock(container, offset) {\n-\t\t\t\tvar newBlock, parentBlock, startNode, node, next, blockName = newBlockName || 'P';\n-\n-\t\t\t\t// Not in a block element or in a table cell or caption\n-\t\t\t\tparentBlock = dom.getParent(container, dom.isBlock);\n-\t\t\t\tif (!parentBlock || !canSplitBlock(parentBlock)) {\n-\t\t\t\t\tparentBlock = parentBlock || editableRoot;\n-\n-\t\t\t\t\tif (!parentBlock.hasChildNodes()) {\n-\t\t\t\t\t\tnewBlock = dom.create(blockName);\n-\t\t\t\t\t\tparentBlock.appendChild(newBlock);\n-\t\t\t\t\t\trng.setStart(newBlock, 0);\n-\t\t\t\t\t\trng.setEnd(newBlock, 0);\n-\t\t\t\t\t\treturn newBlock;\n-\t\t\t\t\t}\n-\n-\t\t\t\t\t// Find parent that is the first child of parentBlock\n-\t\t\t\t\tnode = container;\n-\t\t\t\t\twhile (node.parentNode != parentBlock) {\n-\t\t\t\t\t\tnode = node.parentNode;\n-\t\t\t\t\t}\n-\n-\t\t\t\t\t// Loop left to find start node start wrapping at\n-\t\t\t\t\twhile (node && !dom.isBlock(node)) {\n-\t\t\t\t\t\tstartNode = node;\n-\t\t\t\t\t\tnode = node.previousSibling;\n-\t\t\t\t\t}\n-\n-\t\t\t\t\tif (startNode) {\n-\t\t\t\t\t\tnewBlock = dom.create(blockName);\n-\t\t\t\t\t\tstartNode.parentNode.insertBefore(newBlock, startNode);\n-\n-\t\t\t\t\t\t// Start wrapping until we hit a block\n-\t\t\t\t\t\tnode = startNode;\n-\t\t\t\t\t\twhile (node && !dom.isBlock(node)) {\n-\t\t\t\t\t\t\tnext = node.nextSibling;\n-\t\t\t\t\t\t\tnewBlock.appendChild(node);\n-\t\t\t\t\t\t\tnode = next;\n-\t\t\t\t\t\t}\n-\n-\t\t\t\t\t\t// Restore range to it's past location\n-\t\t\t\t\t\trng.setStart(container, offset);\n-\t\t\t\t\t\trng.setEnd(container, offset);\n-\t\t\t\t\t}\n-\t\t\t\t}\n-\n-\t\t\t\treturn container;\n-\t\t\t};\n-\n-\t\t\t// Inserts a block or br before/after or in the middle of a split list of the LI is empty\n-\t\t\tfunction handleEmptyListItem() {\n-\t\t\t\tfunction isFirstOrLastLi(first) {\n-\t\t\t\t\tvar node = containerBlock[first ? 'firstChild' : 'lastChild'];\n-\n-\t\t\t\t\t// Find first/last element since there might be whitespace there\n-\t\t\t\t\twhile (node) {\n-\t\t\t\t\t\tif (node.nodeType == 1) {\n-\t\t\t\t\t\t\tbreak;\n-\t\t\t\t\t\t}\n-\n-\t\t\t\t\t\tnode = node[first ? 'nextSibling' : 'previousSibling'];\n-\t\t\t\t\t}\n-\n-\t\t\t\t\treturn node === parentBlock;\n-\t\t\t\t};\n-\n-\t\t\t\tnewBlock = newBlockName ? createNewBlock(newBlockName) : dom.create('BR');\n-\n-\t\t\t\tif (isFirstOrLastLi(true) && isFirstOrLastLi()) {\n-\t\t\t\t\t// Is first and last list item then replace the OL/UL with a text block\n-\t\t\t\t\tdom.replace(newBlock, containerBlock);\n-\t\t\t\t} else if (isFirstOrLastLi(true)) {\n-\t\t\t\t\t// First LI in list then remove LI and add text block before list\n-\t\t\t\t\tcontainerBlock.parentNode.insertBefore(newBlock, containerBlock);\n-\t\t\t\t} else if (isFirstOrLastLi()) {\n-\t\t\t\t\t// Last LI in list then temove LI and add text block after list\n-\t\t\t\t\tdom.insertAfter(newBlock, containerBlock);\n-\t\t\t\t\trenderBlockOnIE(newBlock);\n-\t\t\t\t} else {\n-\t\t\t\t\t// Middle LI in list the split the list and insert a text block in the middle\n-\t\t\t\t\t// Extract after fragment and insert it after the current block\n-\t\t\t\t\ttmpRng = rng.cloneRange();\n-\t\t\t\t\ttmpRng.setStartAfter(parentBlock);\n-\t\t\t\t\ttmpRng.setEndAfter(containerBlock);\n-\t\t\t\t\tfragment = tmpRng.extractContents();\n-\t\t\t\t\tdom.insertAfter(fragment, containerBlock);\n-\t\t\t\t\tdom.insertAfter(newBlock, containerBlock);\n-\t\t\t\t}\n-\n-\t\t\t\tdom.remove(parentBlock);\n-\t\t\t\tmoveToCaretPosition(newBlock);\n-\t\t\t\tundoManager.add();\n-\t\t\t};\n-\n-\t\t\t// Walks the parent block to the right and look for any contents\n-\t\t\tfunction hasRightSideContent() {\n-\t\t\t\tvar walker = new TreeWalker(container, parentBlock), node;\n-\n-\t\t\t\twhile (node = walker.next()) {\n-\t\t\t\t\tif (nonEmptyElementsMap[node.nodeName.toLowerCase()] || node.length > 0) {\n-\t\t\t\t\t\treturn true;\n-\t\t\t\t\t}\n-\t\t\t\t}\n-\t\t\t}\n-\n-\t\t\t// Inserts a BR element if the forced_root_block option is set to false or empty string\n-\t\t\tfunction insertBr() {\n-\t\t\t\tvar brElm, extraBr, marker;\n-\n-\t\t\t\tif (container && container.nodeType == 3 && offset >= container.nodeValue.length) {\n-\t\t\t\t\t// Insert extra BR element at the end block elements\n-\t\t\t\t\tif ((!tinymce.isIE || tinymce.isIE11) && !hasRightSideContent()) {\n-\t\t\t\t\t\tbrElm = dom.create('br');\n-\t\t\t\t\t\trng.insertNode(brElm);\n-\t\t\t\t\t\trng.setStartAfter(brElm);\n-\t\t\t\t\t\trng.setEndAfter(brElm);\n-\t\t\t\t\t\textraBr = true;\n-\t\t\t\t\t}\n-\t\t\t\t}\n-\n-\t\t\t\tbrElm = dom.create('br');\n-\t\t\t\trng.insertNode(brElm);\n-\n-\t\t\t\t// Rendering modes below IE8 doesn't display BR elements in PRE unless we have a \\n before it\n-\t\t\t\tif ((tinymce.isIE && !tinymce.isIE11) && parentBlockName == 'PRE' && (!documentMode || documentMode < 8)) {\n-\t\t\t\t\tbrElm.parentNode.insertBefore(dom.doc.createTextNode('\\r'), brElm);\n-\t\t\t\t}\n-\n-\t\t\t\t// Insert temp marker and scroll to that\n-\t\t\t\tmarker = dom.create('span', {}, '&nbsp;');\n-\t\t\t\tbrElm.parentNode.insertBefore(marker, brElm);\n-\t\t\t\tselection.scrollIntoView(marker);\n-\t\t\t\tdom.remove(marker);\n-\n-\t\t\t\tif (!extraBr) {\n-\t\t\t\t\trng.setStartAfter(brElm);\n-\t\t\t\t\trng.setEndAfter(brElm);\n-\t\t\t\t} else {\n-\t\t\t\t\trng.setStartBefore(brElm);\n-\t\t\t\t\trng.setEndBefore(brElm);\n-\t\t\t\t}\n-\n-\t\t\t\tselection.setRng(rng);\n-\t\t\t\tundoManager.add();\n-\t\t\t};\n-\n-\t\t\t// Trims any linebreaks at the beginning of node user for example when pressing enter in a PRE element\n-\t\t\tfunction trimLeadingLineBreaks(node) {\n-\t\t\t\tdo {\n-\t\t\t\t\tif (node.nodeType === 3) {\n-\t\t\t\t\t\tnode.nodeValue = node.nodeValue.replace(/^[\\r\\n]+/, '');\n-\t\t\t\t\t}\n-\n-\t\t\t\t\tnode = node.firstChild;\n-\t\t\t\t} while (node);\n-\t\t\t};\n-\n-\t\t\tfunction getEditableRoot(node) {\n-\t\t\t\tvar root = dom.getRoot(), parent, editableRoot;\n-\n-\t\t\t\t// Get all parents until we hit a non editable parent or the root\n-\t\t\t\tparent = node;\n-\t\t\t\twhile (parent !== root && dom.getContentEditable(parent) !== \"false\") {\n-\t\t\t\t\tif (dom.getContentEditable(parent) === \"true\") {\n-\t\t\t\t\t\teditableRoot = parent;\n-\t\t\t\t\t}\n-\n-\t\t\t\t\tparent = parent.parentNode;\n-\t\t\t\t}\n-\t\t\t\t\n-\t\t\t\treturn parent !== root ? editableRoot : root;\n-\t\t\t};\n-\n-\t\t\t// Adds a BR at the end of blocks that only contains an IMG or INPUT since these might be floated and then they won't expand the block\n-\t\t\tfunction addBrToBlockIfNeeded(block) {\n-\t\t\t\tvar lastChild;\n-\n-\t\t\t\t// IE will render the blocks correctly other browsers needs a BR\n-\t\t\t\tif (!tinymce.isIE || tinymce.isIE11) {\n-\t\t\t\t\tblock.normalize(); // Remove empty text nodes that got left behind by the extract\n-\n-\t\t\t\t\t// Check if the block is empty or contains a floated last child\n-\t\t\t\t\tlastChild = block.lastChild;\n-\t\t\t\t\tif (!lastChild || (/^(left|right)$/gi.test(dom.getStyle(lastChild, 'float', true)))) {\n-\t\t\t\t\t\tdom.add(block, 'br');\n-\t\t\t\t\t}\n-\t\t\t\t}\n-\t\t\t};\n-\n-\t\t\t// Delete any selected contents\n-\t\t\tif (!rng.collapsed) {\n-\t\t\t\teditor.execCommand('Delete');\n-\t\t\t\treturn;\n-\t\t\t}\n-\n-\t\t\t// Event is blocked by some other handler for example the lists plugin\n-\t\t\tif (evt.isDefaultPrevented()) {\n-\t\t\t\treturn;\n-\t\t\t}\n-\n-\t\t\t// Setup range items and newBlockName\n-\t\t\tcontainer = rng.startContainer;\n-\t\t\toffset = rng.startOffset;\n-\t\t\tnewBlockName = (settings.force_p_newlines ? 'p' : '') || settings.forced_root_block;\n-\t\t\tnewBlockName = newBlockName ? newBlockName.toUpperCase() : '';\n-\t\t\tdocumentMode = dom.doc.documentMode;\n-\t\t\tshiftKey = evt.shiftKey;\n-\n-\t\t\t// Resolve node index\n-\t\t\tif (container.nodeType == 1 && container.hasChildNodes()) {\n-\t\t\t\tisAfterLastNodeInContainer = offset > container.childNodes.length - 1;\n-\t\t\t\tcontainer = container.childNodes[Math.min(offset, container.childNodes.length - 1)] || container;\n-\t\t\t\tif (isAfterLastNodeInContainer && container.nodeType == 3) {\n-\t\t\t\t\toffset = container.nodeValue.length;\n-\t\t\t\t} else {\n-\t\t\t\t\toffset = 0;\n-\t\t\t\t}\n-\t\t\t}\n-\n-\t\t\t// Get editable root node normaly the body element but sometimes a div or span\n-\t\t\teditableRoot = getEditableRoot(container);\n-\n-\t\t\t// If there is no editable root then enter is done inside a contentEditable false element\n-\t\t\tif (!editableRoot) {\n-\t\t\t\treturn;\n-\t\t\t}\n-\n-\t\t\tundoManager.beforeChange();\n-\n-\t\t\t// If editable root isn't block nor the root of the editor\n-\t\t\tif (!dom.isBlock(editableRoot) && editableRoot != dom.getRoot()) {\n-\t\t\t\tif (!newBlockName || shiftKey) {\n-\t\t\t\t\tinsertBr();\n-\t\t\t\t}\n-\n-\t\t\t\treturn;\n-\t\t\t}\n-\n-\t\t\t// Wrap the current node and it's sibling in a default block if it's needed.\n-\t\t\t// for example this <td>text|<b>text2</b></td> will become this <td><p>text|<b>text2</p></b></td>\n-\t\t\t// This won't happen if root blocks are disabled or the shiftKey is pressed\n-\t\t\tif ((newBlockName && !shiftKey) || (!newBlockName && shiftKey)) {\n-\t\t\t\tcontainer = wrapSelfAndSiblingsInDefaultBlock(container, offset);\n-\t\t\t}\n-\n-\t\t\t// Find parent block and setup empty block paddings\n-\t\t\tparentBlock = dom.getParent(container, dom.isBlock);\n-\t\t\tcontainerBlock = parentBlock ? dom.getParent(parentBlock.parentNode, dom.isBlock) : null;\n-\n-\t\t\t// Setup block names\n-\t\t\tparentBlockName = parentBlock ? parentBlock.nodeName.toUpperCase() : ''; // IE < 9 & HTML5\n-\t\t\tcontainerBlockName = containerBlock ? containerBlock.nodeName.toUpperCase() : ''; // IE < 9 & HTML5\n-\n-\t\t\t// Enter inside block contained within a LI then split or insert before/after LI\n-\t\t\tif (containerBlockName == 'LI' && !evt.ctrlKey) {\n-\t\t\t\tparentBlock = containerBlock;\n-\t\t\t\tparentBlockName = containerBlockName;\n-\t\t\t}\n-\n-\t\t\t// Handle enter in LI\n-\t\t\tif (parentBlockName == 'LI') {\n-\t\t\t\tif (!newBlockName && shiftKey) {\n-\t\t\t\t\tinsertBr();\n-\t\t\t\t\treturn;\n-\t\t\t\t}\n-\n-\t\t\t\t// Handle enter inside an empty list item\n-\t\t\t\tif (dom.isEmpty(parentBlock)) {\n-\t\t\t\t\t// Let the list plugin or browser handle nested lists for now\n-\t\t\t\t\tif (/^(UL|OL|LI)$/.test(containerBlock.parentNode.nodeName)) {\n-\t\t\t\t\t\treturn false;\n-\t\t\t\t\t}\n-\n-\t\t\t\t\thandleEmptyListItem();\n-\t\t\t\t\treturn;\n-\t\t\t\t}\n-\t\t\t}\n-\n-\t\t\t// Don't split PRE tags but insert a BR instead easier when writing code samples etc\n-\t\t\tif (parentBlockName == 'PRE' && settings.br_in_pre !== false) {\n-\t\t\t\tif (!shiftKey) {\n-\t\t\t\t\tinsertBr();\n-\t\t\t\t\treturn;\n-\t\t\t\t}\n-\t\t\t} else {\n-\t\t\t\t// If no root block is configured then insert a BR by default or if the shiftKey is pressed\n-\t\t\t\tif ((!newBlockName && !shiftKey && parentBlockName != 'LI') || (newBlockName && shiftKey)) {\n-\t\t\t\t\tinsertBr();\n-\t\t\t\t\treturn;\n-\t\t\t\t}\n-\t\t\t}\n-\n-\t\t\t// Default block name if it's not configured\n-\t\t\tnewBlockName = newBlockName || 'P';\n-\n-\t\t\t// Insert new block before/after the parent block depending on caret location\n-\t\t\tif (isCaretAtStartOrEndOfBlock()) {\n-\t\t\t\t// If the caret is at the end of a header we produce a P tag after it similar to Word unless we are in a hgroup\n-\t\t\t\tif (/^(H[1-6]|PRE)$/.test(parentBlockName) && containerBlockName != 'HGROUP') {\n-\t\t\t\t\tnewBlock = createNewBlock(newBlockName);\n-\t\t\t\t} else {\n-\t\t\t\t\tnewBlock = createNewBlock();\n-\t\t\t\t}\n-\n-\t\t\t\t// Split the current container block element if enter is pressed inside an empty inner block element\n-\t\t\t\tif (settings.end_container_on_empty_block && canSplitBlock(containerBlock) && dom.isEmpty(parentBlock)) {\n-\t\t\t\t\t// Split container block for example a BLOCKQUOTE at the current blockParent location for example a P\n-\t\t\t\t\tnewBlock = dom.split(containerBlock, parentBlock);\n-\t\t\t\t} else {\n-\t\t\t\t\tdom.insertAfter(newBlock, parentBlock);\n-\t\t\t\t}\n-\n-\t\t\t\tmoveToCaretPosition(newBlock);\n-\t\t\t} else if (isCaretAtStartOrEndOfBlock(true)) {\n-\t\t\t\t// Insert new block before\n-\t\t\t\tnewBlock = parentBlock.parentNode.insertBefore(createNewBlock(), parentBlock);\n-\t\t\t\trenderBlockOnIE(newBlock);\n-\t\t\t} else {\n-\t\t\t\t// Extract after fragment and insert it after the current block\n-\t\t\t\ttmpRng = rng.cloneRange();\n-\t\t\t\ttmpRng.setEndAfter(parentBlock);\n-\t\t\t\tfragment = tmpRng.extractContents();\n-\t\t\t\ttrimLeadingLineBreaks(fragment);\n-\t\t\t\tnewBlock = fragment.firstChild;\n-\t\t\t\tdom.insertAfter(fragment, parentBlock);\n-\t\t\t\ttrimInlineElementsOnLeftSideOfBlock(newBlock);\n-\t\t\t\taddBrToBlockIfNeeded(parentBlock);\n-\t\t\t\tmoveToCaretPosition(newBlock);\n-\t\t\t}\n-\n-\t\t\tdom.setAttrib(newBlock, 'id', ''); // Remove ID since it needs to be document unique\n-\t\t\tundoManager.add();\n-\t\t}\n-\n-\t\teditor.onKeyDown.add(function(ed, evt) {\n-\t\t\tif (evt.keyCode == 13) {\n-\t\t\t\tif (handleEnterKey(evt) !== false) {\n-\t\t\t\t\tevt.preventDefault();\n-\t\t\t\t}\n-\t\t\t}\n-\t\t});\n-\t};\n-})(tinymce);\n\\ No newline at end of file"
        },
        {
            "filename": "js/tiny_mce/classes/ForceBlocks.js",
            "diff": "@@ -1,115 +0,0 @@\n-/**\n- * ForceBlocks.js\n- *\n- * Copyright, Moxiecode Systems AB\n- * Released under LGPL License.\n- *\n- * License: http://www.tinymce.com/license\n- * Contributing: http://www.tinymce.com/contributing\n- */\n-\n-tinymce.ForceBlocks = function(editor) {\n-\tvar settings = editor.settings, dom = editor.dom, selection = editor.selection, blockElements = editor.schema.getBlockElements();\n-\n-\tfunction addRootBlocks() {\n-\t\tvar node = selection.getStart(), rootNode = editor.getBody(), rng, startContainer, startOffset, endContainer, endOffset, rootBlockNode, tempNode, offset = -0xFFFFFF, wrapped, isInEditorDocument;\n-\n-\t\tif (!node || node.nodeType !== 1 || !settings.forced_root_block)\n-\t\t\treturn;\n-\n-\t\t// Check if node is wrapped in block\n-\t\twhile (node && node != rootNode) {\n-\t\t\tif (blockElements[node.nodeName])\n-\t\t\t\treturn;\n-\n-\t\t\tnode = node.parentNode;\n-\t\t}\n-\n-\t\t// Get current selection\n-\t\trng = selection.getRng();\n-\t\tif (rng.setStart) {\n-\t\t\tstartContainer = rng.startContainer;\n-\t\t\tstartOffset = rng.startOffset;\n-\t\t\tendContainer = rng.endContainer;\n-\t\t\tendOffset = rng.endOffset;\n-\t\t} else {\n-\t\t\t// Force control range into text range\n-\t\t\tif (rng.item) {\n-\t\t\t\tnode = rng.item(0);\n-\t\t\t\trng = editor.getDoc().body.createTextRange();\n-\t\t\t\trng.moveToElementText(node);\n-\t\t\t}\n-\n-\t\t\tisInEditorDocument = rng.parentElement().ownerDocument === editor.getDoc();\n-\t\t\ttmpRng = rng.duplicate();\n-\t\t\ttmpRng.collapse(true);\n-\t\t\tstartOffset = tmpRng.move('character', offset) * -1;\n-\n-\t\t\tif (!tmpRng.collapsed) {\n-\t\t\t\ttmpRng = rng.duplicate();\n-\t\t\t\ttmpRng.collapse(false);\n-\t\t\t\tendOffset = (tmpRng.move('character', offset) * -1) - startOffset;\n-\t\t\t}\n-\t\t}\n-\n-\t\t// Wrap non block elements and text nodes\n-\t\tnode = rootNode.firstChild;\n-\t\twhile (node) {\n-\t\t\tif (node.nodeType === 3 || (node.nodeType == 1 && !blockElements[node.nodeName])) {\n-\t\t\t\t// Remove empty text nodes\n-\t\t\t\tif (node.nodeType === 3 && node.nodeValue.length == 0) {\n-\t\t\t\t\ttempNode = node;\n-\t\t\t\t\tnode = node.nextSibling;\n-\t\t\t\t\tdom.remove(tempNode);\n-\t\t\t\t\tcontinue;\n-\t\t\t\t}\n-\n-\t\t\t\tif (!rootBlockNode) {\n-\t\t\t\t\trootBlockNode = dom.create(settings.forced_root_block);\n-\t\t\t\t\tnode.parentNode.insertBefore(rootBlockNode, node);\n-\t\t\t\t\twrapped = true;\n-\t\t\t\t}\n-\n-\t\t\t\ttempNode = node;\n-\t\t\t\tnode = node.nextSibling;\n-\t\t\t\trootBlockNode.appendChild(tempNode);\n-\t\t\t} else {\n-\t\t\t\trootBlockNode = null;\n-\t\t\t\tnode = node.nextSibling;\n-\t\t\t}\n-\t\t}\n-\n-\t\tif (wrapped) {\n-\t\t\tif (rng.setStart) {\n-\t\t\t\trng.setStart(startContainer, startOffset);\n-\t\t\t\trng.setEnd(endContainer, endOffset);\n-\t\t\t\tselection.setRng(rng);\n-\t\t\t} else {\n-\t\t\t\t// Only select if the previous selection was inside the document to prevent auto focus in quirks mode\n-\t\t\t\tif (isInEditorDocument) {\n-\t\t\t\t\ttry {\n-\t\t\t\t\t\trng = editor.getDoc().body.createTextRange();\n-\t\t\t\t\t\trng.moveToElementText(rootNode);\n-\t\t\t\t\t\trng.collapse(true);\n-\t\t\t\t\t\trng.moveStart('character', startOffset);\n-\n-\t\t\t\t\t\tif (endOffset > 0)\n-\t\t\t\t\t\t\trng.moveEnd('character', endOffset);\n-\n-\t\t\t\t\t\trng.select();\n-\t\t\t\t\t} catch (ex) {\n-\t\t\t\t\t\t// Ignore\n-\t\t\t\t\t}\n-\t\t\t\t}\n-\t\t\t}\n-\n-\t\t\teditor.nodeChanged();\n-\t\t}\n-\t};\n-\n-\t// Force root blocks\n-\tif (settings.forced_root_block) {\n-\t\teditor.onKeyUp.add(addRootBlocks);\n-\t\teditor.onNodeChange.add(addRootBlocks);\n-\t}\n-};"
        },
        {
            "filename": "js/tiny_mce/classes/Formatter.js",
            "diff": "@@ -1,2264 +0,0 @@\n-/**\n- * Formatter.js\n- *\n- * Copyright, Moxiecode Systems AB\n- * Released under LGPL License.\n- *\n- * License: http://www.tinymce.com/license\n- * Contributing: http://www.tinymce.com/contributing\n- */\n-\n-(function(tinymce) {\n-\t/**\n-\t * Text formatter engine class. This class is used to apply formats like bold, italic, font size\n-\t * etc to the current selection or specific nodes. This engine was build to replace the browsers\n-\t * default formatting logic for execCommand due to it's inconsistant and buggy behavior.\n-\t *\n-\t * @class tinymce.Formatter\n-\t * @example\n-\t *  tinymce.activeEditor.formatter.register('mycustomformat', {\n-\t *    inline : 'span',\n-\t *    styles : {color : '#ff0000'}\n-\t *  });\n-\t *\n-\t *  tinymce.activeEditor.formatter.apply('mycustomformat');\n-\t */\n-\n-\t/**\n-\t * Constructs a new formatter instance.\n-\t *\n-\t * @constructor Formatter\n-\t * @param {tinymce.Editor} ed Editor instance to construct the formatter engine to.\n-\t */\n-\ttinymce.Formatter = function(ed) {\n-\t\tvar formats = {},\n-\t\t\teach = tinymce.each,\n-\t\t\tdom = ed.dom,\n-\t\t\tselection = ed.selection,\n-\t\t\tTreeWalker = tinymce.dom.TreeWalker,\n-\t\t\trangeUtils = new tinymce.dom.RangeUtils(dom),\n-\t\t\tisValid = ed.schema.isValidChild,\n-\t\t\tisArray = tinymce.isArray,\n-\t\t\tisBlock = dom.isBlock,\n-\t\t\tforcedRootBlock = ed.settings.forced_root_block,\n-\t\t\tnodeIndex = dom.nodeIndex,\n-\t\t\tINVISIBLE_CHAR = '\\uFEFF',\n-\t\t\tMCE_ATTR_RE = /^(src|href|style)$/,\n-\t\t\tFALSE = false,\n-\t\t\tTRUE = true,\n-\t\t\tformatChangeData,\n-\t\t\tundef,\n-\t\t\tgetContentEditable = dom.getContentEditable;\n-\n-\t\tfunction isTextBlock(name) {\n-\t\t\tif (name.nodeType) {\n-\t\t\t\tname = name.nodeName;\n-\t\t\t}\n-\n-\t\t\treturn !!ed.schema.getTextBlockElements()[name.toLowerCase()];\n-\t\t}\n-\n-\t\tfunction getParents(node, selector) {\n-\t\t\treturn dom.getParents(node, selector, dom.getRoot());\n-\t\t};\n-\n-\t\tfunction isCaretNode(node) {\n-\t\t\treturn node.nodeType === 1 && node.id === '_mce_caret';\n-\t\t};\n-\n-\t\tfunction defaultFormats() {\n-\t\t\tregister({\n-\t\t\t\talignleft : [\n-\t\t\t\t\t{selector : 'figure,p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li', styles : {textAlign : 'left'}, defaultBlock: 'div'},\n-\t\t\t\t\t{selector : 'img,table', collapsed : false, styles : {'float' : 'left'}}\n-\t\t\t\t],\n-\n-\t\t\t\taligncenter : [\n-\t\t\t\t\t{selector : 'figure,p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li', styles : {textAlign : 'center'}, defaultBlock: 'div'},\n-\t\t\t\t\t{selector : 'img', collapsed : false, styles : {display : 'block', marginLeft : 'auto', marginRight : 'auto'}},\n-\t\t\t\t\t{selector : 'table', collapsed : false, styles : {marginLeft : 'auto', marginRight : 'auto'}}\n-\t\t\t\t],\n-\n-\t\t\t\talignright : [\n-\t\t\t\t\t{selector : 'figure,p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li', styles : {textAlign : 'right'}, defaultBlock: 'div'},\n-\t\t\t\t\t{selector : 'img,table', collapsed : false, styles : {'float' : 'right'}}\n-\t\t\t\t],\n-\n-\t\t\t\talignfull : [\n-\t\t\t\t\t{selector : 'figure,p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li', styles : {textAlign : 'justify'}, defaultBlock: 'div'}\n-\t\t\t\t],\n-\n-\t\t\t\tbold : [\n-\t\t\t\t\t{inline : 'strong', remove : 'all'},\n-\t\t\t\t\t{inline : 'span', styles : {fontWeight : 'bold'}},\n-\t\t\t\t\t{inline : 'b', remove : 'all'}\n-\t\t\t\t],\n-\n-\t\t\t\titalic : [\n-\t\t\t\t\t{inline : 'em', remove : 'all'},\n-\t\t\t\t\t{inline : 'span', styles : {fontStyle : 'italic'}},\n-\t\t\t\t\t{inline : 'i', remove : 'all'}\n-\t\t\t\t],\n-\n-\t\t\t\tunderline : [\n-\t\t\t\t\t{inline : 'span', styles : {textDecoration : 'underline'}, exact : true},\n-\t\t\t\t\t{inline : 'u', remove : 'all'}\n-\t\t\t\t],\n-\n-\t\t\t\tstrikethrough : [\n-\t\t\t\t\t{inline : 'span', styles : {textDecoration : 'line-through'}, exact : true},\n-\t\t\t\t\t{inline : 'strike', remove : 'all'}\n-\t\t\t\t],\n-\n-\t\t\t\tforecolor : {inline : 'span', styles : {color : '%value'}, wrap_links : false},\n-\t\t\t\thilitecolor : {inline : 'span', styles : {backgroundColor : '%value'}, wrap_links : false},\n-\t\t\t\tfontname : {inline : 'span', styles : {fontFamily : '%value'}},\n-\t\t\t\tfontsize : {inline : 'span', styles : {fontSize : '%value'}},\n-\t\t\t\tfontsize_class : {inline : 'span', attributes : {'class' : '%value'}},\n-\t\t\t\tblockquote : {block : 'blockquote', wrapper : 1, remove : 'all'},\n-\t\t\t\tsubscript : {inline : 'sub'},\n-\t\t\t\tsuperscript : {inline : 'sup'},\n-\n-\t\t\t\tlink : {inline : 'a', selector : 'a', remove : 'all', split : true, deep : true,\n-\t\t\t\t\tonmatch : function(node) {\n-\t\t\t\t\t\treturn true;\n-\t\t\t\t\t},\n-\n-\t\t\t\t\tonformat : function(elm, fmt, vars) {\n-\t\t\t\t\t\teach(vars, function(value, key) {\n-\t\t\t\t\t\t\tdom.setAttrib(elm, key, value);\n-\t\t\t\t\t\t});\n-\t\t\t\t\t}\n-\t\t\t\t},\n-\n-\t\t\t\tremoveformat : [\n-\t\t\t\t\t{selector : 'b,strong,em,i,font,u,strike', remove : 'all', split : true, expand : false, block_expand : true, deep : true},\n-\t\t\t\t\t{selector : 'span', attributes : ['style', 'class'], remove : 'empty', split : true, expand : false, deep : true},\n-\t\t\t\t\t{selector : '*', attributes : ['style', 'class'], split : false, expand : false, deep : true}\n-\t\t\t\t]\n-\t\t\t});\n-\n-\t\t\t// Register default block formats\n-\t\t\teach('p h1 h2 h3 h4 h5 h6 div address pre div code dt dd samp'.split(/\\s/), function(name) {\n-\t\t\t\tregister(name, {block : name, remove : 'all'});\n-\t\t\t});\n-\n-\t\t\t// Register user defined formats\n-\t\t\tregister(ed.settings.formats);\n-\t\t};\n-\n-\t\tfunction addKeyboardShortcuts() {\n-\t\t\t// Add some inline shortcuts\n-\t\t\ted.addShortcut('ctrl+b', 'bold_desc', 'Bold');\n-\t\t\ted.addShortcut('ctrl+i', 'italic_desc', 'Italic');\n-\t\t\ted.addShortcut('ctrl+u', 'underline_desc', 'Underline');\n-\n-\t\t\t// BlockFormat shortcuts keys\n-\t\t\tfor (var i = 1; i <= 6; i++) {\n-\t\t\t\ted.addShortcut('ctrl+' + i, '', ['FormatBlock', false, 'h' + i]);\n-\t\t\t}\n-\n-\t\t\ted.addShortcut('ctrl+7', '', ['FormatBlock', false, 'p']);\n-\t\t\ted.addShortcut('ctrl+8', '', ['FormatBlock', false, 'div']);\n-\t\t\ted.addShortcut('ctrl+9', '', ['FormatBlock', false, 'address']);\n-\t\t};\n-\n-\t\t// Public functions\n-\n-\t\t/**\n-\t\t * Returns the format by name or all formats if no name is specified.\n-\t\t *\n-\t\t * @method get\n-\t\t * @param {String} name Optional name to retrieve by.\n-\t\t * @return {Array/Object} Array/Object with all registred formats or a specific format.\n-\t\t */\n-\t\tfunction get(name) {\n-\t\t\treturn name ? formats[name] : formats;\n-\t\t};\n-\n-\t\t/**\n-\t\t * Registers a specific format by name.\n-\t\t *\n-\t\t * @method register\n-\t\t * @param {Object/String} name Name of the format for example \"bold\".\n-\t\t * @param {Object/Array} format Optional format object or array of format variants can only be omitted if the first arg is an object.\n-\t\t */\n-\t\tfunction register(name, format) {\n-\t\t\tif (name) {\n-\t\t\t\tif (typeof(name) !== 'string') {\n-\t\t\t\t\teach(name, function(format, name) {\n-\t\t\t\t\t\tregister(name, format);\n-\t\t\t\t\t});\n-\t\t\t\t} else {\n-\t\t\t\t\t// Force format into array and add it to internal collection\n-\t\t\t\t\tformat = format.length ? format : [format];\n-\n-\t\t\t\t\teach(format, function(format) {\n-\t\t\t\t\t\t// Set deep to false by default on selector formats this to avoid removing\n-\t\t\t\t\t\t// alignment on images inside paragraphs when alignment is changed on paragraphs\n-\t\t\t\t\t\tif (format.deep === undef)\n-\t\t\t\t\t\t\tformat.deep = !format.selector;\n-\n-\t\t\t\t\t\t// Default to true\n-\t\t\t\t\t\tif (format.split === undef)\n-\t\t\t\t\t\t\tformat.split = !format.selector || format.inline;\n-\n-\t\t\t\t\t\t// Default to true\n-\t\t\t\t\t\tif (format.remove === undef && format.selector && !format.inline)\n-\t\t\t\t\t\t\tformat.remove = 'none';\n-\n-\t\t\t\t\t\t// Mark format as a mixed format inline + block level\n-\t\t\t\t\t\tif (format.selector && format.inline) {\n-\t\t\t\t\t\t\tformat.mixed = true;\n-\t\t\t\t\t\t\tformat.block_expand = true;\n-\t\t\t\t\t\t}\n-\n-\t\t\t\t\t\t// Split classes if needed\n-\t\t\t\t\t\tif (typeof(format.classes) === 'string')\n-\t\t\t\t\t\t\tformat.classes = format.classes.split(/\\s+/);\n-\t\t\t\t\t});\n-\n-\t\t\t\t\tformats[name] = format;\n-\t\t\t\t}\n-\t\t\t}\n-\t\t};\n-\n-\t\tvar getTextDecoration = function(node) {\n-\t\t\tvar decoration;\n-\n-\t\t\ted.dom.getParent(node, function(n) {\n-\t\t\t\tdecoration = ed.dom.getStyle(n, 'text-decoration');\n-\t\t\t\treturn decoration && decoration !== 'none';\n-\t\t\t});\n-\n-\t\t\treturn decoration;\n-\t\t};\n-\n-\t\tvar processUnderlineAndColor = function(node) {\n-\t\t\tvar textDecoration;\n-\t\t\tif (node.nodeType === 1 && node.parentNode && node.parentNode.nodeType === 1) {\n-\t\t\t\ttextDecoration = getTextDecoration(node.parentNode);\n-\t\t\t\tif (ed.dom.getStyle(node, 'color') && textDecoration) {\n-\t\t\t\t\ted.dom.setStyle(node, 'text-decoration', textDecoration);\n-\t\t\t\t} else if (ed.dom.getStyle(node, 'textdecoration') === textDecoration) {\n-\t\t\t\t\ted.dom.setStyle(node, 'text-decoration', null);\n-\t\t\t\t}\n-\t\t\t}\n-\t\t};\n-\n-\t\t/**\n-\t\t * Applies the specified format to the current selection or specified node.\n-\t\t *\n-\t\t * @method apply\n-\t\t * @param {String} name Name of format to apply.\n-\t\t * @param {Object} vars Optional list of variables to replace within format before applying it.\n-\t\t * @param {Node} node Optional node to apply the format to defaults to current selection.\n-\t\t */\n-\t\tfunction apply(name, vars, node) {\n-\t\t\tvar formatList = get(name), format = formatList[0], bookmark, rng, i, isCollapsed = selection.isCollapsed();\n-\n-\t\t\tfunction setElementFormat(elm, fmt) {\n-\t\t\t\tfmt = fmt || format;\n-\n-\t\t\t\tif (elm) {\n-\t\t\t\t\tif (fmt.onformat) {\n-\t\t\t\t\t\tfmt.onformat(elm, fmt, vars, node);\n-\t\t\t\t\t}\n-\n-\t\t\t\t\teach(fmt.styles, function(value, name) {\n-\t\t\t\t\t\tdom.setStyle(elm, name, replaceVars(value, vars));\n-\t\t\t\t\t});\n-\n-\t\t\t\t\teach(fmt.attributes, function(value, name) {\n-\t\t\t\t\t\tdom.setAttrib(elm, name, replaceVars(value, vars));\n-\t\t\t\t\t});\n-\n-\t\t\t\t\teach(fmt.classes, function(value) {\n-\t\t\t\t\t\tvalue = replaceVars(value, vars);\n-\n-\t\t\t\t\t\tif (!dom.hasClass(elm, value))\n-\t\t\t\t\t\t\tdom.addClass(elm, value);\n-\t\t\t\t\t});\n-\t\t\t\t}\n-\t\t\t};\n-\t\t\tfunction adjustSelectionToVisibleSelection() {\n-\t\t\t\tfunction findSelectionEnd(start, end) {\n-\t\t\t\t\tvar walker = new TreeWalker(end);\n-\t\t\t\t\tfor (node = walker.current(); node; node = walker.prev()) {\n-\t\t\t\t\t\tif (node.childNodes.length > 1 || node == start || node.tagName == 'BR') {\n-\t\t\t\t\t\t\treturn node;\n-\t\t\t\t\t\t}\n-\t\t\t\t\t}\n-\t\t\t\t};\n-\n-\t\t\t\t// Adjust selection so that a end container with a end offset of zero is not included in the selection\n-\t\t\t\t// as this isn't visible to the user.\n-\t\t\t\tvar rng = ed.selection.getRng();\n-\t\t\t\tvar start = rng.startContainer;\n-\t\t\t\tvar end = rng.endContainer;\n-\n-\t\t\t\tif (start != end && rng.endOffset === 0) {\n-\t\t\t\t\tvar newEnd = findSelectionEnd(start, end);\n-\t\t\t\t\tvar endOffset = newEnd.nodeType == 3 ? newEnd.length : newEnd.childNodes.length;\n-\n-\t\t\t\t\trng.setEnd(newEnd, endOffset);\n-\t\t\t\t}\n-\n-\t\t\t\treturn rng;\n-\t\t\t}\n-\t\t\t\n-\t\t\tfunction applyStyleToList(node, bookmark, wrapElm, newWrappers, process){\n-\t\t\t\tvar nodes = [], listIndex = -1, list, startIndex = -1, endIndex = -1, currentWrapElm;\n-\t\t\t\t\n-\t\t\t\t// find the index of the first child list.\n-\t\t\t\teach(node.childNodes, function(n, index) {\n-\t\t\t\t\tif (n.nodeName === \"UL\" || n.nodeName === \"OL\") {\n-\t\t\t\t\t\tlistIndex = index;\n-\t\t\t\t\t\tlist = n;\n-\t\t\t\t\t\treturn false;\n-\t\t\t\t\t}\n-\t\t\t\t});\n-\t\t\t\t\n-\t\t\t\t// get the index of the bookmarks\n-\t\t\t\teach(node.childNodes, function(n, index) {\n-\t\t\t\t\tif (n.nodeName === \"SPAN\" && dom.getAttrib(n, \"data-mce-type\") == \"bookmark\") {\n-\t\t\t\t\t\tif (n.id == bookmark.id + \"_start\") {\n-\t\t\t\t\t\t\tstartIndex = index;\n-\t\t\t\t\t\t} else if (n.id == bookmark.id + \"_end\") {\n-\t\t\t\t\t\t\tendIndex = index;\n-\t\t\t\t\t\t}\n-\t\t\t\t\t}\n-\t\t\t\t});\n-\t\t\t\t\n-\t\t\t\t// if the selection spans across an embedded list, or there isn't an embedded list - handle processing normally\n-\t\t\t\tif (listIndex <= 0 || (startIndex < listIndex && endIndex > listIndex)) {\n-\t\t\t\t\teach(tinymce.grep(node.childNodes), process);\n-\t\t\t\t\treturn 0;\n-\t\t\t\t} else {\n-\t\t\t\t\tcurrentWrapElm = dom.clone(wrapElm, FALSE);\n-\n-\t\t\t\t\t// create a list of the nodes on the same side of the list as the selection\n-\t\t\t\t\teach(tinymce.grep(node.childNodes), function(n, index) {\n-\t\t\t\t\t\tif ((startIndex < listIndex && index < listIndex) || (startIndex > listIndex && index > listIndex)) {\n-\t\t\t\t\t\t\tnodes.push(n); \n-\t\t\t\t\t\t\tn.parentNode.removeChild(n);\n-\t\t\t\t\t\t}\n-\t\t\t\t\t});\n-\n-\t\t\t\t\t// insert the wrapping element either before or after the list.\n-\t\t\t\t\tif (startIndex < listIndex) {\n-\t\t\t\t\t\tnode.insertBefore(currentWrapElm, list);\n-\t\t\t\t\t} else if (startIndex > listIndex) {\n-\t\t\t\t\t\tnode.insertBefore(currentWrapElm, list.nextSibling);\n-\t\t\t\t\t}\n-\t\t\t\t\t\n-\t\t\t\t\t// add the new nodes to the list.\n-\t\t\t\t\tnewWrappers.push(currentWrapElm);\n-\n-\t\t\t\t\teach(nodes, function(node) {\n-\t\t\t\t\t\tcurrentWrapElm.appendChild(node);\n-\t\t\t\t\t});\n-\n-\t\t\t\t\treturn currentWrapElm;\n-\t\t\t\t}\n-\t\t\t};\n-\n-\t\t\tfunction applyRngStyle(rng, bookmark, node_specific) {\n-\t\t\t\tvar newWrappers = [], wrapName, wrapElm, contentEditable = true;\n-\n-\t\t\t\t// Setup wrapper element\n-\t\t\t\twrapName = format.inline || format.block;\n-\t\t\t\twrapElm = dom.create(wrapName);\n-\t\t\t\tsetElementFormat(wrapElm);\n-\n-\t\t\t\trangeUtils.walk(rng, function(nodes) {\n-\t\t\t\t\tvar currentWrapElm;\n-\n-\t\t\t\t\t/**\n-\t\t\t\t\t * Process a list of nodes wrap them.\n-\t\t\t\t\t */\n-\t\t\t\t\tfunction process(node) {\n-\t\t\t\t\t\tvar nodeName, parentName, found, hasContentEditableState, lastContentEditable;\n-\n-\t\t\t\t\t\tlastContentEditable = contentEditable;\n-\t\t\t\t\t\tnodeName = node.nodeName.toLowerCase();\n-\t\t\t\t\t\tparentName = node.parentNode.nodeName.toLowerCase();\n-\n-\t\t\t\t\t\t// Node has a contentEditable value\n-\t\t\t\t\t\tif (node.nodeType === 1 && getContentEditable(node)) {\n-\t\t\t\t\t\t\tlastContentEditable = contentEditable;\n-\t\t\t\t\t\t\tcontentEditable = getContentEditable(node) === \"true\";\n-\t\t\t\t\t\t\thasContentEditableState = true; // We don't want to wrap the container only it's children\n-\t\t\t\t\t\t}\n-\n-\t\t\t\t\t\t// Stop wrapping on br elements\n-\t\t\t\t\t\tif (isEq(nodeName, 'br')) {\n-\t\t\t\t\t\t\tcurrentWrapElm = 0;\n-\n-\t\t\t\t\t\t\t// Remove any br elements when we wrap things\n-\t\t\t\t\t\t\tif (format.block)\n-\t\t\t\t\t\t\t\tdom.remove(node);\n-\n-\t\t\t\t\t\t\treturn;\n-\t\t\t\t\t\t}\n-\n-\t\t\t\t\t\t// If node is wrapper type\n-\t\t\t\t\t\tif (format.wrapper && matchNode(node, name, vars)) {\n-\t\t\t\t\t\t\tcurrentWrapElm = 0;\n-\t\t\t\t\t\t\treturn;\n-\t\t\t\t\t\t}\n-\n-\t\t\t\t\t\t// Can we rename the block\n-\t\t\t\t\t\tif (contentEditable && !hasContentEditableState && format.block && !format.wrapper && isTextBlock(nodeName)) {\n-\t\t\t\t\t\t\tnode = dom.rename(node, wrapName);\n-\t\t\t\t\t\t\tsetElementFormat(node);\n-\t\t\t\t\t\t\tnewWrappers.push(node);\n-\t\t\t\t\t\t\tcurrentWrapElm = 0;\n-\t\t\t\t\t\t\treturn;\n-\t\t\t\t\t\t}\n-\n-\t\t\t\t\t\t// Handle selector patterns\n-\t\t\t\t\t\tif (format.selector) {\n-\t\t\t\t\t\t\t// Look for matching formats\n-\t\t\t\t\t\t\teach(formatList, function(format) {\n-\t\t\t\t\t\t\t\t// Check collapsed state if it exists\n-\t\t\t\t\t\t\t\tif ('collapsed' in format && format.collapsed !== isCollapsed) {\n-\t\t\t\t\t\t\t\t\treturn;\n-\t\t\t\t\t\t\t\t}\n-\n-\t\t\t\t\t\t\t\tif (dom.is(node, format.selector) && !isCaretNode(node)) {\n-\t\t\t\t\t\t\t\t\tsetElementFormat(node, format);\n-\t\t\t\t\t\t\t\t\tfound = true;\n-\t\t\t\t\t\t\t\t}\n-\t\t\t\t\t\t\t});\n-\n-\t\t\t\t\t\t\t// Continue processing if a selector match wasn't found and a inline element is defined\n-\t\t\t\t\t\t\tif (!format.inline || found) {\n-\t\t\t\t\t\t\t\tcurrentWrapElm = 0;\n-\t\t\t\t\t\t\t\treturn;\n-\t\t\t\t\t\t\t}\n-\t\t\t\t\t\t}\n-\n-\t\t\t\t\t\t// Is it valid to wrap this item\n-\t\t\t\t\t\tif (contentEditable && !hasContentEditableState && isValid(wrapName, nodeName) && isValid(parentName, wrapName) &&\n-\t\t\t\t\t\t\t\t!(!node_specific && node.nodeType === 3 && node.nodeValue.length === 1 && node.nodeValue.charCodeAt(0) === 65279) && !isCaretNode(node) && (!format.inline || !isBlock(node))) {\n-\t\t\t\t\t\t\t// Start wrapping\n-\t\t\t\t\t\t\tif (!currentWrapElm) {\n-\t\t\t\t\t\t\t\t// Wrap the node\n-\t\t\t\t\t\t\t\tcurrentWrapElm = dom.clone(wrapElm, FALSE);\n-\t\t\t\t\t\t\t\tnode.parentNode.insertBefore(currentWrapElm, node);\n-\t\t\t\t\t\t\t\tnewWrappers.push(currentWrapElm);\n-\t\t\t\t\t\t\t}\n-\n-\t\t\t\t\t\t\tcurrentWrapElm.appendChild(node);\n-\t\t\t\t\t\t} else if (nodeName == 'li' && bookmark) {\n-\t\t\t\t\t\t\t// Start wrapping - if we are in a list node and have a bookmark, then we will always begin by wrapping in a new element.\n-\t\t\t\t\t\t\tcurrentWrapElm = applyStyleToList(node, bookmark, wrapElm, newWrappers, process);\n-\t\t\t\t\t\t} else {\n-\t\t\t\t\t\t\t// Start a new wrapper for possible children\n-\t\t\t\t\t\t\tcurrentWrapElm = 0;\n-\t\t\t\t\t\t\t\n-\t\t\t\t\t\t\teach(tinymce.grep(node.childNodes), process);\n-\n-\t\t\t\t\t\t\tif (hasContentEditableState) {\n-\t\t\t\t\t\t\t\tcontentEditable = lastContentEditable; // Restore last contentEditable state from stack\n-\t\t\t\t\t\t\t}\n-\n-\t\t\t\t\t\t\t// End the last wrapper\n-\t\t\t\t\t\t\tcurrentWrapElm = 0;\n-\t\t\t\t\t\t}\n-\t\t\t\t\t};\n-\n-\t\t\t\t\t// Process siblings from range\n-\t\t\t\t\teach(nodes, process);\n-\t\t\t\t});\n-\n-\t\t\t\t// Wrap links inside as well, for example color inside a link when the wrapper is around the link\n-\t\t\t\tif (format.wrap_links === false) {\n-\t\t\t\t\teach(newWrappers, function(node) {\n-\t\t\t\t\t\tfunction process(node) {\n-\t\t\t\t\t\t\tvar i, currentWrapElm, children;\n-\n-\t\t\t\t\t\t\tif (node.nodeName === 'A') {\n-\t\t\t\t\t\t\t\tcurrentWrapElm = dom.clone(wrapElm, FALSE);\n-\t\t\t\t\t\t\t\tnewWrappers.push(currentWrapElm);\n-\n-\t\t\t\t\t\t\t\tchildren = tinymce.grep(node.childNodes);\n-\t\t\t\t\t\t\t\tfor (i = 0; i < children.length; i++)\n-\t\t\t\t\t\t\t\t\tcurrentWrapElm.appendChild(children[i]);\n-\n-\t\t\t\t\t\t\t\tnode.appendChild(currentWrapElm);\n-\t\t\t\t\t\t\t}\n-\n-\t\t\t\t\t\t\teach(tinymce.grep(node.childNodes), process);\n-\t\t\t\t\t\t};\n-\n-\t\t\t\t\t\tprocess(node);\n-\t\t\t\t\t});\n-\t\t\t\t}\n-\n-\t\t\t\t// Cleanup\n-\t\t\t\t\n-\t\t\t\teach(newWrappers, function(node) {\n-\t\t\t\t\tvar childCount;\n-\n-\t\t\t\t\tfunction getChildCount(node) {\n-\t\t\t\t\t\tvar count = 0;\n-\n-\t\t\t\t\t\teach(node.childNodes, function(node) {\n-\t\t\t\t\t\t\tif (!isWhiteSpaceNode(node) && !isBookmarkNode(node))\n-\t\t\t\t\t\t\t\tcount++;\n-\t\t\t\t\t\t});\n-\n-\t\t\t\t\t\treturn count;\n-\t\t\t\t\t};\n-\n-\t\t\t\t\tfunction mergeStyles(node) {\n-\t\t\t\t\t\tvar child, clone;\n-\n-\t\t\t\t\t\teach(node.childNodes, function(node) {\n-\t\t\t\t\t\t\tif (node.nodeType == 1 && !isBookmarkNode(node) && !isCaretNode(node)) {\n-\t\t\t\t\t\t\t\tchild = node;\n-\t\t\t\t\t\t\t\treturn FALSE; // break loop\n-\t\t\t\t\t\t\t}\n-\t\t\t\t\t\t});\n-\n-\t\t\t\t\t\t// If child was found and of the same type as the current node\n-\t\t\t\t\t\tif (child && matchName(child, format)) {\n-\t\t\t\t\t\t\tclone = dom.clone(child, FALSE);\n-\t\t\t\t\t\t\tsetElementFormat(clone);\n-\n-\t\t\t\t\t\t\tdom.replace(clone, node, TRUE);\n-\t\t\t\t\t\t\tdom.remove(child, 1);\n-\t\t\t\t\t\t}\n-\n-\t\t\t\t\t\treturn clone || node;\n-\t\t\t\t\t};\n-\n-\t\t\t\t\tchildCount = getChildCount(node);\n-\n-\t\t\t\t\t// Remove empty nodes but only if there is multiple wrappers and they are not block\n-\t\t\t\t\t// elements so never remove single <h1></h1> since that would remove the currrent empty block element where the caret is at\n-\t\t\t\t\tif ((newWrappers.length > 1 || !isBlock(node)) && childCount === 0) {\n-\t\t\t\t\t\tdom.remove(node, 1);\n-\t\t\t\t\t\treturn;\n-\t\t\t\t\t}\n-\n-\t\t\t\t\tif (format.inline || format.wrapper) {\n-\t\t\t\t\t\t// Merges the current node with it's children of similar type to reduce the number of elements\n-\t\t\t\t\t\tif (!format.exact && childCount === 1)\n-\t\t\t\t\t\t\tnode = mergeStyles(node);\n-\n-\t\t\t\t\t\t// Remove/merge children\n-\t\t\t\t\t\teach(formatList, function(format) {\n-\t\t\t\t\t\t\t// Merge all children of similar type will move styles from child to parent\n-\t\t\t\t\t\t\t// this: <span style=\"color:red\"><b><span style=\"color:red; font-size:10px\">text</span></b></span>\n-\t\t\t\t\t\t\t// will become: <span style=\"color:red\"><b><span style=\"font-size:10px\">text</span></b></span>\n-\t\t\t\t\t\t\teach(dom.select(format.inline, node), function(child) {\n-\t\t\t\t\t\t\t\tvar parent;\n-\n-\t\t\t\t\t\t\t\t// When wrap_links is set to false we don't want\n-\t\t\t\t\t\t\t\t// to remove the format on children within links\n-\t\t\t\t\t\t\t\tif (format.wrap_links === false) {\n-\t\t\t\t\t\t\t\t\tparent = child.parentNode;\n-\n-\t\t\t\t\t\t\t\t\tdo {\n-\t\t\t\t\t\t\t\t\t\tif (parent.nodeName === 'A')\n-\t\t\t\t\t\t\t\t\t\t\treturn;\n-\t\t\t\t\t\t\t\t\t} while (parent = parent.parentNode);\n-\t\t\t\t\t\t\t\t}\n-\n-\t\t\t\t\t\t\t\tremoveFormat(format, vars, child, format.exact ? child : null);\n-\t\t\t\t\t\t\t});\n-\t\t\t\t\t\t});\n-\n-\t\t\t\t\t\t// Remove child if direct parent is of same type\n-\t\t\t\t\t\tif (matchNode(node.parentNode, name, vars)) {\n-\t\t\t\t\t\t\tdom.remove(node, 1);\n-\t\t\t\t\t\t\tnode = 0;\n-\t\t\t\t\t\t\treturn TRUE;\n-\t\t\t\t\t\t}\n-\n-\t\t\t\t\t\t// Look for parent with similar style format\n-\t\t\t\t\t\tif (format.merge_with_parents) {\n-\t\t\t\t\t\t\tdom.getParent(node.parentNode, function(parent) {\n-\t\t\t\t\t\t\t\tif (matchNode(parent, name, vars)) {\n-\t\t\t\t\t\t\t\t\tdom.remove(node, 1);\n-\t\t\t\t\t\t\t\t\tnode = 0;\n-\t\t\t\t\t\t\t\t\treturn TRUE;\n-\t\t\t\t\t\t\t\t}\n-\t\t\t\t\t\t\t});\n-\t\t\t\t\t\t}\n-\n-\t\t\t\t\t\t// Merge next and previous siblings if they are similar <b>text</b><b>text</b> becomes <b>texttext</b>\n-\t\t\t\t\t\tif (node && format.merge_siblings !== false) {\n-\t\t\t\t\t\t\tnode = mergeSiblings(getNonWhiteSpaceSibling(node), node);\n-\t\t\t\t\t\t\tnode = mergeSiblings(node, getNonWhiteSpaceSibling(node, TRUE));\n-\t\t\t\t\t\t}\n-\t\t\t\t\t}\n-\t\t\t\t});\n-\t\t\t};\n-\n-\t\t\tif (format) {\n-\t\t\t\tif (node) {\n-\t\t\t\t\tif (node.nodeType) {\n-\t\t\t\t\t\trng = dom.createRng();\n-\t\t\t\t\t\trng.setStartBefore(node);\n-\t\t\t\t\t\trng.setEndAfter(node);\n-\t\t\t\t\t\tapplyRngStyle(expandRng(rng, formatList), null, true);\n-\t\t\t\t\t} else {\n-\t\t\t\t\t\tapplyRngStyle(node, null, true);\n-\t\t\t\t\t}\n-\t\t\t\t} else {\n-\t\t\t\t\tif (!isCollapsed || !format.inline || dom.select('td.mceSelected,th.mceSelected').length) {\n-\t\t\t\t\t\t// Obtain selection node before selection is unselected by applyRngStyle()\n-\t\t\t\t\t\tvar curSelNode = ed.selection.getNode();\n-\n-\t\t\t\t\t\t// If the formats have a default block and we can't find a parent block then start wrapping it with a DIV this is for forced_root_blocks: false\n-\t\t\t\t\t\t// It's kind of a hack but people should be using the default block type P since all desktop editors work that way\n-\t\t\t\t\t\tif (!forcedRootBlock && formatList[0].defaultBlock && !dom.getParent(curSelNode, dom.isBlock)) {\n-\t\t\t\t\t\t\tapply(formatList[0].defaultBlock);\n-\t\t\t\t\t\t}\n-\n-\t\t\t\t\t\t// Apply formatting to selection\n-\t\t\t\t\t\ted.selection.setRng(adjustSelectionToVisibleSelection());\n-\t\t\t\t\t\tbookmark = selection.getBookmark();\n-\t\t\t\t\t\tapplyRngStyle(expandRng(selection.getRng(TRUE), formatList), bookmark);\n-\n-\t\t\t\t\t\t// Colored nodes should be underlined so that the color of the underline matches the text color.\n-\t\t\t\t\t\tif (format.styles && (format.styles.color || format.styles.textDecoration)) {\n-\t\t\t\t\t\t\ttinymce.walk(curSelNode, processUnderlineAndColor, 'childNodes');\n-\t\t\t\t\t\t\tprocessUnderlineAndColor(curSelNode);\n-\t\t\t\t\t\t}\n-\n-\t\t\t\t\t\tselection.moveToBookmark(bookmark);\n-\t\t\t\t\t\tmoveStart(selection.getRng(TRUE));\n-\t\t\t\t\t\ted.nodeChanged();\n-\t\t\t\t\t} else\n-\t\t\t\t\t\tperformCaretAction('apply', name, vars);\n-\t\t\t\t}\n-\t\t\t}\n-\t\t};\n-\n-\t\t/**\n-\t\t * Removes the specified format from the current selection or specified node.\n-\t\t *\n-\t\t * @method remove\n-\t\t * @param {String} name Name of format to remove.\n-\t\t * @param {Object} vars Optional list of variables to replace within format before removing it.\n-\t\t * @param {Node/Range} node Optional node or DOM range to remove the format from defaults to current selection.\n-\t\t */\n-\t\tfunction remove(name, vars, node) {\n-\t\t\tvar formatList = get(name), format = formatList[0], bookmark, i, rng, contentEditable = true;\n-\n-\t\t\t// Merges the styles for each node\n-\t\t\tfunction process(node) {\n-\t\t\t\tvar children, i, l, localContentEditable, lastContentEditable, hasContentEditableState;\n-\n-\t\t\t\t// Skip on text nodes as they have neither format to remove nor children\n-\t\t\t\tif (node.nodeType === 3) {\n-\t\t\t\t\treturn;\n-\t\t\t\t}\n-\n-\t\t\t\t// Node has a contentEditable value\n-\t\t\t\tif (node.nodeType === 1 && getContentEditable(node)) {\n-\t\t\t\t\tlastContentEditable = contentEditable;\n-\t\t\t\t\tcontentEditable = getContentEditable(node) === \"true\";\n-\t\t\t\t\thasContentEditableState = true; // We don't want to wrap the container only it's children\n-\t\t\t\t}\n-\n-\t\t\t\t// Grab the children first since the nodelist might be changed\n-\t\t\t\tchildren = tinymce.grep(node.childNodes);\n-\n-\t\t\t\t// Process current node\n-\t\t\t\tif (contentEditable && !hasContentEditableState) {\n-\t\t\t\t\tfor (i = 0, l = formatList.length; i < l; i++) {\n-\t\t\t\t\t\tif (removeFormat(formatList[i], vars, node, node))\n-\t\t\t\t\t\t\tbreak;\n-\t\t\t\t\t}\n-\t\t\t\t}\n-\n-\t\t\t\t// Process the children\n-\t\t\t\tif (format.deep) {\n-\t\t\t\t\tif (children.length) {\t\t\t\t\t\n-\t\t\t\t\t\tfor (i = 0, l = children.length; i < l; i++)\n-\t\t\t\t\t\t\tprocess(children[i]);\n-\n-\t\t\t\t\t\tif (hasContentEditableState) {\n-\t\t\t\t\t\t\tcontentEditable = lastContentEditable; // Restore last contentEditable state from stack\n-\t\t\t\t\t\t}\n-\t\t\t\t\t}\n-\t\t\t\t}\n-\t\t\t};\n-\n-\t\t\tfunction findFormatRoot(container) {\n-\t\t\t\tvar formatRoot;\n-\n-\t\t\t\t// Find format root\n-\t\t\t\teach(getParents(container.parentNode).reverse(), function(parent) {\n-\t\t\t\t\tvar format;\n-\n-\t\t\t\t\t// Find format root element\n-\t\t\t\t\tif (!formatRoot && parent.id != '_start' && parent.id != '_end') {\n-\t\t\t\t\t\t// Is the node matching the format we are looking for\n-\t\t\t\t\t\tformat = matchNode(parent, name, vars);\n-\t\t\t\t\t\tif (format && format.split !== false)\n-\t\t\t\t\t\t\tformatRoot = parent;\n-\t\t\t\t\t}\n-\t\t\t\t});\n-\n-\t\t\t\treturn formatRoot;\n-\t\t\t};\n-\n-\t\t\tfunction wrapAndSplit(format_root, container, target, split) {\n-\t\t\t\tvar parent, clone, lastClone, firstClone, i, formatRootParent;\n-\n-\t\t\t\t// Format root found then clone formats and split it\n-\t\t\t\tif (format_root) {\n-\t\t\t\t\tformatRootParent = format_root.parentNode;\n-\n-\t\t\t\t\tfor (parent = container.parentNode; parent && parent != formatRootParent; parent = parent.parentNode) {\n-\t\t\t\t\t\tclone = dom.clone(parent, FALSE);\n-\n-\t\t\t\t\t\tfor (i = 0; i < formatList.length; i++) {\n-\t\t\t\t\t\t\tif (removeFormat(formatList[i], vars, clone, clone)) {\n-\t\t\t\t\t\t\t\tclone = 0;\n-\t\t\t\t\t\t\t\tbreak;\n-\t\t\t\t\t\t\t}\n-\t\t\t\t\t\t}\n-\n-\t\t\t\t\t\t// Build wrapper node\n-\t\t\t\t\t\tif (clone) {\n-\t\t\t\t\t\t\tif (lastClone)\n-\t\t\t\t\t\t\t\tclone.appendChild(lastClone);\n-\n-\t\t\t\t\t\t\tif (!firstClone)\n-\t\t\t\t\t\t\t\tfirstClone = clone;\n-\n-\t\t\t\t\t\t\tlastClone = clone;\n-\t\t\t\t\t\t}\n-\t\t\t\t\t}\n-\n-\t\t\t\t\t// Never split block elements if the format is mixed\n-\t\t\t\t\tif (split && (!format.mixed || !isBlock(format_root)))\n-\t\t\t\t\t\tcontainer = dom.split(format_root, container);\n-\n-\t\t\t\t\t// Wrap container in cloned formats\n-\t\t\t\t\tif (lastClone) {\n-\t\t\t\t\t\ttarget.parentNode.insertBefore(lastClone, target);\n-\t\t\t\t\t\tfirstClone.appendChild(target);\n-\t\t\t\t\t}\n-\t\t\t\t}\n-\n-\t\t\t\treturn container;\n-\t\t\t};\n-\n-\t\t\tfunction splitToFormatRoot(container) {\n-\t\t\t\treturn wrapAndSplit(findFormatRoot(container), container, container, true);\n-\t\t\t};\n-\n-\t\t\tfunction unwrap(start) {\n-\t\t\t\tvar node = dom.get(start ? '_start' : '_end'),\n-\t\t\t\t\tout = node[start ? 'firstChild' : 'lastChild'];\n-\n-\t\t\t\t// If the end is placed within the start the result will be removed\n-\t\t\t\t// So this checks if the out node is a bookmark node if it is it\n-\t\t\t\t// checks for another more suitable node\n-\t\t\t\tif (isBookmarkNode(out))\n-\t\t\t\t\tout = out[start ? 'firstChild' : 'lastChild'];\n-\n-\t\t\t\tdom.remove(node, true);\n-\n-\t\t\t\treturn out;\n-\t\t\t};\n-\n-\t\t\tfunction removeRngStyle(rng) {\n-\t\t\t\tvar startContainer, endContainer, node;\n-\n-\t\t\t\trng = expandRng(rng, formatList, TRUE);\n-\n-\t\t\t\tif (format.split) {\n-\t\t\t\t\tstartContainer = getContainer(rng, TRUE);\n-\t\t\t\t\tendContainer = getContainer(rng);\n-\n-\t\t\t\t\tif (startContainer != endContainer) {\n-\t\t\t\t\t\t// WebKit will render the table incorrectly if we wrap a TD in a SPAN so lets see if the can use the first child instead\n-\t\t\t\t\t\t// This will happen if you tripple click a table cell and use remove formatting\n-\t\t\t\t\t\tif (/^(TR|TD)$/.test(startContainer.nodeName) && startContainer.firstChild) {\n-\t\t\t\t\t\t\tstartContainer = (startContainer.nodeName == \"TD\" ? startContainer.firstChild : startContainer.firstChild.firstChild) || startContainer;\n-\t\t\t\t\t\t}\n-\n-\t\t\t\t\t\t// Wrap start/end nodes in span element since these might be cloned/moved\n-\t\t\t\t\t\tstartContainer = wrap(startContainer, 'span', {id : '_start', 'data-mce-type' : 'bookmark'});\n-\t\t\t\t\t\tendContainer = wrap(endContainer, 'span', {id : '_end', 'data-mce-type' : 'bookmark'});\n-\n-\t\t\t\t\t\t// Split start/end\n-\t\t\t\t\t\tsplitToFormatRoot(startContainer);\n-\t\t\t\t\t\tsplitToFormatRoot(endContainer);\n-\n-\t\t\t\t\t\t// Unwrap start/end to get real elements again\n-\t\t\t\t\t\tstartContainer = unwrap(TRUE);\n-\t\t\t\t\t\tendContainer = unwrap();\n-\t\t\t\t\t} else\n-\t\t\t\t\t\tstartContainer = endContainer = splitToFormatRoot(startContainer);\n-\n-\t\t\t\t\t// Update range positions since they might have changed after the split operations\n-\t\t\t\t\trng.startContainer = startContainer.parentNode;\n-\t\t\t\t\trng.startOffset = nodeIndex(startContainer);\n-\t\t\t\t\trng.endContainer = endContainer.parentNode;\n-\t\t\t\t\trng.endOffset = nodeIndex(endContainer) + 1;\n-\t\t\t\t}\n-\n-\t\t\t\t// Remove items between start/end\n-\t\t\t\trangeUtils.walk(rng, function(nodes) {\n-\t\t\t\t\teach(nodes, function(node) {\n-\t\t\t\t\t\tprocess(node);\n-\n-\t\t\t\t\t\t// Remove parent span if it only contains text-decoration: underline, yet a parent node is also underlined.\n-\t\t\t\t\t\tif (node.nodeType === 1 && ed.dom.getStyle(node, 'text-decoration') === 'underline' && node.parentNode && getTextDecoration(node.parentNode) === 'underline') {\n-\t\t\t\t\t\t\tremoveFormat({'deep': false, 'exact': true, 'inline': 'span', 'styles': {'textDecoration' : 'underline'}}, null, node);\n-\t\t\t\t\t\t}\n-\t\t\t\t\t});\n-\t\t\t\t});\n-\t\t\t};\n-\n-\t\t\t// Handle node\n-\t\t\tif (node) {\n-\t\t\t\tif (node.nodeType) {\n-\t\t\t\t\trng = dom.createRng();\n-\t\t\t\t\trng.setStartBefore(node);\n-\t\t\t\t\trng.setEndAfter(node);\n-\t\t\t\t\tremoveRngStyle(rng);\n-\t\t\t\t} else {\n-\t\t\t\t\tremoveRngStyle(node);\n-\t\t\t\t}\n-\n-\t\t\t\treturn;\n-\t\t\t}\n-\n-\t\t\tif (!selection.isCollapsed() || !format.inline || dom.select('td.mceSelected,th.mceSelected').length) {\n-\t\t\t\tbookmark = selection.getBookmark();\n-\t\t\t\tremoveRngStyle(selection.getRng(TRUE));\n-\t\t\t\tselection.moveToBookmark(bookmark);\n-\n-\t\t\t\t// Check if start element still has formatting then we are at: \"<b>text|</b>text\" and need to move the start into the next text node\n-\t\t\t\tif (format.inline && match(name, vars, selection.getStart())) {\n-\t\t\t\t\tmoveStart(selection.getRng(true));\n-\t\t\t\t}\n-\n-\t\t\t\ted.nodeChanged();\n-\t\t\t} else\n-\t\t\t\tperformCaretAction('remove', name, vars);\n-\t\t};\n-\n-\t\t/**\n-\t\t * Toggles the specified format on/off.\n-\t\t *\n-\t\t * @method toggle\n-\t\t * @param {String} name Name of format to apply/remove.\n-\t\t * @param {Object} vars Optional list of variables to replace within format before applying/removing it.\n-\t\t * @param {Node} node Optional node to apply the format to or remove from. Defaults to current selection.\n-\t\t */\n-\t\tfunction toggle(name, vars, node) {\n-\t\t\tvar fmt = get(name);\n-\n-\t\t\tif (match(name, vars, node) && (!('toggle' in fmt[0]) || fmt[0].toggle))\n-\t\t\t\tremove(name, vars, node);\n-\t\t\telse\n-\t\t\t\tapply(name, vars, node);\n-\t\t};\n-\n-\t\t/**\n-\t\t * Return true/false if the specified node has the specified format.\n-\t\t *\n-\t\t * @method matchNode\n-\t\t * @param {Node} node Node to check the format on.\n-\t\t * @param {String} name Format name to check.\n-\t\t * @param {Object} vars Optional list of variables to replace before checking it.\n-\t\t * @param {Boolean} similar Match format that has similar properties.\n-\t\t * @return {Object} Returns the format object it matches or undefined if it doesn't match.\n-\t\t */\n-\t\tfunction matchNode(node, name, vars, similar) {\n-\t\t\tvar formatList = get(name), format, i, classes;\n-\n-\t\t\tfunction matchItems(node, format, item_name) {\n-\t\t\t\tvar key, value, items = format[item_name], i;\n-\n-\t\t\t\t// Custom match\n-\t\t\t\tif (format.onmatch) {\n-\t\t\t\t\treturn format.onmatch(node, format, item_name);\n-\t\t\t\t}\n-\n-\t\t\t\t// Check all items\n-\t\t\t\tif (items) {\n-\t\t\t\t\t// Non indexed object\n-\t\t\t\t\tif (items.length === undef) {\n-\t\t\t\t\t\tfor (key in items) {\n-\t\t\t\t\t\t\tif (items.hasOwnProperty(key)) {\n-\t\t\t\t\t\t\t\tif (item_name === 'attributes')\n-\t\t\t\t\t\t\t\t\tvalue = dom.getAttrib(node, key);\n-\t\t\t\t\t\t\t\telse\n-\t\t\t\t\t\t\t\t\tvalue = getStyle(node, key);\n-\n-\t\t\t\t\t\t\t\tif (similar && !value && !format.exact)\n-\t\t\t\t\t\t\t\t\treturn;\n-\n-\t\t\t\t\t\t\t\tif ((!similar || format.exact) && !isEq(value, replaceVars(items[key], vars)))\n-\t\t\t\t\t\t\t\t\treturn;\n-\t\t\t\t\t\t\t}\n-\t\t\t\t\t\t}\n-\t\t\t\t\t} else {\n-\t\t\t\t\t\t// Only one match needed for indexed arrays\n-\t\t\t\t\t\tfor (i = 0; i < items.length; i++) {\n-\t\t\t\t\t\t\tif (item_name === 'attributes' ? dom.getAttrib(node, items[i]) : getStyle(node, items[i]))\n-\t\t\t\t\t\t\t\treturn format;\n-\t\t\t\t\t\t}\n-\t\t\t\t\t}\n-\t\t\t\t}\n-\n-\t\t\t\treturn format;\n-\t\t\t};\n-\n-\t\t\tif (formatList && node) {\n-\t\t\t\t// Check each format in list\n-\t\t\t\tfor (i = 0; i < formatList.length; i++) {\n-\t\t\t\t\tformat = formatList[i];\n-\n-\t\t\t\t\t// Name name, attributes, styles and classes\n-\t\t\t\t\tif (matchName(node, format) && matchItems(node, format, 'attributes') && matchItems(node, format, 'styles')) {\n-\t\t\t\t\t\t// Match classes\n-\t\t\t\t\t\tif (classes = format.classes) {\n-\t\t\t\t\t\t\tfor (i = 0; i < classes.length; i++) {\n-\t\t\t\t\t\t\t\tif (!dom.hasClass(node, classes[i]))\n-\t\t\t\t\t\t\t\t\treturn;\n-\t\t\t\t\t\t\t}\n-\t\t\t\t\t\t}\n-\n-\t\t\t\t\t\treturn format;\n-\t\t\t\t\t}\n-\t\t\t\t}\n-\t\t\t}\n-\t\t};\n-\n-\t\t/**\n-\t\t * Matches the current selection or specified node against the specified format name.\n-\t\t *\n-\t\t * @method match\n-\t\t * @param {String} name Name of format to match.\n-\t\t * @param {Object} vars Optional list of variables to replace before checking it.\n-\t\t * @param {Node} node Optional node to check.\n-\t\t * @return {boolean} true/false if the specified selection/node matches the format.\n-\t\t */\n-\t\tfunction match(name, vars, node) {\n-\t\t\tvar startNode;\n-\n-\t\t\tfunction matchParents(node) {\n-\t\t\t\t// Find first node with similar format settings\n-\t\t\t\tnode = dom.getParent(node, function(node) {\n-\t\t\t\t\treturn !!matchNode(node, name, vars, true);\n-\t\t\t\t});\n-\n-\t\t\t\t// Do an exact check on the similar format element\n-\t\t\t\treturn matchNode(node, name, vars);\n-\t\t\t};\n-\n-\t\t\t// Check specified node\n-\t\t\tif (node)\n-\t\t\t\treturn matchParents(node);\n-\n-\t\t\t// Check selected node\n-\t\t\tnode = selection.getNode();\n-\t\t\tif (matchParents(node))\n-\t\t\t\treturn TRUE;\n-\n-\t\t\t// Check start node if it's different\n-\t\t\tstartNode = selection.getStart();\n-\t\t\tif (startNode != node) {\n-\t\t\t\tif (matchParents(startNode))\n-\t\t\t\t\treturn TRUE;\n-\t\t\t}\n-\n-\t\t\treturn FALSE;\n-\t\t};\n-\n-\t\t/**\n-\t\t * Matches the current selection against the array of formats and returns a new array with matching formats.\n-\t\t *\n-\t\t * @method matchAll\n-\t\t * @param {Array} names Name of format to match.\n-\t\t * @param {Object} vars Optional list of variables to replace before checking it.\n-\t\t * @return {Array} Array with matched formats.\n-\t\t */\n-\t\tfunction matchAll(names, vars) {\n-\t\t\tvar startElement, matchedFormatNames = [], checkedMap = {}, i, ni, name;\n-\n-\t\t\t// Check start of selection for formats\n-\t\t\tstartElement = selection.getStart();\n-\t\t\tdom.getParent(startElement, function(node) {\n-\t\t\t\tvar i, name;\n-\n-\t\t\t\tfor (i = 0; i < names.length; i++) {\n-\t\t\t\t\tname = names[i];\n-\n-\t\t\t\t\tif (!checkedMap[name] && matchNode(node, name, vars)) {\n-\t\t\t\t\t\tcheckedMap[name] = true;\n-\t\t\t\t\t\tmatchedFormatNames.push(name);\n-\t\t\t\t\t}\n-\t\t\t\t}\n-\t\t\t}, dom.getRoot());\n-\n-\t\t\treturn matchedFormatNames;\n-\t\t};\n-\n-\t\t/**\n-\t\t * Returns true/false if the specified format can be applied to the current selection or not. It will currently only check the state for selector formats, it returns true on all other format types.\n-\t\t *\n-\t\t * @method canApply\n-\t\t * @param {String} name Name of format to check.\n-\t\t * @return {boolean} true/false if the specified format can be applied to the current selection/node.\n-\t\t */\n-\t\tfunction canApply(name) {\n-\t\t\tvar formatList = get(name), startNode, parents, i, x, selector;\n-\n-\t\t\tif (formatList) {\n-\t\t\t\tstartNode = selection.getStart();\n-\t\t\t\tparents = getParents(startNode);\n-\n-\t\t\t\tfor (x = formatList.length - 1; x >= 0; x--) {\n-\t\t\t\t\tselector = formatList[x].selector;\n-\n-\t\t\t\t\t// Format is not selector based, then always return TRUE\n-\t\t\t\t\tif (!selector)\n-\t\t\t\t\t\treturn TRUE;\n-\n-\t\t\t\t\tfor (i = parents.length - 1; i >= 0; i--) {\n-\t\t\t\t\t\tif (dom.is(parents[i], selector))\n-\t\t\t\t\t\t\treturn TRUE;\n-\t\t\t\t\t}\n-\t\t\t\t}\n-\t\t\t}\n-\n-\t\t\treturn FALSE;\n-\t\t};\n-\n-\t\t/**\n-\t\t * Executes the specified callback when the current selection matches the formats or not.\n-\t\t *\n-\t\t * @method formatChanged\n-\t\t * @param {String} formats Comma separated list of formats to check for.\n-\t\t * @param {function} callback Callback with state and args when the format is changed/toggled on/off.\n-\t\t * @param {Boolean} similar True/false state if the match should handle similar or exact formats.\n-\t\t */\n-\t\tfunction formatChanged(formats, callback, similar) {\n-\t\t\tvar currentFormats;\n-\n-\t\t\t// Setup format node change logic\n-\t\t\tif (!formatChangeData) {\n-\t\t\t\tformatChangeData = {};\n-\t\t\t\tcurrentFormats = {};\n-\n-\t\t\t\ted.onNodeChange.addToTop(function(ed, cm, node) {\n-\t\t\t\t\tvar parents = getParents(node), matchedFormats = {};\n-\n-\t\t\t\t\t// Check for new formats\n-\t\t\t\t\teach(formatChangeData, function(callbacks, format) {\n-\t\t\t\t\t\teach(parents, function(node) {\n-\t\t\t\t\t\t\tif (matchNode(node, format, {}, callbacks.similar)) {\n-\t\t\t\t\t\t\t\tif (!currentFormats[format]) {\n-\t\t\t\t\t\t\t\t\t// Execute callbacks\n-\t\t\t\t\t\t\t\t\teach(callbacks, function(callback) {\n-\t\t\t\t\t\t\t\t\t\tcallback(true, {node: node, format: format, parents: parents});\n-\t\t\t\t\t\t\t\t\t});\n-\n-\t\t\t\t\t\t\t\t\tcurrentFormats[format] = callbacks;\n-\t\t\t\t\t\t\t\t}\n-\n-\t\t\t\t\t\t\t\tmatchedFormats[format] = callbacks;\n-\t\t\t\t\t\t\t\treturn false;\n-\t\t\t\t\t\t\t}\n-\t\t\t\t\t\t});\n-\t\t\t\t\t});\n-\n-\t\t\t\t\t// Check if current formats still match\n-\t\t\t\t\teach(currentFormats, function(callbacks, format) {\n-\t\t\t\t\t\tif (!matchedFormats[format]) {\n-\t\t\t\t\t\t\tdelete currentFormats[format];\n-\n-\t\t\t\t\t\t\teach(callbacks, function(callback) {\n-\t\t\t\t\t\t\t\tcallback(false, {node: node, format: format, parents: parents});\n-\t\t\t\t\t\t\t});\n-\t\t\t\t\t\t}\n-\t\t\t\t\t});\n-\t\t\t\t});\n-\t\t\t}\n-\n-\t\t\t// Add format listeners\n-\t\t\teach(formats.split(','), function(format) {\n-\t\t\t\tif (!formatChangeData[format]) {\n-\t\t\t\t\tformatChangeData[format] = [];\n-\t\t\t\t\tformatChangeData[format].similar = similar;\n-\t\t\t\t}\n-\n-\t\t\t\tformatChangeData[format].push(callback);\n-\t\t\t});\n-\n-\t\t\treturn this;\n-\t\t};\n-\n-\t\t// Expose to public\n-\t\ttinymce.extend(this, {\n-\t\t\tget : get,\n-\t\t\tregister : register,\n-\t\t\tapply : apply,\n-\t\t\tremove : remove,\n-\t\t\ttoggle : toggle,\n-\t\t\tmatch : match,\n-\t\t\tmatchAll : matchAll,\n-\t\t\tmatchNode : matchNode,\n-\t\t\tcanApply : canApply,\n-\t\t\tformatChanged: formatChanged\n-\t\t});\n-\n-\t\t// Initialize\n-\t\tdefaultFormats();\n-\t\taddKeyboardShortcuts();\n-\n-\t\t// Private functions\n-\n-\t\t/**\n-\t\t * Checks if the specified nodes name matches the format inline/block or selector.\n-\t\t *\n-\t\t * @private\n-\t\t * @param {Node} node Node to match against the specified format.\n-\t\t * @param {Object} format Format object o match with.\n-\t\t * @return {boolean} true/false if the format matches.\n-\t\t */\n-\t\tfunction matchName(node, format) {\n-\t\t\t// Check for inline match\n-\t\t\tif (isEq(node, format.inline))\n-\t\t\t\treturn TRUE;\n-\n-\t\t\t// Check for block match\n-\t\t\tif (isEq(node, format.block))\n-\t\t\t\treturn TRUE;\n-\n-\t\t\t// Check for selector match\n-\t\t\tif (format.selector)\n-\t\t\t\treturn dom.is(node, format.selector);\n-\t\t};\n-\n-\t\t/**\n-\t\t * Compares two string/nodes regardless of their case.\n-\t\t *\n-\t\t * @private\n-\t\t * @param {String/Node} Node or string to compare.\n-\t\t * @param {String/Node} Node or string to compare.\n-\t\t * @return {boolean} True/false if they match.\n-\t\t */\n-\t\tfunction isEq(str1, str2) {\n-\t\t\tstr1 = str1 || '';\n-\t\t\tstr2 = str2 || '';\n-\n-\t\t\tstr1 = '' + (str1.nodeName || str1);\n-\t\t\tstr2 = '' + (str2.nodeName || str2);\n-\n-\t\t\treturn str1.toLowerCase() == str2.toLowerCase();\n-\t\t};\n-\n-\t\t/**\n-\t\t * Returns the style by name on the specified node. This method modifies the style\n-\t\t * contents to make it more easy to match. This will resolve a few browser issues.\n-\t\t *\n-\t\t * @private\n-\t\t * @param {Node} node to get style from.\n-\t\t * @param {String} name Style name to get.\n-\t\t * @return {String} Style item value.\n-\t\t */\n-\t\tfunction getStyle(node, name) {\n-\t\t\tvar styleVal = dom.getStyle(node, name);\n-\n-\t\t\t// Force the format to hex\n-\t\t\tif (name == 'color' || name == 'backgroundColor')\n-\t\t\t\tstyleVal = dom.toHex(styleVal);\n-\n-\t\t\t// Opera will return bold as 700\n-\t\t\tif (name == 'fontWeight' && styleVal == 700)\n-\t\t\t\tstyleVal = 'bold';\n-\n-\t\t\treturn '' + styleVal;\n-\t\t};\n-\n-\t\t/**\n-\t\t * Replaces variables in the value. The variable format is %var.\n-\t\t *\n-\t\t * @private\n-\t\t * @param {String} value Value to replace variables in.\n-\t\t * @param {Object} vars Name/value array with variables to replace.\n-\t\t * @return {String} New value with replaced variables.\n-\t\t */\n-\t\tfunction replaceVars(value, vars) {\n-\t\t\tif (typeof(value) != \"string\")\n-\t\t\t\tvalue = value(vars);\n-\t\t\telse if (vars) {\n-\t\t\t\tvalue = value.replace(/%(\\w+)/g, function(str, name) {\n-\t\t\t\t\treturn vars[name] || str;\n-\t\t\t\t});\n-\t\t\t}\n-\n-\t\t\treturn value;\n-\t\t};\n-\n-\t\tfunction isWhiteSpaceNode(node) {\n-\t\t\treturn node && node.nodeType === 3 && /^([\\t \\r\\n]+|)$/.test(node.nodeValue);\n-\t\t};\n-\n-\t\tfunction wrap(node, name, attrs) {\n-\t\t\tvar wrapper = dom.create(name, attrs);\n-\n-\t\t\tnode.parentNode.insertBefore(wrapper, node);\n-\t\t\twrapper.appendChild(node);\n-\n-\t\t\treturn wrapper;\n-\t\t};\n-\n-\t\t/**\n-\t\t * Expands the specified range like object to depending on format.\n-\t\t *\n-\t\t * For example on block formats it will move the start/end position\n-\t\t * to the beginning of the current block.\n-\t\t *\n-\t\t * @private\n-\t\t * @param {Object} rng Range like object.\n-\t\t * @param {Array} formats Array with formats to expand by.\n-\t\t * @return {Object} Expanded range like object.\n-\t\t */\n-\t\tfunction expandRng(rng, format, remove) {\n-\t\t\tvar sibling, lastIdx, leaf, endPoint,\n-\t\t\t\tstartContainer = rng.startContainer,\n-\t\t\t\tstartOffset = rng.startOffset,\n-\t\t\t\tendContainer = rng.endContainer,\n-\t\t\t\tendOffset = rng.endOffset;\n-\n-\t\t\t// This function walks up the tree if there is no siblings before/after the node\n-\t\t\tfunction findParentContainer(start) {\n-\t\t\t\tvar container, parent, child, sibling, siblingName, root;\n-\n-\t\t\t\tcontainer = parent = start ? startContainer : endContainer;\n-\t\t\t\tsiblingName = start ? 'previousSibling' : 'nextSibling';\n-\t\t\t\troot = dom.getRoot();\n-\n-\t\t\t\tfunction isBogusBr(node) {\n-\t\t\t\t\treturn node.nodeName == \"BR\" && node.getAttribute('data-mce-bogus') && !node.nextSibling;\n-\t\t\t\t};\n-\n-\t\t\t\t// If it's a text node and the offset is inside the text\n-\t\t\t\tif (container.nodeType == 3 && !isWhiteSpaceNode(container)) {\n-\t\t\t\t\tif (start ? startOffset > 0 : endOffset < container.nodeValue.length) {\n-\t\t\t\t\t\treturn container;\n-\t\t\t\t\t}\n-\t\t\t\t}\n-\n-\t\t\t\tfor (;;) {\n-\t\t\t\t\t// Stop expanding on block elements\n-\t\t\t\t\tif (!format[0].block_expand && isBlock(parent))\n-\t\t\t\t\t\treturn parent;\n-\n-\t\t\t\t\t// Walk left/right\n-\t\t\t\t\tfor (sibling = parent[siblingName]; sibling; sibling = sibling[siblingName]) {\n-\t\t\t\t\t\tif (!isBookmarkNode(sibling) && !isWhiteSpaceNode(sibling) && !isBogusBr(sibling)) {\n-\t\t\t\t\t\t\treturn parent;\n-\t\t\t\t\t\t}\n-\t\t\t\t\t}\n-\n-\t\t\t\t\t// Check if we can move up are we at root level or body level\n-\t\t\t\t\tif (parent.parentNode == root) {\n-\t\t\t\t\t\tcontainer = parent;\n-\t\t\t\t\t\tbreak;\n-\t\t\t\t\t}\n-\n-\t\t\t\t\tparent = parent.parentNode;\n-\t\t\t\t}\n-\n-\t\t\t\treturn container;\n-\t\t\t};\n-\n-\t\t\t// This function walks down the tree to find the leaf at the selection.\n-\t\t\t// The offset is also returned as if node initially a leaf, the offset may be in the middle of the text node.\n-\t\t\tfunction findLeaf(node, offset) {\n-\t\t\t\tif (offset === undef)\n-\t\t\t\t\toffset = node.nodeType === 3 ? node.length : node.childNodes.length;\n-\t\t\t\twhile (node && node.hasChildNodes()) {\n-\t\t\t\t\tnode = node.childNodes[offset];\n-\t\t\t\t\tif (node)\n-\t\t\t\t\t\toffset = node.nodeType === 3 ? node.length : node.childNodes.length;\n-\t\t\t\t}\n-\t\t\t\treturn { node: node, offset: offset };\n-\t\t\t}\n-\n-\t\t\t// If index based start position then resolve it\n-\t\t\tif (startContainer.nodeType == 1 && startContainer.hasChildNodes()) {\n-\t\t\t\tlastIdx = startContainer.childNodes.length - 1;\n-\t\t\t\tstartContainer = startContainer.childNodes[startOffset > lastIdx ? lastIdx : startOffset];\n-\n-\t\t\t\tif (startContainer.nodeType == 3)\n-\t\t\t\t\tstartOffset = 0;\n-\t\t\t}\n-\n-\t\t\t// If index based end position then resolve it\n-\t\t\tif (endContainer.nodeType == 1 && endContainer.hasChildNodes()) {\n-\t\t\t\tlastIdx = endContainer.childNodes.length - 1;\n-\t\t\t\tendContainer = endContainer.childNodes[endOffset > lastIdx ? lastIdx : endOffset - 1];\n-\n-\t\t\t\tif (endContainer.nodeType == 3)\n-\t\t\t\t\tendOffset = endContainer.nodeValue.length;\n-\t\t\t}\n-\n-\t\t\t// Expands the node to the closes contentEditable false element if it exists\n-\t\t\tfunction findParentContentEditable(node) {\n-\t\t\t\tvar parent = node;\n-\n-\t\t\t\twhile (parent) {\n-\t\t\t\t\tif (parent.nodeType === 1 && getContentEditable(parent)) {\n-\t\t\t\t\t\treturn getContentEditable(parent) === \"false\" ? parent : node;\n-\t\t\t\t\t}\n-\n-\t\t\t\t\tparent = parent.parentNode;\n-\t\t\t\t}\n-\n-\t\t\t\treturn node;\n-\t\t\t};\n-\n-\t\t\tfunction findWordEndPoint(container, offset, start) {\n-\t\t\t\tvar walker, node, pos, lastTextNode;\n-\n-\t\t\t\tfunction findSpace(node, offset) {\n-\t\t\t\t\tvar pos, pos2, str = node.nodeValue;\n-\n-\t\t\t\t\tif (typeof(offset) == \"undefined\") {\n-\t\t\t\t\t\toffset = start ? str.length : 0;\n-\t\t\t\t\t}\n-\n-\t\t\t\t\tif (start) {\n-\t\t\t\t\t\tpos = str.lastIndexOf(' ', offset);\n-\t\t\t\t\t\tpos2 = str.lastIndexOf('\\u00a0', offset);\n-\t\t\t\t\t\tpos = pos > pos2 ? pos : pos2;\n-\n-\t\t\t\t\t\t// Include the space on remove to avoid tag soup\n-\t\t\t\t\t\tif (pos !== -1 && !remove) {\n-\t\t\t\t\t\t\tpos++;\n-\t\t\t\t\t\t}\n-\t\t\t\t\t} else {\n-\t\t\t\t\t\tpos = str.indexOf(' ', offset);\n-\t\t\t\t\t\tpos2 = str.indexOf('\\u00a0', offset);\n-\t\t\t\t\t\tpos = pos !== -1 && (pos2 === -1 || pos < pos2) ? pos : pos2;\n-\t\t\t\t\t}\n-\n-\t\t\t\t\treturn pos;\n-\t\t\t\t};\n-\n-\t\t\t\tif (container.nodeType === 3) {\n-\t\t\t\t\tpos = findSpace(container, offset);\n-\n-\t\t\t\t\tif (pos !== -1) {\n-\t\t\t\t\t\treturn {container : container, offset : pos};\n-\t\t\t\t\t}\n-\n-\t\t\t\t\tlastTextNode = container;\n-\t\t\t\t}\n-\n-\t\t\t\t// Walk the nodes inside the block\n-\t\t\t\twalker = new TreeWalker(container, dom.getParent(container, isBlock) || ed.getBody());\n-\t\t\t\twhile (node = walker[start ? 'prev' : 'next']()) {\n-\t\t\t\t\tif (node.nodeType === 3) {\n-\t\t\t\t\t\tlastTextNode = node;\n-\t\t\t\t\t\tpos = findSpace(node);\n-\n-\t\t\t\t\t\tif (pos !== -1) {\n-\t\t\t\t\t\t\treturn {container : node, offset : pos};\n-\t\t\t\t\t\t}\n-\t\t\t\t\t} else if (isBlock(node)) {\n-\t\t\t\t\t\tbreak;\n-\t\t\t\t\t}\n-\t\t\t\t}\n-\n-\t\t\t\tif (lastTextNode) {\n-\t\t\t\t\tif (start) {\n-\t\t\t\t\t\toffset = 0;\n-\t\t\t\t\t} else {\n-\t\t\t\t\t\toffset = lastTextNode.length;\n-\t\t\t\t\t}\n-\n-\t\t\t\t\treturn {container: lastTextNode, offset: offset};\n-\t\t\t\t}\n-\t\t\t};\n-\n-\t\t\tfunction findSelectorEndPoint(container, sibling_name) {\n-\t\t\t\tvar parents, i, y, curFormat;\n-\n-\t\t\t\tif (container.nodeType == 3 && container.nodeValue.length === 0 && container[sibling_name])\n-\t\t\t\t\tcontainer = container[sibling_name];\n-\n-\t\t\t\tparents = getParents(container);\n-\t\t\t\tfor (i = 0; i < parents.length; i++) {\n-\t\t\t\t\tfor (y = 0; y < format.length; y++) {\n-\t\t\t\t\t\tcurFormat = format[y];\n-\n-\t\t\t\t\t\t// If collapsed state is set then skip formats that doesn't match that\n-\t\t\t\t\t\tif (\"collapsed\" in curFormat && curFormat.collapsed !== rng.collapsed)\n-\t\t\t\t\t\t\tcontinue;\n-\n-\t\t\t\t\t\tif (dom.is(parents[i], curFormat.selector))\n-\t\t\t\t\t\t\treturn parents[i];\n-\t\t\t\t\t}\n-\t\t\t\t}\n-\n-\t\t\t\treturn container;\n-\t\t\t};\n-\n-\t\t\tfunction findBlockEndPoint(container, sibling_name, sibling_name2) {\n-\t\t\t\tvar node;\n-\n-\t\t\t\t// Expand to block of similar type\n-\t\t\t\tif (!format[0].wrapper)\n-\t\t\t\t\tnode = dom.getParent(container, format[0].block);\n-\n-\t\t\t\t// Expand to first wrappable block element or any block element\n-\t\t\t\tif (!node)\n-\t\t\t\t\tnode = dom.getParent(container.nodeType == 3 ? container.parentNode : container, isTextBlock);\n-\n-\t\t\t\t// Exclude inner lists from wrapping\n-\t\t\t\tif (node && format[0].wrapper)\n-\t\t\t\t\tnode = getParents(node, 'ul,ol').reverse()[0] || node;\n-\n-\t\t\t\t// Didn't find a block element look for first/last wrappable element\n-\t\t\t\tif (!node) {\n-\t\t\t\t\tnode = container;\n-\n-\t\t\t\t\twhile (node[sibling_name] && !isBlock(node[sibling_name])) {\n-\t\t\t\t\t\tnode = node[sibling_name];\n-\n-\t\t\t\t\t\t// Break on BR but include it will be removed later on\n-\t\t\t\t\t\t// we can't remove it now since we need to check if it can be wrapped\n-\t\t\t\t\t\tif (isEq(node, 'br'))\n-\t\t\t\t\t\t\tbreak;\n-\t\t\t\t\t}\n-\t\t\t\t}\n-\n-\t\t\t\treturn node || container;\n-\t\t\t};\n-\n-\t\t\t// Expand to closest contentEditable element\n-\t\t\tstartContainer = findParentContentEditable(startContainer);\n-\t\t\tendContainer = findParentContentEditable(endContainer);\n-\n-\t\t\t// Exclude bookmark nodes if possible\n-\t\t\tif (isBookmarkNode(startContainer.parentNode) || isBookmarkNode(startContainer)) {\n-\t\t\t\tstartContainer = isBookmarkNode(startContainer) ? startContainer : startContainer.parentNode;\n-\t\t\t\tstartContainer = startContainer.nextSibling || startContainer;\n-\n-\t\t\t\tif (startContainer.nodeType == 3)\n-\t\t\t\t\tstartOffset = 0;\n-\t\t\t}\n-\n-\t\t\tif (isBookmarkNode(endContainer.parentNode) || isBookmarkNode(endContainer)) {\n-\t\t\t\tendContainer = isBookmarkNode(endContainer) ? endContainer : endContainer.parentNode;\n-\t\t\t\tendContainer = endContainer.previousSibling || endContainer;\n-\n-\t\t\t\tif (endContainer.nodeType == 3)\n-\t\t\t\t\tendOffset = endContainer.length;\n-\t\t\t}\n-\n-\t\t\tif (format[0].inline) {\n-\t\t\t\tif (rng.collapsed) {\n-\t\t\t\t\t// Expand left to closest word boundery\n-\t\t\t\t\tendPoint = findWordEndPoint(startContainer, startOffset, true);\n-\t\t\t\t\tif (endPoint) {\n-\t\t\t\t\t\tstartContainer = endPoint.container;\n-\t\t\t\t\t\tstartOffset = endPoint.offset;\n-\t\t\t\t\t}\n-\n-\t\t\t\t\t// Expand right to closest word boundery\n-\t\t\t\t\tendPoint = findWordEndPoint(endContainer, endOffset);\n-\t\t\t\t\tif (endPoint) {\n-\t\t\t\t\t\tendContainer = endPoint.container;\n-\t\t\t\t\t\tendOffset = endPoint.offset;\n-\t\t\t\t\t}\n-\t\t\t\t}\n-\n-\t\t\t\t// Avoid applying formatting to a trailing space.\n-\t\t\t\tleaf = findLeaf(endContainer, endOffset);\n-\t\t\t\tif (leaf.node) {\n-\t\t\t\t\twhile (leaf.node && leaf.offset === 0 && leaf.node.previousSibling)\n-\t\t\t\t\t\tleaf = findLeaf(leaf.node.previousSibling);\n-\n-\t\t\t\t\tif (leaf.node && leaf.offset > 0 && leaf.node.nodeType === 3 &&\n-\t\t\t\t\t\t\tleaf.node.nodeValue.charAt(leaf.offset - 1) === ' ') {\n-\n-\t\t\t\t\t\tif (leaf.offset > 1) {\n-\t\t\t\t\t\t\tendContainer = leaf.node;\n-\t\t\t\t\t\t\tendContainer.splitText(leaf.offset - 1);\n-\t\t\t\t\t\t}\n-\t\t\t\t\t}\n-\t\t\t\t}\n-\t\t\t}\n-\n-\t\t\t// Move start/end point up the tree if the leaves are sharp and if we are in different containers\n-\t\t\t// Example * becomes !: !<p><b><i>*text</i><i>text*</i></b></p>!\n-\t\t\t// This will reduce the number of wrapper elements that needs to be created\n-\t\t\t// Move start point up the tree\n-\t\t\tif (format[0].inline || format[0].block_expand) {\n-\t\t\t\tif (!format[0].inline || (startContainer.nodeType != 3 || startOffset === 0)) {\n-\t\t\t\t\tstartContainer = findParentContainer(true);\n-\t\t\t\t}\n-\n-\t\t\t\tif (!format[0].inline || (endContainer.nodeType != 3 || endOffset === endContainer.nodeValue.length)) {\n-\t\t\t\t\tendContainer = findParentContainer();\n-\t\t\t\t}\n-\t\t\t}\n-\n-\t\t\t// Expand start/end container to matching selector\n-\t\t\tif (format[0].selector && format[0].expand !== FALSE && !format[0].inline) {\n-\t\t\t\t// Find new startContainer/endContainer if there is better one\n-\t\t\t\tstartContainer = findSelectorEndPoint(startContainer, 'previousSibling');\n-\t\t\t\tendContainer = findSelectorEndPoint(endContainer, 'nextSibling');\n-\t\t\t}\n-\n-\t\t\t// Expand start/end container to matching block element or text node\n-\t\t\tif (format[0].block || format[0].selector) {\n-\t\t\t\t// Find new startContainer/endContainer if there is better one\n-\t\t\t\tstartContainer = findBlockEndPoint(startContainer, 'previousSibling');\n-\t\t\t\tendContainer = findBlockEndPoint(endContainer, 'nextSibling');\n-\n-\t\t\t\t// Non block element then try to expand up the leaf\n-\t\t\t\tif (format[0].block) {\n-\t\t\t\t\tif (!isBlock(startContainer))\n-\t\t\t\t\t\tstartContainer = findParentContainer(true);\n-\n-\t\t\t\t\tif (!isBlock(endContainer))\n-\t\t\t\t\t\tendContainer = findParentContainer();\n-\t\t\t\t}\n-\t\t\t}\n-\n-\t\t\t// Setup index for startContainer\n-\t\t\tif (startContainer.nodeType == 1) {\n-\t\t\t\tstartOffset = nodeIndex(startContainer);\n-\t\t\t\tstartContainer = startContainer.parentNode;\n-\t\t\t}\n-\n-\t\t\t// Setup index for endContainer\n-\t\t\tif (endContainer.nodeType == 1) {\n-\t\t\t\tendOffset = nodeIndex(endContainer) + 1;\n-\t\t\t\tendContainer = endContainer.parentNode;\n-\t\t\t}\n-\n-\t\t\t// Return new range like object\n-\t\t\treturn {\n-\t\t\t\tstartContainer : startContainer,\n-\t\t\t\tstartOffset : startOffset,\n-\t\t\t\tendContainer : endContainer,\n-\t\t\t\tendOffset : endOffset\n-\t\t\t};\n-\t\t}\n-\n-\t\t/**\n-\t\t * Removes the specified format for the specified node. It will also remove the node if it doesn't have\n-\t\t * any attributes if the format specifies it to do so.\n-\t\t *\n-\t\t * @private\n-\t\t * @param {Object} format Format object with items to remove from node.\n-\t\t * @param {Object} vars Name/value object with variables to apply to format.\n-\t\t * @param {Node} node Node to remove the format styles on.\n-\t\t * @param {Node} compare_node Optional compare node, if specified the styles will be compared to that node.\n-\t\t * @return {Boolean} True/false if the node was removed or not.\n-\t\t */\n-\t\tfunction removeFormat(format, vars, node, compare_node) {\n-\t\t\tvar i, attrs, stylesModified;\n-\n-\t\t\t// Check if node matches format\n-\t\t\tif (!matchName(node, format))\n-\t\t\t\treturn FALSE;\n-\n-\t\t\t// Should we compare with format attribs and styles\n-\t\t\tif (format.remove != 'all') {\n-\t\t\t\t// Remove styles\n-\t\t\t\teach(format.styles, function(value, name) {\n-\t\t\t\t\tvalue = replaceVars(value, vars);\n-\n-\t\t\t\t\t// Indexed array\n-\t\t\t\t\tif (typeof(name) === 'number') {\n-\t\t\t\t\t\tname = value;\n-\t\t\t\t\t\tcompare_node = 0;\n-\t\t\t\t\t}\n-\n-\t\t\t\t\tif (!compare_node || isEq(getStyle(compare_node, name), value))\n-\t\t\t\t\t\tdom.setStyle(node, name, '');\n-\n-\t\t\t\t\tstylesModified = 1;\n-\t\t\t\t});\n-\n-\t\t\t\t// Remove style attribute if it's empty\n-\t\t\t\tif (stylesModified && dom.getAttrib(node, 'style') == '') {\n-\t\t\t\t\tnode.removeAttribute('style');\n-\t\t\t\t\tnode.removeAttribute('data-mce-style');\n-\t\t\t\t}\n-\n-\t\t\t\t// Remove attributes\n-\t\t\t\teach(format.attributes, function(value, name) {\n-\t\t\t\t\tvar valueOut;\n-\n-\t\t\t\t\tvalue = replaceVars(value, vars);\n-\n-\t\t\t\t\t// Indexed array\n-\t\t\t\t\tif (typeof(name) === 'number') {\n-\t\t\t\t\t\tname = value;\n-\t\t\t\t\t\tcompare_node = 0;\n-\t\t\t\t\t}\n-\n-\t\t\t\t\tif (!compare_node || isEq(dom.getAttrib(compare_node, name), value)) {\n-\t\t\t\t\t\t// Keep internal classes\n-\t\t\t\t\t\tif (name == 'class') {\n-\t\t\t\t\t\t\tvalue = dom.getAttrib(node, name);\n-\t\t\t\t\t\t\tif (value) {\n-\t\t\t\t\t\t\t\t// Build new class value where everything is removed except the internal prefixed classes\n-\t\t\t\t\t\t\t\tvalueOut = '';\n-\t\t\t\t\t\t\t\teach(value.split(/\\s+/), function(cls) {\n-\t\t\t\t\t\t\t\t\tif (/mce\\w+/.test(cls))\n-\t\t\t\t\t\t\t\t\t\tvalueOut += (valueOut ? ' ' : '') + cls;\n-\t\t\t\t\t\t\t\t});\n-\n-\t\t\t\t\t\t\t\t// We got some internal classes left\n-\t\t\t\t\t\t\t\tif (valueOut) {\n-\t\t\t\t\t\t\t\t\tdom.setAttrib(node, name, valueOut);\n-\t\t\t\t\t\t\t\t\treturn;\n-\t\t\t\t\t\t\t\t}\n-\t\t\t\t\t\t\t}\n-\t\t\t\t\t\t}\n-\n-\t\t\t\t\t\t// IE6 has a bug where the attribute doesn't get removed correctly\n-\t\t\t\t\t\tif (name == \"class\")\n-\t\t\t\t\t\t\tnode.removeAttribute('className');\n-\n-\t\t\t\t\t\t// Remove mce prefixed attributes\n-\t\t\t\t\t\tif (MCE_ATTR_RE.test(name))\n-\t\t\t\t\t\t\tnode.removeAttribute('data-mce-' + name);\n-\n-\t\t\t\t\t\tnode.removeAttribute(name);\n-\t\t\t\t\t}\n-\t\t\t\t});\n-\n-\t\t\t\t// Remove classes\n-\t\t\t\teach(format.classes, function(value) {\n-\t\t\t\t\tvalue = replaceVars(value, vars);\n-\n-\t\t\t\t\tif (!compare_node || dom.hasClass(compare_node, value))\n-\t\t\t\t\t\tdom.removeClass(node, value);\n-\t\t\t\t});\n-\n-\t\t\t\t// Check for non internal attributes\n-\t\t\t\tattrs = dom.getAttribs(node);\n-\t\t\t\tfor (i = 0; i < attrs.length; i++) {\n-\t\t\t\t\tif (attrs[i].nodeName.indexOf('_') !== 0)\n-\t\t\t\t\t\treturn FALSE;\n-\t\t\t\t}\n-\t\t\t}\n-\n-\t\t\t// Remove the inline child if it's empty for example <b> or <span>\n-\t\t\tif (format.remove != 'none') {\n-\t\t\t\tremoveNode(node, format);\n-\t\t\t\treturn TRUE;\n-\t\t\t}\n-\t\t};\n-\n-\t\t/**\n-\t\t * Removes the node and wrap it's children in paragraphs before doing so or\n-\t\t * appends BR elements to the beginning/end of the block element if forcedRootBlocks is disabled.\n-\t\t *\n-\t\t * If the div in the node below gets removed:\n-\t\t *  text<div>text</div>text\n-\t\t *\n-\t\t * Output becomes:\n-\t\t *  text<div><br />text<br /></div>text\n-\t\t *\n-\t\t * So when the div is removed the result is:\n-\t\t *  text<br />text<br />text\n-\t\t *\n-\t\t * @private\n-\t\t * @param {Node} node Node to remove + apply BR/P elements to.\n-\t\t * @param {Object} format Format rule.\n-\t\t * @return {Node} Input node.\n-\t\t */\n-\t\tfunction removeNode(node, format) {\n-\t\t\tvar parentNode = node.parentNode, rootBlockElm;\n-\n-\t\t\tfunction find(node, next, inc) {\n-\t\t\t\tnode = getNonWhiteSpaceSibling(node, next, inc);\n-\n-\t\t\t\treturn !node || (node.nodeName == 'BR' || isBlock(node));\n-\t\t\t};\n-\n-\t\t\tif (format.block) {\n-\t\t\t\tif (!forcedRootBlock) {\n-\t\t\t\t\t// Append BR elements if needed before we remove the block\n-\t\t\t\t\tif (isBlock(node) && !isBlock(parentNode)) {\n-\t\t\t\t\t\tif (!find(node, FALSE) && !find(node.firstChild, TRUE, 1))\n-\t\t\t\t\t\t\tnode.insertBefore(dom.create('br'), node.firstChild);\n-\n-\t\t\t\t\t\tif (!find(node, TRUE) && !find(node.lastChild, FALSE, 1))\n-\t\t\t\t\t\t\tnode.appendChild(dom.create('br'));\n-\t\t\t\t\t}\n-\t\t\t\t} else {\n-\t\t\t\t\t// Wrap the block in a forcedRootBlock if we are at the root of document\n-\t\t\t\t\tif (parentNode == dom.getRoot()) {\n-\t\t\t\t\t\tif (!format.list_block || !isEq(node, format.list_block)) {\n-\t\t\t\t\t\t\teach(tinymce.grep(node.childNodes), function(node) {\n-\t\t\t\t\t\t\t\tif (isValid(forcedRootBlock, node.nodeName.toLowerCase())) {\n-\t\t\t\t\t\t\t\t\tif (!rootBlockElm)\n-\t\t\t\t\t\t\t\t\t\trootBlockElm = wrap(node, forcedRootBlock);\n-\t\t\t\t\t\t\t\t\telse\n-\t\t\t\t\t\t\t\t\t\trootBlockElm.appendChild(node);\n-\t\t\t\t\t\t\t\t} else\n-\t\t\t\t\t\t\t\t\trootBlockElm = 0;\n-\t\t\t\t\t\t\t});\n-\t\t\t\t\t\t}\n-\t\t\t\t\t}\n-\t\t\t\t}\n-\t\t\t}\n-\n-\t\t\t// Never remove nodes that isn't the specified inline element if a selector is specified too\n-\t\t\tif (format.selector && format.inline && !isEq(format.inline, node))\n-\t\t\t\treturn;\n-\n-\t\t\tdom.remove(node, 1);\n-\t\t};\n-\n-\t\t/**\n-\t\t * Returns the next/previous non whitespace node.\n-\t\t *\n-\t\t * @private\n-\t\t * @param {Node} node Node to start at.\n-\t\t * @param {boolean} next (Optional) Include next or previous node defaults to previous.\n-\t\t * @param {boolean} inc (Optional) Include the current node in checking. Defaults to false.\n-\t\t * @return {Node} Next or previous node or undefined if it wasn't found.\n-\t\t */\n-\t\tfunction getNonWhiteSpaceSibling(node, next, inc) {\n-\t\t\tif (node) {\n-\t\t\t\tnext = next ? 'nextSibling' : 'previousSibling';\n-\n-\t\t\t\tfor (node = inc ? node : node[next]; node; node = node[next]) {\n-\t\t\t\t\tif (node.nodeType == 1 || !isWhiteSpaceNode(node))\n-\t\t\t\t\t\treturn node;\n-\t\t\t\t}\n-\t\t\t}\n-\t\t};\n-\n-\t\t/**\n-\t\t * Checks if the specified node is a bookmark node or not.\n-\t\t *\n-\t\t * @param {Node} node Node to check if it's a bookmark node or not.\n-\t\t * @return {Boolean} true/false if the node is a bookmark node.\n-\t\t */\n-\t\tfunction isBookmarkNode(node) {\n-\t\t\treturn node && node.nodeType == 1 && node.getAttribute('data-mce-type') == 'bookmark';\n-\t\t};\n-\n-\t\t/**\n-\t\t * Merges the next/previous sibling element if they match.\n-\t\t *\n-\t\t * @private\n-\t\t * @param {Node} prev Previous node to compare/merge.\n-\t\t * @param {Node} next Next node to compare/merge.\n-\t\t * @return {Node} Next node if we didn't merge and prev node if we did.\n-\t\t */\n-\t\tfunction mergeSiblings(prev, next) {\n-\t\t\tvar marker, sibling, tmpSibling;\n-\n-\t\t\t/**\n-\t\t\t * Compares two nodes and checks if it's attributes and styles matches.\n-\t\t\t * This doesn't compare classes as items since their order is significant.\n-\t\t\t *\n-\t\t\t * @private\n-\t\t\t * @param {Node} node1 First node to compare with.\n-\t\t\t * @param {Node} node2 Second node to compare with.\n-\t\t\t * @return {boolean} True/false if the nodes are the same or not.\n-\t\t\t */\n-\t\t\tfunction compareElements(node1, node2) {\n-\t\t\t\t// Not the same name\n-\t\t\t\tif (node1.nodeName != node2.nodeName)\n-\t\t\t\t\treturn FALSE;\n-\n-\t\t\t\t/**\n-\t\t\t\t * Returns all the nodes attributes excluding internal ones, styles and classes.\n-\t\t\t\t *\n-\t\t\t\t * @private\n-\t\t\t\t * @param {Node} node Node to get attributes from.\n-\t\t\t\t * @return {Object} Name/value object with attributes and attribute values.\n-\t\t\t\t */\n-\t\t\t\tfunction getAttribs(node) {\n-\t\t\t\t\tvar attribs = {};\n-\n-\t\t\t\t\teach(dom.getAttribs(node), function(attr) {\n-\t\t\t\t\t\tvar name = attr.nodeName.toLowerCase();\n-\n-\t\t\t\t\t\t// Don't compare internal attributes or style\n-\t\t\t\t\t\tif (name.indexOf('_') !== 0 && name !== 'style')\n-\t\t\t\t\t\t\tattribs[name] = dom.getAttrib(node, name);\n-\t\t\t\t\t});\n-\n-\t\t\t\t\treturn attribs;\n-\t\t\t\t};\n-\n-\t\t\t\t/**\n-\t\t\t\t * Compares two objects checks if it's key + value exists in the other one.\n-\t\t\t\t *\n-\t\t\t\t * @private\n-\t\t\t\t * @param {Object} obj1 First object to compare.\n-\t\t\t\t * @param {Object} obj2 Second object to compare.\n-\t\t\t\t * @return {boolean} True/false if the objects matches or not.\n-\t\t\t\t */\n-\t\t\t\tfunction compareObjects(obj1, obj2) {\n-\t\t\t\t\tvar value, name;\n-\n-\t\t\t\t\tfor (name in obj1) {\n-\t\t\t\t\t\t// Obj1 has item obj2 doesn't have\n-\t\t\t\t\t\tif (obj1.hasOwnProperty(name)) {\n-\t\t\t\t\t\t\tvalue = obj2[name];\n-\n-\t\t\t\t\t\t\t// Obj2 doesn't have obj1 item\n-\t\t\t\t\t\t\tif (value === undef)\n-\t\t\t\t\t\t\t\treturn FALSE;\n-\n-\t\t\t\t\t\t\t// Obj2 item has a different value\n-\t\t\t\t\t\t\tif (obj1[name] != value)\n-\t\t\t\t\t\t\t\treturn FALSE;\n-\n-\t\t\t\t\t\t\t// Delete similar value\n-\t\t\t\t\t\t\tdelete obj2[name];\n-\t\t\t\t\t\t}\n-\t\t\t\t\t}\n-\n-\t\t\t\t\t// Check if obj 2 has something obj 1 doesn't have\n-\t\t\t\t\tfor (name in obj2) {\n-\t\t\t\t\t\t// Obj2 has item obj1 doesn't have\n-\t\t\t\t\t\tif (obj2.hasOwnProperty(name))\n-\t\t\t\t\t\t\treturn FALSE;\n-\t\t\t\t\t}\n-\n-\t\t\t\t\treturn TRUE;\n-\t\t\t\t};\n-\n-\t\t\t\t// Attribs are not the same\n-\t\t\t\tif (!compareObjects(getAttribs(node1), getAttribs(node2)))\n-\t\t\t\t\treturn FALSE;\n-\n-\t\t\t\t// Styles are not the same\n-\t\t\t\tif (!compareObjects(dom.parseStyle(dom.getAttrib(node1, 'style')), dom.parseStyle(dom.getAttrib(node2, 'style'))))\n-\t\t\t\t\treturn FALSE;\n-\n-\t\t\t\treturn TRUE;\n-\t\t\t};\n-\n-\t\t\tfunction findElementSibling(node, sibling_name) {\n-\t\t\t\tfor (sibling = node; sibling; sibling = sibling[sibling_name]) {\n-\t\t\t\t\tif (sibling.nodeType == 3 && sibling.nodeValue.length !== 0)\n-\t\t\t\t\t\treturn node;\n-\n-\t\t\t\t\tif (sibling.nodeType == 1 && !isBookmarkNode(sibling))\n-\t\t\t\t\t\treturn sibling;\n-\t\t\t\t}\n-\n-\t\t\t\treturn node;\n-\t\t\t};\n-\n-\t\t\t// Check if next/prev exists and that they are elements\n-\t\t\tif (prev && next) {\n-\t\t\t\t// If previous sibling is empty then jump over it\n-\t\t\t\tprev = findElementSibling(prev, 'previousSibling');\n-\t\t\t\tnext = findElementSibling(next, 'nextSibling');\n-\n-\t\t\t\t// Compare next and previous nodes\n-\t\t\t\tif (compareElements(prev, next)) {\n-\t\t\t\t\t// Append nodes between\n-\t\t\t\t\tfor (sibling = prev.nextSibling; sibling && sibling != next;) {\n-\t\t\t\t\t\ttmpSibling = sibling;\n-\t\t\t\t\t\tsibling = sibling.nextSibling;\n-\t\t\t\t\t\tprev.appendChild(tmpSibling);\n-\t\t\t\t\t}\n-\n-\t\t\t\t\t// Remove next node\n-\t\t\t\t\tdom.remove(next);\n-\n-\t\t\t\t\t// Move children into prev node\n-\t\t\t\t\teach(tinymce.grep(next.childNodes), function(node) {\n-\t\t\t\t\t\tprev.appendChild(node);\n-\t\t\t\t\t});\n-\n-\t\t\t\t\treturn prev;\n-\t\t\t\t}\n-\t\t\t}\n-\n-\t\t\treturn next;\n-\t\t};\n-\n-\t\tfunction getContainer(rng, start) {\n-\t\t\tvar container, offset, lastIdx, walker;\n-\n-\t\t\tcontainer = rng[start ? 'startContainer' : 'endContainer'];\n-\t\t\toffset = rng[start ? 'startOffset' : 'endOffset'];\n-\n-\t\t\tif (container.nodeType == 1) {\n-\t\t\t\tlastIdx = container.childNodes.length - 1;\n-\n-\t\t\t\tif (!start && offset)\n-\t\t\t\t\toffset--;\n-\n-\t\t\t\tcontainer = container.childNodes[offset > lastIdx ? lastIdx : offset];\n-\t\t\t}\n-\n-\t\t\t// If start text node is excluded then walk to the next node\n-\t\t\tif (container.nodeType === 3 && start && offset >= container.nodeValue.length) {\n-\t\t\t\tcontainer = new TreeWalker(container, ed.getBody()).next() || container;\n-\t\t\t}\n-\n-\t\t\t// If end text node is excluded then walk to the previous node\n-\t\t\tif (container.nodeType === 3 && !start && offset === 0) {\n-\t\t\t\tcontainer = new TreeWalker(container, ed.getBody()).prev() || container;\n-\t\t\t}\n-\n-\t\t\treturn container;\n-\t\t};\n-\n-\t\tfunction performCaretAction(type, name, vars) {\n-\t\t\tvar caretContainerId = '_mce_caret', debug = ed.settings.caret_debug;\n-\n-\t\t\t// Creates a caret container bogus element\n-\t\t\tfunction createCaretContainer(fill) {\n-\t\t\t\tvar caretContainer = dom.create('span', {id: caretContainerId, 'data-mce-bogus': true, style: debug ? 'color:red' : ''});\n-\n-\t\t\t\tif (fill) {\n-\t\t\t\t\tcaretContainer.appendChild(ed.getDoc().createTextNode(INVISIBLE_CHAR));\n-\t\t\t\t}\n-\n-\t\t\t\treturn caretContainer;\n-\t\t\t};\n-\n-\t\t\tfunction isCaretContainerEmpty(node, nodes) {\n-\t\t\t\twhile (node) {\n-\t\t\t\t\tif ((node.nodeType === 3 && node.nodeValue !== INVISIBLE_CHAR) || node.childNodes.length > 1) {\n-\t\t\t\t\t\treturn false;\n-\t\t\t\t\t}\n-\n-\t\t\t\t\t// Collect nodes\n-\t\t\t\t\tif (nodes && node.nodeType === 1) {\n-\t\t\t\t\t\tnodes.push(node);\n-\t\t\t\t\t}\n-\n-\t\t\t\t\tnode = node.firstChild;\n-\t\t\t\t}\n-\n-\t\t\t\treturn true;\n-\t\t\t};\n-\t\t\t\n-\t\t\t// Returns any parent caret container element\n-\t\t\tfunction getParentCaretContainer(node) {\n-\t\t\t\twhile (node) {\n-\t\t\t\t\tif (node.id === caretContainerId) {\n-\t\t\t\t\t\treturn node;\n-\t\t\t\t\t}\n-\n-\t\t\t\t\tnode = node.parentNode;\n-\t\t\t\t}\n-\t\t\t};\n-\n-\t\t\t// Finds the first text node in the specified node\n-\t\t\tfunction findFirstTextNode(node) {\n-\t\t\t\tvar walker;\n-\n-\t\t\t\tif (node) {\n-\t\t\t\t\twalker = new TreeWalker(node, node);\n-\n-\t\t\t\t\tfor (node = walker.current(); node; node = walker.next()) {\n-\t\t\t\t\t\tif (node.nodeType === 3) {\n-\t\t\t\t\t\t\treturn node;\n-\t\t\t\t\t\t}\n-\t\t\t\t\t}\n-\t\t\t\t}\n-\t\t\t};\n-\n-\t\t\t// Removes the caret container for the specified node or all on the current document\n-\t\t\tfunction removeCaretContainer(node, move_caret) {\n-\t\t\t\tvar child, rng;\n-\n-\t\t\t\tif (!node) {\n-\t\t\t\t\tnode = getParentCaretContainer(selection.getStart());\n-\n-\t\t\t\t\tif (!node) {\n-\t\t\t\t\t\twhile (node = dom.get(caretContainerId)) {\n-\t\t\t\t\t\t\tremoveCaretContainer(node, false);\n-\t\t\t\t\t\t}\n-\t\t\t\t\t}\n-\t\t\t\t} else {\n-\t\t\t\t\trng = selection.getRng(true);\n-\n-\t\t\t\t\tif (isCaretContainerEmpty(node)) {\n-\t\t\t\t\t\tif (move_caret !== false) {\n-\t\t\t\t\t\t\trng.setStartBefore(node);\n-\t\t\t\t\t\t\trng.setEndBefore(node);\n-\t\t\t\t\t\t}\n-\n-\t\t\t\t\t\tdom.remove(node);\n-\t\t\t\t\t} else {\n-\t\t\t\t\t\tchild = findFirstTextNode(node);\n-\n-\t\t\t\t\t\tif (child.nodeValue.charAt(0) === INVISIBLE_CHAR) {\n-\t\t\t\t\t\t\tchild = child.deleteData(0, 1);\n-\t\t\t\t\t\t}\n-\n-\t\t\t\t\t\tdom.remove(node, 1);\n-\t\t\t\t\t}\n-\n-\t\t\t\t\tselection.setRng(rng);\n-\t\t\t\t}\n-\t\t\t};\n-\t\t\t\n-\t\t\t// Applies formatting to the caret postion\n-\t\t\tfunction applyCaretFormat() {\n-\t\t\t\tvar rng, caretContainer, textNode, offset, bookmark, container, text;\n-\n-\t\t\t\trng = selection.getRng(true);\n-\t\t\t\toffset = rng.startOffset;\n-\t\t\t\tcontainer = rng.startContainer;\n-\t\t\t\ttext = container.nodeValue;\n-\n-\t\t\t\tcaretContainer = getParentCaretContainer(selection.getStart());\n-\t\t\t\tif (caretContainer) {\n-\t\t\t\t\ttextNode = findFirstTextNode(caretContainer);\n-\t\t\t\t}\n-\n-\t\t\t\t// Expand to word is caret is in the middle of a text node and the char before/after is a alpha numeric character\n-\t\t\t\tif (text && offset > 0 && offset < text.length && /\\w/.test(text.charAt(offset)) && /\\w/.test(text.charAt(offset - 1))) {\n-\t\t\t\t\t// Get bookmark of caret position\n-\t\t\t\t\tbookmark = selection.getBookmark();\n-\n-\t\t\t\t\t// Collapse bookmark range (WebKit)\n-\t\t\t\t\trng.collapse(true);\n-\n-\t\t\t\t\t// Expand the range to the closest word and split it at those points\n-\t\t\t\t\trng = expandRng(rng, get(name));\n-\t\t\t\t\trng = rangeUtils.split(rng);\n-\n-\t\t\t\t\t// Apply the format to the range\n-\t\t\t\t\tapply(name, vars, rng);\n-\n-\t\t\t\t\t// Move selection back to caret position\n-\t\t\t\t\tselection.moveToBookmark(bookmark);\n-\t\t\t\t} else {\n-\t\t\t\t\tif (!caretContainer || textNode.nodeValue !== INVISIBLE_CHAR) {\n-\t\t\t\t\t\tcaretContainer = createCaretContainer(true);\n-\t\t\t\t\t\ttextNode = caretContainer.firstChild;\n-\n-\t\t\t\t\t\trng.insertNode(caretContainer);\n-\t\t\t\t\t\toffset = 1;\n-\n-\t\t\t\t\t\tapply(name, vars, caretContainer);\n-\t\t\t\t\t} else {\n-\t\t\t\t\t\tapply(name, vars, caretContainer);\n-\t\t\t\t\t}\n-\n-\t\t\t\t\t// Move selection to text node\n-\t\t\t\t\tselection.setCursorLocation(textNode, offset);\n-\t\t\t\t}\n-\t\t\t};\n-\n-\t\t\tfunction removeCaretFormat() {\n-\t\t\t\tvar rng = selection.getRng(true), container, offset, bookmark,\n-\t\t\t\t\thasContentAfter, node, formatNode, parents = [], i, caretContainer;\n-\n-\t\t\t\tcontainer = rng.startContainer;\n-\t\t\t\toffset = rng.startOffset;\n-\t\t\t\tnode = container;\n-\n-\t\t\t\tif (container.nodeType == 3) {\n-\t\t\t\t\tif (offset != container.nodeValue.length || container.nodeValue === INVISIBLE_CHAR) {\n-\t\t\t\t\t\thasContentAfter = true;\n-\t\t\t\t\t}\n-\n-\t\t\t\t\tnode = node.parentNode;\n-\t\t\t\t}\n-\n-\t\t\t\twhile (node) {\n-\t\t\t\t\tif (matchNode(node, name, vars)) {\n-\t\t\t\t\t\tformatNode = node;\n-\t\t\t\t\t\tbreak;\n-\t\t\t\t\t}\n-\n-\t\t\t\t\tif (node.nextSibling) {\n-\t\t\t\t\t\thasContentAfter = true;\n-\t\t\t\t\t}\n-\n-\t\t\t\t\tparents.push(node);\n-\t\t\t\t\tnode = node.parentNode;\n-\t\t\t\t}\n-\n-\t\t\t\t// Node doesn't have the specified format\n-\t\t\t\tif (!formatNode) {\n-\t\t\t\t\treturn;\n-\t\t\t\t}\n-\n-\t\t\t\t// Is there contents after the caret then remove the format on the element\n-\t\t\t\tif (hasContentAfter) {\n-\t\t\t\t\t// Get bookmark of caret position\n-\t\t\t\t\tbookmark = selection.getBookmark();\n-\n-\t\t\t\t\t// Collapse bookmark range (WebKit)\n-\t\t\t\t\trng.collapse(true);\n-\n-\t\t\t\t\t// Expand the range to the closest word and split it at those points\n-\t\t\t\t\trng = expandRng(rng, get(name), true);\n-\t\t\t\t\trng = rangeUtils.split(rng);\n-\n-\t\t\t\t\t// Remove the format from the range\n-\t\t\t\t\tremove(name, vars, rng);\n-\n-\t\t\t\t\t// Move selection back to caret position\n-\t\t\t\t\tselection.moveToBookmark(bookmark);\n-\t\t\t\t} else {\n-\t\t\t\t\tcaretContainer = createCaretContainer();\n-\n-\t\t\t\t\tnode = caretContainer;\n-\t\t\t\t\tfor (i = parents.length - 1; i >= 0; i--) {\n-\t\t\t\t\t\tnode.appendChild(dom.clone(parents[i], false));\n-\t\t\t\t\t\tnode = node.firstChild;\n-\t\t\t\t\t}\n-\n-\t\t\t\t\t// Insert invisible character into inner most format element\n-\t\t\t\t\tnode.appendChild(dom.doc.createTextNode(INVISIBLE_CHAR));\n-\t\t\t\t\tnode = node.firstChild;\n-\n-\t\t\t\t\tvar block = dom.getParent(formatNode, isTextBlock);\n-\n-\t\t\t\t\tif (block && dom.isEmpty(block)) {\n-\t\t\t\t\t\t// Replace formatNode with caretContainer when removing format from empty block like <p><b>|</b></p>\n-\t\t\t\t\t\tformatNode.parentNode.replaceChild(caretContainer, formatNode);\n-\t\t\t\t\t} else {\n-\t\t\t\t\t\t// Insert caret container after the formated node\n-\t\t\t\t\t\tdom.insertAfter(caretContainer, formatNode);\n-\t\t\t\t\t}\n-\n-\t\t\t\t\t// Move selection to text node\n-\t\t\t\t\tselection.setCursorLocation(node, 1);\n-\n-\t\t\t\t\t// If the formatNode is empty, we can remove it safely. \n-\t\t\t\t\tif (dom.isEmpty(formatNode)) {\n-\t\t\t\t\t\tdom.remove(formatNode);\n-\t\t\t\t\t}\n-\t\t\t\t}\n-\t\t\t};\n-\n-\t\t\t// Checks if the parent caret container node isn't empty if that is the case it\n-\t\t\t// will remove the bogus state on all children that isn't empty\n-\t\t\tfunction unmarkBogusCaretParents() {\n-\t\t\t\tvar i, caretContainer, node;\n-\n-\t\t\t\tcaretContainer = getParentCaretContainer(selection.getStart());\n-\t\t\t\tif (caretContainer && !dom.isEmpty(caretContainer)) {\n-\t\t\t\t\ttinymce.walk(caretContainer, function(node) {\n-\t\t\t\t\t\tif (node.nodeType == 1 && node.id !== caretContainerId && !dom.isEmpty(node)) {\n-\t\t\t\t\t\t\tdom.setAttrib(node, 'data-mce-bogus', null);\n-\t\t\t\t\t\t}\n-\t\t\t\t\t}, 'childNodes');\n-\t\t\t\t}\n-\t\t\t};\n-\n-\t\t\t// Only bind the caret events once\n-\t\t\tif (!self._hasCaretEvents) {\n-\t\t\t\t// Mark current caret container elements as bogus when getting the contents so we don't end up with empty elements\n-\t\t\t\ted.onBeforeGetContent.addToTop(function() {\n-\t\t\t\t\tvar nodes = [], i;\n-\n-\t\t\t\t\tif (isCaretContainerEmpty(getParentCaretContainer(selection.getStart()), nodes)) {\n-\t\t\t\t\t\t// Mark children\n-\t\t\t\t\t\ti = nodes.length;\n-\t\t\t\t\t\twhile (i--) {\n-\t\t\t\t\t\t\tdom.setAttrib(nodes[i], 'data-mce-bogus', '1');\n-\t\t\t\t\t\t}\n-\t\t\t\t\t}\n-\t\t\t\t});\n-\n-\t\t\t\t// Remove caret container on mouse up and on key up\n-\t\t\t\ttinymce.each('onMouseUp onKeyUp'.split(' '), function(name) {\n-\t\t\t\t\ted[name].addToTop(function() {\n-\t\t\t\t\t\tremoveCaretContainer();\n-\t\t\t\t\t\tunmarkBogusCaretParents();\n-\t\t\t\t\t});\n-\t\t\t\t});\n-\n-\t\t\t\t// Remove caret container on keydown and it's a backspace, enter or left/right arrow keys\n-\t\t\t\ted.onKeyDown.addToTop(function(ed, e) {\n-\t\t\t\t\tvar keyCode = e.keyCode;\n-\n-\t\t\t\t\tif (keyCode == 8 || keyCode == 37 || keyCode == 39) {\n-\t\t\t\t\t\tremoveCaretContainer(getParentCaretContainer(selection.getStart()));\n-\t\t\t\t\t}\n-\n-\t\t\t\t\tunmarkBogusCaretParents();\n-\t\t\t\t});\n-\n-\t\t\t\t// Remove bogus state if they got filled by contents using editor.selection.setContent\n-\t\t\t\tselection.onSetContent.add(unmarkBogusCaretParents);\n-\n-\t\t\t\tself._hasCaretEvents = true;\n-\t\t\t}\n-\n-\t\t\t// Do apply or remove caret format\n-\t\t\tif (type == \"apply\") {\n-\t\t\t\tapplyCaretFormat();\n-\t\t\t} else {\n-\t\t\t\tremoveCaretFormat();\n-\t\t\t}\n-\t\t};\n-\n-\t\t/**\n-\t\t * Moves the start to the first suitable text node.\n-\t\t */\n-\t\tfunction moveStart(rng) {\n-\t\t\tvar container = rng.startContainer,\n-\t\t\t\t\toffset = rng.startOffset, isAtEndOfText,\n-\t\t\t\t\twalker, node, nodes, tmpNode;\n-\n-\t\t\t// Convert text node into index if possible\n-\t\t\tif (container.nodeType == 3 && offset >= container.nodeValue.length) {\n-\t\t\t\t// Get the parent container location and walk from there\n-\t\t\t\toffset = nodeIndex(container);\n-\t\t\t\tcontainer = container.parentNode;\n-\t\t\t\tisAtEndOfText = true;\n-\t\t\t}\n-\n-\t\t\t// Move startContainer/startOffset in to a suitable node\n-\t\t\tif (container.nodeType == 1) {\n-\t\t\t\tnodes = container.childNodes;\n-\t\t\t\tcontainer = nodes[Math.min(offset, nodes.length - 1)];\n-\t\t\t\twalker = new TreeWalker(container, dom.getParent(container, dom.isBlock));\n-\n-\t\t\t\t// If offset is at end of the parent node walk to the next one\n-\t\t\t\tif (offset > nodes.length - 1 || isAtEndOfText)\n-\t\t\t\t\twalker.next();\n-\n-\t\t\t\tfor (node = walker.current(); node; node = walker.next()) {\n-\t\t\t\t\tif (node.nodeType == 3 && !isWhiteSpaceNode(node)) {\n-\t\t\t\t\t\t// IE has a \"neat\" feature where it moves the start node into the closest element\n-\t\t\t\t\t\t// we can avoid this by inserting an element before it and then remove it after we set the selection\n-\t\t\t\t\t\ttmpNode = dom.create('a', null, INVISIBLE_CHAR);\n-\t\t\t\t\t\tnode.parentNode.insertBefore(tmpNode, node);\n-\n-\t\t\t\t\t\t// Set selection and remove tmpNode\n-\t\t\t\t\t\trng.setStart(node, 0);\n-\t\t\t\t\t\tselection.setRng(rng);\n-\t\t\t\t\t\tdom.remove(tmpNode);\n-\n-\t\t\t\t\t\treturn;\n-\t\t\t\t\t}\n-\t\t\t\t}\n-\t\t\t}\n-\t\t};\n-\t};\n-})(tinymce);"
        },
        {
            "filename": "js/tiny_mce/classes/LegacyInput.js",
            "diff": "@@ -1,66 +0,0 @@\n-/**\n- * LegacyInput.js\n- *\n- * Copyright, Moxiecode Systems AB\n- * Released under LGPL License.\n- *\n- * License: http://www.tinymce.com/license\n- * Contributing: http://www.tinymce.com/contributing\n- */\n-\n-tinymce.onAddEditor.add(function(tinymce, ed) {\n-\tvar filters, fontSizes, dom, settings = ed.settings;\n-\n-\tfunction replaceWithSpan(node, styles) {\n-\t\ttinymce.each(styles, function(value, name) {\n-\t\t\tif (value)\n-\t\t\t\tdom.setStyle(node, name, value);\n-\t\t});\n-\n-\t\tdom.rename(node, 'span');\n-\t};\n-\n-\tfunction convert(editor, params) {\n-\t\tdom = editor.dom;\n-\n-\t\tif (settings.convert_fonts_to_spans) {\n-\t\t\ttinymce.each(dom.select('font,u,strike', params.node), function(node) {\n-\t\t\t\tfilters[node.nodeName.toLowerCase()](ed.dom, node);\n-\t\t\t});\n-\t\t}\n-\t};\n-\n-\tif (settings.inline_styles) {\n-\t\tfontSizes = tinymce.explode(settings.font_size_legacy_values);\n-\n-\t\tfilters = {\n-\t\t\tfont : function(dom, node) {\n-\t\t\t\treplaceWithSpan(node, {\n-\t\t\t\t\tbackgroundColor : node.style.backgroundColor,\n-\t\t\t\t\tcolor : node.color,\n-\t\t\t\t\tfontFamily : node.face,\n-\t\t\t\t\tfontSize : fontSizes[parseInt(node.size, 10) - 1]\n-\t\t\t\t});\n-\t\t\t},\n-\n-\t\t\tu : function(dom, node) {\n-\t\t\t\treplaceWithSpan(node, {\n-\t\t\t\t\ttextDecoration : 'underline'\n-\t\t\t\t});\n-\t\t\t},\n-\n-\t\t\tstrike : function(dom, node) {\n-\t\t\t\treplaceWithSpan(node, {\n-\t\t\t\t\ttextDecoration : 'line-through'\n-\t\t\t\t});\n-\t\t\t}\n-\t\t};\n-\n-\t\ted.onPreProcess.add(convert);\n-\t\ted.onSetContent.add(convert);\n-\n-\t\ted.onInit.add(function() {\n-\t\t\ted.selection.onSetContent.add(convert);\n-\t\t});\n-\t}\n-});"
        },
        {
            "filename": "js/tiny_mce/classes/Popup.js",
            "diff": "@@ -1,417 +0,0 @@\n-/**\n- * Popup.js\n- *\n- * Copyright, Moxiecode Systems AB\n- * Released under LGPL License.\n- *\n- * License: http://www.tinymce.com/license\n- * Contributing: http://www.tinymce.com/contributing\n- */\n-\n-// Some global instances\n-var tinymce = null, tinyMCEPopup, tinyMCE;\n-\n-/**\n- * TinyMCE popup/dialog helper class. This gives you easy access to the\n- * parent editor instance and a bunch of other things. It's higly recommended\n- * that you load this script into your dialogs.\n- *\n- * @static\n- * @class tinyMCEPopup\n- */\n-tinyMCEPopup = {\n-\t/**\n-\t * Initializes the popup this will be called automatically.\n-\t *\n-\t * @method init\n-\t */\n-\tinit : function() {\n-\t\tvar t = this, w, ti;\n-\n-\t\t// Find window & API\n-\t\tw = t.getWin();\n-\t\ttinymce = w.tinymce;\n-\t\ttinyMCE = w.tinyMCE;\n-\t\tt.editor = tinymce.EditorManager.activeEditor;\n-\t\tt.params = t.editor.windowManager.params;\n-\t\tt.features = t.editor.windowManager.features;\n-\n-\t\t// Setup local DOM\n-\t\tt.dom = t.editor.windowManager.createInstance('tinymce.dom.DOMUtils', document, {ownEvents: true, proxy: tinyMCEPopup._eventProxy});\n-\t\tt.dom.bind(window, 'ready', t._onDOMLoaded, t);\n-\n-\t\t// Enables you to skip loading the default css\n-\t\tif (t.features.popup_css !== false)\n-\t\t\tt.dom.loadCSS(t.features.popup_css || t.editor.settings.popup_css);\n-\n-\t\t// Setup on init listeners\n-\t\tt.listeners = [];\n-\n-\t\t/**\n-\t\t * Fires when the popup is initialized.\n-\t\t *\n-\t\t * @event onInit\n-\t\t * @param {tinymce.Editor} editor Editor instance.\n-\t\t * @example\n-\t\t * // Alerts the selected contents when the dialog is loaded\n-\t\t * tinyMCEPopup.onInit.add(function(ed) {\n-\t\t *     alert(ed.selection.getContent());\n-\t\t * });\n-\t\t * \n-\t\t * // Executes the init method on page load in some object using the SomeObject scope\n-\t\t * tinyMCEPopup.onInit.add(SomeObject.init, SomeObject);\n-\t\t */\n-\t\tt.onInit = {\n-\t\t\tadd : function(f, s) {\n-\t\t\t\tt.listeners.push({func : f, scope : s});\n-\t\t\t}\n-\t\t};\n-\n-\t\tt.isWindow = !t.getWindowArg('mce_inline');\n-\t\tt.id = t.getWindowArg('mce_window_id');\n-\t\tt.editor.windowManager.onOpen.dispatch(t.editor.windowManager, window);\n-\t},\n-\n-\t/**\n-\t * Returns the reference to the parent window that opened the dialog.\n-\t *\n-\t * @method getWin\n-\t * @return {Window} Reference to the parent window that opened the dialog.\n-\t */\n-\tgetWin : function() {\n-\t\t// Added frameElement check to fix bug: #2817583\n-\t\treturn (!window.frameElement && window.dialogArguments) || opener || parent || top;\n-\t},\n-\n-\t/**\n-\t * Returns a window argument/parameter by name.\n-\t *\n-\t * @method getWindowArg\n-\t * @param {String} n Name of the window argument to retrieve.\n-\t * @param {String} dv Optional default value to return.\n-\t * @return {String} Argument value or default value if it wasn't found.\n-\t */\n-\tgetWindowArg : function(n, dv) {\n-\t\tvar v = this.params[n];\n-\n-\t\treturn tinymce.is(v) ? v : dv;\n-\t},\n-\n-\t/**\n-\t * Returns a editor parameter/config option value.\n-\t *\n-\t * @method getParam\n-\t * @param {String} n Name of the editor config option to retrieve.\n-\t * @param {String} dv Optional default value to return.\n-\t * @return {String} Parameter value or default value if it wasn't found.\n-\t */\n-\tgetParam : function(n, dv) {\n-\t\treturn this.editor.getParam(n, dv);\n-\t},\n-\n-\t/**\n-\t * Returns a language item by key.\n-\t *\n-\t * @method getLang\n-\t * @param {String} n Language item like mydialog.something.\n-\t * @param {String} dv Optional default value to return.\n-\t * @return {String} Language value for the item like \"my string\" or the default value if it wasn't found.\n-\t */\n-\tgetLang : function(n, dv) {\n-\t\treturn this.editor.getLang(n, dv);\n-\t},\n-\n-\t/**\n-\t * Executed a command on editor that opened the dialog/popup.\n-\t *\n-\t * @method execCommand\n-\t * @param {String} cmd Command to execute.\n-\t * @param {Boolean} ui Optional boolean value if the UI for the command should be presented or not.\n-\t * @param {Object} val Optional value to pass with the comman like an URL.\n-\t * @param {Object} a Optional arguments object.\n-\t */\n-\texecCommand : function(cmd, ui, val, a) {\n-\t\ta = a || {};\n-\t\ta.skip_focus = 1;\n-\n-\t\tthis.restoreSelection();\n-\t\treturn this.editor.execCommand(cmd, ui, val, a);\n-\t},\n-\n-\t/**\n-\t * Resizes the dialog to the inner size of the window. This is needed since various browsers\n-\t * have different border sizes on windows.\n-\t *\n-\t * @method resizeToInnerSize\n-\t */\n-\tresizeToInnerSize : function() {\n-\t\tvar t = this;\n-\n-\t\t// Detach it to workaround a Chrome specific bug\n-\t\t// https://sourceforge.net/tracker/?func=detail&atid=635682&aid=2926339&group_id=103281\n-\t\tsetTimeout(function() {\n-\t\t\tvar vp = t.dom.getViewPort(window);\n-\n-\t\t\tt.editor.windowManager.resizeBy(\n-\t\t\t\tt.getWindowArg('mce_width') - vp.w,\n-\t\t\t\tt.getWindowArg('mce_height') - vp.h,\n-\t\t\t\tt.id || window\n-\t\t\t);\n-\t\t}, 10);\n-\t},\n-\n-\t/**\n-\t * Will executed the specified string when the page has been loaded. This function\n-\t * was added for compatibility with the 2.x branch.\n-\t *\n-\t * @method executeOnLoad\n-\t * @param {String} s String to evalutate on init.\n-\t */\n-\texecuteOnLoad : function(s) {\n-\t\tthis.onInit.add(function() {\n-\t\t\teval(s);\n-\t\t});\n-\t},\n-\n-\t/**\n-\t * Stores the current editor selection for later restoration. This can be useful since some browsers\n-\t * looses it's selection if a control element is selected/focused inside the dialogs.\n-\t *\n-\t * @method storeSelection\n-\t */\n-\tstoreSelection : function() {\n-\t\tthis.editor.windowManager.bookmark = tinyMCEPopup.editor.selection.getBookmark(1);\n-\t},\n-\n-\t/**\n-\t * Restores any stored selection. This can be useful since some browsers\n-\t * looses it's selection if a control element is selected/focused inside the dialogs.\n-\t *\n-\t * @method restoreSelection\n-\t */\n-\trestoreSelection : function() {\n-\t\tvar t = tinyMCEPopup;\n-\n-\t\tif (!t.isWindow && tinymce.isIE) {\n-\t\t\tt.editor.selection.moveToBookmark(t.editor.windowManager.bookmark);\n-\t\t}\n-\t},\n-\n-\t/**\n-\t * Loads a specific dialog language pack. If you pass in plugin_url as a arugment\n-\t * when you open the window it will load the <plugin url>/langs/<code>_dlg.js lang pack file.\n-\t *\n-\t * @method requireLangPack\n-\t */\n-\trequireLangPack : function() {\n-\t\tvar t = this, u = t.getWindowArg('plugin_url') || t.getWindowArg('theme_url');\n-\n-\t\tif (u && t.editor.settings.language && t.features.translate_i18n !== false && t.editor.settings.language_load !== false) {\n-\t\t\tu += '/langs/' + t.editor.settings.language + '_dlg.js';\n-\n-\t\t\tif (!tinymce.ScriptLoader.isDone(u)) {\n-\t\t\t\tdocument.write('<script type=\"text/javascript\" src=\"' + tinymce._addVer(u) + '\"></script>');\n-\t\t\t\ttinymce.ScriptLoader.markDone(u);\n-\t\t\t}\n-\t\t}\n-\t},\n-\n-\t/**\n-\t * Executes a color picker on the specified element id. When the user\n-\t * then selects a color it will be set as the value of the specified element.\n-\t *\n-\t * @method pickColor\n-\t * @param {DOMEvent} e DOM event object.\n-\t * @param {string} element_id Element id to be filled with the color value from the picker.\n-\t */\n-\tpickColor : function(e, element_id) {\n-\t\tthis.execCommand('mceColorPicker', true, {\n-\t\t\tcolor : document.getElementById(element_id).value,\n-\t\t\tfunc : function(c) {\n-\t\t\t\tdocument.getElementById(element_id).value = c;\n-\n-\t\t\t\ttry {\n-\t\t\t\t\tdocument.getElementById(element_id).onchange();\n-\t\t\t\t} catch (ex) {\n-\t\t\t\t\t// Try fire event, ignore errors\n-\t\t\t\t}\n-\t\t\t}\n-\t\t});\n-\t},\n-\n-\t/**\n-\t * Opens a filebrowser/imagebrowser this will set the output value from\n-\t * the browser as a value on the specified element.\n-\t *\n-\t * @method openBrowser\n-\t * @param {string} element_id Id of the element to set value in.\n-\t * @param {string} type Type of browser to open image/file/flash.\n-\t * @param {string} option Option name to get the file_broswer_callback function name from.\n-\t */\n-\topenBrowser : function(element_id, type, option) {\n-\t\ttinyMCEPopup.restoreSelection();\n-\t\tthis.editor.execCallback('file_browser_callback', element_id, document.getElementById(element_id).value, type, window);\n-\t},\n-\n-\t/**\n-\t * Creates a confirm dialog. Please don't use the blocking behavior of this\n-\t * native version use the callback method instead then it can be extended.\n-\t *\n-\t * @method confirm\n-\t * @param {String} t Title for the new confirm dialog.\n-\t * @param {function} cb Callback function to be executed after the user has selected ok or cancel.\n-\t * @param {Object} s Optional scope to execute the callback in.\n-\t */\n-\tconfirm : function(t, cb, s) {\n-\t\tthis.editor.windowManager.confirm(t, cb, s, window);\n-\t},\n-\n-\t/**\n-\t * Creates a alert dialog. Please don't use the blocking behavior of this\n-\t * native version use the callback method instead then it can be extended.\n-\t *\n-\t * @method alert\n-\t * @param {String} t Title for the new alert dialog.\n-\t * @param {function} cb Callback function to be executed after the user has selected ok.\n-\t * @param {Object} s Optional scope to execute the callback in.\n-\t */\n-\talert : function(tx, cb, s) {\n-\t\tthis.editor.windowManager.alert(tx, cb, s, window);\n-\t},\n-\n-\t/**\n-\t * Closes the current window.\n-\t *\n-\t * @method close\n-\t */\n-\tclose : function() {\n-\t\tvar t = this;\n-\n-\t\t// To avoid domain relaxing issue in Opera\n-\t\tfunction close() {\n-\t\t\tt.editor.windowManager.close(window);\n-\t\t\ttinymce = tinyMCE = t.editor = t.params = t.dom = t.dom.doc = null; // Cleanup\n-\t\t};\n-\n-\t\tif (tinymce.isOpera)\n-\t\t\tt.getWin().setTimeout(close, 0);\n-\t\telse\n-\t\t\tclose();\n-\t},\n-\n-\t// Internal functions\t\n-\n-\t_restoreSelection : function(e) {\n-\t\tvar e = (e && e.target) || window.event.srcElement;\n-\n-\t\tif (e.nodeName == 'INPUT' && (e.type == 'submit' || e.type == 'button'))\n-\t\t\ttinyMCEPopup.restoreSelection();\n-\t},\n-\n-\t_onDOMLoaded : function() {\n-\t\tvar t = tinyMCEPopup, ti = document.title, bm, h, nv;\n-\n-\t\t// Translate page\n-\t\tif (t.features.translate_i18n !== false) {\n-\t\t\th = document.body.innerHTML;\n-\n-\t\t\t// Replace a=x with a=\"x\" in IE\n-\t\t\tif (tinymce.isIE)\n-\t\t\t\th = h.replace(/ (value|title|alt)=([^\"][^\\s>]+)/gi, ' $1=\"$2\"')\n-\n-\t\t\tdocument.dir = t.editor.getParam('directionality','');\n-\n-\t\t\tif ((nv = t.editor.translate(h)) && nv != h)\n-\t\t\t\tdocument.body.innerHTML = nv;\n-\n-\t\t\tif ((nv = t.editor.translate(ti)) && nv != ti)\n-\t\t\t\tdocument.title = ti = nv;\n-\t\t}\n-\n-\t\tif (!t.editor.getParam('browser_preferred_colors', false) || !t.isWindow)\n-\t\t\tt.dom.addClass(document.body, 'forceColors');\n-\n-\t\tdocument.body.style.display = '';\n-\n-\t\t// Restore selection in IE when focus is placed on a non textarea or input element of the type text\n-\t\tif (tinymce.isIE && !tinymce.isIE11) {\n-\t\t\tdocument.attachEvent('onmouseup', tinyMCEPopup._restoreSelection);\n-\n-\t\t\t// Add base target element for it since it would fail with modal dialogs\n-\t\t\tt.dom.add(t.dom.select('head')[0], 'base', {target : '_self'});\n-\t\t} else if (tinymce.isIE11) {\n-\t\t\tdocument.addEventListener('mouseup', tinyMCEPopup._restoreSelection, false);\n- \t\t}\n-\n-\t\tt.restoreSelection();\n-\t\tt.resizeToInnerSize();\n-\n-\t\t// Set inline title\n-\t\tif (!t.isWindow)\n-\t\t\tt.editor.windowManager.setTitle(window, ti);\n-\t\telse\n-\t\t\twindow.focus();\n-\n-\t\tif (!tinymce.isIE && !t.isWindow) {\n-\t\t\tt.dom.bind(document, 'focus', function() {\n-\t\t\t\tt.editor.windowManager.focus(t.id);\n-\t\t\t});\n-\t\t}\n-\n-\t\t// Patch for accessibility\n-\t\ttinymce.each(t.dom.select('select'), function(e) {\n-\t\t\te.onkeydown = tinyMCEPopup._accessHandler;\n-\t\t});\n-\n-\t\t// Call onInit\n-\t\t// Init must be called before focus so the selection won't get lost by the focus call\n-\t\ttinymce.each(t.listeners, function(o) {\n-\t\t\to.func.call(o.scope, t.editor);\n-\t\t});\n-\n-\t\t// Move focus to window\n-\t\tif (t.getWindowArg('mce_auto_focus', true)) {\n-\t\t\twindow.focus();\n-\n-\t\t\t// Focus element with mceFocus class\n-\t\t\ttinymce.each(document.forms, function(f) {\n-\t\t\t\ttinymce.each(f.elements, function(e) {\n-\t\t\t\t\tif (t.dom.hasClass(e, 'mceFocus') && !e.disabled) {\n-\t\t\t\t\t\te.focus();\n-\t\t\t\t\t\treturn false; // Break loop\n-\t\t\t\t\t}\n-\t\t\t\t});\n-\t\t\t});\n-\t\t}\n-\n-\t\tdocument.onkeyup = tinyMCEPopup._closeWinKeyHandler;\n-\t},\n-\n-\t_accessHandler : function(e) {\n-\t\te = e || window.event;\n-\n-\t\tif (e.keyCode == 13 || e.keyCode == 32) {\n-\t\t\tvar elm = e.target || e.srcElement;\n-\n-\t\t\tif (elm.onchange)\n-\t\t\t\telm.onchange();\n-\n-\t\t\treturn tinymce.dom.Event.cancel(e);\n-\t\t}\n-\t},\n-\n-\t_closeWinKeyHandler : function(e) {\n-\t\te = e || window.event;\n-\n-\t\tif (e.keyCode == 27)\n-\t\t\ttinyMCEPopup.close();\n-\t},\n-\n-\t_eventProxy: function(id) {\n-\t\treturn function(evt) {\n-\t\t\ttinyMCEPopup.dom.events.callNativeHandler(id, evt);\n-\t\t};\n-\t}\n-};\n-\n-tinyMCEPopup.init();\n\\ No newline at end of file"
        },
        {
            "filename": "js/tiny_mce/classes/UndoManager.js",
            "diff": "@@ -1,310 +0,0 @@\n-/**\n- * UndoManager.js\n- *\n- * Copyright, Moxiecode Systems AB\n- * Released under LGPL License.\n- *\n- * License: http://www.tinymce.com/license\n- * Contributing: http://www.tinymce.com/contributing\n- */\n-\n-(function(tinymce) {\n-\tvar Dispatcher = tinymce.util.Dispatcher;\n-\n-\t/**\n-\t * This class handles the undo/redo history levels for the editor. Since the build in undo/redo has major drawbacks a custom one was needed.\n-\t *\n-\t * @class tinymce.UndoManager\n-\t */\n-\ttinymce.UndoManager = function(editor) {\n-\t\tvar self, index = 0, data = [], beforeBookmark, onAdd, onUndo, onRedo;\n-\n-\t\tfunction getContent() {\n-\t\t\t// Remove whitespace before/after and remove pure bogus nodes\n-\t\t\treturn tinymce.trim(editor.getContent({format : 'raw', no_events : 1}).replace(/<span[^>]+data-mce-bogus[^>]+>[\\u200B\\uFEFF]+<\\/span>/g, ''));\n-\t\t};\n-\n-\t\tfunction addNonTypingUndoLevel() {\n-\t\t\tself.typing = false;\n-\t\t\tself.add();\n-\t\t};\n-\n-\t\t// Create event instances\n-\t\tonBeforeAdd = new Dispatcher(self);\n-\t\tonAdd       = new Dispatcher(self);\n-\t\tonUndo      = new Dispatcher(self);\n-\t\tonRedo      = new Dispatcher(self);\n-\n-\t\t// Pass though onAdd event from UndoManager to Editor as onChange\n-\t\tonAdd.add(function(undoman, level) {\n-\t\t\tif (undoman.hasUndo())\n-\t\t\t\treturn editor.onChange.dispatch(editor, level, undoman);\n-\t\t});\n-\n-\t\t// Pass though onUndo event from UndoManager to Editor\n-\t\tonUndo.add(function(undoman, level) {\n-\t\t\treturn editor.onUndo.dispatch(editor, level, undoman);\n-\t\t});\n-\n-\t\t// Pass though onRedo event from UndoManager to Editor\n-\t\tonRedo.add(function(undoman, level) {\n-\t\t\treturn editor.onRedo.dispatch(editor, level, undoman);\n-\t\t});\n-\n-\t\t// Add initial undo level when the editor is initialized\n-\t\teditor.onInit.add(function() {\n-\t\t\tself.add();\n-\t\t});\n-\n-\t\t// Get position before an execCommand is processed\n-\t\teditor.onBeforeExecCommand.add(function(ed, cmd, ui, val, args) {\n-\t\t\tif (cmd != 'Undo' && cmd != 'Redo' && cmd != 'mceRepaint' && (!args || !args.skip_undo)) {\n-\t\t\t\tself.beforeChange();\n-\t\t\t}\n-\t\t});\n-\n-\t\t// Add undo level after an execCommand call was made\n-\t\teditor.onExecCommand.add(function(ed, cmd, ui, val, args) {\n-\t\t\tif (cmd != 'Undo' && cmd != 'Redo' && cmd != 'mceRepaint' && (!args || !args.skip_undo)) {\n-\t\t\t\tself.add();\n-\t\t\t}\n-\t\t});\n-\n-\t\t// Add undo level on save contents, drag end and blur/focusout\n-\t\teditor.onSaveContent.add(addNonTypingUndoLevel);\n-\t\teditor.dom.bind(editor.dom.getRoot(), 'dragend', addNonTypingUndoLevel);\n-\t\teditor.dom.bind(editor.getBody(), 'focusout', function(e) {\n-\t\t\tif (!editor.removed && self.typing) {\n-\t\t\t\taddNonTypingUndoLevel();\n-\t\t\t}\n-\t\t});\n-\n-\t\teditor.onKeyUp.add(function(editor, e) {\n-\t\t\tvar keyCode = e.keyCode;\n-\n-\t\t\tif ((keyCode >= 33 && keyCode <= 36) || (keyCode >= 37 && keyCode <= 40) || keyCode == 45 || keyCode == 13 || e.ctrlKey) {\n-\t\t\t\taddNonTypingUndoLevel();\n-\t\t\t}\n-\t\t});\n-\n-\t\teditor.onKeyDown.add(function(editor, e) {\n-\t\t\tvar keyCode = e.keyCode;\n-\n-\t\t\t// Is caracter positon keys left,right,up,down,home,end,pgdown,pgup,enter\n-\t\t\tif ((keyCode >= 33 && keyCode <= 36) || (keyCode >= 37 && keyCode <= 40) || keyCode == 45) {\n-\t\t\t\tif (self.typing) {\n-\t\t\t\t\taddNonTypingUndoLevel();\n-\t\t\t\t}\n-\n-\t\t\t\treturn;\n-\t\t\t}\n-\n-\t\t\t// If key isn't shift,ctrl,alt,capslock,metakey\n-\t\t\tif ((keyCode < 16 || keyCode > 20) && keyCode != 224 && keyCode != 91 && !self.typing) {\n-\t\t\t\tself.beforeChange();\n-\t\t\t\tself.typing = true;\n-\t\t\t\tself.add();\n-\t\t\t}\n-\t\t});\n-\n-\t\teditor.onMouseDown.add(function(editor, e) {\n-\t\t\tif (self.typing) {\n-\t\t\t\taddNonTypingUndoLevel();\n-\t\t\t}\n-\t\t});\n-\n-\t\t// Add keyboard shortcuts for undo/redo keys\n-\t\teditor.addShortcut('ctrl+z', 'undo_desc', 'Undo');\n-\t\teditor.addShortcut('ctrl+y', 'redo_desc', 'Redo');\n-\n-\t\tself = {\n-\t\t\t// Explose for debugging reasons\n-\t\t\tdata : data,\n-\n-\t\t\t/**\n-\t\t\t * State if the user is currently typing or not. This will add a typing operation into one undo\n-\t\t\t * level instead of one new level for each keystroke.\n-\t\t\t *\n-\t\t\t * @field {Boolean} typing\n-\t\t\t */\n-\t\t\ttyping : false,\n-\t\t\t\n-\t\t\t/**\n-\t\t\t * This event will fire before a new undo level is added to the undo manager\n-\t\t\t * \n-\t\t\t * @event onBeforeAdd\n-\t\t\t * @param {tinymce.UndoManager} sender UndoManager instance that is going to add the new level\n-\t\t\t * @param {Object} level The new level object containing a bookmark and contents\n-\t\t\t */\n-\t\t\tonBeforeAdd: onBeforeAdd,\n-\n-\t\t\t/**\n-\t\t\t * This event will fire each time a new undo level is added to the undo manager.\n-\t\t\t *\n-\t\t\t * @event onAdd\n-\t\t\t * @param {tinymce.UndoManager} sender UndoManager instance that got the new level.\n-\t\t\t * @param {Object} level The new level object containing a bookmark and contents.\n-\t\t\t */\n-\t\t\tonAdd : onAdd,\n-\n-\t\t\t/**\n-\t\t\t * This event will fire when the user make an undo of a change.\n-\t\t\t *\n-\t\t\t * @event onUndo\n-\t\t\t * @param {tinymce.UndoManager} sender UndoManager instance that got the new level.\n-\t\t\t * @param {Object} level The old level object containing a bookmark and contents.\n-\t\t\t */\n-\t\t\tonUndo : onUndo,\n-\n-\t\t\t/**\n-\t\t\t * This event will fire when the user make an redo of a change.\n-\t\t\t *\n-\t\t\t * @event onRedo\n-\t\t\t * @param {tinymce.UndoManager} sender UndoManager instance that got the new level.\n-\t\t\t * @param {Object} level The old level object containing a bookmark and contents.\n-\t\t\t */\n-\t\t\tonRedo : onRedo,\n-\n-\t\t\t/**\n-\t\t\t * Stores away a bookmark to be used when performing an undo action so that the selection is before\n-\t\t\t * the change has been made.\n-\t\t\t *\n-\t\t\t * @method beforeChange\n-\t\t\t */\n-\t\t\tbeforeChange : function() {\n-\t\t\t\tbeforeBookmark = editor.selection.getBookmark(2, true);\n-\t\t\t},\n-\n-\t\t\t/**\n-\t\t\t * Adds a new undo level/snapshot to the undo list.\n-\t\t\t *\n-\t\t\t * @method add\n-\t\t\t * @param {Object} l Optional undo level object to add.\n-\t\t\t * @return {Object} Undo level that got added or null it a level wasn't needed.\n-\t\t\t */\n-\t\t\tadd : function(level) {\n-\t\t\t\tvar i, settings = editor.settings, lastLevel;\n-\n-\t\t\t\tlevel = level || {};\n-\t\t\t\tlevel.content = getContent();\n-\t\t\t\t\n-\t\t\t\tself.onBeforeAdd.dispatch(self, level);\n-\n-\t\t\t\t// Add undo level if needed\n-\t\t\t\tlastLevel = data[index];\n-\t\t\t\tif (lastLevel && lastLevel.content == level.content)\n-\t\t\t\t\treturn null;\n-\n-\t\t\t\t// Set before bookmark on previous level\n-\t\t\t\tif (data[index])\n-\t\t\t\t\tdata[index].beforeBookmark = beforeBookmark;\n-\n-\t\t\t\t// Time to compress\n-\t\t\t\tif (settings.custom_undo_redo_levels) {\n-\t\t\t\t\tif (data.length > settings.custom_undo_redo_levels) {\n-\t\t\t\t\t\tfor (i = 0; i < data.length - 1; i++)\n-\t\t\t\t\t\t\tdata[i] = data[i + 1];\n-\n-\t\t\t\t\t\tdata.length--;\n-\t\t\t\t\t\tindex = data.length;\n-\t\t\t\t\t}\n-\t\t\t\t}\n-\n-\t\t\t\t// Get a non intrusive normalized bookmark\n-\t\t\t\tlevel.bookmark = editor.selection.getBookmark(2, true);\n-\n-\t\t\t\t// Crop array if needed\n-\t\t\t\tif (index < data.length - 1)\n-\t\t\t\t\tdata.length = index + 1;\n-\n-\t\t\t\tdata.push(level);\n-\t\t\t\tindex = data.length - 1;\n-\n-\t\t\t\tself.onAdd.dispatch(self, level);\n-\t\t\t\teditor.isNotDirty = 0;\n-\n-\t\t\t\treturn level;\n-\t\t\t},\n-\n-\t\t\t/**\n-\t\t\t * Undoes the last action.\n-\t\t\t *\n-\t\t\t * @method undo\n-\t\t\t * @return {Object} Undo level or null if no undo was performed.\n-\t\t\t */\n-\t\t\tundo : function() {\n-\t\t\t\tvar level, i;\n-\n-\t\t\t\tif (self.typing) {\n-\t\t\t\t\tself.add();\n-\t\t\t\t\tself.typing = false;\n-\t\t\t\t}\n-\n-\t\t\t\tif (index > 0) {\n-\t\t\t\t\tlevel = data[--index];\n-\n-\t\t\t\t\teditor.setContent(level.content, {format : 'raw'});\n-\t\t\t\t\teditor.selection.moveToBookmark(level.beforeBookmark);\n-\n-\t\t\t\t\tself.onUndo.dispatch(self, level);\n-\t\t\t\t}\n-\n-\t\t\t\treturn level;\n-\t\t\t},\n-\n-\t\t\t/**\n-\t\t\t * Redoes the last action.\n-\t\t\t *\n-\t\t\t * @method redo\n-\t\t\t * @return {Object} Redo level or null if no redo was performed.\n-\t\t\t */\n-\t\t\tredo : function() {\n-\t\t\t\tvar level;\n-\n-\t\t\t\tif (index < data.length - 1) {\n-\t\t\t\t\tlevel = data[++index];\n-\n-\t\t\t\t\teditor.setContent(level.content, {format : 'raw'});\n-\t\t\t\t\teditor.selection.moveToBookmark(level.bookmark);\n-\n-\t\t\t\t\tself.onRedo.dispatch(self, level);\n-\t\t\t\t}\n-\n-\t\t\t\treturn level;\n-\t\t\t},\n-\n-\t\t\t/**\n-\t\t\t * Removes all undo levels.\n-\t\t\t *\n-\t\t\t * @method clear\n-\t\t\t */\n-\t\t\tclear : function() {\n-\t\t\t\tdata = [];\n-\t\t\t\tindex = 0;\n-\t\t\t\tself.typing = false;\n-\t\t\t},\n-\n-\t\t\t/**\n-\t\t\t * Returns true/false if the undo manager has any undo levels.\n-\t\t\t *\n-\t\t\t * @method hasUndo\n-\t\t\t * @return {Boolean} true/false if the undo manager has any undo levels.\n-\t\t\t */\n-\t\t\thasUndo : function() {\n-\t\t\t\treturn index > 0 || this.typing;\n-\t\t\t},\n-\n-\t\t\t/**\n-\t\t\t * Returns true/false if the undo manager has any redo levels.\n-\t\t\t *\n-\t\t\t * @method hasRedo\n-\t\t\t * @return {Boolean} true/false if the undo manager has any redo levels.\n-\t\t\t */\n-\t\t\thasRedo : function() {\n-\t\t\t\treturn index < data.length - 1 && !this.typing;\n-\t\t\t}\n-\t\t};\n-\n-\t\treturn self;\n-\t};\n-})(tinymce);"
        },
        {
            "filename": "js/tiny_mce/classes/WindowManager.js",
            "diff": "@@ -1,231 +0,0 @@\n-/**\n- * WindowManager.js\n- *\n- * Copyright, Moxiecode Systems AB\n- * Released under LGPL License.\n- *\n- * License: http://www.tinymce.com/license\n- * Contributing: http://www.tinymce.com/contributing\n- */\n-\n-(function(tinymce) {\n-\tvar Dispatcher = tinymce.util.Dispatcher, each = tinymce.each, isIE = tinymce.isIE, isOpera = tinymce.isOpera;\n-\n-\t/**\n-\t * This class handles the creation of native windows and dialogs. This class can be extended to provide for example inline dialogs.\n-\t *\n-\t * @class tinymce.WindowManager\n-\t * @example\n-\t * // Opens a new dialog with the file.htm file and the size 320x240\n-\t * // It also adds a custom parameter this can be retrieved by using tinyMCEPopup.getWindowArg inside the dialog.\n-\t * tinyMCE.activeEditor.windowManager.open({\n-\t *    url : 'file.htm',\n-\t *    width : 320,\n-\t *    height : 240\n-\t * }, {\n-\t *    custom_param : 1\n-\t * });\n-\t * \n-\t * // Displays an alert box using the active editors window manager instance\n-\t * tinyMCE.activeEditor.windowManager.alert('Hello world!');\n-\t * \n-\t * // Displays an confirm box and an alert message will be displayed depending on what you choose in the confirm\n-\t * tinyMCE.activeEditor.windowManager.confirm(\"Do you want to do something\", function(s) {\n-\t *    if (s)\n-\t *       tinyMCE.activeEditor.windowManager.alert(\"Ok\");\n-\t *    else\n-\t *       tinyMCE.activeEditor.windowManager.alert(\"Cancel\");\n-\t * });\n-\t */\n-\ttinymce.create('tinymce.WindowManager', {\n-\t\t/**\n-\t\t * Constructs a new window manager instance.\n-\t\t *\n-\t\t * @constructor\n-\t\t * @method WindowManager\n-\t\t * @param {tinymce.Editor} ed Editor instance that the windows are bound to.\n-\t\t */\n-\t\tWindowManager : function(ed) {\n-\t\t\tvar t = this;\n-\n-\t\t\tt.editor = ed;\n-\t\t\tt.onOpen = new Dispatcher(t);\n-\t\t\tt.onClose = new Dispatcher(t);\n-\t\t\tt.params = {};\n-\t\t\tt.features = {};\n-\t\t},\n-\n-\t\t/**\n-\t\t * Opens a new window.\n-\t\t *\n-\t\t * @method open\n-\t\t * @param {Object} s Optional name/value settings collection contains things like width/height/url etc.\n-\t\t * @option {String} title Window title. \n-\t\t * @option {String} file URL of the file to open in the window. \n-\t\t * @option {Number} width Width in pixels. \n-\t\t * @option {Number} height Height in pixels. \n-\t\t * @option {Boolean} resizable Specifies whether the popup window is resizable or not. \n-\t\t * @option {Boolean} maximizable Specifies whether the popup window has a \"maximize\" button and can get maximized or not. \n-\t\t * @option {Boolean} inline Specifies whether to display in-line (set to 1 or true for in-line display; requires inlinepopups plugin). \n-\t\t * @option {String/Boolean} popup_css Optional CSS to use in the popup. Set to false to remove the default one. \n-\t\t * @option {Boolean} translate_i18n Specifies whether translation should occur or not of i18 key strings. Default is true. \n-\t\t * @option {String/bool} close_previous Specifies whether a previously opened popup window is to be closed or not (like when calling the file browser window over the advlink popup). \n-\t\t * @option {String/bool} scrollbars Specifies whether the popup window can have scrollbars if required (i.e. content larger than the popup size specified). \n-\t\t * @param {Object} p Optional parameters/arguments collection can be used by the dialogs to retrieve custom parameters.\n-\t\t * @option {String} plugin_url url to plugin if opening plugin window that calls tinyMCEPopup.requireLangPack() and needs access to the plugin language js files \n-\t\t */\n-\t\topen : function(s, p) {\n-\t\t\tvar t = this, f = '', x, y, mo = t.editor.settings.dialog_type == 'modal', w, sw, sh, vp = tinymce.DOM.getViewPort(), u;\n-\n-\t\t\t// Default some options\n-\t\t\ts = s || {};\n-\t\t\tp = p || {};\n-\t\t\tsw = isOpera ? vp.w : screen.width; // Opera uses windows inside the Opera window\n-\t\t\tsh = isOpera ? vp.h : screen.height;\n-\t\t\ts.name = s.name || 'mc_' + new Date().getTime();\n-\t\t\ts.width = parseInt(s.width || 320);\n-\t\t\ts.height = parseInt(s.height || 240);\n-\t\t\ts.resizable = true;\n-\t\t\ts.left = s.left || parseInt(sw / 2.0) - (s.width / 2.0);\n-\t\t\ts.top = s.top || parseInt(sh / 2.0) - (s.height / 2.0);\n-\t\t\tp.inline = false;\n-\t\t\tp.mce_width = s.width;\n-\t\t\tp.mce_height = s.height;\n-\t\t\tp.mce_auto_focus = s.auto_focus;\n-\n-\t\t\tif (mo) {\n-\t\t\t\tif (isIE) {\n-\t\t\t\t\ts.center = true;\n-\t\t\t\t\ts.help = false;\n-\t\t\t\t\ts.dialogWidth = s.width + 'px';\n-\t\t\t\t\ts.dialogHeight = s.height + 'px';\n-\t\t\t\t\ts.scroll = s.scrollbars || false;\n-\t\t\t\t}\n-\t\t\t}\n-\n-\t\t\t// Build features string\n-\t\t\teach(s, function(v, k) {\n-\t\t\t\tif (tinymce.is(v, 'boolean'))\n-\t\t\t\t\tv = v ? 'yes' : 'no';\n-\n-\t\t\t\tif (!/^(name|url)$/.test(k)) {\n-\t\t\t\t\tif (isIE && mo)\n-\t\t\t\t\t\tf += (f ? ';' : '') + k + ':' + v;\n-\t\t\t\t\telse\n-\t\t\t\t\t\tf += (f ? ',' : '') + k + '=' + v;\n-\t\t\t\t}\n-\t\t\t});\n-\n-\t\t\tt.features = s;\n-\t\t\tt.params = p;\n-\t\t\tt.onOpen.dispatch(t, s, p);\n-\n-\t\t\tu = s.url || s.file;\n-\t\t\tu = tinymce._addVer(u);\n-\n-\t\t\ttry {\n-\t\t\t\tif (isIE && mo) {\n-\t\t\t\t\tw = 1;\n-\t\t\t\t\twindow.showModalDialog(u, window, f);\n-\t\t\t\t} else\n-\t\t\t\t\tw = window.open(u, s.name, f);\n-\t\t\t} catch (ex) {\n-\t\t\t\t// Ignore\n-\t\t\t}\n-\n-\t\t\tif (!w)\n-\t\t\t\talert(t.editor.getLang('popup_blocked'));\n-\t\t},\n-\n-\t\t/**\n-\t\t * Closes the specified window. This will also dispatch out a onClose event.\n-\t\t *\n-\t\t * @method close\n-\t\t * @param {Window} w Native window object to close.\n-\t\t */\n-\t\tclose : function(w) {\n-\t\t\tw.close();\n-\t\t\tthis.onClose.dispatch(this);\n-\t\t},\n-\n-\t\t/**\n-\t\t * Creates a instance of a class. This method was needed since IE can't create instances\n-\t\t * of classes from a parent window due to some reference problem. Any arguments passed after the class name\n-\t\t * will be passed as arguments to the constructor.\n-\t\t *\n-\t\t * @method createInstance\n-\t\t * @param {String} cl Class name to create an instance of.\n-\t\t * @return {Object} Instance of the specified class.\n-\t\t * @example\n-\t\t * var uri = tinyMCEPopup.editor.windowManager.createInstance('tinymce.util.URI', 'http://www.somesite.com');\n-\t\t * alert(uri.getURI());\n-\t\t */\n-\t\tcreateInstance : function(cl, a, b, c, d, e) {\n-\t\t\tvar f = tinymce.resolve(cl);\n-\n-\t\t\treturn new f(a, b, c, d, e);\n-\t\t},\n-\n-\t\t/**\n-\t\t * Creates a confirm dialog. Please don't use the blocking behavior of this\n-\t\t * native version use the callback method instead then it can be extended.\n-\t\t *\n-\t\t * @method confirm\n-\t\t * @param {String} t Title for the new confirm dialog.\n-\t\t * @param {function} cb Callback function to be executed after the user has selected ok or cancel.\n-\t\t * @param {Object} s Optional scope to execute the callback in.\n-\t\t * @example\n-\t\t * // Displays an confirm box and an alert message will be displayed depending on what you choose in the confirm\n-\t\t * tinyMCE.activeEditor.windowManager.confirm(\"Do you want to do something\", function(s) {\n-\t\t *    if (s)\n-\t\t *       tinyMCE.activeEditor.windowManager.alert(\"Ok\");\n-\t\t *    else\n-\t\t *       tinyMCE.activeEditor.windowManager.alert(\"Cancel\");\n-\t\t * });\n-\t\t */\n-\t\tconfirm : function(t, cb, s, w) {\n-\t\t\tw = w || window;\n-\n-\t\t\tcb.call(s || this, w.confirm(this._decode(this.editor.getLang(t, t))));\n-\t\t},\n-\n-\t\t/**\n-\t\t * Creates a alert dialog. Please don't use the blocking behavior of this\n-\t\t * native version use the callback method instead then it can be extended.\n-\t\t *\n-\t\t * @method alert\n-\t\t * @param {String} t Title for the new alert dialog.\n-\t\t * @param {function} cb Callback function to be executed after the user has selected ok.\n-\t\t * @param {Object} s Optional scope to execute the callback in.\n-\t\t * @example\n-\t\t * // Displays an alert box using the active editors window manager instance\n-\t\t * tinyMCE.activeEditor.windowManager.alert('Hello world!');\n-\t\t */\n-\t\talert : function(tx, cb, s, w) {\n-\t\t\tvar t = this;\n-\n-\t\t\tw = w || window;\n-\t\t\tw.alert(t._decode(t.editor.getLang(tx, tx)));\n-\n-\t\t\tif (cb)\n-\t\t\t\tcb.call(s || t);\n-\t\t},\n-\n-\t\t/**\n-\t\t * Resizes the specified window or id.\n-\t\t *\n-\t\t * @param {Number} dw Delta width.\n-\t\t * @param {Number} dh Delta height.\n-\t\t * @param {window/id} win Window if the dialog isn't inline. Id if the dialog is inline.\n-\t\t */\n-\t\tresizeBy : function(dw, dh, win) {\n-\t\t\twin.resizeBy(dw, dh);\n-\t\t},\n-\n-\t\t// Internal functions\n-\n-\t\t_decode : function(s) {\n-\t\t\treturn tinymce.DOM.decode(s).replace(/\\\\n/g, '\\n');\n-\t\t}\n-\t});\n-}(tinymce));\n\\ No newline at end of file"
        },
        {
            "filename": "js/tiny_mce/classes/adapter/jquery/adapter.js",
            "diff": "@@ -1,323 +0,0 @@\n-/**\n- * adapter.js\n- *\n- * Copyright, Moxiecode Systems AB\n- * Released under LGPL License.\n- *\n- * License: http://www.tinymce.com/license\n- * Contributing: http://www.tinymce.com/contributing\n- */\n-\n-// #ifdef jquery_adapter\n-\n-(function($, tinymce) {\n-\tvar is = tinymce.is, attrRegExp = /^(href|src|style)$/i, undef;\n-\n-\t// jQuery is undefined\n-\tif (!$ && window.console) {\n-\t\treturn console.log(\"Load jQuery first!\");\n-\t}\n-\n-\t// Stick jQuery into the tinymce namespace\n-\ttinymce.$ = $;\n-\n-\t// Setup adapter\n-\ttinymce.adapter = {\n-\t\tpatchEditor : function(editor) {\n-\t\t\tvar fn = $.fn;\n-\n-\t\t\t// Adapt the css function to make sure that the data-mce-style\n-\t\t\t// attribute gets updated with the new style information\n-\t\t\tfunction css(name, value) {\n-\t\t\t\tvar self = this;\n-\n-\t\t\t\t// Remove data-mce-style when set operation occurs\n-\t\t\t\tif (value)\n-\t\t\t\t\tself.removeAttr('data-mce-style');\n-\n-\t\t\t\treturn fn.css.apply(self, arguments);\n-\t\t\t};\n-\n-\t\t\t// Apapt the attr function to make sure that it uses the data-mce- prefixed variants\n-\t\t\tfunction attr(name, value) {\n-\t\t\t\tvar self = this;\n-\n-\t\t\t\t// Update/retrieve data-mce- attribute variants\n-\t\t\t\tif (attrRegExp.test(name)) {\n-\t\t\t\t\tif (value !== undef) {\n-\t\t\t\t\t\t// Use TinyMCE behavior when setting the specifc attributes\n-\t\t\t\t\t\tself.each(function(i, node) {\n-\t\t\t\t\t\t\teditor.dom.setAttrib(node, name, value);\n-\t\t\t\t\t\t});\n-\n-\t\t\t\t\t\treturn self;\n-\t\t\t\t\t} else\n-\t\t\t\t\t\treturn self.attr('data-mce-' + name);\n-\t\t\t\t}\n-\n-\t\t\t\t// Default behavior\n-\t\t\t\treturn fn.attr.apply(self, arguments);\n-\t\t\t};\n-\n-\t\t\t// Patch various jQuery functions to handle tinymce specific attribute and content behavior\n-\t\t\t// we don't patch the jQuery.fn directly since it will most likely break compatibility\n-\t\t\t// with other jQuery logic on the page. Only instances created by TinyMCE should be patched.\n-\t\t\tfunction patch(jq) {\n-\t\t\t\t// Patch some functions, only patch the object once\n-\t\t\t\tif (jq.css !== css) {\n-\t\t\t\t\t// Patch css/attr to use the data-mce- prefixed attribute variants\n-\t\t\t\t\tjq.css = css;\n-\t\t\t\t\tjq.attr = attr;\n-\n-\t\t\t\t\tjq.tinymce = editor;\n-\n-\t\t\t\t\t// Each pushed jQuery instance needs to be patched\n-\t\t\t\t\t// as well for example when traversing the DOM\n-\t\t\t\t\tjq.pushStack = function() {\n-\t\t\t\t\t\treturn patch(fn.pushStack.apply(this, arguments));\n-\t\t\t\t\t};\n-\t\t\t\t}\n-\n-\t\t\t\treturn jq;\n-\t\t\t};\n-\n-\t\t\t// Add a $ function on each editor instance this one is scoped for the editor document object\n-\t\t\t// this way you can do chaining like this tinymce.get(0).$('p').append('text').css('color', 'red');\n-\t\t\teditor.$ = function(selector, scope) {\n-\t\t\t\tvar doc = editor.getDoc();\n-\n-\t\t\t\treturn patch($(selector || doc, doc || scope));\n-\t\t\t};\n-\t\t}\n-\t};\n-\n-\t// Patch in core NS functions\n-\ttinymce.extend = $.extend;\n-\ttinymce.extend(tinymce, {\n-\t\tmap : $.map,\n-\t\tgrep : function(a, f) {return $.grep(a, f || function(){return 1;});},\n-\t\tinArray : function(a, v) {return $.inArray(v, a || []);}\n-\n-\t\t/* Didn't iterate stylesheets\n-\t\teach : function(o, cb, s) {\n-\t\t\tif (!o)\n-\t\t\t\treturn 0;\n-\n-\t\t\tvar r = 1;\n-\n-\t\t\t$.each(o, function(nr, el){\n-\t\t\t\tif (cb.call(s, el, nr, o) === false) {\n-\t\t\t\t\tr = 0;\n-\t\t\t\t\treturn false;\n-\t\t\t\t}\n-\t\t\t});\n-\n-\t\t\treturn r;\n-\t\t}*/\n-\t});\n-\n-\t// Patch in functions in various clases\n-\t// Add a \"#ifndefjquery\" statement around each core API function you add below\n-\tvar patches = {\n-\t\t'tinymce.dom.DOMUtils' : {\n-\t\t\t/*\n-\t\t\taddClass : function(e, c) {\n-\t\t\t\tif (is(e, 'array') && is(e[0], 'string'))\n-\t\t\t\t\te = e.join(',#');\n-\t\t\t\treturn (e && $(is(e, 'string') ? '#' + e : e)\n-\t\t\t\t\t.addClass(c)\n-\t\t\t\t\t.attr('class')) || false;\n-\t\t\t},\n-\n-\t\t\thasClass : function(n, c) {\n-\t\t\t\treturn $(is(n, 'string') ? '#' + n : n).hasClass(c);\n-\t\t\t},\n-\n-\t\t\tremoveClass : function(e, c) {\n-\t\t\t\tif (!e)\n-\t\t\t\t\treturn false;\n-\n-\t\t\t\tvar r = [];\n-\n-\t\t\t\t$(is(e, 'string') ? '#' + e : e)\n-\t\t\t\t\t.removeClass(c)\n-\t\t\t\t\t.each(function(){\n-\t\t\t\t\t\tr.push(this.className);\n-\t\t\t\t\t});\n-\n-\t\t\t\treturn r.length == 1 ? r[0] : r;\n-\t\t\t},\n-\t\t\t*/\n-\n-\t\t\tselect : function(pattern, scope) {\n-\t\t\t\tvar t = this;\n-\n-\t\t\t\treturn $.find(pattern, t.get(scope) || t.get(t.settings.root_element) || t.doc, []);\n-\t\t\t},\n-\n-\t\t\tis : function(n, patt) {\n-\t\t\t\t// Simple all selector, jQuery 1.8 and above returns true for text nodes, different from previous versions\n-\t\t\t\tif (n.nodeType !== 1 && patt === '*') {\n-\t\t\t\t\treturn false;\n-\t\t\t\t}\n-\n-\t\t\t\treturn $(this.get(n)).is(patt);\n-\t\t\t}\n-\n-\t\t\t/*\n-\t\t\tshow : function(e) {\n-\t\t\t\tif (is(e, 'array') && is(e[0], 'string'))\n-\t\t\t\t\te = e.join(',#');\n-\n-\t\t\t\t$(is(e, 'string') ? '#' + e : e).css('display', 'block');\n-\t\t\t},\n-\n-\t\t\thide : function(e) {\n-\t\t\t\tif (is(e, 'array') && is(e[0], 'string'))\n-\t\t\t\t\te = e.join(',#');\n-\n-\t\t\t\t$(is(e, 'string') ? '#' + e : e).css('display', 'none');\n-\t\t\t},\n-\n-\t\t\tisHidden : function(e) {\n-\t\t\t\treturn $(is(e, 'string') ? '#' + e : e).is(':hidden');\n-\t\t\t},\n-\n-\t\t\tinsertAfter : function(n, e) {\n-\t\t\t\treturn $(is(e, 'string') ? '#' + e : e).after(n);\n-\t\t\t},\n-\n-\t\t\treplace : function(o, n, k) {\n-\t\t\t\tn = $(is(n, 'string') ? '#' + n : n);\n-\n-\t\t\t\tif (k)\n-\t\t\t\t\tn.children().appendTo(o);\n-\n-\t\t\t\tn.replaceWith(o);\n-\t\t\t},\n-\n-\t\t\tsetStyle : function(n, na, v) {\n-\t\t\t\tif (is(n, 'array') && is(n[0], 'string'))\n-\t\t\t\t\tn = n.join(',#');\n-\n-\t\t\t\t$(is(n, 'string') ? '#' + n : n).css(na, v);\n-\t\t\t},\n-\n-\t\t\tgetStyle : function(n, na, c) {\n-\t\t\t\treturn $(is(n, 'string') ? '#' + n : n).css(na);\n-\t\t\t},\n-\n-\t\t\tsetStyles : function(e, o) {\n-\t\t\t\tif (is(e, 'array') && is(e[0], 'string'))\n-\t\t\t\t\te = e.join(',#');\n-\t\t\t\t$(is(e, 'string') ? '#' + e : e).css(o);\n-\t\t\t},\n-\n-\t\t\tsetAttrib : function(e, n, v) {\n-\t\t\t\tvar t = this, s = t.settings;\n-\n-\t\t\t\tif (is(e, 'array') && is(e[0], 'string'))\n-\t\t\t\t\te = e.join(',#');\n-\n-\t\t\t\te = $(is(e, 'string') ? '#' + e : e);\n-\n-\t\t\t\tswitch (n) {\n-\t\t\t\t\tcase \"style\":\n-\t\t\t\t\t\te.each(function(i, v){\n-\t\t\t\t\t\t\tif (s.keep_values)\n-\t\t\t\t\t\t\t\t$(v).attr('data-mce-style', v);\n-\n-\t\t\t\t\t\t\tv.style.cssText = v;\n-\t\t\t\t\t\t});\n-\t\t\t\t\t\tbreak;\n-\n-\t\t\t\t\tcase \"class\":\n-\t\t\t\t\t\te.each(function(){\n-\t\t\t\t\t\t\tthis.className = v;\n-\t\t\t\t\t\t});\n-\t\t\t\t\t\tbreak;\n-\n-\t\t\t\t\tcase \"src\":\n-\t\t\t\t\tcase \"href\":\n-\t\t\t\t\t\te.each(function(i, v){\n-\t\t\t\t\t\t\tif (s.keep_values) {\n-\t\t\t\t\t\t\t\tif (s.url_converter)\n-\t\t\t\t\t\t\t\t\tv = s.url_converter.call(s.url_converter_scope || t, v, n, v);\n-\n-\t\t\t\t\t\t\t\tt.setAttrib(v, 'data-mce-' + n, v);\n-\t\t\t\t\t\t\t}\n-\t\t\t\t\t\t});\n-\n-\t\t\t\t\t\tbreak;\n-\t\t\t\t}\n-\n-\t\t\t\tif (v !== null && v.length !== 0)\n-\t\t\t\t\te.attr(n, '' + v);\n-\t\t\t\telse\n-\t\t\t\t\te.removeAttr(n);\n-\t\t\t},\n-\n-\t\t\tsetAttribs : function(e, o) {\n-\t\t\t\tvar t = this;\n-\n-\t\t\t\t$.each(o, function(n, v){\n-\t\t\t\t\tt.setAttrib(e,n,v);\n-\t\t\t\t});\n-\t\t\t}\n-\t\t\t*/\n-\t\t}\n-\n-/*\n-\t\t'tinymce.dom.Event' : {\n-\t\t\tadd : function (o, n, f, s) {\n-\t\t\t\tvar lo, cb;\n-\n-\t\t\t\tcb = function(e) {\n-\t\t\t\t\te.target = e.target || this;\n-\t\t\t\t\tf.call(s || this, e);\n-\t\t\t\t};\n-\n-\t\t\t\tif (is(o, 'array') && is(o[0], 'string'))\n-\t\t\t\t\to = o.join(',#');\n-\t\t\t\to = $(is(o, 'string') ? '#' + o : o);\n-\t\t\t\tif (n == 'init') {\n-\t\t\t\t\to.ready(cb, s);\n-\t\t\t\t} else {\n-\t\t\t\t\tif (s) {\n-\t\t\t\t\t\to.bind(n, s, cb);\n-\t\t\t\t\t} else {\n-\t\t\t\t\t\to.bind(n, cb);\n-\t\t\t\t\t}\n-\t\t\t\t}\n-\n-\t\t\t\tlo = this._jqLookup || (this._jqLookup = []);\n-\t\t\t\tlo.push({func : f, cfunc : cb});\n-\n-\t\t\t\treturn cb;\n-\t\t\t},\n-\n-\t\t\tremove : function(o, n, f) {\n-\t\t\t\t// Find cfunc\n-\t\t\t\t$(this._jqLookup).each(function() {\n-\t\t\t\t\tif (this.func === f)\n-\t\t\t\t\t\tf = this.cfunc;\n-\t\t\t\t});\n-\n-\t\t\t\tif (is(o, 'array') && is(o[0], 'string'))\n-\t\t\t\t\to = o.join(',#');\n-\n-\t\t\t\t$(is(o, 'string') ? '#' + o : o).unbind(n,f);\n-\n-\t\t\t\treturn true;\n-\t\t\t}\n-\t\t}\n-*/\n-\t};\n-\n-\t// Patch functions after a class is created\n-\ttinymce.onCreate = function(ty, c, p) {\n-\t\ttinymce.extend(p, patches[c]);\n-\t};\n-})(window.jQuery, tinymce);\n-\n-// #endif"
        },
        {
            "filename": "js/tiny_mce/classes/adapter/jquery/jquery.tinymce.js",
            "diff": "@@ -1,341 +0,0 @@\n-/**\n- * jquery.tinymce.js\n- *\n- * Copyright, Moxiecode Systems AB\n- * Released under LGPL License.\n- *\n- * License: http://www.tinymce.com/license\n- * Contributing: http://www.tinymce.com/contributing\n- */\n-\n-(function($) {\n-\tvar undef,\n-\t\tlazyLoading,\n-\t\tdelayedInits = [],\n-\t\twin = window;\n-\n-\t$.fn.tinymce = function(settings) {\n-\t\tvar self = this, url, ed, base, pos, lang, query = \"\", suffix = \"\";\n-\n-\t\t// No match then just ignore the call\n-\t\tif (!self.length)\n-\t\t\treturn self;\n-\n-\t\t// Get editor instance\n-\t\tif (!settings)\n-\t\t\treturn tinyMCE.get(self[0].id);\n-\n-\t\tself.css('visibility', 'hidden'); // Hide textarea to avoid flicker\n-\n-\t\tfunction init() {\n-\t\t\tvar editors = [], initCount = 0;\n-\n-\t\t\t// Apply patches to the jQuery object, only once\n-\t\t\tif (applyPatch) {\n-\t\t\t\tapplyPatch();\n-\t\t\t\tapplyPatch = null;\n-\t\t\t}\n-\n-\t\t\t// Create an editor instance for each matched node\n-\t\t\tself.each(function(i, node) {\n-\t\t\t\tvar ed, id = node.id, oninit = settings.oninit;\n-\n-\t\t\t\t// Generate unique id for target element if needed\n-\t\t\t\tif (!id)\n-\t\t\t\t\tnode.id = id = tinymce.DOM.uniqueId();\n-\n-\t\t\t\t// Create editor instance and render it\n-\t\t\t\ted = new tinymce.Editor(id, settings);\n-\t\t\t\teditors.push(ed);\n-\n-\t\t\t\ted.onInit.add(function() {\n-\t\t\t\t\tvar scope, func = oninit;\n-\n-\t\t\t\t\tself.css('visibility', '');\n-\n-\t\t\t\t\t// Run this if the oninit setting is defined\n-\t\t\t\t\t// this logic will fire the oninit callback ones each\n-\t\t\t\t\t// matched editor instance is initialized\n-\t\t\t\t\tif (oninit) {\n-\t\t\t\t\t\t// Fire the oninit event ones each editor instance is initialized\n-\t\t\t\t\t\tif (++initCount == editors.length) {\n-\t\t\t\t\t\t\tif (tinymce.is(func, \"string\")) {\n-\t\t\t\t\t\t\t\tscope = (func.indexOf(\".\") === -1) ? null : tinymce.resolve(func.replace(/\\.\\w+$/, \"\"));\n-\t\t\t\t\t\t\t\tfunc = tinymce.resolve(func);\n-\t\t\t\t\t\t\t}\n-\n-\t\t\t\t\t\t\t// Call the oninit function with the object\n-\t\t\t\t\t\t\tfunc.apply(scope || tinymce, editors);\n-\t\t\t\t\t\t}\n-\t\t\t\t\t}\n-\t\t\t\t});\n-\t\t\t});\n-\n-\t\t\t// Render the editor instances in a separate loop since we\n-\t\t\t// need to have the full editors array used in the onInit calls\n-\t\t\t$.each(editors, function(i, ed) {\n-\t\t\t\ted.render();\n-\t\t\t});\n-\t\t}\n-\n-\t\t// Load TinyMCE on demand, if we need to\n-\t\tif (!win.tinymce && !lazyLoading && (url = settings.script_url)) {\n-\t\t\tlazyLoading = 1;\n-\t\t\tbase = url.substring(0, url.lastIndexOf(\"/\"));\n-\n-\t\t\t// Check if it's a dev/src version they want to load then\n-\t\t\t// make sure that all plugins, themes etc are loaded in source mode aswell\n-\t\t\tif (/_(src|dev)\\.js/g.test(url))\n-\t\t\t\tsuffix = \"_src\";\n-\n-\t\t\t// Parse out query part, this will be appended to all scripts, css etc to clear browser cache\n-\t\t\tpos = url.lastIndexOf(\"?\");\n-\t\t\tif (pos != -1)\n-\t\t\t\tquery = url.substring(pos + 1);\n-\n-\t\t\t// Setup tinyMCEPreInit object this will later be used by the TinyMCE\n-\t\t\t// core script to locate other resources like CSS files, dialogs etc\n-\t\t\t// You can also predefined a tinyMCEPreInit object and then it will use that instead\n-\t\t\twin.tinyMCEPreInit = win.tinyMCEPreInit || {\n-\t\t\t\tbase : base,\n-\t\t\t\tsuffix : suffix,\n-\t\t\t\tquery : query\n-\t\t\t};\n-\n-\t\t\t// url contains gzip then we assume it's a compressor\n-\t\t\tif (url.indexOf('gzip') != -1) {\n-\t\t\t\tlang = settings.language || \"en\";\n-\t\t\t\turl = url + (/\\?/.test(url) ? '&' : '?') + \"js=true&core=true&suffix=\" + escape(suffix) + \"&themes=\" + escape(settings.theme) + \"&plugins=\" + escape(settings.plugins) + \"&languages=\" + lang;\n-\n-\t\t\t\t// Check if compressor script is already loaded otherwise setup a basic one\n-\t\t\t\tif (!win.tinyMCE_GZ) {\n-\t\t\t\t\ttinyMCE_GZ = {\n-\t\t\t\t\t\tstart : function() {\n-\t\t\t\t\t\t\ttinymce.suffix = suffix;\n-\n-\t\t\t\t\t\t\tfunction load(url) {\n-\t\t\t\t\t\t\t\ttinymce.ScriptLoader.markDone(tinyMCE.baseURI.toAbsolute(url));\n-\t\t\t\t\t\t\t}\n-\n-\t\t\t\t\t\t\t// Add core languages\n-\t\t\t\t\t\t\tload(\"langs/\" + lang + \".js\");\n-\n-\t\t\t\t\t\t\t// Add themes with languages\n-\t\t\t\t\t\t\tload(\"themes/\" + settings.theme + \"/editor_template\" + suffix + \".js\");\n-\t\t\t\t\t\t\tload(\"themes/\" + settings.theme + \"/langs/\" + lang + \".js\");\n-\n-\t\t\t\t\t\t\t// Add plugins with languages\n-\t\t\t\t\t\t\t$.each(settings.plugins.split(\",\"), function(i, name) {\n-\t\t\t\t\t\t\t\tif (name) {\n-\t\t\t\t\t\t\t\t\tload(\"plugins/\" + name + \"/editor_plugin\" + suffix + \".js\");\n-\t\t\t\t\t\t\t\t\tload(\"plugins/\" + name + \"/langs/\" + lang + \".js\");\n-\t\t\t\t\t\t\t\t}\n-\t\t\t\t\t\t\t});\n-\t\t\t\t\t\t},\n-\n-\t\t\t\t\t\tend : function() {\n-\t\t\t\t\t\t}\n-\t\t\t\t\t}\n-\t\t\t\t}\n-\t\t\t}\n-\n-\t\t\t// Load the script cached and execute the inits once it's done\n-\t\t\t$.ajax({\n-\t\t\t\ttype : \"GET\",\n-\t\t\t\turl : url,\n-\t\t\t\tdataType : \"script\",\n-\t\t\t\tcache : true,\n-\t\t\t\tsuccess : function() {\n-\t\t\t\t\ttinymce.dom.Event.domLoaded = 1;\n-\t\t\t\t\tlazyLoading = 2;\n-\n-\t\t\t\t\t// Execute callback after mainscript has been loaded and before the initialization occurs\n-\t\t\t\t\tif (settings.script_loaded)\n-\t\t\t\t\t\tsettings.script_loaded();\n-\n-\t\t\t\t\tinit();\n-\n-\t\t\t\t\t$.each(delayedInits, function(i, init) {\n-\t\t\t\t\t\tinit();\n-\t\t\t\t\t});\n-\t\t\t\t}\n-\t\t\t});\n-\t\t} else {\n-\t\t\t// Delay the init call until tinymce is loaded\n-\t\t\tif (lazyLoading === 1)\n-\t\t\t\tdelayedInits.push(init);\n-\t\t\telse\n-\t\t\t\tinit();\n-\t\t}\n-\n-\t\treturn self;\n-\t};\n-\n-\t// Add :tinymce psuedo selector this will select elements that has been converted into editor instances\n-\t// it's now possible to use things like $('*:tinymce') to get all TinyMCE bound elements.\n-\t$.extend($.expr[\":\"], {\n-\t\ttinymce : function(e) {\n-\t\t\treturn !!(e.id && \"tinyMCE\" in window && tinyMCE.get(e.id));\n-\t\t}\n-\t});\n-\n-\t// This function patches internal jQuery functions so that if\n-\t// you for example remove an div element containing an editor it's\n-\t// automatically destroyed by the TinyMCE API\n-\tfunction applyPatch() {\n-\t\t// Removes any child editor instances by looking for editor wrapper elements\n-\t\tfunction removeEditors(name) {\n-\t\t\t// If the function is remove\n-\t\t\tif (name === \"remove\") {\n-\t\t\t\tthis.each(function(i, node) {\n-\t\t\t\t\tvar ed = tinyMCEInstance(node);\n-\n-\t\t\t\t\tif (ed)\n-\t\t\t\t\t\ted.remove();\n-\t\t\t\t});\n-\t\t\t}\n-\n-\t\t\tthis.find(\"span.mceEditor,div.mceEditor\").each(function(i, node) {\n-\t\t\t\tvar ed = tinyMCE.get(node.id.replace(/_parent$/, \"\"));\n-\n-\t\t\t\tif (ed)\n-\t\t\t\t\ted.remove();\n-\t\t\t});\n-\t\t}\n-\n-\t\t// Loads or saves contents from/to textarea if the value\n-\t\t// argument is defined it will set the TinyMCE internal contents\n-\t\tfunction loadOrSave(value) {\n-\t\t\tvar self = this, ed;\n-\n-\t\t\t// Handle set value\n-\t\t\tif (value !== undef) {\n-\t\t\t\tremoveEditors.call(self);\n-\n-\t\t\t\t// Saves the contents before get/set value of textarea/div\n-\t\t\t\tself.each(function(i, node) {\n-\t\t\t\t\tvar ed;\n-\n-\t\t\t\t\tif (ed = tinyMCE.get(node.id))\n-\t\t\t\t\t\ted.setContent(value);\n-\t\t\t\t});\n-\t\t\t} else if (self.length > 0) {\n-\t\t\t\t// Handle get value\n-\t\t\t\tif (ed = tinyMCE.get(self[0].id))\n-\t\t\t\t\treturn ed.getContent();\n-\t\t\t}\n-\t\t}\n-\n-\t\t// Returns tinymce instance for the specified element or null if it wasn't found\n-\t\tfunction tinyMCEInstance(element) {\n-\t\t\tvar ed = null;\n-\n-\t\t\t(element) && (element.id) && (win.tinymce) && (ed = tinyMCE.get(element.id));\n-\n-\t\t\treturn ed;\n-\t\t}\n-\n-\t\t// Checks if the specified set contains tinymce instances\n-\t\tfunction containsTinyMCE(matchedSet) {\n-\t\t\treturn !!((matchedSet) && (matchedSet.length) && (win.tinymce) && (matchedSet.is(\":tinymce\")));\n-\t\t}\n-\n-\t\t// Patch various jQuery functions\n-\t\tvar jQueryFn = {};\n-\n-\t\t// Patch some setter/getter functions these will\n-\t\t// now be able to set/get the contents of editor instances for\n-\t\t// example $('#editorid').html('Content'); will update the TinyMCE iframe instance\n-\t\t$.each([\"text\", \"html\", \"val\"], function(i, name) {\n-\t\t\tvar origFn = jQueryFn[name] = $.fn[name],\n-\t\t\t\ttextProc = (name === \"text\");\n-\n-\t\t\t $.fn[name] = function(value) {\n-\t\t\t\tvar self = this;\n-\n-\t\t\t\tif (!containsTinyMCE(self))\n-\t\t\t\t\treturn origFn.apply(self, arguments);\n-\n-\t\t\t\tif (value !== undef) {\n-\t\t\t\t\tloadOrSave.call(self.filter(\":tinymce\"), value);\n-\t\t\t\t\torigFn.apply(self.not(\":tinymce\"), arguments);\n-\n-\t\t\t\t\treturn self; // return original set for chaining\n-\t\t\t\t} else {\n-\t\t\t\t\tvar ret = \"\";\n-\t\t\t\t\tvar args = arguments;\n-\t\t\t\t\t\n-\t\t\t\t\t(textProc ? self : self.eq(0)).each(function(i, node) {\n-\t\t\t\t\t\tvar ed = tinyMCEInstance(node);\n-\n-\t\t\t\t\t\tret += ed ? (textProc ? ed.getContent().replace(/<(?:\"[^\"]*\"|'[^']*'|[^'\">])*>/g, \"\") : ed.getContent({save: true})) : origFn.apply($(node), args);\n-\t\t\t\t\t});\n-\n-\t\t\t\t\treturn ret;\n-\t\t\t\t}\n-\t\t\t };\n-\t\t});\n-\n-\t\t// Makes it possible to use $('#id').append(\"content\"); to append contents to the TinyMCE editor iframe\n-\t\t$.each([\"append\", \"prepend\"], function(i, name) {\n-\t\t\tvar origFn = jQueryFn[name] = $.fn[name],\n-\t\t\t\tprepend = (name === \"prepend\");\n-\n-\t\t\t $.fn[name] = function(value) {\n-\t\t\t\tvar self = this;\n-\n-\t\t\t\tif (!containsTinyMCE(self))\n-\t\t\t\t\treturn origFn.apply(self, arguments);\n-\n-\t\t\t\tif (value !== undef) {\n-\t\t\t\t\tself.filter(\":tinymce\").each(function(i, node) {\n-\t\t\t\t\t\tvar ed = tinyMCEInstance(node);\n-\n-\t\t\t\t\t\ted && ed.setContent(prepend ? value + ed.getContent() : ed.getContent() + value);\n-\t\t\t\t\t});\n-\n-\t\t\t\t\torigFn.apply(self.not(\":tinymce\"), arguments);\n-\n-\t\t\t\t\treturn self; // return original set for chaining\n-\t\t\t\t}\n-\t\t\t };\n-\t\t});\n-\n-\t\t// Makes sure that the editor instance gets properly destroyed when the parent element is removed\n-\t\t$.each([\"remove\", \"replaceWith\", \"replaceAll\", \"empty\"], function(i, name) {\n-\t\t\tvar origFn = jQueryFn[name] = $.fn[name];\n-\n-\t\t\t$.fn[name] = function() {\n-\t\t\t\tremoveEditors.call(this, name);\n-\n-\t\t\t\treturn origFn.apply(this, arguments);\n-\t\t\t};\n-\t\t});\n-\n-\t\tjQueryFn.attr = $.fn.attr;\n-\n-\t\t// Makes sure that $('#tinymce_id').attr('value') gets the editors current HTML contents\n-\t\t$.fn.attr = function(name, value) {\n-\t\t\tvar self = this, args = arguments;\n-\n-\t\t\tif ((!name) || (name !== \"value\") || (!containsTinyMCE(self))) {\n-\t\t\t\tif (value !== undef) {\n-\t\t\t\t\treturn jQueryFn.attr.apply(self, args);\n-\t\t\t\t} else {\n-\t\t\t\t\treturn jQueryFn.attr.apply(self, args);\n-\t\t\t\t}\n-\t\t\t}\n-\n-\t\t\tif (value !== undef) {\n-\t\t\t\tloadOrSave.call(self.filter(\":tinymce\"), value);\n-\t\t\t\tjQueryFn.attr.apply(self.not(\":tinymce\"), args);\n-\n-\t\t\t\treturn self; // return original set for chaining\n-\t\t\t} else {\n-\t\t\t\tvar node = self[0], ed = tinyMCEInstance(node);\n-\n-\t\t\t\treturn ed ? ed.getContent({save: true}) : jQueryFn.attr.apply($(node), args);\n-\t\t\t}\n-\t\t};\n-\t}\n-})(jQuery);\n\\ No newline at end of file"
        },
        {
            "filename": "js/tiny_mce/classes/adapter/prototype/adapter.js",
            "diff": "@@ -1,39 +0,0 @@\n-/**\n- * adapter.js\n- *\n- * Copyright, Moxiecode Systems AB\n- * Released under LGPL License.\n- *\n- * License: http://www.tinymce.com/license\n- * Contributing: http://www.tinymce.com/contributing\n- */\n-\n-// #ifdef prototype_adapter\n-\n-(function() {\n-\tif (!window.Prototype)\n-\t\treturn alert(\"Load prototype first!\");\n-\n-\t// Patch in core NS functions\n-\ttinymce.extend(tinymce, {\n-\t\ttrim : function(s) {return s ? s.strip() : '';},\n-\t\tinArray : function(a, v) {return a && a.indexOf ? a.indexOf(v) : -1;}\n-\t});\n-\n-\t// Patch in functions in various clases\n-\t// Add a \"#ifndefjquery\" statement around each core API function you add below\n-\tvar patches = {\n-\t\t'tinymce.util.JSON' : {\n-\t\t\t/*serialize : function(o) {\n-\t\t\t\treturn o.toJSON();\n-\t\t\t}*/\n-\t\t}\n-\t};\n-\n-\t// Patch functions after a class is created\n-\ttinymce.onCreate = function(ty, c, p) {\n-\t\ttinymce.extend(p, patches[c]);\n-\t};\n-})();\n-\n-// #endif"
        },
        {
            "filename": "js/tiny_mce/classes/dom/DOMUtils.js",
            "diff": "@@ -1,2001 +0,0 @@\n-/**\n- * DOMUtils.js\n- *\n- * Copyright, Moxiecode Systems AB\n- * Released under LGPL License.\n- *\n- * License: http://www.tinymce.com/license\n- * Contributing: http://www.tinymce.com/contributing\n- */\n-\n-(function(tinymce) {\n-\t// Shorten names\n-\tvar each = tinymce.each,\n-\t\tis = tinymce.is,\n-\t\tisWebKit = tinymce.isWebKit,\n-\t\tisIE = tinymce.isIE,\n-\t\tEntities = tinymce.html.Entities,\n-\t\tsimpleSelectorRe = /^([a-z0-9],?)+$/i,\n-\t\twhiteSpaceRegExp = /^[ \\t\\r\\n]*$/;\n-\n-\t/**\n-\t * Utility class for various DOM manipulation and retrival functions.\n-\t *\n-\t * @class tinymce.dom.DOMUtils\n-\t * @example\n-\t * // Add a class to an element by id in the page\n-\t * tinymce.DOM.addClass('someid', 'someclass');\n-\t *\n-\t * // Add a class to an element by id inside the editor\n-\t * tinyMCE.activeEditor.dom.addClass('someid', 'someclass');\n-\t */\n-\ttinymce.create('tinymce.dom.DOMUtils', {\n-\t\tdoc : null,\n-\t\troot : null,\n-\t\tfiles : null,\n-\t\tpixelStyles : /^(top|left|bottom|right|width|height|borderWidth)$/,\n-\t\tprops : {\n-\t\t\t\"for\" : \"htmlFor\",\n-\t\t\t\"class\" : \"className\",\n-\t\t\tclassName : \"className\",\n-\t\t\tchecked : \"checked\",\n-\t\t\tdisabled : \"disabled\",\n-\t\t\tmaxlength : \"maxLength\",\n-\t\t\treadonly : \"readOnly\",\n-\t\t\tselected : \"selected\",\n-\t\t\tvalue : \"value\",\n-\t\t\tid : \"id\",\n-\t\t\tname : \"name\",\n-\t\t\ttype : \"type\"\n-\t\t},\n-\n-\t\t/**\n-\t\t * Constructs a new DOMUtils instance. Consult the Wiki for more details on settings etc for this class.\n-\t\t *\n-\t\t * @constructor\n-\t\t * @method DOMUtils\n-\t\t * @param {Document} d Document reference to bind the utility class to.\n-\t\t * @param {settings} s Optional settings collection.\n-\t\t */\n-\t\tDOMUtils : function(d, s) {\n-\t\t\tvar t = this, globalStyle, name, blockElementsMap;\n-\n-\t\t\tt.doc = d;\n-\t\t\tt.win = window;\n-\t\t\tt.files = {};\n-\t\t\tt.cssFlicker = false;\n-\t\t\tt.counter = 0;\n-\t\t\tt.stdMode = !tinymce.isIE || d.documentMode >= 8;\n-\t\t\tt.boxModel = !tinymce.isIE || d.compatMode == \"CSS1Compat\" || t.stdMode;\n-\t\t\tt.hasOuterHTML = \"outerHTML\" in d.createElement(\"a\");\n-\n-\t\t\tt.settings = s = tinymce.extend({\n-\t\t\t\tkeep_values : false,\n-\t\t\t\thex_colors : 1\n-\t\t\t}, s);\n-\t\t\t\n-\t\t\tt.schema = s.schema;\n-\t\t\tt.styles = new tinymce.html.Styles({\n-\t\t\t\turl_converter : s.url_converter,\n-\t\t\t\turl_converter_scope : s.url_converter_scope\n-\t\t\t}, s.schema);\n-\n-\t\t\t// Fix IE6SP2 flicker and check it failed for pre SP2\n-\t\t\tif (tinymce.isIE6) {\n-\t\t\t\ttry {\n-\t\t\t\t\td.execCommand('BackgroundImageCache', false, true);\n-\t\t\t\t} catch (e) {\n-\t\t\t\t\tt.cssFlicker = true;\n-\t\t\t\t}\n-\t\t\t}\n-\n-\t\t\tt.fixDoc(d);\n-\t\t\tt.events = s.ownEvents ? new tinymce.dom.EventUtils(s.proxy) : tinymce.dom.Event;\n-\t\t\ttinymce.addUnload(t.destroy, t);\n-\t\t\tblockElementsMap = s.schema ? s.schema.getBlockElements() : {};\n-\n-\t\t\t/**\n-\t\t\t * Returns true/false if the specified element is a block element or not.\n-\t\t\t *\n-\t\t\t * @method isBlock\n-\t\t\t * @param {Node/String} node Element/Node to check.\n-\t\t\t * @return {Boolean} True/False state if the node is a block element or not.\n-\t\t\t */\n-\t\t\tt.isBlock = function(node) {\n-\t\t\t\t// Fix for #5446\n-\t\t\t\tif (!node) {\n-\t\t\t\t\treturn false;\n-\t\t\t\t}\n-\n-\t\t\t\t// This function is called in module pattern style since it might be executed with the wrong this scope\n-\t\t\t\tvar type = node.nodeType;\n-\n-\t\t\t\t// If it's a node then check the type and use the nodeName\n-\t\t\t\tif (type)\n-\t\t\t\t\treturn !!(type === 1 && blockElementsMap[node.nodeName]);\n-\n-\t\t\t\treturn !!blockElementsMap[node];\n-\t\t\t};\n-\t\t},\n-\n-\t\tfixDoc: function(doc) {\n-\t\t\tvar settings = this.settings, name;\n-\n-\t\t\tif (isIE && !tinymce.isIE11 && settings.schema) {\n-\t\t\t\t// Add missing HTML 4/5 elements to IE\n-\t\t\t\t('abbr article aside audio canvas ' +\n-\t\t\t\t'details figcaption figure footer ' +\n-\t\t\t\t'header hgroup mark menu meter nav ' +\n-\t\t\t\t'output progress section summary ' +\n-\t\t\t\t'time video').replace(/\\w+/g, function(name) {\n-\t\t\t\t\tdoc.createElement(name);\n-\t\t\t\t});\n-\n-\t\t\t\t// Create all custom elements\n-\t\t\t\tfor (name in settings.schema.getCustomElements()) {\n-\t\t\t\t\tdoc.createElement(name);\n-\t\t\t\t}\n-\t\t\t}\n-\t\t},\n-\n-\t\tclone: function(node, deep) {\n-\t\t\tvar self = this, clone, doc;\n-\n-\t\t\t// TODO: Add feature detection here in the future\n-\t\t\tif (!isIE || tinymce.isIE11 || node.nodeType !== 1 || deep) {\n-\t\t\t\treturn node.cloneNode(deep);\n-\t\t\t}\n-\n-\t\t\tdoc = self.doc;\n-\n-\t\t\t// Make a HTML5 safe shallow copy\n-\t\t\tif (!deep) {\n-\t\t\t\tclone = doc.createElement(node.nodeName);\n-\n-\t\t\t\t// Copy attribs\n-\t\t\t\teach(self.getAttribs(node), function(attr) {\n-\t\t\t\t\tself.setAttrib(clone, attr.nodeName, self.getAttrib(node, attr.nodeName));\n-\t\t\t\t});\n-\n-\t\t\t\treturn clone;\n-\t\t\t}\n-/*\n-\t\t\t// Setup HTML5 patched document fragment\n-\t\t\tif (!self.frag) {\n-\t\t\t\tself.frag = doc.createDocumentFragment();\n-\t\t\t\tself.fixDoc(self.frag);\n-\t\t\t}\n-\n-\t\t\t// Make a deep copy by adding it to the document fragment then removing it this removed the :section\n-\t\t\tclone = doc.createElement('div');\n-\t\t\tself.frag.appendChild(clone);\n-\t\t\tclone.innerHTML = node.outerHTML;\n-\t\t\tself.frag.removeChild(clone);\n-*/\n-\t\t\treturn clone.firstChild;\n-\t\t},\n-\n-\t\t/**\n-\t\t * Returns the root node of the document this is normally the body but might be a DIV. Parents like getParent will not\n-\t\t * go above the point of this root node.\n-\t\t *\n-\t\t * @method getRoot\n-\t\t * @return {Element} Root element for the utility class.\n-\t\t */\n-\t\tgetRoot : function() {\n-\t\t\tvar t = this, s = t.settings;\n-\n-\t\t\treturn (s && t.get(s.root_element)) || t.doc.body;\n-\t\t},\n-\n-\t\t/**\n-\t\t * Returns the viewport of the window.\n-\t\t *\n-\t\t * @method getViewPort\n-\t\t * @param {Window} w Optional window to get viewport of.\n-\t\t * @return {Object} Viewport object with fields x, y, w and h.\n-\t\t */\n-\t\tgetViewPort : function(w) {\n-\t\t\tvar d, b;\n-\n-\t\t\tw = !w ? this.win : w;\n-\t\t\td = w.document;\n-\t\t\tb = this.boxModel ? d.documentElement : d.body;\n-\n-\t\t\t// Returns viewport size excluding scrollbars\n-\t\t\treturn {\n-\t\t\t\tx : w.pageXOffset || b.scrollLeft,\n-\t\t\t\ty : w.pageYOffset || b.scrollTop,\n-\t\t\t\tw : w.innerWidth || b.clientWidth,\n-\t\t\t\th : w.innerHeight || b.clientHeight\n-\t\t\t};\n-\t\t},\n-\n-\t\t/**\n-\t\t * Returns the rectangle for a specific element.\n-\t\t *\n-\t\t * @method getRect\n-\t\t * @param {Element/String} e Element object or element ID to get rectange from.\n-\t\t * @return {object} Rectange for specified element object with x, y, w, h fields.\n-\t\t */\n-\t\tgetRect : function(e) {\n-\t\t\tvar p, t = this, sr;\n-\n-\t\t\te = t.get(e);\n-\t\t\tp = t.getPos(e);\n-\t\t\tsr = t.getSize(e);\n-\n-\t\t\treturn {\n-\t\t\t\tx : p.x,\n-\t\t\t\ty : p.y,\n-\t\t\t\tw : sr.w,\n-\t\t\t\th : sr.h\n-\t\t\t};\n-\t\t},\n-\n-\t\t/**\n-\t\t * Returns the size dimensions of the specified element.\n-\t\t *\n-\t\t * @method getSize\n-\t\t * @param {Element/String} e Element object or element ID to get rectange from.\n-\t\t * @return {object} Rectange for specified element object with w, h fields.\n-\t\t */\n-\t\tgetSize : function(e) {\n-\t\t\tvar t = this, w, h;\n-\n-\t\t\te = t.get(e);\n-\t\t\tw = t.getStyle(e, 'width');\n-\t\t\th = t.getStyle(e, 'height');\n-\n-\t\t\t// Non pixel value, then force offset/clientWidth\n-\t\t\tif (w.indexOf('px') === -1)\n-\t\t\t\tw = 0;\n-\n-\t\t\t// Non pixel value, then force offset/clientWidth\n-\t\t\tif (h.indexOf('px') === -1)\n-\t\t\t\th = 0;\n-\n-\t\t\treturn {\n-\t\t\t\tw : parseInt(w, 10) || e.offsetWidth || e.clientWidth,\n-\t\t\t\th : parseInt(h, 10) || e.offsetHeight || e.clientHeight\n-\t\t\t};\n-\t\t},\n-\n-\t\t/**\n-\t\t * Returns a node by the specified selector function. This function will\n-\t\t * loop through all parent nodes and call the specified function for each node.\n-\t\t * If the function then returns true indicating that it has found what it was looking for, the loop execution will then end\n-\t\t * and the node it found will be returned.\n-\t\t *\n-\t\t * @method getParent\n-\t\t * @param {Node/String} n DOM node to search parents on or ID string.\n-\t\t * @param {function} f Selection function to execute on each node or CSS pattern.\n-\t\t * @param {Node} r Optional root element, never go below this point.\n-\t\t * @return {Node} DOM Node or null if it wasn't found.\n-\t\t */\n-\t\tgetParent : function(n, f, r) {\n-\t\t\treturn this.getParents(n, f, r, false);\n-\t\t},\n-\n-\t\t/**\n-\t\t * Returns a node list of all parents matching the specified selector function or pattern.\n-\t\t * If the function then returns true indicating that it has found what it was looking for and that node will be collected.\n-\t\t *\n-\t\t * @method getParents\n-\t\t * @param {Node/String} n DOM node to search parents on or ID string.\n-\t\t * @param {function} f Selection function to execute on each node or CSS pattern.\n-\t\t * @param {Node} r Optional root element, never go below this point.\n-\t\t * @return {Array} Array of nodes or null if it wasn't found.\n-\t\t */\n-\t\tgetParents : function(n, f, r, c) {\n-\t\t\tvar t = this, na, se = t.settings, o = [];\n-\n-\t\t\tn = t.get(n);\n-\t\t\tc = c === undefined;\n-\n-\t\t\tif (se.strict_root)\n-\t\t\t\tr = r || t.getRoot();\n-\n-\t\t\t// Wrap node name as func\n-\t\t\tif (is(f, 'string')) {\n-\t\t\t\tna = f;\n-\n-\t\t\t\tif (f === '*') {\n-\t\t\t\t\tf = function(n) {return n.nodeType == 1;};\n-\t\t\t\t} else {\n-\t\t\t\t\tf = function(n) {\n-\t\t\t\t\t\treturn t.is(n, na);\n-\t\t\t\t\t};\n-\t\t\t\t}\n-\t\t\t}\n-\n-\t\t\twhile (n) {\n-\t\t\t\tif (n == r || !n.nodeType || n.nodeType === 9)\n-\t\t\t\t\tbreak;\n-\n-\t\t\t\tif (!f || f(n)) {\n-\t\t\t\t\tif (c)\n-\t\t\t\t\t\to.push(n);\n-\t\t\t\t\telse\n-\t\t\t\t\t\treturn n;\n-\t\t\t\t}\n-\n-\t\t\t\tn = n.parentNode;\n-\t\t\t}\n-\n-\t\t\treturn c ? o : null;\n-\t\t},\n-\n-\t\t/**\n-\t\t * Returns the specified element by ID or the input element if it isn't a string.\n-\t\t *\n-\t\t * @method get\n-\t\t * @param {String/Element} n Element id to look for or element to just pass though.\n-\t\t * @return {Element} Element matching the specified id or null if it wasn't found.\n-\t\t */\n-\t\tget : function(e) {\n-\t\t\tvar n;\n-\n-\t\t\tif (e && this.doc && typeof(e) == 'string') {\n-\t\t\t\tn = e;\n-\t\t\t\te = this.doc.getElementById(e);\n-\n-\t\t\t\t// IE and Opera returns meta elements when they match the specified input ID, but getElementsByName seems to do the trick\n-\t\t\t\tif (e && e.id !== n)\n-\t\t\t\t\treturn this.doc.getElementsByName(n)[1];\n-\t\t\t}\n-\n-\t\t\treturn e;\n-\t\t},\n-\n-\t\t/**\n-\t\t * Returns the next node that matches selector or function\n-\t\t *\n-\t\t * @method getNext\n-\t\t * @param {Node} node Node to find siblings from.\n-\t\t * @param {String/function} selector Selector CSS expression or function.\n-\t\t * @return {Node} Next node item matching the selector or null if it wasn't found.\n-\t\t */\n-\t\tgetNext : function(node, selector) {\n-\t\t\treturn this._findSib(node, selector, 'nextSibling');\n-\t\t},\n-\n-\t\t/**\n-\t\t * Returns the previous node that matches selector or function\n-\t\t *\n-\t\t * @method getPrev\n-\t\t * @param {Node} node Node to find siblings from.\n-\t\t * @param {String/function} selector Selector CSS expression or function.\n-\t\t * @return {Node} Previous node item matching the selector or null if it wasn't found.\n-\t\t */\n-\t\tgetPrev : function(node, selector) {\n-\t\t\treturn this._findSib(node, selector, 'previousSibling');\n-\t\t},\n-\n-\t\t// #ifndef jquery\n-\n-\t\t/**\n-\t\t * Selects specific elements by a CSS level 3 pattern. For example \"div#a1 p.test\".\n-\t\t * This function is optimized for the most common patterns needed in TinyMCE but it also performes good enough\n-\t\t * on more complex patterns.\n-\t\t *\n-\t\t * @method select\n-\t\t * @param {String} p CSS level 1 pattern to select/find elements by.\n-\t\t * @param {Object} s Optional root element/scope element to search in.\n-\t\t * @return {Array} Array with all matched elements.\n-\t\t * @example\n-\t\t * // Adds a class to all paragraphs in the currently active editor\n-\t\t * tinyMCE.activeEditor.dom.addClass(tinyMCE.activeEditor.dom.select('p'), 'someclass');\n-\t\t * \n-\t\t * // Adds a class to all spans that has the test class in the currently active editor\n-\t\t * tinyMCE.activeEditor.dom.addClass(tinyMCE.activeEditor.dom.select('span.test'), 'someclass')\n-\t\t */\n-\t\tselect : function(pa, s) {\n-\t\t\tvar t = this;\n-\n-\t\t\treturn tinymce.dom.Sizzle(pa, t.get(s) || t.get(t.settings.root_element) || t.doc, []);\n-\t\t},\n-\n-\t\t/**\n-\t\t * Returns true/false if the specified element matches the specified css pattern.\n-\t\t *\n-\t\t * @method is\n-\t\t * @param {Node/NodeList} n DOM node to match or an array of nodes to match.\n-\t\t * @param {String} selector CSS pattern to match the element agains.\n-\t\t */\n-\t\tis : function(n, selector) {\n-\t\t\tvar i;\n-\n-\t\t\t// If it isn't an array then try to do some simple selectors instead of Sizzle for to boost performance\n-\t\t\tif (n.length === undefined) {\n-\t\t\t\t// Simple all selector\n-\t\t\t\tif (selector === '*')\n-\t\t\t\t\treturn n.nodeType == 1;\n-\n-\t\t\t\t// Simple selector just elements\n-\t\t\t\tif (simpleSelectorRe.test(selector)) {\n-\t\t\t\t\tselector = selector.toLowerCase().split(/,/);\n-\t\t\t\t\tn = n.nodeName.toLowerCase();\n-\n-\t\t\t\t\tfor (i = selector.length - 1; i >= 0; i--) {\n-\t\t\t\t\t\tif (selector[i] == n)\n-\t\t\t\t\t\t\treturn true;\n-\t\t\t\t\t}\n-\n-\t\t\t\t\treturn false;\n-\t\t\t\t}\n-\t\t\t}\n-\n-\t\t\treturn tinymce.dom.Sizzle.matches(selector, n.nodeType ? [n] : n).length > 0;\n-\t\t},\n-\n-\t\t// #endif\n-\n-\t\t/**\n-\t\t * Adds the specified element to another element or elements.\n-\t\t *\n-\t\t * @method add\n-\t\t * @param {String/Element/Array} Element id string, DOM node element or array of id's or elements to add to.\n-\t\t * @param {String/Element} n Name of new element to add or existing element to add.\n-\t\t * @param {Object} a Optional object collection with arguments to add to the new element(s).\n-\t\t * @param {String} h Optional inner HTML contents to add for each element.\n-\t\t * @param {Boolean} c Optional internal state to indicate if it should create or add.\n-\t\t * @return {Element/Array} Element that got created or array with elements if multiple elements where passed.\n-\t\t * @example\n-\t\t * // Adds a new paragraph to the end of the active editor\n-\t\t * tinyMCE.activeEditor.dom.add(tinyMCE.activeEditor.getBody(), 'p', {title : 'my title'}, 'Some content');\n-\t\t */\n-\t\tadd : function(p, n, a, h, c) {\n-\t\t\tvar t = this;\n-\n-\t\t\treturn this.run(p, function(p) {\n-\t\t\t\tvar e, k;\n-\n-\t\t\t\te = is(n, 'string') ? t.doc.createElement(n) : n;\n-\t\t\t\tt.setAttribs(e, a);\n-\n-\t\t\t\tif (h) {\n-\t\t\t\t\tif (h.nodeType)\n-\t\t\t\t\t\te.appendChild(h);\n-\t\t\t\t\telse\n-\t\t\t\t\t\tt.setHTML(e, h);\n-\t\t\t\t}\n-\n-\t\t\t\treturn !c ? p.appendChild(e) : e;\n-\t\t\t});\n-\t\t},\n-\n-\t\t/**\n-\t\t * Creates a new element.\n-\t\t *\n-\t\t * @method create\n-\t\t * @param {String} n Name of new element.\n-\t\t * @param {Object} a Optional object name/value collection with element attributes.\n-\t\t * @param {String} h Optional HTML string to set as inner HTML of the element.\n-\t\t * @return {Element} HTML DOM node element that got created.\n-\t\t * @example\n-\t\t * // Adds an element where the caret/selection is in the active editor\n-\t\t * var el = tinyMCE.activeEditor.dom.create('div', {id : 'test', 'class' : 'myclass'}, 'some content');\n-\t\t * tinyMCE.activeEditor.selection.setNode(el);\n-\t\t */\n-\t\tcreate : function(n, a, h) {\n-\t\t\treturn this.add(this.doc.createElement(n), n, a, h, 1);\n-\t\t},\n-\n-\t\t/**\n-\t\t * Create HTML string for element. The element will be closed unless an empty inner HTML string is passed.\n-\t\t *\n-\t\t * @method createHTML\n-\t\t * @param {String} n Name of new element.\n-\t\t * @param {Object} a Optional object name/value collection with element attributes.\n-\t\t * @param {String} h Optional HTML string to set as inner HTML of the element.\n-\t\t * @return {String} String with new HTML element like for example: <a href=\"#\">test</a>.\n-\t\t * @example\n-\t\t * // Creates a html chunk and inserts it at the current selection/caret location\n-\t\t * tinyMCE.activeEditor.selection.setContent(tinyMCE.activeEditor.dom.createHTML('a', {href : 'test.html'}, 'some line'));\n-\t\t */\n-\t\tcreateHTML : function(n, a, h) {\n-\t\t\tvar o = '', t = this, k;\n-\n-\t\t\to += '<' + n;\n-\n-\t\t\tfor (k in a) {\n-\t\t\t\tif (a.hasOwnProperty(k))\n-\t\t\t\t\to += ' ' + k + '=\"' + t.encode(a[k]) + '\"';\n-\t\t\t}\n-\n-\t\t\t// A call to tinymce.is doesn't work for some odd reason on IE9 possible bug inside their JS runtime\n-\t\t\tif (typeof(h) != \"undefined\")\n-\t\t\t\treturn o + '>' + h + '</' + n + '>';\n-\n-\t\t\treturn o + ' />';\n-\t\t},\n-\n-\t\t/**\n-\t\t * Removes/deletes the specified element(s) from the DOM.\n-\t\t *\n-\t\t * @method remove\n-\t\t * @param {String/Element/Array} node ID of element or DOM element object or array containing multiple elements/ids.\n-\t\t * @param {Boolean} keep_children Optional state to keep children or not. If set to true all children will be placed at the location of the removed element.\n-\t\t * @return {Element/Array} HTML DOM element that got removed or array of elements depending on input.\n-\t\t * @example\n-\t\t * // Removes all paragraphs in the active editor\n-\t\t * tinyMCE.activeEditor.dom.remove(tinyMCE.activeEditor.dom.select('p'));\n-\t\t * \n-\t\t * // Removes a element by id in the document\n-\t\t * tinyMCE.DOM.remove('mydiv');\n-\t\t */\n-\t\tremove : function(node, keep_children) {\n-\t\t\treturn this.run(node, function(node) {\n-\t\t\t\tvar child, parent = node.parentNode;\n-\n-\t\t\t\tif (!parent)\n-\t\t\t\t\treturn null;\n-\n-\t\t\t\tif (keep_children) {\n-\t\t\t\t\twhile (child = node.firstChild) {\n-\t\t\t\t\t\t// IE 8 will crash if you don't remove completely empty text nodes\n-\t\t\t\t\t\tif (!tinymce.isIE || child.nodeType !== 3 || child.nodeValue)\n-\t\t\t\t\t\t\tparent.insertBefore(child, node);\n-\t\t\t\t\t\telse\n-\t\t\t\t\t\t\tnode.removeChild(child);\n-\t\t\t\t\t}\n-\t\t\t\t}\n-\n-\t\t\t\treturn parent.removeChild(node);\n-\t\t\t});\n-\t\t},\n-\n-\t\t/**\n-\t\t * Sets the CSS style value on a HTML element. The name can be a camelcase string\n-\t\t * or the CSS style name like background-color.\n-\t\t *\n-\t\t * @method setStyle\n-\t\t * @param {String/Element/Array} n HTML element/Element ID or Array of elements/ids to set CSS style value on.\n-\t\t * @param {String} na Name of the style value to set.\n-\t\t * @param {String} v Value to set on the style.\n-\t\t * @example\n-\t\t * // Sets a style value on all paragraphs in the currently active editor\n-\t\t * tinyMCE.activeEditor.dom.setStyle(tinyMCE.activeEditor.dom.select('p'), 'background-color', 'red');\n-\t\t * \n-\t\t * // Sets a style value to an element by id in the current document\n-\t\t * tinyMCE.DOM.setStyle('mydiv', 'background-color', 'red');\n-\t\t */\n-\t\tsetStyle : function(n, na, v) {\n-\t\t\tvar t = this;\n-\n-\t\t\treturn t.run(n, function(e) {\n-\t\t\t\tvar s, i;\n-\n-\t\t\t\ts = e.style;\n-\n-\t\t\t\t// Camelcase it, if needed\n-\t\t\t\tna = na.replace(/-(\\D)/g, function(a, b){\n-\t\t\t\t\treturn b.toUpperCase();\n-\t\t\t\t});\n-\n-\t\t\t\t// Default px suffix on these\n-\t\t\t\tif (t.pixelStyles.test(na) && (tinymce.is(v, 'number') || /^[\\-0-9\\.]+$/.test(v)))\n-\t\t\t\t\tv += 'px';\n-\n-\t\t\t\tswitch (na) {\n-\t\t\t\t\tcase 'opacity':\n-\t\t\t\t\t\t// IE specific opacity\n-\t\t\t\t\t\tif (isIE && ! tinymce.isIE11) {\n-\t\t\t\t\t\t\ts.filter = v === '' ? '' : \"alpha(opacity=\" + (v * 100) + \")\";\n-\n-\t\t\t\t\t\t\tif (!n.currentStyle || !n.currentStyle.hasLayout)\n-\t\t\t\t\t\t\t\ts.display = 'inline-block';\n-\t\t\t\t\t\t}\n-\n-\t\t\t\t\t\t// Fix for older browsers\n-\t\t\t\t\t\ts[na] = s['-moz-opacity'] = s['-khtml-opacity'] = v || '';\n-\t\t\t\t\t\tbreak;\n-\n-\t\t\t\t\tcase 'float':\n-\t\t\t\t\t\t(isIE && ! tinymce.isIE11) ? s.styleFloat = v : s.cssFloat = v;\n-\t\t\t\t\t\tbreak;\n-\t\t\t\t\t\n-\t\t\t\t\tdefault:\n-\t\t\t\t\t\ts[na] = v || '';\n-\t\t\t\t}\n-\n-\t\t\t\t// Force update of the style data\n-\t\t\t\tif (t.settings.update_styles)\n-\t\t\t\t\tt.setAttrib(e, 'data-mce-style');\n-\t\t\t});\n-\t\t},\n-\n-\t\t/**\n-\t\t * Returns the current style or runtime/computed value of a element.\n-\t\t *\n-\t\t * @method getStyle\n-\t\t * @param {String/Element} n HTML element or element id string to get style from.\n-\t\t * @param {String} na Style name to return.\n-\t\t * @param {Boolean} c Computed style.\n-\t\t * @return {String} Current style or computed style value of a element.\n-\t\t */\n-\t\tgetStyle : function(n, na, c) {\n-\t\t\tn = this.get(n);\n-\n-\t\t\tif (!n)\n-\t\t\t\treturn;\n-\n-\t\t\t// Gecko\n-\t\t\tif (this.doc.defaultView && c) {\n-\t\t\t\t// Remove camelcase\n-\t\t\t\tna = na.replace(/[A-Z]/g, function(a){\n-\t\t\t\t\treturn '-' + a;\n-\t\t\t\t});\n-\n-\t\t\t\ttry {\n-\t\t\t\t\treturn this.doc.defaultView.getComputedStyle(n, null).getPropertyValue(na);\n-\t\t\t\t} catch (ex) {\n-\t\t\t\t\t// Old safari might fail\n-\t\t\t\t\treturn null;\n-\t\t\t\t}\n-\t\t\t}\n-\n-\t\t\t// Camelcase it, if needed\n-\t\t\tna = na.replace(/-(\\D)/g, function(a, b){\n-\t\t\t\treturn b.toUpperCase();\n-\t\t\t});\n-\n-\t\t\tif (na == 'float')\n-\t\t\t\tna = isIE ? 'styleFloat' : 'cssFloat';\n-\n-\t\t\t// IE & Opera\n-\t\t\tif (n.currentStyle && c)\n-\t\t\t\treturn n.currentStyle[na];\n-\n-\t\t\treturn n.style ? n.style[na] : undefined;\n-\t\t},\n-\n-\t\t/**\n-\t\t * Sets multiple styles on the specified element(s).\n-\t\t *\n-\t\t * @method setStyles\n-\t\t * @param {Element/String/Array} e DOM element, element id string or array of elements/ids to set styles on.\n-\t\t * @param {Object} o Name/Value collection of style items to add to the element(s).\n-\t\t * @example\n-\t\t * // Sets styles on all paragraphs in the currently active editor\n-\t\t * tinyMCE.activeEditor.dom.setStyles(tinyMCE.activeEditor.dom.select('p'), {'background-color' : 'red', 'color' : 'green'});\n-\t\t * \n-\t\t * // Sets styles to an element by id in the current document\n-\t\t * tinyMCE.DOM.setStyles('mydiv', {'background-color' : 'red', 'color' : 'green'});\n-\t\t */\n-\t\tsetStyles : function(e, o) {\n-\t\t\tvar t = this, s = t.settings, ol;\n-\n-\t\t\tol = s.update_styles;\n-\t\t\ts.update_styles = 0;\n-\n-\t\t\teach(o, function(v, n) {\n-\t\t\t\tt.setStyle(e, n, v);\n-\t\t\t});\n-\n-\t\t\t// Update style info\n-\t\t\ts.update_styles = ol;\n-\t\t\tif (s.update_styles)\n-\t\t\t\tt.setAttrib(e, s.cssText);\n-\t\t},\n-\n-\t\t/**\n-\t\t * Removes all attributes from an element or elements.\n-\t\t * \n-\t\t * @param {Element/String/Array} e DOM element, element id string or array of elements/ids to remove attributes from.\n-\t\t */\n-\t\tremoveAllAttribs: function(e) {\n-\t\t\treturn this.run(e, function(e) {\n-\t\t\t\tvar i, attrs = e.attributes;\n-\t\t\t\tfor (i = attrs.length - 1; i >= 0; i--) {\n-\t\t\t\t\te.removeAttributeNode(attrs.item(i));\n-\t\t\t\t}\n-\t\t\t});\n-\t\t},\n-\n-\t\t/**\n-\t\t * Sets the specified attributes value of a element or elements.\n-\t\t *\n-\t\t * @method setAttrib\n-\t\t * @param {Element/String/Array} e DOM element, element id string or array of elements/ids to set attribute on.\n-\t\t * @param {String} n Name of attribute to set.\n-\t\t * @param {String} v Value to set on the attribute of this value is falsy like null 0 or '' it will remove the attribute instead.\n-\t\t * @example\n-\t\t * // Sets an attribute to all paragraphs in the active editor\n-\t\t * tinyMCE.activeEditor.dom.setAttrib(tinyMCE.activeEditor.dom.select('p'), 'class', 'myclass');\n-\t\t * \n-\t\t * // Sets an attribute to a specific element in the current page\n-\t\t * tinyMCE.dom.setAttrib('mydiv', 'class', 'myclass');\n-\t\t */\n-\t\tsetAttrib : function(e, n, v) {\n-\t\t\tvar t = this;\n-\n-\t\t\t// Whats the point\n-\t\t\tif (!e || !n)\n-\t\t\t\treturn;\n-\n-\t\t\t// Strict XML mode\n-\t\t\tif (t.settings.strict)\n-\t\t\t\tn = n.toLowerCase();\n-\n-\t\t\treturn this.run(e, function(e) {\n-\t\t\t\tvar s = t.settings;\n-\t\t\t\tvar originalValue = e.getAttribute(n);\n-\t\t\t\tif (v !== null) {\n-\t\t\t\t\tswitch (n) {\n-\t\t\t\t\t\tcase \"style\":\n-\t\t\t\t\t\t\tif (!is(v, 'string')) {\n-\t\t\t\t\t\t\t\teach(v, function(v, n) {\n-\t\t\t\t\t\t\t\t\tt.setStyle(e, n, v);\n-\t\t\t\t\t\t\t\t});\n-\n-\t\t\t\t\t\t\t\treturn;\n-\t\t\t\t\t\t\t}\n-\n-\t\t\t\t\t\t\t// No mce_style for elements with these since they might get resized by the user\n-\t\t\t\t\t\t\tif (s.keep_values) {\n-\t\t\t\t\t\t\t\tif (v && !t._isRes(v))\n-\t\t\t\t\t\t\t\t\te.setAttribute('data-mce-style', v, 2);\n-\t\t\t\t\t\t\t\telse\n-\t\t\t\t\t\t\t\t\te.removeAttribute('data-mce-style', 2);\n-\t\t\t\t\t\t\t}\n-\n-\t\t\t\t\t\t\te.style.cssText = v;\n-\t\t\t\t\t\t\tbreak;\n-\n-\t\t\t\t\t\tcase \"class\":\n-\t\t\t\t\t\t\te.className = v || ''; // Fix IE null bug\n-\t\t\t\t\t\t\tbreak;\n-\n-\t\t\t\t\t\tcase \"src\":\n-\t\t\t\t\t\tcase \"href\":\n-\t\t\t\t\t\t\tif (s.keep_values) {\n-\t\t\t\t\t\t\t\tif (s.url_converter)\n-\t\t\t\t\t\t\t\t\tv = s.url_converter.call(s.url_converter_scope || t, v, n, e);\n-\n-\t\t\t\t\t\t\t\tt.setAttrib(e, 'data-mce-' + n, v, 2);\n-\t\t\t\t\t\t\t}\n-\n-\t\t\t\t\t\t\tbreak;\n-\n-\t\t\t\t\t\tcase \"shape\":\n-\t\t\t\t\t\t\te.setAttribute('data-mce-style', v);\n-\t\t\t\t\t\t\tbreak;\n-\t\t\t\t\t}\n-\t\t\t\t}\n-\t\t\t\tif (is(v) && v !== null && v.length !== 0)\n-\t\t\t\t\te.setAttribute(n, '' + v, 2);\n-\t\t\t\telse\n-\t\t\t\t\te.removeAttribute(n, 2);\n-\n-\t\t\t\t// fire onChangeAttrib event for attributes that have changed\n-\t\t\t\tif (tinyMCE.activeEditor && originalValue != v) {\n-\t\t\t\t\tvar ed = tinyMCE.activeEditor;\n-\t\t\t\t\ted.onSetAttrib.dispatch(ed, e, n, v);\n-\t\t\t\t}\n-\t\t\t});\n-\t\t},\n-\n-\t\t/**\n-\t\t * Sets the specified attributes of a element or elements.\n-\t\t *\n-\t\t * @method setAttribs\n-\t\t * @param {Element/String/Array} e DOM element, element id string or array of elements/ids to set attributes on.\n-\t\t * @param {Object} o Name/Value collection of attribute items to add to the element(s).\n-\t\t * @example\n-\t\t * // Sets some attributes to all paragraphs in the active editor\n-\t\t * tinyMCE.activeEditor.dom.setAttribs(tinyMCE.activeEditor.dom.select('p'), {'class' : 'myclass', title : 'some title'});\n-\t\t * \n-\t\t * // Sets some attributes to a specific element in the current page\n-\t\t * tinyMCE.DOM.setAttribs('mydiv', {'class' : 'myclass', title : 'some title'});\n-\t\t */\n-\t\tsetAttribs : function(e, o) {\n-\t\t\tvar t = this;\n-\n-\t\t\treturn this.run(e, function(e) {\n-\t\t\t\teach(o, function(v, n) {\n-\t\t\t\t\tt.setAttrib(e, n, v);\n-\t\t\t\t});\n-\t\t\t});\n-\t\t},\n-\n-\t\t/**\n-\t\t * Returns the specified attribute by name.\n-\t\t *\n-\t\t * @method getAttrib\n-\t\t * @param {String/Element} e Element string id or DOM element to get attribute from.\n-\t\t * @param {String} n Name of attribute to get.\n-\t\t * @param {String} dv Optional default value to return if the attribute didn't exist.\n-\t\t * @return {String} Attribute value string, default value or null if the attribute wasn't found.\n-\t\t */\n-\t\tgetAttrib : function(e, n, dv) {\n-\t\t\tvar v, t = this, undef;\n-\n-\t\t\te = t.get(e);\n-\n-\t\t\tif (!e || e.nodeType !== 1)\n-\t\t\t\treturn dv === undef ? false : dv;\n-\n-\t\t\tif (!is(dv))\n-\t\t\t\tdv = '';\n-\n-\t\t\t// Try the mce variant for these\n-\t\t\tif (/^(src|href|style|coords|shape)$/.test(n)) {\n-\t\t\t\tv = e.getAttribute(\"data-mce-\" + n);\n-\n-\t\t\t\tif (v)\n-\t\t\t\t\treturn v;\n-\t\t\t}\n-\n-\t\t\tif (isIE && t.props[n]) {\n-\t\t\t\tv = e[t.props[n]];\n-\t\t\t\tv = v && v.nodeValue ? v.nodeValue : v;\n-\t\t\t}\n-\n-\t\t\tif (!v)\n-\t\t\t\tv = e.getAttribute(n, 2);\n-\n-\t\t\t// Check boolean attribs\n-\t\t\tif (/^(checked|compact|declare|defer|disabled|ismap|multiple|nohref|noshade|nowrap|readonly|selected)$/.test(n)) {\n-\t\t\t\tif (e[t.props[n]] === true && v === '')\n-\t\t\t\t\treturn n;\n-\n-\t\t\t\treturn v ? n : '';\n-\t\t\t}\n-\n-\t\t\t// Inner input elements will override attributes on form elements\n-\t\t\tif (e.nodeName === \"FORM\" && e.getAttributeNode(n))\n-\t\t\t\treturn e.getAttributeNode(n).nodeValue;\n-\n-\t\t\tif (n === 'style') {\n-\t\t\t\tv = v || e.style.cssText;\n-\n-\t\t\t\tif (v) {\n-\t\t\t\t\tv = t.serializeStyle(t.parseStyle(v), e.nodeName);\n-\n-\t\t\t\t\tif (t.settings.keep_values && !t._isRes(v))\n-\t\t\t\t\t\te.setAttribute('data-mce-style', v);\n-\t\t\t\t}\n-\t\t\t}\n-\n-\t\t\t// Remove Apple and WebKit stuff\n-\t\t\tif (isWebKit && n === \"class\" && v)\n-\t\t\t\tv = v.replace(/(apple|webkit)\\-[a-z\\-]+/gi, '');\n-\n-\t\t\t// Handle IE issues\n-\t\t\tif (isIE) {\n-\t\t\t\tswitch (n) {\n-\t\t\t\t\tcase 'rowspan':\n-\t\t\t\t\tcase 'colspan':\n-\t\t\t\t\t\t// IE returns 1 as default value\n-\t\t\t\t\t\tif (v === 1)\n-\t\t\t\t\t\t\tv = '';\n-\n-\t\t\t\t\t\tbreak;\n-\n-\t\t\t\t\tcase 'size':\n-\t\t\t\t\t\t// IE returns +0 as default value for size\n-\t\t\t\t\t\tif (v === '+0' || v === 20 || v === 0)\n-\t\t\t\t\t\t\tv = '';\n-\n-\t\t\t\t\t\tbreak;\n-\n-\t\t\t\t\tcase 'width':\n-\t\t\t\t\tcase 'height':\n-\t\t\t\t\tcase 'vspace':\n-\t\t\t\t\tcase 'checked':\n-\t\t\t\t\tcase 'disabled':\n-\t\t\t\t\tcase 'readonly':\n-\t\t\t\t\t\tif (v === 0)\n-\t\t\t\t\t\t\tv = '';\n-\n-\t\t\t\t\t\tbreak;\n-\n-\t\t\t\t\tcase 'hspace':\n-\t\t\t\t\t\t// IE returns -1 as default value\n-\t\t\t\t\t\tif (v === -1)\n-\t\t\t\t\t\t\tv = '';\n-\n-\t\t\t\t\t\tbreak;\n-\n-\t\t\t\t\tcase 'maxlength':\n-\t\t\t\t\tcase 'tabindex':\n-\t\t\t\t\t\t// IE returns default value\n-\t\t\t\t\t\tif (v === 32768 || v === 2147483647 || v === '32768')\n-\t\t\t\t\t\t\tv = '';\n-\n-\t\t\t\t\t\tbreak;\n-\n-\t\t\t\t\tcase 'multiple':\n-\t\t\t\t\tcase 'compact':\n-\t\t\t\t\tcase 'noshade':\n-\t\t\t\t\tcase 'nowrap':\n-\t\t\t\t\t\tif (v === 65535)\n-\t\t\t\t\t\t\treturn n;\n-\n-\t\t\t\t\t\treturn dv;\n-\n-\t\t\t\t\tcase 'shape':\n-\t\t\t\t\t\tv = v.toLowerCase();\n-\t\t\t\t\t\tbreak;\n-\n-\t\t\t\t\tdefault:\n-\t\t\t\t\t\t// IE has odd anonymous function for event attributes\n-\t\t\t\t\t\tif (n.indexOf('on') === 0 && v)\n-\t\t\t\t\t\t\tv = tinymce._replace(/^function\\s+\\w+\\(\\)\\s+\\{\\s+(.*)\\s+\\}$/, '$1', '' + v);\n-\t\t\t\t}\n-\t\t\t}\n-\n-\t\t\treturn (v !== undef && v !== null && v !== '') ? '' + v : dv;\n-\t\t},\n-\n-\t\t/**\n-\t\t * Returns the absolute x, y position of a node. The position will be returned in a object with x, y fields.\n-\t\t *\n-\t\t * @method getPos\n-\t\t * @param {Element/String} n HTML element or element id to get x, y position from.\n-\t\t * @param {Element} ro Optional root element to stop calculations at.\n-\t\t * @return {object} Absolute position of the specified element object with x, y fields.\n-\t\t */\n-\t\tgetPos : function(n, ro) {\n-\t\t\tvar t = this, x = 0, y = 0, e, d = t.doc, r;\n-\n-\t\t\tn = t.get(n);\n-\t\t\tro = ro || d.body;\n-\n-\t\t\tif (n) {\n-\t\t\t\t// Use getBoundingClientRect if it exists since it's faster than looping offset nodes\n-\t\t\t\tif (n.getBoundingClientRect) {\n-\t\t\t\t\tn = n.getBoundingClientRect();\n-\t\t\t\t\te = t.boxModel ? d.documentElement : d.body;\n-\n-\t\t\t\t\t// Add scroll offsets from documentElement or body since IE with the wrong box model will use d.body and so do WebKit\n-\t\t\t\t\t// Also remove the body/documentelement clientTop/clientLeft on IE 6, 7 since they offset the position\n-\t\t\t\t\tx = n.left + (d.documentElement.scrollLeft || d.body.scrollLeft) - e.clientTop;\n-\t\t\t\t\ty = n.top + (d.documentElement.scrollTop || d.body.scrollTop) - e.clientLeft;\n-\n-\t\t\t\t\treturn {x : x, y : y};\n-\t\t\t\t}\n-\n-\t\t\t\tr = n;\n-\t\t\t\twhile (r && r != ro && r.nodeType) {\n-\t\t\t\t\tx += r.offsetLeft || 0;\n-\t\t\t\t\ty += r.offsetTop || 0;\n-\t\t\t\t\tr = r.offsetParent;\n-\t\t\t\t}\n-\n-\t\t\t\tr = n.parentNode;\n-\t\t\t\twhile (r && r != ro && r.nodeType) {\n-\t\t\t\t\tx -= r.scrollLeft || 0;\n-\t\t\t\t\ty -= r.scrollTop || 0;\n-\t\t\t\t\tr = r.parentNode;\n-\t\t\t\t}\n-\t\t\t}\n-\n-\t\t\treturn {x : x, y : y};\n-\t\t},\n-\n-\t\t/**\n-\t\t * Parses the specified style value into an object collection. This parser will also\n-\t\t * merge and remove any redundant items that browsers might have added. It will also convert non hex\n-\t\t * colors to hex values. Urls inside the styles will also be converted to absolute/relative based on settings.\n-\t\t *\n-\t\t * @method parseStyle\n-\t\t * @param {String} st Style value to parse for example: border:1px solid red;.\n-\t\t * @return {Object} Object representation of that style like {border : '1px solid red'}\n-\t\t */\n-\t\tparseStyle : function(st) {\n-\t\t\treturn this.styles.parse(st);\n-\t\t},\n-\n-\t\t/**\n-\t\t * Serializes the specified style object into a string.\n-\t\t *\n-\t\t * @method serializeStyle\n-\t\t * @param {Object} o Object to serialize as string for example: {border : '1px solid red'}\n-\t\t * @param {String} name Optional element name.\n-\t\t * @return {String} String representation of the style object for example: border: 1px solid red.\n-\t\t */\n-\t\tserializeStyle : function(o, name) {\n-\t\t\treturn this.styles.serialize(o, name);\n-\t\t},\n-\n-\t\t/**\n-\t\t * Adds a style element at the top of the document with the specified cssText content.\n-\t\t *\n-\t\t * @method addStyle\n-\t\t * @param {String} cssText CSS Text style to add to top of head of document.\n-\t\t */\n-\t\taddStyle: function(cssText) {\n-\t\t\tvar doc = this.doc, head;\n-\n-\t\t\t// Create style element if needed\n-\t\t\tstyleElm = doc.getElementById('mceDefaultStyles');\n-\t\t\tif (!styleElm) {\n-\t\t\t\tstyleElm = doc.createElement('style'),\n-\t\t\t\tstyleElm.id = 'mceDefaultStyles';\n-\t\t\t\tstyleElm.type = 'text/css';\n-\n-\t\t\t\thead = doc.getElementsByTagName('head')[0];\n-\t\t\t\tif (head.firstChild) {\n-\t\t\t\t\thead.insertBefore(styleElm, head.firstChild);\n-\t\t\t\t} else {\n-\t\t\t\t\thead.appendChild(styleElm);\n-\t\t\t\t}\n-\t\t\t}\n-\n-\t\t\t// Append style data to old or new style element\n-\t\t\tif (styleElm.styleSheet) {\n-\t\t\t\tstyleElm.styleSheet.cssText += cssText;\n-\t\t\t} else {\n-\t\t\t\tstyleElm.appendChild(doc.createTextNode(cssText));\n-\t\t\t}\n-\t\t},\n-\n-\t\t/**\n-\t\t * Imports/loads the specified CSS file into the document bound to the class.\n-\t\t *\n-\t\t * @method loadCSS\n-\t\t * @param {String} u URL to CSS file to load.\n-\t\t * @example\n-\t\t * // Loads a CSS file dynamically into the current document\n-\t\t * tinymce.DOM.loadCSS('somepath/some.css');\n-\t\t * \n-\t\t * // Loads a CSS file into the currently active editor instance\n-\t\t * tinyMCE.activeEditor.dom.loadCSS('somepath/some.css');\n-\t\t * \n-\t\t * // Loads a CSS file into an editor instance by id\n-\t\t * tinyMCE.get('someid').dom.loadCSS('somepath/some.css');\n-\t\t * \n-\t\t * // Loads multiple CSS files into the current document\n-\t\t * tinymce.DOM.loadCSS('somepath/some.css,somepath/someother.css');\n-\t\t */\n-\t\tloadCSS : function(u) {\n-\t\t\tvar t = this, d = t.doc, head;\n-\n-\t\t\tif (!u)\n-\t\t\t\tu = '';\n-\n-\t\t\thead = d.getElementsByTagName('head')[0];\n-\n-\t\t\teach(u.split(','), function(u) {\n-\t\t\t\tvar link;\n-\n-\t\t\t\tif (t.files[u])\n-\t\t\t\t\treturn;\n-\n-\t\t\t\tt.files[u] = true;\n-\t\t\t\tlink = t.create('link', {rel : 'stylesheet', href : tinymce._addVer(u)});\n-\n-\t\t\t\t// IE 8 has a bug where dynamically loading stylesheets would produce a 1 item remaining bug\n-\t\t\t\t// This fix seems to resolve that issue by realcing the document ones a stylesheet finishes loading\n-\t\t\t\t// It's ugly but it seems to work fine.\n-\t\t\t\tif (isIE && !tinymce.isIE11 && d.documentMode && d.recalc) {\n-\t\t\t\t\tlink.onload = function() {\n-\t\t\t\t\t\tif (d.recalc)\n-\t\t\t\t\t\t\td.recalc();\n-\n-\t\t\t\t\t\tlink.onload = null;\n-\t\t\t\t\t};\n-\t\t\t\t}\n-\n-\t\t\t\thead.appendChild(link);\n-\t\t\t});\n-\t\t},\n-\n-\t\t/**\n-\t\t * Adds a class to the specified element or elements.\n-\t\t *\n-\t\t * @method addClass\n-\t\t * @param {String/Element/Array} Element ID string or DOM element or array with elements or IDs.\n-\t\t * @param {String} c Class name to add to each element.\n-\t\t * @return {String/Array} String with new class value or array with new class values for all elements.\n-\t\t * @example\n-\t\t * // Adds a class to all paragraphs in the active editor\n-\t\t * tinyMCE.activeEditor.dom.addClass(tinyMCE.activeEditor.dom.select('p'), 'myclass');\n-\t\t * \n-\t\t * // Adds a class to a specific element in the current page\n-\t\t * tinyMCE.DOM.addClass('mydiv', 'myclass');\n-\t\t */\n-\t\taddClass : function(e, c) {\n-\t\t\treturn this.run(e, function(e) {\n-\t\t\t\tvar o;\n-\n-\t\t\t\tif (!c)\n-\t\t\t\t\treturn 0;\n-\n-\t\t\t\tif (this.hasClass(e, c))\n-\t\t\t\t\treturn e.className;\n-\n-\t\t\t\to = this.removeClass(e, c);\n-\n-\t\t\t\treturn e.className = (o != '' ? (o + ' ') : '') + c;\n-\t\t\t});\n-\t\t},\n-\n-\t\t/**\n-\t\t * Removes a class from the specified element or elements.\n-\t\t *\n-\t\t * @method removeClass\n-\t\t * @param {String/Element/Array} Element ID string or DOM element or array with elements or IDs.\n-\t\t * @param {String} c Class name to remove to each element.\n-\t\t * @return {String/Array} String with new class value or array with new class values for all elements.\n-\t\t * @example\n-\t\t * // Removes a class from all paragraphs in the active editor\n-\t\t * tinyMCE.activeEditor.dom.removeClass(tinyMCE.activeEditor.dom.select('p'), 'myclass');\n-\t\t * \n-\t\t * // Removes a class from a specific element in the current page\n-\t\t * tinyMCE.DOM.removeClass('mydiv', 'myclass');\n-\t\t */\n-\t\tremoveClass : function(e, c) {\n-\t\t\tvar t = this, re;\n-\n-\t\t\treturn t.run(e, function(e) {\n-\t\t\t\tvar v;\n-\n-\t\t\t\tif (t.hasClass(e, c)) {\n-\t\t\t\t\tif (!re)\n-\t\t\t\t\t\tre = new RegExp(\"(^|\\\\s+)\" + c + \"(\\\\s+|$)\", \"g\");\n-\n-\t\t\t\t\tv = e.className.replace(re, ' ');\n-\t\t\t\t\tv = tinymce.trim(v != ' ' ? v : '');\n-\n-\t\t\t\t\te.className = v;\n-\n-\t\t\t\t\t// Empty class attr\n-\t\t\t\t\tif (!v) {\n-\t\t\t\t\t\te.removeAttribute('class');\n-\t\t\t\t\t\te.removeAttribute('className');\n-\t\t\t\t\t}\n-\n-\t\t\t\t\treturn v;\n-\t\t\t\t}\n-\n-\t\t\t\treturn e.className;\n-\t\t\t});\n-\t\t},\n-\n-\t\t/**\n-\t\t * Returns true if the specified element has the specified class.\n-\t\t *\n-\t\t * @method hasClass\n-\t\t * @param {String/Element} n HTML element or element id string to check CSS class on.\n-\t\t * @param {String} c CSS class to check for.\n-\t\t * @return {Boolean} true/false if the specified element has the specified class.\n-\t\t */\n-\t\thasClass : function(n, c) {\n-\t\t\tn = this.get(n);\n-\n-\t\t\tif (!n || !c)\n-\t\t\t\treturn false;\n-\n-\t\t\treturn (' ' + n.className + ' ').indexOf(' ' + c + ' ') !== -1;\n-\t\t},\n-\n-\t\t/**\n-\t\t * Shows the specified element(s) by ID by setting the \"display\" style.\n-\t\t *\n-\t\t * @method show\n-\t\t * @param {String/Element/Array} e ID of DOM element or DOM element or array with elements or IDs to show.\n-\t\t */\n-\t\tshow : function(e) {\n-\t\t\treturn this.setStyle(e, 'display', 'block');\n-\t\t},\n-\n-\t\t/**\n-\t\t * Hides the specified element(s) by ID by setting the \"display\" style.\n-\t\t *\n-\t\t * @method hide\n-\t\t * @param {String/Element/Array} e ID of DOM element or DOM element or array with elements or IDs to hide.\n-\t\t * @example\n-\t\t * // Hides a element by id in the document\n-\t\t * tinymce.DOM.hide('myid');\n-\t\t */\n-\t\thide : function(e) {\n-\t\t\treturn this.setStyle(e, 'display', 'none');\n-\t\t},\n-\n-\t\t/**\n-\t\t * Returns true/false if the element is hidden or not by checking the \"display\" style.\n-\t\t *\n-\t\t * @method isHidden\n-\t\t * @param {String/Element} e Id or element to check display state on.\n-\t\t * @return {Boolean} true/false if the element is hidden or not.\n-\t\t */\n-\t\tisHidden : function(e) {\n-\t\t\te = this.get(e);\n-\n-\t\t\treturn !e || e.style.display == 'none' || this.getStyle(e, 'display') == 'none';\n-\t\t},\n-\n-\t\t/**\n-\t\t * Returns a unique id. This can be useful when generating elements on the fly.\n-\t\t * This method will not check if the element allready exists.\n-\t\t *\n-\t\t * @method uniqueId\n-\t\t * @param {String} p Optional prefix to add infront of all ids defaults to \"mce_\".\n-\t\t * @return {String} Unique id.\n-\t\t */\n-\t\tuniqueId : function(p) {\n-\t\t\treturn (!p ? 'mce_' : p) + (this.counter++);\n-\t\t},\n-\n-\t\t/**\n-\t\t * Sets the specified HTML content inside the element or elements. The HTML will first be processed this means\n-\t\t * URLs will get converted, hex color values fixed etc. Check processHTML for details.\n-\t\t *\n-\t\t * @method setHTML\n-\t\t * @param {Element/String/Array} e DOM element, element id string or array of elements/ids to set HTML inside.\n-\t\t * @param {String} h HTML content to set as inner HTML of the element.\n-\t\t * @example\n-\t\t * // Sets the inner HTML of all paragraphs in the active editor\n-\t\t * tinyMCE.activeEditor.dom.setHTML(tinyMCE.activeEditor.dom.select('p'), 'some inner html');\n-\t\t * \n-\t\t * // Sets the inner HTML of a element by id in the document\n-\t\t * tinyMCE.DOM.setHTML('mydiv', 'some inner html');\n-\t\t */\n-\t\tsetHTML : function(element, html) {\n-\t\t\tvar self = this;\n-\n-\t\t\treturn self.run(element, function(element) {\n-\t\t\t\tif (isIE) {\n-\t\t\t\t\t// Remove all child nodes, IE keeps empty text nodes in DOM\n-\t\t\t\t\twhile (element.firstChild)\n-\t\t\t\t\t\telement.removeChild(element.firstChild);\n-\n-\t\t\t\t\ttry {\n-\t\t\t\t\t\t// IE will remove comments from the beginning\n-\t\t\t\t\t\t// unless you padd the contents with something\n-\t\t\t\t\t\telement.innerHTML = '<br />' + html;\n-\t\t\t\t\t\telement.removeChild(element.firstChild);\n-\t\t\t\t\t} catch (ex) {\n-\t\t\t\t\t\t// IE sometimes produces an unknown runtime error on innerHTML if it's an block element within a block element for example a div inside a p\n-\t\t\t\t\t\t// This seems to fix this problem\n-\n-\t\t\t\t\t\t// Create new div with HTML contents and a BR infront to keep comments\n-\t\t\t\t\t\tvar newElement = self.create('div');\n-\t\t\t\t\t\tnewElement.innerHTML = '<br />' + html;\n-\n-\t\t\t\t\t\t// Add all children from div to target\n-\t\t\t\t\t\teach (tinymce.grep(newElement.childNodes), function(node, i) {\n-\t\t\t\t\t\t\t// Skip br element\n-\t\t\t\t\t\t\tif (i && element.canHaveHTML)\n-\t\t\t\t\t\t\t\telement.appendChild(node);\n-\t\t\t\t\t\t});\n-\t\t\t\t\t}\n-\t\t\t\t} else\n-\t\t\t\t\telement.innerHTML = html;\n-\n-\t\t\t\treturn html;\n-\t\t\t});\n-\t\t},\n-\n-\t\t/**\n-\t\t * Returns the outer HTML of an element.\n-\t\t *\n-\t\t * @method getOuterHTML\n-\t\t * @param {String/Element} elm Element ID or element object to get outer HTML from.\n-\t\t * @return {String} Outer HTML string.\n-\t\t * @example\n-\t\t * tinymce.DOM.getOuterHTML(editorElement);\n-\t\t * tinyMCE.activeEditor.getOuterHTML(tinyMCE.activeEditor.getBody());\n-\t\t */\n-\t\tgetOuterHTML : function(elm) {\n-\t\t\tvar doc, self = this;\n-\n-\t\t\telm = self.get(elm);\n-\n-\t\t\tif (!elm)\n-\t\t\t\treturn null;\n-\n-\t\t\tif (elm.nodeType === 1 && self.hasOuterHTML)\n-\t\t\t\treturn elm.outerHTML;\n-\n-\t\t\tdoc = (elm.ownerDocument || self.doc).createElement(\"body\");\n-\t\t\tdoc.appendChild(elm.cloneNode(true));\n-\n-\t\t\treturn doc.innerHTML;\n-\t\t},\n-\n-\t\t/**\n-\t\t * Sets the specified outer HTML on a element or elements.\n-\t\t *\n-\t\t * @method setOuterHTML\n-\t\t * @param {Element/String/Array} e DOM element, element id string or array of elements/ids to set outer HTML on.\n-\t\t * @param {Object} h HTML code to set as outer value for the element.\n-\t\t * @param {Document} d Optional document scope to use in this process defaults to the document of the DOM class.\n-\t\t * @example\n-\t\t * // Sets the outer HTML of all paragraphs in the active editor\n-\t\t * tinyMCE.activeEditor.dom.setOuterHTML(tinyMCE.activeEditor.dom.select('p'), '<div>some html</div>');\n-\t\t * \n-\t\t * // Sets the outer HTML of a element by id in the document\n-\t\t * tinyMCE.DOM.setOuterHTML('mydiv', '<div>some html</div>');\n-\t\t */\n-\t\tsetOuterHTML : function(e, h, d) {\n-\t\t\tvar t = this;\n-\n-\t\t\tfunction setHTML(e, h, d) {\n-\t\t\t\tvar n, tp;\n-\n-\t\t\t\ttp = d.createElement(\"body\");\n-\t\t\t\ttp.innerHTML = h;\n-\n-\t\t\t\tn = tp.lastChild;\n-\t\t\t\twhile (n) {\n-\t\t\t\t\tt.insertAfter(n.cloneNode(true), e);\n-\t\t\t\t\tn = n.previousSibling;\n-\t\t\t\t}\n-\n-\t\t\t\tt.remove(e);\n-\t\t\t};\n-\n-\t\t\treturn this.run(e, function(e) {\n-\t\t\t\te = t.get(e);\n-\n-\t\t\t\t// Only set HTML on elements\n-\t\t\t\tif (e.nodeType == 1) {\n-\t\t\t\t\td = d || e.ownerDocument || t.doc;\n-\n-\t\t\t\t\tif (isIE) {\n-\t\t\t\t\t\ttry {\n-\t\t\t\t\t\t\t// Try outerHTML for IE it sometimes produces an unknown runtime error\n-\t\t\t\t\t\t\tif (isIE && e.nodeType == 1)\n-\t\t\t\t\t\t\t\te.outerHTML = h;\n-\t\t\t\t\t\t\telse\n-\t\t\t\t\t\t\t\tsetHTML(e, h, d);\n-\t\t\t\t\t\t} catch (ex) {\n-\t\t\t\t\t\t\t// Fix for unknown runtime error\n-\t\t\t\t\t\t\tsetHTML(e, h, d);\n-\t\t\t\t\t\t}\n-\t\t\t\t\t} else\n-\t\t\t\t\t\tsetHTML(e, h, d);\n-\t\t\t\t}\n-\t\t\t});\n-\t\t},\n-\n-\t\t/**\n-\t\t * Entity decode a string, resolves any HTML entities like &aring;.\n-\t\t *\n-\t\t * @method decode\n-\t\t * @param {String} s String to decode entities on.\n-\t\t * @return {String} Entity decoded string.\n-\t\t */\n-\t\tdecode : Entities.decode,\n-\n-\t\t/**\n-\t\t * Entity encodes a string, encodes the most common entities <>\"& into entities.\n-\t\t *\n-\t\t * @method encode\n-\t\t * @param {String} text String to encode with entities.\n-\t\t * @return {String} Entity encoded string.\n-\t\t */\n-\t\tencode : Entities.encodeAllRaw,\n-\n-\t\t/**\n-\t\t * Inserts a element after the reference element.\n-\t\t *\n-\t\t * @method insertAfter\n-\t\t * @param {Element} node Element to insert after the reference.\n-\t\t * @param {Element/String/Array} reference_node Reference element, element id or array of elements to insert after.\n-\t\t * @return {Element/Array} Element that got added or an array with elements. \n-\t\t */\n-\t\tinsertAfter : function(node, reference_node) {\n-\t\t\treference_node = this.get(reference_node);\n-\n-\t\t\treturn this.run(node, function(node) {\n-\t\t\t\tvar parent, nextSibling;\n-\n-\t\t\t\tparent = reference_node.parentNode;\n-\t\t\t\tnextSibling = reference_node.nextSibling;\n-\n-\t\t\t\tif (nextSibling)\n-\t\t\t\t\tparent.insertBefore(node, nextSibling);\n-\t\t\t\telse\n-\t\t\t\t\tparent.appendChild(node);\n-\n-\t\t\t\treturn node;\n-\t\t\t});\n-\t\t},\n-\n-\t\t/**\n-\t\t * Replaces the specified element or elements with the specified element, the new element will\n-\t\t * be cloned if multiple inputs elements are passed.\n-\t\t *\n-\t\t * @method replace\n-\t\t * @param {Element} n New element to replace old ones with.\n-\t\t * @param {Element/String/Array} o Element DOM node, element id or array of elements or ids to replace.\n-\t\t * @param {Boolean} k Optional keep children state, if set to true child nodes from the old object will be added to new ones.\n-\t\t */\n-\t\treplace : function(n, o, k) {\n-\t\t\tvar t = this;\n-\n-\t\t\tif (is(o, 'array'))\n-\t\t\t\tn = n.cloneNode(true);\n-\n-\t\t\treturn t.run(o, function(o) {\n-\t\t\t\tif (k) {\n-\t\t\t\t\teach(tinymce.grep(o.childNodes), function(c) {\n-\t\t\t\t\t\tn.appendChild(c);\n-\t\t\t\t\t});\n-\t\t\t\t}\n-\n-\t\t\t\treturn o.parentNode.replaceChild(n, o);\n-\t\t\t});\n-\t\t},\n-\n-\t\t/**\n-\t\t * Renames the specified element to a new name and keep it's attributes and children.\n-\t\t *\n-\t\t * @method rename\n-\t\t * @param {Element} elm Element to rename.\n-\t\t * @param {String} name Name of the new element.\n-\t\t * @return New element or the old element if it needed renaming.\n-\t\t */\n-\t\trename : function(elm, name) {\n-\t\t\tvar t = this, newElm;\n-\n-\t\t\tif (elm.nodeName != name.toUpperCase()) {\n-\t\t\t\t// Rename block element\n-\t\t\t\tnewElm = t.create(name);\n-\n-\t\t\t\t// Copy attribs to new block\n-\t\t\t\teach(t.getAttribs(elm), function(attr_node) {\n-\t\t\t\t\tt.setAttrib(newElm, attr_node.nodeName, t.getAttrib(elm, attr_node.nodeName));\n-\t\t\t\t});\n-\n-\t\t\t\t// Replace block\n-\t\t\t\tt.replace(newElm, elm, 1);\n-\t\t\t}\n-\n-\t\t\treturn newElm || elm;\n-\t\t},\n-\n-\t\t/**\n-\t\t * Find the common ancestor of two elements. This is a shorter method than using the DOM Range logic.\n-\t\t *\n-\t\t * @method findCommonAncestor\n-\t\t * @param {Element} a Element to find common ancestor of.\n-\t\t * @param {Element} b Element to find common ancestor of.\n-\t\t * @return {Element} Common ancestor element of the two input elements.\n-\t\t */\n-\t\tfindCommonAncestor : function(a, b) {\n-\t\t\tvar ps = a, pe;\n-\n-\t\t\twhile (ps) {\n-\t\t\t\tpe = b;\n-\n-\t\t\t\twhile (pe && ps != pe)\n-\t\t\t\t\tpe = pe.parentNode;\n-\n-\t\t\t\tif (ps == pe)\n-\t\t\t\t\tbreak;\n-\n-\t\t\t\tps = ps.parentNode;\n-\t\t\t}\n-\n-\t\t\tif (!ps && a.ownerDocument)\n-\t\t\t\treturn a.ownerDocument.documentElement;\n-\n-\t\t\treturn ps;\n-\t\t},\n-\n-\t\t/**\n-\t\t * Parses the specified RGB color value and returns a hex version of that color.\n-\t\t *\n-\t\t * @method toHex\n-\t\t * @param {String} s RGB string value like rgb(1,2,3)\n-\t\t * @return {String} Hex version of that RGB value like #FF00FF.\n-\t\t */\n-\t\ttoHex : function(s) {\n-\t\t\tvar c = /^\\s*rgb\\s*?\\(\\s*?([0-9]+)\\s*?,\\s*?([0-9]+)\\s*?,\\s*?([0-9]+)\\s*?\\)\\s*$/i.exec(s);\n-\n-\t\t\tfunction hex(s) {\n-\t\t\t\ts = parseInt(s, 10).toString(16);\n-\n-\t\t\t\treturn s.length > 1 ? s : '0' + s; // 0 -> 00\n-\t\t\t};\n-\n-\t\t\tif (c) {\n-\t\t\t\ts = '#' + hex(c[1]) + hex(c[2]) + hex(c[3]);\n-\n-\t\t\t\treturn s;\n-\t\t\t}\n-\n-\t\t\treturn s;\n-\t\t},\n-\n-\t\t/**\n-\t\t * Returns a array of all single CSS classes in the document. A single CSS class is a simple\n-\t\t * rule like \".class\" complex ones like \"div td.class\" will not be added to output.\n-\t\t *\n-\t\t * @method getClasses\n-\t\t * @return {Array} Array with class objects each object has a class field might be other fields in the future.\n-\t\t */\n-\t\tgetClasses : function() {\n-\t\t\tvar t = this, cl = [], i, lo = {}, f = t.settings.class_filter, ov;\n-\n-\t\t\tif (t.classes)\n-\t\t\t\treturn t.classes;\n-\n-\t\t\tfunction addClasses(s) {\n-\t\t\t\t// IE style imports\n-\t\t\t\teach(s.imports, function(r) {\n-\t\t\t\t\taddClasses(r);\n-\t\t\t\t});\n-\n-\t\t\t\teach(s.cssRules || s.rules, function(r) {\n-\t\t\t\t\t// Real type or fake it on IE\n-\t\t\t\t\tswitch (r.type || 1) {\n-\t\t\t\t\t\t// Rule\n-\t\t\t\t\t\tcase 1:\n-\t\t\t\t\t\t\tif (r.selectorText) {\n-\t\t\t\t\t\t\t\teach(r.selectorText.split(','), function(v) {\n-\t\t\t\t\t\t\t\t\tv = v.replace(/^\\s*|\\s*$|^\\s\\./g, \"\");\n-\n-\t\t\t\t\t\t\t\t\t// Is internal or it doesn't contain a class\n-\t\t\t\t\t\t\t\t\tif (/\\.mce/.test(v) || !/\\.[\\w\\-]+$/.test(v))\n-\t\t\t\t\t\t\t\t\t\treturn;\n-\n-\t\t\t\t\t\t\t\t\t// Remove everything but class name\n-\t\t\t\t\t\t\t\t\tov = v;\n-\t\t\t\t\t\t\t\t\tv = tinymce._replace(/.*\\.([a-z0-9_\\-]+).*/i, '$1', v);\n-\n-\t\t\t\t\t\t\t\t\t// Filter classes\n-\t\t\t\t\t\t\t\t\tif (f && !(v = f(v, ov)))\n-\t\t\t\t\t\t\t\t\t\treturn;\n-\n-\t\t\t\t\t\t\t\t\tif (!lo[v]) {\n-\t\t\t\t\t\t\t\t\t\tcl.push({'class' : v});\n-\t\t\t\t\t\t\t\t\t\tlo[v] = 1;\n-\t\t\t\t\t\t\t\t\t}\n-\t\t\t\t\t\t\t\t});\n-\t\t\t\t\t\t\t}\n-\t\t\t\t\t\t\tbreak;\n-\n-\t\t\t\t\t\t// Import\n-\t\t\t\t\t\tcase 3:\n-\t\t\t\t\t\t\ttry {\n-\t\t\t\t\t\t\t\taddClasses(r.styleSheet);\n-\t\t\t\t\t\t\t} catch (ex) {\n-\t\t\t\t\t\t\t\t// Ignore\n-\t\t\t\t\t\t\t}\n-\n-\t\t\t\t\t\t\tbreak;\n-\t\t\t\t\t}\n-\t\t\t\t});\n-\t\t\t};\n-\n-\t\t\ttry {\n-\t\t\t\teach(t.doc.styleSheets, addClasses);\n-\t\t\t} catch (ex) {\n-\t\t\t\t// Ignore\n-\t\t\t}\n-\n-\t\t\tif (cl.length > 0)\n-\t\t\t\tt.classes = cl;\n-\n-\t\t\treturn cl;\n-\t\t},\n-\n-\t\t/**\n-\t\t * Executes the specified function on the element by id or dom element node or array of elements/id.\n-\t\t *\n-\t\t * @method run\n-\t\t * @param {String/Element/Array} Element ID or DOM element object or array with ids or elements.\n-\t\t * @param {function} f Function to execute for each item.\n-\t\t * @param {Object} s Optional scope to execute the function in.\n-\t\t * @return {Object/Array} Single object or array with objects depending on multiple input or not.\n-\t\t */\n-\t\trun : function(e, f, s) {\n-\t\t\tvar t = this, o;\n-\n-\t\t\tif (t.doc && typeof(e) === 'string')\n-\t\t\t\te = t.get(e);\n-\n-\t\t\tif (!e)\n-\t\t\t\treturn false;\n-\n-\t\t\ts = s || this;\n-\t\t\tif (!e.nodeType && (e.length || e.length === 0)) {\n-\t\t\t\to = [];\n-\n-\t\t\t\teach(e, function(e, i) {\n-\t\t\t\t\tif (e) {\n-\t\t\t\t\t\tif (typeof(e) == 'string')\n-\t\t\t\t\t\t\te = t.doc.getElementById(e);\n-\n-\t\t\t\t\t\to.push(f.call(s, e, i));\n-\t\t\t\t\t}\n-\t\t\t\t});\n-\n-\t\t\t\treturn o;\n-\t\t\t}\n-\n-\t\t\treturn f.call(s, e);\n-\t\t},\n-\n-\t\t/**\n-\t\t * Returns an NodeList with attributes for the element.\n-\t\t *\n-\t\t * @method getAttribs\n-\t\t * @param {HTMLElement/string} n Element node or string id to get attributes from.\n-\t\t * @return {NodeList} NodeList with attributes.\n-\t\t */\n-\t\tgetAttribs : function(n) {\n-\t\t\tvar o;\n-\n-\t\t\tn = this.get(n);\n-\n-\t\t\tif (!n)\n-\t\t\t\treturn [];\n-\n-\t\t\tif (isIE) {\n-\t\t\t\to = [];\n-\n-\t\t\t\t// Object will throw exception in IE\n-\t\t\t\tif (n.nodeName == 'OBJECT')\n-\t\t\t\t\treturn n.attributes;\n-\n-\t\t\t\t// IE doesn't keep the selected attribute if you clone option elements\n-\t\t\t\tif (n.nodeName === 'OPTION' && this.getAttrib(n, 'selected'))\n-\t\t\t\t\to.push({specified : 1, nodeName : 'selected'});\n-\n-\t\t\t\t// It's crazy that this is faster in IE but it's because it returns all attributes all the time\n-\t\t\t\tn.cloneNode(false).outerHTML.replace(/<\\/?[\\w:\\-]+ ?|=[\\\"][^\\\"]+\\\"|=\\'[^\\']+\\'|=[\\w\\-]+|>/gi, '').replace(/[\\w:\\-]+/gi, function(a) {\n-\t\t\t\t\to.push({specified : 1, nodeName : a});\n-\t\t\t\t});\n-\n-\t\t\t\treturn o;\n-\t\t\t}\n-\n-\t\t\treturn n.attributes;\n-\t\t},\n-\n-\t\t/**\n-\t\t * Returns true/false if the specified node is to be considered empty or not.\n-\t\t *\n-\t\t * @example\n-\t\t * tinymce.DOM.isEmpty(node, {img : true});\n-\t\t * @method isEmpty\n-\t\t * @param {Object} elements Optional name/value object with elements that are automatically treated as non empty elements.\n-\t\t * @return {Boolean} true/false if the node is empty or not.\n-\t\t */\n-\t\tisEmpty : function(node, elements) {\n-\t\t\tvar self = this, i, attributes, type, walker, name, brCount = 0;\n-\n-\t\t\tnode = node.firstChild;\n-\t\t\tif (node) {\n-\t\t\t\twalker = new tinymce.dom.TreeWalker(node, node.parentNode);\n-\t\t\t\telements = elements || self.schema ? self.schema.getNonEmptyElements() : null;\n-\n-\t\t\t\tdo {\n-\t\t\t\t\ttype = node.nodeType;\n-\n-\t\t\t\t\tif (type === 1) {\n-\t\t\t\t\t\t// Ignore bogus elements\n-\t\t\t\t\t\tif (node.getAttribute('data-mce-bogus'))\n-\t\t\t\t\t\t\tcontinue;\n-\n-\t\t\t\t\t\t// Keep empty elements like <img />\n-\t\t\t\t\t\tname = node.nodeName.toLowerCase();\n-\t\t\t\t\t\tif (elements && elements[name]) {\n-\t\t\t\t\t\t\t// Ignore single BR elements in blocks like <p><br /></p> or <p><span><br /></span></p>\n-\t\t\t\t\t\t\tif (name === 'br') {\n-\t\t\t\t\t\t\t\tbrCount++;\n-\t\t\t\t\t\t\t\tcontinue;\n-\t\t\t\t\t\t\t}\n-\n-\t\t\t\t\t\t\treturn false;\n-\t\t\t\t\t\t}\n-\n-\t\t\t\t\t\t// Keep elements with data-bookmark attributes or name attribute like <a name=\"1\"></a>\n-\t\t\t\t\t\tattributes = self.getAttribs(node);\n-\t\t\t\t\t\ti = node.attributes.length;\n-\t\t\t\t\t\twhile (i--) {\n-\t\t\t\t\t\t\tname = node.attributes[i].nodeName;\n-\t\t\t\t\t\t\tif (name === \"name\" || name === 'data-mce-bookmark')\n-\t\t\t\t\t\t\t\treturn false;\n-\t\t\t\t\t\t}\n-\t\t\t\t\t}\n-\n-\t\t\t\t\t// Keep comment nodes\n-\t\t\t\t\tif (type == 8)\n-\t\t\t\t\t\treturn false;\n-\n-\t\t\t\t\t// Keep non whitespace text nodes\n-\t\t\t\t\tif ((type === 3 && !whiteSpaceRegExp.test(node.nodeValue)))\n-\t\t\t\t\t\treturn false;\n-\t\t\t\t} while (node = walker.next());\n-\t\t\t}\n-\n-\t\t\treturn brCount <= 1;\n-\t\t},\n-\n-\t\t/**\n-\t\t * Destroys all internal references to the DOM to solve IE leak issues.\n-\t\t *\n-\t\t * @method destroy\n-\t\t */\n-\t\tdestroy : function(s) {\n-\t\t\tvar t = this;\n-\n-\t\t\tt.win = t.doc = t.root = t.events = t.frag = null;\n-\n-\t\t\t// Manual destroy then remove unload handler\n-\t\t\tif (!s)\n-\t\t\t\ttinymce.removeUnload(t.destroy);\n-\t\t},\n-\n-\t\t/**\n-\t\t * Created a new DOM Range object. This will use the native DOM Range API if it's\n-\t\t * available if it's not it will fallback to the custom TinyMCE implementation.\n-\t\t *\n-\t\t * @method createRng\n-\t\t * @return {DOMRange} DOM Range object.\n-\t\t * @example\n-\t\t * var rng = tinymce.DOM.createRng();\n-\t\t * alert(rng.startContainer + \",\" + rng.startOffset);\n-\t\t */\n-\t\tcreateRng : function() {\n-\t\t\tvar d = this.doc;\n-\n-\t\t\treturn d.createRange ? d.createRange() : new tinymce.dom.Range(this);\n-\t\t},\n-\n-\t\t/**\n-\t\t * Returns the index of the specified node within it's parent.\n-\t\t *\n-\t\t * @param {Node} node Node to look for.\n-\t\t * @param {boolean} normalized Optional true/false state if the index is what it would be after a normalization.\n-\t\t * @return {Number} Index of the specified node.\n-\t\t */\n-\t\tnodeIndex : function(node, normalized) {\n-\t\t\tvar idx = 0, lastNodeType, lastNode, nodeType;\n-\n-\t\t\tif (node) {\n-\t\t\t\tfor (lastNodeType = node.nodeType, node = node.previousSibling, lastNode = node; node; node = node.previousSibling) {\n-\t\t\t\t\tnodeType = node.nodeType;\n-\n-\t\t\t\t\t// Normalize text nodes\n-\t\t\t\t\tif (normalized && nodeType == 3) {\n-\t\t\t\t\t\tif (nodeType == lastNodeType || !node.nodeValue.length)\n-\t\t\t\t\t\t\tcontinue;\n-\t\t\t\t\t}\n-\t\t\t\t\tidx++;\n-\t\t\t\t\tlastNodeType = nodeType;\n-\t\t\t\t}\n-\t\t\t}\n-\n-\t\t\treturn idx;\n-\t\t},\n-\n-\t\t/**\n-\t\t * Splits an element into two new elements and places the specified split\n-\t\t * element or element between the new ones. For example splitting the paragraph at the bold element in\n-\t\t * this example <p>abc<b>abc</b>123</p> would produce <p>abc</p><b>abc</b><p>123</p>. \n-\t\t *\n-\t\t * @method split\n-\t\t * @param {Element} pe Parent element to split.\n-\t\t * @param {Element} e Element to split at.\n-\t\t * @param {Element} re Optional replacement element to replace the split element by.\n-\t\t * @return {Element} Returns the split element or the replacement element if that is specified.\n-\t\t */\n-\t\tsplit : function(pe, e, re) {\n-\t\t\tvar t = this, r = t.createRng(), bef, aft, pa;\n-\n-\t\t\t// W3C valid browsers tend to leave empty nodes to the left/right side of the contents, this makes sense\n-\t\t\t// but we don't want that in our code since it serves no purpose for the end user\n-\t\t\t// For example if this is chopped:\n-\t\t\t//   <p>text 1<span><b>CHOP</b></span>text 2</p>\n-\t\t\t// would produce:\n-\t\t\t//   <p>text 1<span></span></p><b>CHOP</b><p><span></span>text 2</p>\n-\t\t\t// this function will then trim of empty edges and produce:\n-\t\t\t//   <p>text 1</p><b>CHOP</b><p>text 2</p>\n-\t\t\tfunction trim(node) {\n-\t\t\t\tvar i, children = node.childNodes, type = node.nodeType;\n-\n-\t\t\t\tfunction surroundedBySpans(node) {\n-\t\t\t\t\tvar previousIsSpan = node.previousSibling && node.previousSibling.nodeName == 'SPAN';\n-\t\t\t\t\tvar nextIsSpan = node.nextSibling && node.nextSibling.nodeName == 'SPAN';\n-\t\t\t\t\treturn previousIsSpan && nextIsSpan;\n-\t\t\t\t}\n-\n-\t\t\t\tif (type == 1 && node.getAttribute('data-mce-type') == 'bookmark')\n-\t\t\t\t\treturn;\n-\n-\t\t\t\tfor (i = children.length - 1; i >= 0; i--)\n-\t\t\t\t\ttrim(children[i]);\n-\n-\t\t\t\tif (type != 9) {\n-\t\t\t\t\t// Keep non whitespace text nodes\n-\t\t\t\t\tif (type == 3 && node.nodeValue.length > 0) {\n-\t\t\t\t\t\t// If parent element isn't a block or there isn't any useful contents for example \"<p>   </p>\"\n-\t\t\t\t\t\t// Also keep text nodes with only spaces if surrounded by spans.\n-\t\t\t\t\t\t// eg. \"<p><span>a</span> <span>b</span></p>\" should keep space between a and b\n-\t\t\t\t\t\tvar trimmedLength = tinymce.trim(node.nodeValue).length;\n-\t\t\t\t\t\tif (!t.isBlock(node.parentNode) || trimmedLength > 0 || trimmedLength === 0 && surroundedBySpans(node))\n-\t\t\t\t\t\t\treturn;\n-\t\t\t\t\t} else if (type == 1) {\n-\t\t\t\t\t\t// If the only child is a bookmark then move it up\n-\t\t\t\t\t\tchildren = node.childNodes;\n-\t\t\t\t\t\tif (children.length == 1 && children[0] && children[0].nodeType == 1 && children[0].getAttribute('data-mce-type') == 'bookmark')\n-\t\t\t\t\t\t\tnode.parentNode.insertBefore(children[0], node);\n-\n-\t\t\t\t\t\t// Keep non empty elements or img, hr etc\n-\t\t\t\t\t\tif (children.length || /^(br|hr|input|img)$/i.test(node.nodeName))\n-\t\t\t\t\t\t\treturn;\n-\t\t\t\t\t}\n-\n-\t\t\t\t\tt.remove(node);\n-\t\t\t\t}\n-\n-\t\t\t\treturn node;\n-\t\t\t};\n-\n-\t\t\tif (pe && e) {\n-\t\t\t\t// Get before chunk\n-\t\t\t\tr.setStart(pe.parentNode, t.nodeIndex(pe));\n-\t\t\t\tr.setEnd(e.parentNode, t.nodeIndex(e));\n-\t\t\t\tbef = r.extractContents();\n-\n-\t\t\t\t// Get after chunk\n-\t\t\t\tr = t.createRng();\n-\t\t\t\tr.setStart(e.parentNode, t.nodeIndex(e) + 1);\n-\t\t\t\tr.setEnd(pe.parentNode, t.nodeIndex(pe) + 1);\n-\t\t\t\taft = r.extractContents();\n-\n-\t\t\t\t// Insert before chunk\n-\t\t\t\tpa = pe.parentNode;\n-\t\t\t\tpa.insertBefore(trim(bef), pe);\n-\n-\t\t\t\t// Insert middle chunk\n-\t\t\t\tif (re)\n-\t\t\t\tpa.replaceChild(re, e);\n-\t\t\telse\n-\t\t\t\tpa.insertBefore(e, pe);\n-\n-\t\t\t\t// Insert after chunk\n-\t\t\t\tpa.insertBefore(trim(aft), pe);\n-\t\t\t\tt.remove(pe);\n-\n-\t\t\t\treturn re || e;\n-\t\t\t}\n-\t\t},\n-\n-\t\t/**\n-\t\t * Adds an event handler to the specified object.\n-\t\t *\n-\t\t * @method bind\n-\t\t * @param {Element/Document/Window/Array/String} o Object or element id string to add event handler to or an array of elements/ids/documents.\n-\t\t * @param {String} n Name of event handler to add for example: click.\n-\t\t * @param {function} f Function to execute when the event occurs.\n-\t\t * @param {Object} s Optional scope to execute the function in.\n-\t\t * @return {function} Function callback handler the same as the one passed in.\n-\t\t */\n-\t\tbind : function(target, name, func, scope) {\n-\t\t\treturn this.events.add(target, name, func, scope || this);\n-\t\t},\n-\n-\t\t/**\n-\t\t * Removes the specified event handler by name and function from a element or collection of elements.\n-\t\t *\n-\t\t * @method unbind\n-\t\t * @param {String/Element/Array} o Element ID string or HTML element or an array of elements or ids to remove handler from.\n-\t\t * @param {String} n Event handler name like for example: \"click\"\n-\t\t * @param {function} f Function to remove.\n-\t\t * @return {bool/Array} Bool state if true if the handler was removed or an array with states if multiple elements where passed in.\n-\t\t */\n-\t\tunbind : function(target, name, func) {\n-\t\t\treturn this.events.remove(target, name, func);\n-\t\t},\n-\n-\t\t/**\n-\t\t * Fires the specified event name with object on target.\n-\t\t *\n-\t\t * @method fire\n-\t\t * @param {Node/Document/Window} target Target element or object to fire event on.\n-\t\t * @param {String} name Name of the event to fire.\n-\t\t * @param {Object} evt Event object to send.\n-\t\t * @return {Event} Event object.\n-\t\t */\n-\t\tfire : function(target, name, evt) {\n-\t\t\treturn this.events.fire(target, name, evt);\n-\t\t},\n-\n-\t\t// Returns the content editable state of a node\n-\t\tgetContentEditable: function(node) {\n-\t\t\tvar contentEditable;\n-\n-\t\t\t// Check type\n-\t\t\tif (node.nodeType != 1) {\n-\t\t\t\treturn null;\n-\t\t\t}\n-\n-\t\t\t// Check for fake content editable\n-\t\t\tcontentEditable = node.getAttribute(\"data-mce-contenteditable\");\n-\t\t\tif (contentEditable && contentEditable !== \"inherit\") {\n-\t\t\t\treturn contentEditable;\n-\t\t\t}\n-\n-\t\t\t// Check for real content editable\n-\t\t\treturn node.contentEditable !== \"inherit\" ? node.contentEditable : null;\n-\t\t},\n-\n-\t\t// #ifdef debug\n-\n-\t\tdumpRng : function(r) {\n-\t\t\treturn 'startContainer: ' + r.startContainer.nodeName + ', startOffset: ' + r.startOffset + ', endContainer: ' + r.endContainer.nodeName + ', endOffset: ' + r.endOffset;\n-\t\t},\n-\n-\t\t// #endif\n-\n-\t\t_findSib : function(node, selector, name) {\n-\t\t\tvar t = this, f = selector;\n-\n-\t\t\tif (node) {\n-\t\t\t\t// If expression make a function of it using is\n-\t\t\t\tif (is(f, 'string')) {\n-\t\t\t\t\tf = function(node) {\n-\t\t\t\t\t\treturn t.is(node, selector);\n-\t\t\t\t\t};\n-\t\t\t\t}\n-\n-\t\t\t\t// Loop all siblings\n-\t\t\t\tfor (node = node[name]; node; node = node[name]) {\n-\t\t\t\t\tif (f(node))\n-\t\t\t\t\t\treturn node;\n-\t\t\t\t}\n-\t\t\t}\n-\n-\t\t\treturn null;\n-\t\t},\n-\n-\t\t_isRes : function(c) {\n-\t\t\t// Is live resizble element\n-\t\t\treturn /^(top|left|bottom|right|width|height)/i.test(c) || /;\\s*(top|left|bottom|right|width|height)/i.test(c);\n-\t\t}\n-\n-\t\t/*\n-\t\twalk : function(n, f, s) {\n-\t\t\tvar d = this.doc, w;\n-\n-\t\t\tif (d.createTreeWalker) {\n-\t\t\t\tw = d.createTreeWalker(n, NodeFilter.SHOW_TEXT, null, false);\n-\n-\t\t\t\twhile ((n = w.nextNode()) != null)\n-\t\t\t\t\tf.call(s || this, n);\n-\t\t\t} else\n-\t\t\t\ttinymce.walk(n, f, 'childNodes', s);\n-\t\t}\n-\t\t*/\n-\n-\t\t/*\n-\t\ttoRGB : function(s) {\n-\t\t\tvar c = /^\\s*?#([0-9A-F]{2})([0-9A-F]{1,2})([0-9A-F]{2})?\\s*?$/.exec(s);\n-\n-\t\t\tif (c) {\n-\t\t\t\t// #FFF -> #FFFFFF\n-\t\t\t\tif (!is(c[3]))\n-\t\t\t\t\tc[3] = c[2] = c[1];\n-\n-\t\t\t\treturn \"rgb(\" + parseInt(c[1], 16) + \",\" + parseInt(c[2], 16) + \",\" + parseInt(c[3], 16) + \")\";\n-\t\t\t}\n-\n-\t\t\treturn s;\n-\t\t}\n-\t\t*/\n-\t});\n-\n-\t/**\n-\t * Instance of DOMUtils for the current document.\n-\t *\n-\t * @property DOM\n-\t * @member tinymce\n-\t * @type tinymce.dom.DOMUtils\n-\t * @example\n-\t * // Example of how to add a class to some element by id\n-\t * tinymce.DOM.addClass('someid', 'someclass');\n-\t */\n-\ttinymce.DOM = new tinymce.dom.DOMUtils(document, {process_html : 0});\n-})(tinymce);"
        },
        {
            "filename": "js/tiny_mce/classes/dom/Element.js",
            "diff": "@@ -1,195 +0,0 @@\n-/**\n- * Element.js\n- *\n- * Copyright, Moxiecode Systems AB\n- * Released under LGPL License.\n- *\n- * License: http://www.tinymce.com/license\n- * Contributing: http://www.tinymce.com/contributing\n- */\n-\n-(function(tinymce) {\n-\t/**\n-\t * Element class, this enables element blocking in IE. Element blocking is a method to block out select blockes that\n-\t * gets visible though DIVs on IE 6 it uses a iframe for this blocking. This class also shortens the length of some DOM API calls\n-\t * since it's bound to an element.\n-\t *\n-\t * @class tinymce.dom.Element\n-\t * @example\n-\t * // Creates an basic element for an existing element\n-\t * var elm = new tinymce.dom.Element('someid');\n-\t * \n-\t * elm.setStyle('background-color', 'red');\n-\t * elm.moveTo(10, 10);\n-\t */\n-\n-\t/**\n-\t * Constructs a new Element instance. Consult the Wiki for more details on this class.\n-\t *\n-\t * @constructor\n-\t * @method Element\n-\t * @param {String} id Element ID to bind/execute methods on.\n-\t * @param {Object} settings Optional settings name/value collection.\n-\t */\n-\ttinymce.dom.Element = function(id, settings) {\n-\t\tvar t = this, dom, el;\n-\n-\t\tt.settings = settings = settings || {};\n-\t\tt.id = id;\n-\t\tt.dom = dom = settings.dom || tinymce.DOM;\n-\n-\t\t// Only IE leaks DOM references, this is a lot faster\n-\t\tif (!tinymce.isIE)\n-\t\t\tel = dom.get(t.id);\n-\n-\t\ttinymce.each(\n-\t\t\t\t('getPos,getRect,getParent,add,setStyle,getStyle,setStyles,' + \n-\t\t\t\t'setAttrib,setAttribs,getAttrib,addClass,removeClass,' + \n-\t\t\t\t'hasClass,getOuterHTML,setOuterHTML,remove,show,hide,' + \n-\t\t\t\t'isHidden,setHTML,get').split(/,/), function(k) {\n-\t\t\t\t\tt[k] = function() {\n-\t\t\t\t\t\tvar a = [id], i;\n-\n-\t\t\t\t\t\tfor (i = 0; i < arguments.length; i++)\n-\t\t\t\t\t\t\ta.push(arguments[i]);\n-\n-\t\t\t\t\t\ta = dom[k].apply(dom, a);\n-\t\t\t\t\t\tt.update(k);\n-\n-\t\t\t\t\t\treturn a;\n-\t\t\t\t\t};\n-\t\t\t}\n-\t\t);\n-\n-\t\ttinymce.extend(t, {\n-\t\t\t/**\n-\t\t\t * Adds a event handler to the element.\n-\t\t\t *\n-\t\t\t * @method on\n-\t\t\t * @param {String} n Event name like for example \"click\".\n-\t\t\t * @param {function} f Function to execute on the specified event.\n-\t\t\t * @param {Object} s Optional scope to execute function on.\n-\t\t\t * @return {function} Event handler function the same as the input function.\n-\t\t\t */\n-\t\t\ton : function(n, f, s) {\n-\t\t\t\treturn tinymce.dom.Event.add(t.id, n, f, s);\n-\t\t\t},\n-\n-\t\t\t/**\n-\t\t\t * Returns the absolute X, Y cordinate of the element.\n-\t\t\t *\n-\t\t\t * @method getXY\n-\t\t\t * @return {Object} Objext with x, y cordinate fields.\n-\t\t\t */\n-\t\t\tgetXY : function() {\n-\t\t\t\treturn {\n-\t\t\t\t\tx : parseInt(t.getStyle('left')),\n-\t\t\t\t\ty : parseInt(t.getStyle('top'))\n-\t\t\t\t};\n-\t\t\t},\n-\n-\t\t\t/**\n-\t\t\t * Returns the size of the element by a object with w and h fields.\n-\t\t\t *\n-\t\t\t * @method getSize\n-\t\t\t * @return {Object} Object with element size with a w and h field.\n-\t\t\t */\n-\t\t\tgetSize : function() {\n-\t\t\t\tvar n = dom.get(t.id);\n-\n-\t\t\t\treturn {\n-\t\t\t\t\tw : parseInt(t.getStyle('width') || n.clientWidth),\n-\t\t\t\t\th : parseInt(t.getStyle('height') || n.clientHeight)\n-\t\t\t\t};\n-\t\t\t},\n-\n-\t\t\t/**\n-\t\t\t * Moves the element to a specific absolute position.\n-\t\t\t *\n-\t\t\t * @method moveTo\n-\t\t\t * @param {Number} x X cordinate of element position.\n-\t\t\t * @param {Number} y Y cordinate of element position.\n-\t\t\t */\n-\t\t\tmoveTo : function(x, y) {\n-\t\t\t\tt.setStyles({left : x, top : y});\n-\t\t\t},\n-\n-\t\t\t/**\n-\t\t\t * Moves the element relative to the current position.\n-\t\t\t *\n-\t\t\t * @method moveBy\n-\t\t\t * @param {Number} x Relative X cordinate of element position.\n-\t\t\t * @param {Number} y Relative Y cordinate of element position.\n-\t\t\t */\n-\t\t\tmoveBy : function(x, y) {\n-\t\t\t\tvar p = t.getXY();\n-\n-\t\t\t\tt.moveTo(p.x + x, p.y + y);\n-\t\t\t},\n-\n-\t\t\t/**\n-\t\t\t * Resizes the element to a specific size.\n-\t\t\t *\n-\t\t\t * @method resizeTo\n-\t\t\t * @param {Number} w New width of element.\n-\t\t\t * @param {Numner} h New height of element.\n-\t\t\t */\n-\t\t\tresizeTo : function(w, h) {\n-\t\t\t\tt.setStyles({width : w, height : h});\n-\t\t\t},\n-\n-\t\t\t/**\n-\t\t\t * Resizes the element relative to the current sizeto a specific size.\n-\t\t\t *\n-\t\t\t * @method resizeBy\n-\t\t\t * @param {Number} w Relative width of element.\n-\t\t\t * @param {Numner} h Relative height of element.\n-\t\t\t */\n-\t\t\tresizeBy : function(w, h) {\n-\t\t\t\tvar s = t.getSize();\n-\n-\t\t\t\tt.resizeTo(s.w + w, s.h + h);\n-\t\t\t},\n-\n-\t\t\t/**\n-\t\t\t * Updates the element blocker in IE6 based on the style information of the element.\n-\t\t\t *\n-\t\t\t * @method update\n-\t\t\t * @param {String} k Optional function key. Used internally.\n-\t\t\t */\n-\t\t\tupdate : function(k) {\n-\t\t\t\tvar b;\n-\n-\t\t\t\tif (tinymce.isIE6 && settings.blocker) {\n-\t\t\t\t\tk = k || '';\n-\n-\t\t\t\t\t// Ignore getters\n-\t\t\t\t\tif (k.indexOf('get') === 0 || k.indexOf('has') === 0 || k.indexOf('is') === 0)\n-\t\t\t\t\t\treturn;\n-\n-\t\t\t\t\t// Remove blocker on remove\n-\t\t\t\t\tif (k == 'remove') {\n-\t\t\t\t\t\tdom.remove(t.blocker);\n-\t\t\t\t\t\treturn;\n-\t\t\t\t\t}\n-\n-\t\t\t\t\tif (!t.blocker) {\n-\t\t\t\t\t\tt.blocker = dom.uniqueId();\n-\t\t\t\t\t\tb = dom.add(settings.container || dom.getRoot(), 'iframe', {id : t.blocker, style : 'position:absolute;', frameBorder : 0, src : 'javascript:\"\"'});\n-\t\t\t\t\t\tdom.setStyle(b, 'opacity', 0);\n-\t\t\t\t\t} else\n-\t\t\t\t\t\tb = dom.get(t.blocker);\n-\n-\t\t\t\t\tdom.setStyles(b, {\n-\t\t\t\t\t\tleft : t.getStyle('left', 1),\n-\t\t\t\t\t\ttop : t.getStyle('top', 1),\n-\t\t\t\t\t\twidth : t.getStyle('width', 1),\n-\t\t\t\t\t\theight : t.getStyle('height', 1),\n-\t\t\t\t\t\tdisplay : t.getStyle('display', 1),\n-\t\t\t\t\t\tzIndex : parseInt(t.getStyle('zIndex', 1) || 0) - 1\n-\t\t\t\t\t});\n-\t\t\t\t}\n-\t\t\t}\n-\t\t});\n-\t};\n-})(tinymce);"
        },
        {
            "filename": "js/tiny_mce/classes/dom/EventUtils.js",
            "diff": "@@ -1,616 +0,0 @@\n-/**\n- * EventUtils.js\n- *\n- * Copyright, Moxiecode Systems AB\n- * Released under LGPL License.\n- *\n- * License: http://www.tinymce.com/license\n- * Contributing: http://www.tinymce.com/contributing\n- */\n-\n-// JSLint defined globals\n-/*global tinymce:false, window:false */\n-\n-tinymce.dom = {};\n-\n-(function(namespace, expando) {\n-\tvar w3cEventModel = !!document.addEventListener;\n-\n-\t/**\n-\t * Binds a native event to a callback on the speified target.\n-\t */\n-\tfunction addEvent(target, name, callback, capture) {\n-\t\tif (target.addEventListener) {\n-\t\t\ttarget.addEventListener(name, callback, capture || false);\n-\t\t} else if (target.attachEvent) {\n-\t\t\ttarget.attachEvent('on' + name, callback);\n-\t\t}\n-\t}\n-\n-\t/**\n-\t * Unbinds a native event callback on the specified target.\n-\t */\n-\tfunction removeEvent(target, name, callback, capture) {\n-\t\tif (target.removeEventListener) {\n-\t\t\ttarget.removeEventListener(name, callback, capture || false);\n-\t\t} else if (target.detachEvent) {\n-\t\t\ttarget.detachEvent('on' + name, callback);\n-\t\t}\n-\t}\n-\n-\t/**\n-\t * Normalizes a native event object or just adds the event specific methods on a custom event.\n-\t */\n-\tfunction fix(original_event, data) {\n-\t\tvar name, event = data || {};\n-\n-\t\t// Dummy function that gets replaced on the delegation state functions\n-\t\tfunction returnFalse() {\n-\t\t\treturn false;\n-\t\t}\n-\n-\t\t// Dummy function that gets replaced on the delegation state functions\n-\t\tfunction returnTrue() {\n-\t\t\treturn true;\n-\t\t}\n-\n-\t\t// Copy all properties from the original event\n-\t\tfor (name in original_event) {\n-\t\t\t// layerX/layerY is deprecated in Chrome and produces a warning\n-\t\t\tif (name !== \"layerX\" && name !== \"layerY\") {\n-\t\t\t\tevent[name] = original_event[name];\n-\t\t\t}\n-\t\t}\n-\n-\t\t// Normalize target IE uses srcElement\n-\t\tif (!event.target) {\n-\t\t\tevent.target = event.srcElement || document;\n-\t\t}\n-\n-\t\t// Add preventDefault method\n-\t\tevent.preventDefault = function() {\n-\t\t\tevent.isDefaultPrevented = returnTrue;\n-\n-\t\t\t// Execute preventDefault on the original event object\n-\t\t\tif (original_event) {\n-\t\t\t\tif (original_event.preventDefault) {\n-\t\t\t\t\toriginal_event.preventDefault();\n-\t\t\t\t} else {\n-\t\t\t\t\toriginal_event.returnValue = false; // IE\n-\t\t\t\t}\n-\t\t\t}\n-\t\t};\n-\n-\t\t// Add stopPropagation\n-\t\tevent.stopPropagation = function() {\n-\t\t\tevent.isPropagationStopped = returnTrue;\n-\n-\t\t\t// Execute stopPropagation on the original event object\n-\t\t\tif (original_event) {\n-\t\t\t\tif (original_event.stopPropagation) {\n-\t\t\t\t\toriginal_event.stopPropagation();\n-\t\t\t\t} else {\n-\t\t\t\t\toriginal_event.cancelBubble = true; // IE\n-\t\t\t\t}\n-\t\t\t }\n-\t\t};\n-\n-\t\t// Add stopImmediatePropagation\n-\t\tevent.stopImmediatePropagation = function() {\n-\t\t\tevent.isImmediatePropagationStopped = returnTrue;\n-\t\t\tevent.stopPropagation();\n-\t\t};\n-\n-\t\t// Add event delegation states\n-\t\tif (!event.isDefaultPrevented) {\n-\t\t\tevent.isDefaultPrevented = returnFalse;\n-\t\t\tevent.isPropagationStopped = returnFalse;\n-\t\t\tevent.isImmediatePropagationStopped = returnFalse;\n-\t\t}\n-\n-\t\treturn event;\n-\t}\n-\n-\t/**\n-\t * Bind a DOMContentLoaded event across browsers and executes the callback once the page DOM is initialized.\n-\t * It will also set/check the domLoaded state of the event_utils instance so ready isn't called multiple times.\n-\t */\n-\tfunction bindOnReady(win, callback, event_utils) {\n-\t\tvar doc = win.document, event = {type: 'ready'};\n-\n-\t\t// Gets called when the DOM is ready\n-\t\tfunction readyHandler() {\n-\t\t\tif (!event_utils.domLoaded) {\n-\t\t\t\tevent_utils.domLoaded = true;\n-\t\t\t\tcallback(event);\n-\t\t\t}\n-\t\t}\n-\n-\t\t// Page already loaded then fire it directly\n-\t\tif (doc.readyState == \"complete\") {\n-\t\t\treadyHandler();\n-\t\t\treturn;\n-\t\t}\n-\n-\t\t// Use W3C method\n-\t\tif (w3cEventModel) {\n-\t\t\taddEvent(win, 'DOMContentLoaded', readyHandler);\n-\t\t} else {\n-\t\t\t// Use IE method\n-\t\t\taddEvent(doc, \"readystatechange\", function() {\n-\t\t\t\tif (doc.readyState === \"complete\") {\n-\t\t\t\t\tremoveEvent(doc, \"readystatechange\", arguments.callee);\n-\t\t\t\t\treadyHandler();\n-\t\t\t\t}\n-\t\t\t});\n-\n-\t\t\t// Wait until we can scroll, when we can the DOM is initialized\n-\t\t\tif (doc.documentElement.doScroll && win === win.top) {\n-\t\t\t\t(function() {\n-\t\t\t\t\ttry {\n-\t\t\t\t\t\t// If IE is used, use the trick by Diego Perini licensed under MIT by request to the author.\n-\t\t\t\t\t\t// http://javascript.nwbox.com/IEContentLoaded/\n-\t\t\t\t\t\tdoc.documentElement.doScroll(\"left\");\n-\t\t\t\t\t} catch (ex) {\n-\t\t\t\t\t\tsetTimeout(arguments.callee, 0);\n-\t\t\t\t\t\treturn;\n-\t\t\t\t\t}\n-\n-\t\t\t\t\treadyHandler();\n-\t\t\t\t})();\n-\t\t\t}\n-\t\t}\n-\n-\t\t// Fallback if any of the above methods should fail for some odd reason\n-\t\taddEvent(win, 'load', readyHandler);\n-\t}\n-\n-\t/**\n-\t * This class enables you to bind/unbind native events to elements and normalize it's behavior across browsers.\n-\t */\n-\tfunction EventUtils(proxy) {\n-\t\tvar self = this, events = {}, count, isFocusBlurBound, hasFocusIn, hasMouseEnterLeave, mouseEnterLeave;\n-\n-\t\thasMouseEnterLeave = \"onmouseenter\" in document.documentElement;\n-\t\thasFocusIn = \"onfocusin\" in document.documentElement;\n-\t\tmouseEnterLeave = {mouseenter: 'mouseover', mouseleave: 'mouseout'};\n-\t\tcount = 1;\n-\n-\t\t// State if the DOMContentLoaded was executed or not\n-\t\tself.domLoaded = false;\n-\t\tself.events = events;\n-\n-\t\t/**\n-\t\t * Executes all event handler callbacks for a specific event.\n-\t\t *\n-\t\t * @param {Event} evt Event object.\n-\t\t * @param {String} id Expando id value to look for.\n-\t\t */\n-\t\tfunction executeHandlers(evt, id) {\n-\t\t\tvar callbackList, i, l, callback;\n-\n-\t\t\tcallbackList = events[id][evt.type];\n-\t\t\tif (callbackList) {\n-\t\t\t\tfor (i = 0, l = callbackList.length; i < l; i++) {\n-\t\t\t\t\tcallback = callbackList[i];\n-\t\t\t\t\t\n-\t\t\t\t\t// Check if callback exists might be removed if a unbind is called inside the callback\n-\t\t\t\t\tif (callback && callback.func.call(callback.scope, evt) === false) {\n-\t\t\t\t\t\tevt.preventDefault();\n-\t\t\t\t\t}\n-\n-\t\t\t\t\t// Should we stop propagation to immediate listeners\n-\t\t\t\t\tif (evt.isImmediatePropagationStopped()) {\n-\t\t\t\t\t\treturn;\n-\t\t\t\t\t}\n-\t\t\t\t}\n-\t\t\t}\n-\t\t}\n-\n-\t\t/**\n-\t\t * Binds a callback to an event on the specified target.\n-\t\t *\n-\t\t * @method bind\n-\t\t * @param {Object} target Target node/window or custom object.\n-\t\t * @param {String} names Name of the event to bind.\n-\t\t * @param {function} callback Callback function to execute when the event occurs.\n-\t\t * @param {Object} scope Scope to call the callback function on, defaults to target.\n-\t\t * @return {function} Callback function that got bound.\n-\t\t */\n-\t\tself.bind = function(target, names, callback, scope) {\n-\t\t\tvar id, callbackList, i, name, fakeName, nativeHandler, capture, win = window;\n-\n-\t\t\t// Native event handler function patches the event and executes the callbacks for the expando\n-\t\t\tfunction defaultNativeHandler(evt) {\n-\t\t\t\texecuteHandlers(fix(evt || win.event), id);\n-\t\t\t}\n-\n-\t\t\t// Don't bind to text nodes or comments\n-\t\t\tif (!target || target.nodeType === 3 || target.nodeType === 8) {\n-\t\t\t\treturn;\n-\t\t\t}\n-\n-\t\t\t// Create or get events id for the target\n-\t\t\tif (!target[expando]) {\n-\t\t\t\tid = count++;\n-\t\t\t\ttarget[expando] = id;\n-\t\t\t\tevents[id] = {};\n-\t\t\t} else {\n-\t\t\t\tid = target[expando];\n-\n-\t\t\t\tif (!events[id]) {\n-\t\t\t\t\tevents[id] = {};\n-\t\t\t\t}\n-\t\t\t}\n-\n-\t\t\t// Setup the specified scope or use the target as a default\n-\t\t\tscope = scope || target;\n-\n-\t\t\t// Split names and bind each event, enables you to bind multiple events with one call\n-\t\t\tnames = names.split(' ');\n-\t\t\ti = names.length;\n-\t\t\twhile (i--) {\n-\t\t\t\tname = names[i];\n-\t\t\t\tnativeHandler = defaultNativeHandler;\n-\t\t\t\tfakeName = capture = false;\n-\n-\t\t\t\t// Use ready instead of DOMContentLoaded\n-\t\t\t\tif (name === \"DOMContentLoaded\") {\n-\t\t\t\t\tname = \"ready\";\n-\t\t\t\t}\n-\n-\t\t\t\t// DOM is already ready\n-\t\t\t\tif ((self.domLoaded || target.readyState == 'complete') && name === \"ready\") {\n-\t\t\t\t\tself.domLoaded = true;\n-\t\t\t\t\tcallback.call(scope, fix({type: name}));\n-\t\t\t\t\tcontinue;\n-\t\t\t\t}\n-\n-\t\t\t\t// Handle mouseenter/mouseleaver\n-\t\t\t\tif (!hasMouseEnterLeave) {\n-\t\t\t\t\tfakeName = mouseEnterLeave[name];\n-\n-\t\t\t\t\tif (fakeName) {\n-\t\t\t\t\t\tnativeHandler = function(evt) {\n-\t\t\t\t\t\t\tvar current, related;\n-\n-\t\t\t\t\t\t\tcurrent = evt.currentTarget;\n-\t\t\t\t\t\t\trelated = evt.relatedTarget;\n-\n-\t\t\t\t\t\t\t// Check if related is inside the current target if it's not then the event should be ignored since it's a mouseover/mouseout inside the element\n-\t\t\t\t\t\t\tif (related && current.contains) {\n-\t\t\t\t\t\t\t\t// Use contains for performance\n-\t\t\t\t\t\t\t\trelated = current.contains(related);\n-\t\t\t\t\t\t\t} else {\n-\t\t\t\t\t\t\t\twhile (related && related !== current) {\n-\t\t\t\t\t\t\t\t\trelated = related.parentNode;\n-\t\t\t\t\t\t\t\t}\n-\t\t\t\t\t\t\t}\n-\n-\t\t\t\t\t\t\t// Fire fake event\n-\t\t\t\t\t\t\tif (!related) {\n-\t\t\t\t\t\t\t\tevt = fix(evt || win.event);\n-\t\t\t\t\t\t\t\tevt.type = evt.type === 'mouseout' ? 'mouseleave' : 'mouseenter';\n-\t\t\t\t\t\t\t\tevt.target = current;\n-\t\t\t\t\t\t\t\texecuteHandlers(evt, id);\n-\t\t\t\t\t\t\t}\n-\t\t\t\t\t\t};\n-\t\t\t\t\t}\n-\t\t\t\t}\n-\n-\t\t\t\t// Fake bubbeling of focusin/focusout\n-\t\t\t\tif (!hasFocusIn && (name === \"focusin\" || name === \"focusout\")) {\n-\t\t\t\t\tcapture = true;\n-\t\t\t\t\tfakeName = name === \"focusin\" ? \"focus\" : \"blur\";\n-\t\t\t\t\tnativeHandler = function(evt) {\n-\t\t\t\t\t\tevt = fix(evt || win.event);\n-\t\t\t\t\t\tevt.type = evt.type === 'focus' ? 'focusin' : 'focusout';\n-\t\t\t\t\t\texecuteHandlers(evt, id);\n-\t\t\t\t\t};\n-\t\t\t\t}\n-\n-\t\t\t\t// Setup callback list and bind native event\n-\t\t\t\tcallbackList = events[id][name];\n-\t\t\t\tif (!callbackList) {\n-\t\t\t\t\tevents[id][name] = callbackList = [{func: callback, scope: scope}];\n-\t\t\t\t\tcallbackList.fakeName = fakeName;\n-\t\t\t\t\tcallbackList.capture = capture;\n-\n-\t\t\t\t\t// Add the nativeHandler to the callback list so that we can later unbind it\n-\t\t\t\t\tcallbackList.nativeHandler = nativeHandler;\n-\t\t\t\t\tif (!w3cEventModel) {\n-\t\t\t\t\t\tcallbackList.proxyHandler = proxy(id);\n-\t\t\t\t\t}\n-\n-\t\t\t\t\t// Check if the target has native events support\n-\t\t\t\t\tif (name === \"ready\") {\n-\t\t\t\t\t\tbindOnReady(target, nativeHandler, self);\n-\t\t\t\t\t} else {\n-\t\t\t\t\t\taddEvent(target, fakeName || name, w3cEventModel ? nativeHandler : callbackList.proxyHandler, capture);\n-\t\t\t\t\t}\n-\t\t\t\t} else {\n-\t\t\t\t\t// If it already has an native handler then just push the callback\n-\t\t\t\t\tcallbackList.push({func: callback, scope: scope});\n-\t\t\t\t}\n-\t\t\t}\n-\n-\t\t\ttarget = callbackList = 0; // Clean memory for IE\n-\n-\t\t\treturn callback;\n-\t\t};\n-\n-\t\t/**\n-\t\t * Unbinds the specified event by name, name and callback or all events on the target.\n-\t\t *\n-\t\t * @method unbind\n-\t\t * @param {Object} target Target node/window or custom object.\n-\t\t * @param {String} names Optional event name to unbind.\n-\t\t * @param {function} callback Optional callback function to unbind.\n-\t\t * @return {EventUtils} Event utils instance.\n-\t\t */\n-\t\tself.unbind = function(target, names, callback) {\n-\t\t\tvar id, callbackList, i, ci, name, eventMap;\n-\n-\t\t\t// Don't bind to text nodes or comments\n-\t\t\tif (!target || target.nodeType === 3 || target.nodeType === 8) {\n-\t\t\t\treturn self;\n-\t\t\t}\n-\n-\t\t\t// Unbind event or events if the target has the expando\n-\t\t\tid = target[expando];\n-\t\t\tif (id) {\n-\t\t\t\teventMap = events[id];\n-\n-\t\t\t\t// Specific callback\n-\t\t\t\tif (names) {\n-\t\t\t\t\tnames = names.split(' ');\n-\t\t\t\t\ti = names.length;\n-\t\t\t\t\twhile (i--) {\n-\t\t\t\t\t\tname = names[i];\n-\t\t\t\t\t\tcallbackList = eventMap[name];\n-\n-\t\t\t\t\t\t// Unbind the event if it exists in the map\n-\t\t\t\t\t\tif (callbackList) {\n-\t\t\t\t\t\t\t// Remove specified callback\n-\t\t\t\t\t\t\tif (callback) {\n-\t\t\t\t\t\t\t\tci = callbackList.length;\n-\t\t\t\t\t\t\t\twhile (ci--) {\n-\t\t\t\t\t\t\t\t\tif (callbackList[ci].func === callback) {\n-\t\t\t\t\t\t\t\t\t\tcallbackList.splice(ci, 1);\n-\t\t\t\t\t\t\t\t\t}\n-\t\t\t\t\t\t\t\t}\n-\t\t\t\t\t\t\t}\n-\n-\t\t\t\t\t\t\t// Remove all callbacks if there isn't a specified callback or there is no callbacks left\n-\t\t\t\t\t\t\tif (!callback || callbackList.length === 0) {\n-\t\t\t\t\t\t\t\tdelete eventMap[name];\n-\t\t\t\t\t\t\t\tremoveEvent(target, callbackList.fakeName || name, w3cEventModel ? callbackList.nativeHandler : callbackList.proxyHandler, callbackList.capture);\n-\t\t\t\t\t\t\t}\n-\t\t\t\t\t\t}\n-\t\t\t\t\t}\n-\t\t\t\t} else {\n-\t\t\t\t\t// All events for a specific element\n-\t\t\t\t\tfor (name in eventMap) {\n-\t\t\t\t\t\tcallbackList = eventMap[name];\n-\t\t\t\t\t\tremoveEvent(target, callbackList.fakeName || name, w3cEventModel ? callbackList.nativeHandler : callbackList.proxyHandler, callbackList.capture);\n-\t\t\t\t\t}\n-\n-\t\t\t\t\teventMap = {};\n-\t\t\t\t}\n-\n-\t\t\t\t// Check if object is empty, if it isn't then we won't remove the expando map\n-\t\t\t\tfor (name in eventMap) {\n-\t\t\t\t\treturn self;\n-\t\t\t\t}\n-\n-\t\t\t\t// Delete event object\n-\t\t\t\tdelete events[id];\n-\n-\t\t\t\t// Remove expando from target\n-\t\t\t\ttry {\n-\t\t\t\t\t// IE will fail here since it can't delete properties from window\n-\t\t\t\t\tdelete target[expando];\n-\t\t\t\t} catch (ex) {\n-\t\t\t\t\t// IE will set it to null\n-\t\t\t\t\ttarget[expando] = null;\n-\t\t\t\t}\n-\t\t\t}\n-\n-\t\t\treturn self;\n-\t\t};\n-\n-\t\t/**\n-\t\t * Fires the specified event on the specified target.\n-\t\t *\n-\t\t * @method fire\n-\t\t * @param {Object} target Target node/window or custom object.\n-\t\t * @param {String} name Event name to fire.\n-\t\t * @param {Object} args Optional arguments to send to the observers.\n-\t\t * @return {EventUtils} Event utils instance.\n-\t\t */\n-\t\tself.fire = function(target, name, args) {\n-\t\t\tvar id, event;\n-\n-\t\t\t// Don't bind to text nodes or comments\n-\t\t\tif (!target || target.nodeType === 3 || target.nodeType === 8) {\n-\t\t\t\treturn self;\n-\t\t\t}\n-\n-\t\t\t// Build event object by patching the args\n-\t\t\tevent = fix(null, args);\n-\t\t\tevent.type = name;\n-\n-\t\t\tdo {\n-\t\t\t\t// Found an expando that means there is listeners to execute\n-\t\t\t\tid = target[expando];\n-\t\t\t\tif (id) {\n-\t\t\t\t\texecuteHandlers(event, id);\n-\t\t\t\t}\n-\n-\t\t\t\t// Walk up the DOM\n-\t\t\t\ttarget = target.parentNode || target.ownerDocument || target.defaultView || target.parentWindow;\n-\t\t\t} while (target && !event.isPropagationStopped());\n-\n-\t\t\treturn self;\n-\t\t};\n-\n-\t\t/**\n-\t\t * Removes all bound event listeners for the specified target. This will also remove any bound\n-\t\t * listeners to child nodes within that target.\n-\t\t *\n-\t\t * @method clean\n-\t\t * @param {Object} target Target node/window object.\n-\t\t * @return {EventUtils} Event utils instance.\n-\t\t */\n-\t\tself.clean = function(target) {\n-\t\t\tvar i, children, unbind = self.unbind;\n-\t\n-\t\t\t// Don't bind to text nodes or comments\n-\t\t\tif (!target || target.nodeType === 3 || target.nodeType === 8) {\n-\t\t\t\treturn self;\n-\t\t\t}\n-\n-\t\t\t// Unbind any element on the specificed target\n-\t\t\tif (target[expando]) {\n-\t\t\t\tunbind(target);\n-\t\t\t}\n-\n-\t\t\t// Target doesn't have getElementsByTagName it's probably a window object then use it's document to find the children\n-\t\t\tif (!target.getElementsByTagName) {\n-\t\t\t\ttarget = target.document;\n-\t\t\t}\n-\n-\t\t\t// Remove events from each child element\n-\t\t\tif (target && target.getElementsByTagName) {\n-\t\t\t\tunbind(target);\n-\n-\t\t\t\tchildren = target.getElementsByTagName('*');\n-\t\t\t\ti = children.length;\n-\t\t\t\twhile (i--) {\n-\t\t\t\t\ttarget = children[i];\n-\n-\t\t\t\t\tif (target[expando]) {\n-\t\t\t\t\t\tunbind(target);\n-\t\t\t\t\t}\n-\t\t\t\t}\n-\t\t\t}\n-\n-\t\t\treturn self;\n-\t\t};\n-\n-\t\tself.callNativeHandler = function(id, evt) {\n-\t\t\tif (events) {\n-\t\t\t\tevents[id][evt.type].nativeHandler(evt);\n-\t\t\t}\n-\t\t};\n-\n-\t\t/**\n-\t\t * Destroys the event object. Call this on IE to remove memory leaks.\n-\t\t */\n-\t\tself.destory = function() {\n-\t\t\tevents = {};\n-\t\t};\n-\n-\t\t// Legacy function calls\n-\n-\t\tself.add = function(target, events, func, scope) {\n-\t\t\t// Old API supported direct ID assignment\n-\t\t\tif (typeof(target) === \"string\") {\n-\t\t\t\ttarget = document.getElementById(target);\n-\t\t\t}\n-\n-\t\t\t// Old API supported multiple targets\n-\t\t\tif (target && target instanceof Array) {\n-\t\t\t\tvar i = target.length;\n-\n-\t\t\t\twhile (i--) {\n-\t\t\t\t\tself.add(target[i], events, func, scope);\n-\t\t\t\t}\n-\n-\t\t\t\treturn;\n-\t\t\t}\n-\n-\t\t\t// Old API called ready init\n-\t\t\tif (events === \"init\") {\n-\t\t\t\tevents = \"ready\";\n-\t\t\t}\n-\n-\t\t\treturn self.bind(target, events instanceof Array ? events.join(' ') : events, func, scope);\n-\t\t};\n-\n-\t\tself.remove = function(target, events, func, scope) {\n-\t\t\tif (!target) {\n-\t\t\t\treturn self;\n-\t\t\t}\n-\n-\t\t\t// Old API supported direct ID assignment\n-\t\t\tif (typeof(target) === \"string\") {\n-\t\t\t\ttarget = document.getElementById(target);\n-\t\t\t}\n-\n-\t\t\t// Old API supported multiple targets\n-\t\t\tif (target instanceof Array) {\n-\t\t\t\tvar i = target.length;\n-\n-\t\t\t\twhile (i--) {\n-\t\t\t\t\tself.remove(target[i], events, func, scope);\n-\t\t\t\t}\n-\n-\t\t\t\treturn self;\n-\t\t\t}\n-\n-\t\t\treturn self.unbind(target, events instanceof Array ? events.join(' ') : events, func);\n-\t\t};\n-\n-\t\tself.clear = function(target) {\n-\t\t\t// Old API supported direct ID assignment\n-\t\t\tif (typeof(target) === \"string\") {\n-\t\t\t\ttarget = document.getElementById(target);\n-\t\t\t}\n-\n-\t\t\treturn self.clean(target);\n-\t\t};\n-\n-\t\tself.cancel = function(e) {\n-\t\t\tif (e) {\n-\t\t\t\tself.prevent(e);\n-\t\t\t\tself.stop(e);\n-\t\t\t}\n-\n-\t\t\treturn false;\n-\t\t};\n-\n-\t\tself.prevent = function(e) {\n-\t\t\tif (!e.preventDefault) {\n-\t\t\t\te = fix(e);\n-\t\t\t}\n-\n-\t\t\te.preventDefault();\n-\n-\t\t\treturn false;\n-\t\t};\n-\n-\t\tself.stop = function(e) {\n-\t\t\tif (!e.stopPropagation) {\n-\t\t\t\te = fix(e);\n-\t\t\t}\n-\n-\t\t\te.stopPropagation();\n-\n-\t\t\treturn false;\n-\t\t};\n-\t}\n-\n-\tnamespace.EventUtils = EventUtils;\n-\n-\tnamespace.Event = new EventUtils(function(id) {\n-\t\treturn function(evt) {\n-\t\t\ttinymce.dom.Event.callNativeHandler(id, evt);\n-\t\t};\n-\t});\n-\n-\t// Bind ready event when tinymce script is loaded\n-\tnamespace.Event.bind(window, 'ready', function() {});\n-\n-\tnamespace = 0;\n-})(tinymce.dom, 'data-mce-expando'); // Namespace and expando"
        },
        {
            "filename": "js/tiny_mce/classes/dom/Range.js",
            "diff": "@@ -1,714 +0,0 @@\n-/**\n- * Range.js\n- *\n- * Copyright, Moxiecode Systems AB\n- * Released under LGPL License.\n- *\n- * License: http://www.tinymce.com/license\n- * Contributing: http://www.tinymce.com/contributing\n- */\n-\n-(function(ns) {\n-\t// Range constructor\n-\tfunction Range(dom) {\n-\t\tvar t = this,\n-\t\t\tdoc = dom.doc,\n-\t\t\tEXTRACT = 0,\n-\t\t\tCLONE = 1,\n-\t\t\tDELETE = 2,\n-\t\t\tTRUE = true,\n-\t\t\tFALSE = false,\n-\t\t\tSTART_OFFSET = 'startOffset',\n-\t\t\tSTART_CONTAINER = 'startContainer',\n-\t\t\tEND_CONTAINER = 'endContainer',\n-\t\t\tEND_OFFSET = 'endOffset',\n-\t\t\textend = tinymce.extend,\n-\t\t\tnodeIndex = dom.nodeIndex;\n-\n-\t\textend(t, {\n-\t\t\t// Inital states\n-\t\t\tstartContainer : doc,\n-\t\t\tstartOffset : 0,\n-\t\t\tendContainer : doc,\n-\t\t\tendOffset : 0,\n-\t\t\tcollapsed : TRUE,\n-\t\t\tcommonAncestorContainer : doc,\n-\n-\t\t\t// Range constants\n-\t\t\tSTART_TO_START : 0,\n-\t\t\tSTART_TO_END : 1,\n-\t\t\tEND_TO_END : 2,\n-\t\t\tEND_TO_START : 3,\n-\n-\t\t\t// Public methods\n-\t\t\tsetStart : setStart,\n-\t\t\tsetEnd : setEnd,\n-\t\t\tsetStartBefore : setStartBefore,\n-\t\t\tsetStartAfter : setStartAfter,\n-\t\t\tsetEndBefore : setEndBefore,\n-\t\t\tsetEndAfter : setEndAfter,\n-\t\t\tcollapse : collapse,\n-\t\t\tselectNode : selectNode,\n-\t\t\tselectNodeContents : selectNodeContents,\n-\t\t\tcompareBoundaryPoints : compareBoundaryPoints,\n-\t\t\tdeleteContents : deleteContents,\n-\t\t\textractContents : extractContents,\n-\t\t\tcloneContents : cloneContents,\n-\t\t\tinsertNode : insertNode,\n-\t\t\tsurroundContents : surroundContents,\n-\t\t\tcloneRange : cloneRange,\n-\t\t\ttoStringIE : toStringIE\n-\t\t});\n-\n-\t\tfunction createDocumentFragment() {\n-\t\t\treturn doc.createDocumentFragment();\n-\t\t};\n-\n-\t\tfunction setStart(n, o) {\n-\t\t\t_setEndPoint(TRUE, n, o);\n-\t\t};\n-\n-\t\tfunction setEnd(n, o) {\n-\t\t\t_setEndPoint(FALSE, n, o);\n-\t\t};\n-\n-\t\tfunction setStartBefore(n) {\n-\t\t\tsetStart(n.parentNode, nodeIndex(n));\n-\t\t};\n-\n-\t\tfunction setStartAfter(n) {\n-\t\t\tsetStart(n.parentNode, nodeIndex(n) + 1);\n-\t\t};\n-\n-\t\tfunction setEndBefore(n) {\n-\t\t\tsetEnd(n.parentNode, nodeIndex(n));\n-\t\t};\n-\n-\t\tfunction setEndAfter(n) {\n-\t\t\tsetEnd(n.parentNode, nodeIndex(n) + 1);\n-\t\t};\n-\n-\t\tfunction collapse(ts) {\n-\t\t\tif (ts) {\n-\t\t\t\tt[END_CONTAINER] = t[START_CONTAINER];\n-\t\t\t\tt[END_OFFSET] = t[START_OFFSET];\n-\t\t\t} else {\n-\t\t\t\tt[START_CONTAINER] = t[END_CONTAINER];\n-\t\t\t\tt[START_OFFSET] = t[END_OFFSET];\n-\t\t\t}\n-\n-\t\t\tt.collapsed = TRUE;\n-\t\t};\n-\n-\t\tfunction selectNode(n) {\n-\t\t\tsetStartBefore(n);\n-\t\t\tsetEndAfter(n);\n-\t\t};\n-\n-\t\tfunction selectNodeContents(n) {\n-\t\t\tsetStart(n, 0);\n-\t\t\tsetEnd(n, n.nodeType === 1 ? n.childNodes.length : n.nodeValue.length);\n-\t\t};\n-\n-\t\tfunction compareBoundaryPoints(h, r) {\n-\t\t\tvar sc = t[START_CONTAINER], so = t[START_OFFSET], ec = t[END_CONTAINER], eo = t[END_OFFSET],\n-\t\t\trsc = r.startContainer, rso = r.startOffset, rec = r.endContainer, reo = r.endOffset;\n-\n-\t\t\t// Check START_TO_START\n-\t\t\tif (h === 0)\n-\t\t\t\treturn _compareBoundaryPoints(sc, so, rsc, rso);\n-\t\n-\t\t\t// Check START_TO_END\n-\t\t\tif (h === 1)\n-\t\t\t\treturn _compareBoundaryPoints(ec, eo, rsc, rso);\n-\t\n-\t\t\t// Check END_TO_END\n-\t\t\tif (h === 2)\n-\t\t\t\treturn _compareBoundaryPoints(ec, eo, rec, reo);\n-\t\n-\t\t\t// Check END_TO_START\n-\t\t\tif (h === 3) \n-\t\t\t\treturn _compareBoundaryPoints(sc, so, rec, reo);\n-\t\t};\n-\n-\t\tfunction deleteContents() {\n-\t\t\t_traverse(DELETE);\n-\t\t};\n-\n-\t\tfunction extractContents() {\n-\t\t\treturn _traverse(EXTRACT);\n-\t\t};\n-\n-\t\tfunction cloneContents() {\n-\t\t\treturn _traverse(CLONE);\n-\t\t};\n-\n-\t\tfunction insertNode(n) {\n-\t\t\tvar startContainer = this[START_CONTAINER],\n-\t\t\t\tstartOffset = this[START_OFFSET], nn, o;\n-\n-\t\t\t// Node is TEXT_NODE or CDATA\n-\t\t\tif ((startContainer.nodeType === 3 || startContainer.nodeType === 4) && startContainer.nodeValue) {\n-\t\t\t\tif (!startOffset) {\n-\t\t\t\t\t// At the start of text\n-\t\t\t\t\tstartContainer.parentNode.insertBefore(n, startContainer);\n-\t\t\t\t} else if (startOffset >= startContainer.nodeValue.length) {\n-\t\t\t\t\t// At the end of text\n-\t\t\t\t\tdom.insertAfter(n, startContainer);\n-\t\t\t\t} else {\n-\t\t\t\t\t// Middle, need to split\n-\t\t\t\t\tnn = startContainer.splitText(startOffset);\n-\t\t\t\t\tstartContainer.parentNode.insertBefore(n, nn);\n-\t\t\t\t}\n-\t\t\t} else {\n-\t\t\t\t// Insert element node\n-\t\t\t\tif (startContainer.childNodes.length > 0)\n-\t\t\t\t\to = startContainer.childNodes[startOffset];\n-\n-\t\t\t\tif (o)\n-\t\t\t\t\tstartContainer.insertBefore(n, o);\n-\t\t\t\telse\n-\t\t\t\t\tstartContainer.appendChild(n);\n-\t\t\t}\n-\t\t};\n-\n-\t\tfunction surroundContents(n) {\n-\t\t\tvar f = t.extractContents();\n-\n-\t\t\tt.insertNode(n);\n-\t\t\tn.appendChild(f);\n-\t\t\tt.selectNode(n);\n-\t\t};\n-\n-\t\tfunction cloneRange() {\n-\t\t\treturn extend(new Range(dom), {\n-\t\t\t\tstartContainer : t[START_CONTAINER],\n-\t\t\t\tstartOffset : t[START_OFFSET],\n-\t\t\t\tendContainer : t[END_CONTAINER],\n-\t\t\t\tendOffset : t[END_OFFSET],\n-\t\t\t\tcollapsed : t.collapsed,\n-\t\t\t\tcommonAncestorContainer : t.commonAncestorContainer\n-\t\t\t});\n-\t\t};\n-\n-\t\t// Private methods\n-\n-\t\tfunction _getSelectedNode(container, offset) {\n-\t\t\tvar child;\n-\n-\t\t\tif (container.nodeType == 3 /* TEXT_NODE */)\n-\t\t\t\treturn container;\n-\n-\t\t\tif (offset < 0)\n-\t\t\t\treturn container;\n-\n-\t\t\tchild = container.firstChild;\n-\t\t\twhile (child && offset > 0) {\n-\t\t\t\t--offset;\n-\t\t\t\tchild = child.nextSibling;\n-\t\t\t}\n-\n-\t\t\tif (child)\n-\t\t\t\treturn child;\n-\n-\t\t\treturn container;\n-\t\t};\n-\n-\t\tfunction _isCollapsed() {\n-\t\t\treturn (t[START_CONTAINER] == t[END_CONTAINER] && t[START_OFFSET] == t[END_OFFSET]);\n-\t\t};\n-\n-\t\tfunction _compareBoundaryPoints(containerA, offsetA, containerB, offsetB) {\n-\t\t\tvar c, offsetC, n, cmnRoot, childA, childB;\n-\t\t\t\n-\t\t\t// In the first case the boundary-points have the same container. A is before B\n-\t\t\t// if its offset is less than the offset of B, A is equal to B if its offset is\n-\t\t\t// equal to the offset of B, and A is after B if its offset is greater than the\n-\t\t\t// offset of B.\n-\t\t\tif (containerA == containerB) {\n-\t\t\t\tif (offsetA == offsetB)\n-\t\t\t\t\treturn 0; // equal\n-\n-\t\t\t\tif (offsetA < offsetB)\n-\t\t\t\t\treturn -1; // before\n-\n-\t\t\t\treturn 1; // after\n-\t\t\t}\n-\n-\t\t\t// In the second case a child node C of the container of A is an ancestor\n-\t\t\t// container of B. In this case, A is before B if the offset of A is less than or\n-\t\t\t// equal to the index of the child node C and A is after B otherwise.\n-\t\t\tc = containerB;\n-\t\t\twhile (c && c.parentNode != containerA)\n-\t\t\t\tc = c.parentNode;\n-\n-\t\t\tif (c) {\n-\t\t\t\toffsetC = 0;\n-\t\t\t\tn = containerA.firstChild;\n-\n-\t\t\t\twhile (n != c && offsetC < offsetA) {\n-\t\t\t\t\toffsetC++;\n-\t\t\t\t\tn = n.nextSibling;\n-\t\t\t\t}\n-\n-\t\t\t\tif (offsetA <= offsetC)\n-\t\t\t\t\treturn -1; // before\n-\n-\t\t\t\treturn 1; // after\n-\t\t\t}\n-\n-\t\t\t// In the third case a child node C of the container of B is an ancestor container\n-\t\t\t// of A. In this case, A is before B if the index of the child node C is less than\n-\t\t\t// the offset of B and A is after B otherwise.\n-\t\t\tc = containerA;\n-\t\t\twhile (c && c.parentNode != containerB) {\n-\t\t\t\tc = c.parentNode;\n-\t\t\t}\n-\n-\t\t\tif (c) {\n-\t\t\t\toffsetC = 0;\n-\t\t\t\tn = containerB.firstChild;\n-\n-\t\t\t\twhile (n != c && offsetC < offsetB) {\n-\t\t\t\t\toffsetC++;\n-\t\t\t\t\tn = n.nextSibling;\n-\t\t\t\t}\n-\n-\t\t\t\tif (offsetC < offsetB)\n-\t\t\t\t\treturn -1; // before\n-\n-\t\t\t\treturn 1; // after\n-\t\t\t}\n-\n-\t\t\t// In the fourth case, none of three other cases hold: the containers of A and B\n-\t\t\t// are siblings or descendants of sibling nodes. In this case, A is before B if\n-\t\t\t// the container of A is before the container of B in a pre-order traversal of the\n-\t\t\t// Ranges' context tree and A is after B otherwise.\n-\t\t\tcmnRoot = dom.findCommonAncestor(containerA, containerB);\n-\t\t\tchildA = containerA;\n-\n-\t\t\twhile (childA && childA.parentNode != cmnRoot)\n-\t\t\t\tchildA = childA.parentNode;\n-\n-\t\t\tif (!childA)\n-\t\t\t\tchildA = cmnRoot;\n-\n-\t\t\tchildB = containerB;\n-\t\t\twhile (childB && childB.parentNode != cmnRoot)\n-\t\t\t\tchildB = childB.parentNode;\n-\n-\t\t\tif (!childB)\n-\t\t\t\tchildB = cmnRoot;\n-\n-\t\t\tif (childA == childB)\n-\t\t\t\treturn 0; // equal\n-\n-\t\t\tn = cmnRoot.firstChild;\n-\t\t\twhile (n) {\n-\t\t\t\tif (n == childA)\n-\t\t\t\t\treturn -1; // before\n-\n-\t\t\t\tif (n == childB)\n-\t\t\t\t\treturn 1; // after\n-\n-\t\t\t\tn = n.nextSibling;\n-\t\t\t}\n-\t\t};\n-\n-\t\tfunction _setEndPoint(st, n, o) {\n-\t\t\tvar ec, sc;\n-\n-\t\t\tif (st) {\n-\t\t\t\tt[START_CONTAINER] = n;\n-\t\t\t\tt[START_OFFSET] = o;\n-\t\t\t} else {\n-\t\t\t\tt[END_CONTAINER] = n;\n-\t\t\t\tt[END_OFFSET] = o;\n-\t\t\t}\n-\n-\t\t\t// If one boundary-point of a Range is set to have a root container\n-\t\t\t// other than the current one for the Range, the Range is collapsed to\n-\t\t\t// the new position. This enforces the restriction that both boundary-\n-\t\t\t// points of a Range must have the same root container.\n-\t\t\tec = t[END_CONTAINER];\n-\t\t\twhile (ec.parentNode)\n-\t\t\t\tec = ec.parentNode;\n-\n-\t\t\tsc = t[START_CONTAINER];\n-\t\t\twhile (sc.parentNode)\n-\t\t\t\tsc = sc.parentNode;\n-\n-\t\t\tif (sc == ec) {\n-\t\t\t\t// The start position of a Range is guaranteed to never be after the\n-\t\t\t\t// end position. To enforce this restriction, if the start is set to\n-\t\t\t\t// be at a position after the end, the Range is collapsed to that\n-\t\t\t\t// position.\n-\t\t\t\tif (_compareBoundaryPoints(t[START_CONTAINER], t[START_OFFSET], t[END_CONTAINER], t[END_OFFSET]) > 0)\n-\t\t\t\t\tt.collapse(st);\n-\t\t\t} else\n-\t\t\t\tt.collapse(st);\n-\n-\t\t\tt.collapsed = _isCollapsed();\n-\t\t\tt.commonAncestorContainer = dom.findCommonAncestor(t[START_CONTAINER], t[END_CONTAINER]);\n-\t\t};\n-\n-\t\tfunction _traverse(how) {\n-\t\t\tvar c, endContainerDepth = 0, startContainerDepth = 0, p, depthDiff, startNode, endNode, sp, ep;\n-\n-\t\t\tif (t[START_CONTAINER] == t[END_CONTAINER])\n-\t\t\t\treturn _traverseSameContainer(how);\n-\n-\t\t\tfor (c = t[END_CONTAINER], p = c.parentNode; p; c = p, p = p.parentNode) {\n-\t\t\t\tif (p == t[START_CONTAINER])\n-\t\t\t\t\treturn _traverseCommonStartContainer(c, how);\n-\n-\t\t\t\t++endContainerDepth;\n-\t\t\t}\n-\n-\t\t\tfor (c = t[START_CONTAINER], p = c.parentNode; p; c = p, p = p.parentNode) {\n-\t\t\t\tif (p == t[END_CONTAINER])\n-\t\t\t\t\treturn _traverseCommonEndContainer(c, how);\n-\n-\t\t\t\t++startContainerDepth;\n-\t\t\t}\n-\n-\t\t\tdepthDiff = startContainerDepth - endContainerDepth;\n-\n-\t\t\tstartNode = t[START_CONTAINER];\n-\t\t\twhile (depthDiff > 0) {\n-\t\t\t\tstartNode = startNode.parentNode;\n-\t\t\t\tdepthDiff--;\n-\t\t\t}\n-\n-\t\t\tendNode = t[END_CONTAINER];\n-\t\t\twhile (depthDiff < 0) {\n-\t\t\t\tendNode = endNode.parentNode;\n-\t\t\t\tdepthDiff++;\n-\t\t\t}\n-\n-\t\t\t// ascend the ancestor hierarchy until we have a common parent.\n-\t\t\tfor (sp = startNode.parentNode, ep = endNode.parentNode; sp != ep; sp = sp.parentNode, ep = ep.parentNode) {\n-\t\t\t\tstartNode = sp;\n-\t\t\t\tendNode = ep;\n-\t\t\t}\n-\n-\t\t\treturn _traverseCommonAncestors(startNode, endNode, how);\n-\t\t};\n-\n-\t\t function _traverseSameContainer(how) {\n-\t\t\tvar frag, s, sub, n, cnt, sibling, xferNode, start, len;\n-\n-\t\t\tif (how != DELETE)\n-\t\t\t\tfrag = createDocumentFragment();\n-\n-\t\t\t// If selection is empty, just return the fragment\n-\t\t\tif (t[START_OFFSET] == t[END_OFFSET])\n-\t\t\t\treturn frag;\n-\n-\t\t\t// Text node needs special case handling\n-\t\t\tif (t[START_CONTAINER].nodeType == 3 /* TEXT_NODE */) {\n-\t\t\t\t// get the substring\n-\t\t\t\ts = t[START_CONTAINER].nodeValue;\n-\t\t\t\tsub = s.substring(t[START_OFFSET], t[END_OFFSET]);\n-\n-\t\t\t\t// set the original text node to its new value\n-\t\t\t\tif (how != CLONE) {\n-\t\t\t\t\tn = t[START_CONTAINER];\n-\t\t\t\t\tstart = t[START_OFFSET];\n-\t\t\t\t\tlen = t[END_OFFSET] - t[START_OFFSET];\n-\n-\t\t\t\t\tif (start === 0 && len >= n.nodeValue.length - 1) {\n-\t\t\t\t\t\tn.parentNode.removeChild(n);\n-\t\t\t\t\t} else {\n-\t\t\t\t\t\tn.deleteData(start, len);\n-\t\t\t\t\t}\n-\n-\t\t\t\t\t// Nothing is partially selected, so collapse to start point\n-\t\t\t\t\tt.collapse(TRUE);\n-\t\t\t\t}\n-\n-\t\t\t\tif (how == DELETE)\n-\t\t\t\t\treturn;\n-\n-\t\t\t\tif (sub.length > 0) {\n-\t\t\t\t\tfrag.appendChild(doc.createTextNode(sub));\n-\t\t\t\t}\n-\n-\t\t\t\treturn frag;\n-\t\t\t}\n-\n-\t\t\t// Copy nodes between the start/end offsets.\n-\t\t\tn = _getSelectedNode(t[START_CONTAINER], t[START_OFFSET]);\n-\t\t\tcnt = t[END_OFFSET] - t[START_OFFSET];\n-\n-\t\t\twhile (n && cnt > 0) {\n-\t\t\t\tsibling = n.nextSibling;\n-\t\t\t\txferNode = _traverseFullySelected(n, how);\n-\n-\t\t\t\tif (frag)\n-\t\t\t\t\tfrag.appendChild( xferNode );\n-\n-\t\t\t\t--cnt;\n-\t\t\t\tn = sibling;\n-\t\t\t}\n-\n-\t\t\t// Nothing is partially selected, so collapse to start point\n-\t\t\tif (how != CLONE)\n-\t\t\t\tt.collapse(TRUE);\n-\n-\t\t\treturn frag;\n-\t\t};\n-\n-\t\tfunction _traverseCommonStartContainer(endAncestor, how) {\n-\t\t\tvar frag, n, endIdx, cnt, sibling, xferNode;\n-\n-\t\t\tif (how != DELETE)\n-\t\t\t\tfrag = createDocumentFragment();\n-\n-\t\t\tn = _traverseRightBoundary(endAncestor, how);\n-\n-\t\t\tif (frag)\n-\t\t\t\tfrag.appendChild(n);\n-\n-\t\t\tendIdx = nodeIndex(endAncestor);\n-\t\t\tcnt = endIdx - t[START_OFFSET];\n-\n-\t\t\tif (cnt <= 0) {\n-\t\t\t\t// Collapse to just before the endAncestor, which\n-\t\t\t\t// is partially selected.\n-\t\t\t\tif (how != CLONE) {\n-\t\t\t\t\tt.setEndBefore(endAncestor);\n-\t\t\t\t\tt.collapse(FALSE);\n-\t\t\t\t}\n-\n-\t\t\t\treturn frag;\n-\t\t\t}\n-\n-\t\t\tn = endAncestor.previousSibling;\n-\t\t\twhile (cnt > 0) {\n-\t\t\t\tsibling = n.previousSibling;\n-\t\t\t\txferNode = _traverseFullySelected(n, how);\n-\n-\t\t\t\tif (frag)\n-\t\t\t\t\tfrag.insertBefore(xferNode, frag.firstChild);\n-\n-\t\t\t\t--cnt;\n-\t\t\t\tn = sibling;\n-\t\t\t}\n-\n-\t\t\t// Collapse to just before the endAncestor, which\n-\t\t\t// is partially selected.\n-\t\t\tif (how != CLONE) {\n-\t\t\t\tt.setEndBefore(endAncestor);\n-\t\t\t\tt.collapse(FALSE);\n-\t\t\t}\n-\n-\t\t\treturn frag;\n-\t\t};\n-\n-\t\tfunction _traverseCommonEndContainer(startAncestor, how) {\n-\t\t\tvar frag, startIdx, n, cnt, sibling, xferNode;\n-\n-\t\t\tif (how != DELETE)\n-\t\t\t\tfrag = createDocumentFragment();\n-\n-\t\t\tn = _traverseLeftBoundary(startAncestor, how);\n-\t\t\tif (frag)\n-\t\t\t\tfrag.appendChild(n);\n-\n-\t\t\tstartIdx = nodeIndex(startAncestor);\n-\t\t\t++startIdx; // Because we already traversed it\n-\n-\t\t\tcnt = t[END_OFFSET] - startIdx;\n-\t\t\tn = startAncestor.nextSibling;\n-\t\t\twhile (n && cnt > 0) {\n-\t\t\t\tsibling = n.nextSibling;\n-\t\t\t\txferNode = _traverseFullySelected(n, how);\n-\n-\t\t\t\tif (frag)\n-\t\t\t\t\tfrag.appendChild(xferNode);\n-\n-\t\t\t\t--cnt;\n-\t\t\t\tn = sibling;\n-\t\t\t}\n-\n-\t\t\tif (how != CLONE) {\n-\t\t\t\tt.setStartAfter(startAncestor);\n-\t\t\t\tt.collapse(TRUE);\n-\t\t\t}\n-\n-\t\t\treturn frag;\n-\t\t};\n-\n-\t\tfunction _traverseCommonAncestors(startAncestor, endAncestor, how) {\n-\t\t\tvar n, frag, commonParent, startOffset, endOffset, cnt, sibling, nextSibling;\n-\n-\t\t\tif (how != DELETE)\n-\t\t\t\tfrag = createDocumentFragment();\n-\n-\t\t\tn = _traverseLeftBoundary(startAncestor, how);\n-\t\t\tif (frag)\n-\t\t\t\tfrag.appendChild(n);\n-\n-\t\t\tcommonParent = startAncestor.parentNode;\n-\t\t\tstartOffset = nodeIndex(startAncestor);\n-\t\t\tendOffset = nodeIndex(endAncestor);\n-\t\t\t++startOffset;\n-\n-\t\t\tcnt = endOffset - startOffset;\n-\t\t\tsibling = startAncestor.nextSibling;\n-\n-\t\t\twhile (cnt > 0) {\n-\t\t\t\tnextSibling = sibling.nextSibling;\n-\t\t\t\tn = _traverseFullySelected(sibling, how);\n-\n-\t\t\t\tif (frag)\n-\t\t\t\t\tfrag.appendChild(n);\n-\n-\t\t\t\tsibling = nextSibling;\n-\t\t\t\t--cnt;\n-\t\t\t}\n-\n-\t\t\tn = _traverseRightBoundary(endAncestor, how);\n-\n-\t\t\tif (frag)\n-\t\t\t\tfrag.appendChild(n);\n-\n-\t\t\tif (how != CLONE) {\n-\t\t\t\tt.setStartAfter(startAncestor);\n-\t\t\t\tt.collapse(TRUE);\n-\t\t\t}\n-\n-\t\t\treturn frag;\n-\t\t};\n-\n-\t\tfunction _traverseRightBoundary(root, how) {\n-\t\t\tvar next = _getSelectedNode(t[END_CONTAINER], t[END_OFFSET] - 1), parent, clonedParent, prevSibling, clonedChild, clonedGrandParent, isFullySelected = next != t[END_CONTAINER];\n-\n-\t\t\tif (next == root)\n-\t\t\t\treturn _traverseNode(next, isFullySelected, FALSE, how);\n-\n-\t\t\tparent = next.parentNode;\n-\t\t\tclonedParent = _traverseNode(parent, FALSE, FALSE, how);\n-\n-\t\t\twhile (parent) {\n-\t\t\t\twhile (next) {\n-\t\t\t\t\tprevSibling = next.previousSibling;\n-\t\t\t\t\tclonedChild = _traverseNode(next, isFullySelected, FALSE, how);\n-\n-\t\t\t\t\tif (how != DELETE)\n-\t\t\t\t\t\tclonedParent.insertBefore(clonedChild, clonedParent.firstChild);\n-\n-\t\t\t\t\tisFullySelected = TRUE;\n-\t\t\t\t\tnext = prevSibling;\n-\t\t\t\t}\n-\n-\t\t\t\tif (parent == root)\n-\t\t\t\t\treturn clonedParent;\n-\n-\t\t\t\tnext = parent.previousSibling;\n-\t\t\t\tparent = parent.parentNode;\n-\n-\t\t\t\tclonedGrandParent = _traverseNode(parent, FALSE, FALSE, how);\n-\n-\t\t\t\tif (how != DELETE)\n-\t\t\t\t\tclonedGrandParent.appendChild(clonedParent);\n-\n-\t\t\t\tclonedParent = clonedGrandParent;\n-\t\t\t}\n-\t\t};\n-\n-\t\tfunction _traverseLeftBoundary(root, how) {\n-\t\t\tvar next = _getSelectedNode(t[START_CONTAINER], t[START_OFFSET]), isFullySelected = next != t[START_CONTAINER], parent, clonedParent, nextSibling, clonedChild, clonedGrandParent;\n-\n-\t\t\tif (next == root)\n-\t\t\t\treturn _traverseNode(next, isFullySelected, TRUE, how);\n-\n-\t\t\tparent = next.parentNode;\n-\t\t\tclonedParent = _traverseNode(parent, FALSE, TRUE, how);\n-\n-\t\t\twhile (parent) {\n-\t\t\t\twhile (next) {\n-\t\t\t\t\tnextSibling = next.nextSibling;\n-\t\t\t\t\tclonedChild = _traverseNode(next, isFullySelected, TRUE, how);\n-\n-\t\t\t\t\tif (how != DELETE)\n-\t\t\t\t\t\tclonedParent.appendChild(clonedChild);\n-\n-\t\t\t\t\tisFullySelected = TRUE;\n-\t\t\t\t\tnext = nextSibling;\n-\t\t\t\t}\n-\n-\t\t\t\tif (parent == root)\n-\t\t\t\t\treturn clonedParent;\n-\n-\t\t\t\tnext = parent.nextSibling;\n-\t\t\t\tparent = parent.parentNode;\n-\n-\t\t\t\tclonedGrandParent = _traverseNode(parent, FALSE, TRUE, how);\n-\n-\t\t\t\tif (how != DELETE)\n-\t\t\t\t\tclonedGrandParent.appendChild(clonedParent);\n-\n-\t\t\t\tclonedParent = clonedGrandParent;\n-\t\t\t}\n-\t\t};\n-\n-\t\tfunction _traverseNode(n, isFullySelected, isLeft, how) {\n-\t\t\tvar txtValue, newNodeValue, oldNodeValue, offset, newNode;\n-\n-\t\t\tif (isFullySelected)\n-\t\t\t\treturn _traverseFullySelected(n, how);\n-\n-\t\t\tif (n.nodeType == 3 /* TEXT_NODE */) {\n-\t\t\t\ttxtValue = n.nodeValue;\n-\n-\t\t\t\tif (isLeft) {\n-\t\t\t\t\toffset = t[START_OFFSET];\n-\t\t\t\t\tnewNodeValue = txtValue.substring(offset);\n-\t\t\t\t\toldNodeValue = txtValue.substring(0, offset);\n-\t\t\t\t} else {\n-\t\t\t\t\toffset = t[END_OFFSET];\n-\t\t\t\t\tnewNodeValue = txtValue.substring(0, offset);\n-\t\t\t\t\toldNodeValue = txtValue.substring(offset);\n-\t\t\t\t}\n-\n-\t\t\t\tif (how != CLONE)\n-\t\t\t\t\tn.nodeValue = oldNodeValue;\n-\n-\t\t\t\tif (how == DELETE)\n-\t\t\t\t\treturn;\n-\n-\t\t\t\tnewNode = dom.clone(n, FALSE);\n-\t\t\t\tnewNode.nodeValue = newNodeValue;\n-\n-\t\t\t\treturn newNode;\n-\t\t\t}\n-\n-\t\t\tif (how == DELETE)\n-\t\t\t\treturn;\n-\n-\t\t\treturn dom.clone(n, FALSE);\n-\t\t};\n-\n-\t\tfunction _traverseFullySelected(n, how) {\n-\t\t\tif (how != DELETE)\n-\t\t\t\treturn how == CLONE ? dom.clone(n, TRUE) : n;\n-\n-\t\t\tn.parentNode.removeChild(n);\n-\t\t};\n-\n-\t\tfunction toStringIE() {\n-\t\t\treturn dom.create('body', null, cloneContents()).outerText;\n-\t\t}\n-\t\t\n-\t\treturn t;\n-\t};\n-\n-\tns.Range = Range;\n-\n-\t// Older IE versions doesn't let you override toString by it's constructor so we have to stick it in the prototype\n-\tRange.prototype.toString = function() {\n-\t\treturn this.toStringIE();\n-\t};\n-})(tinymce.dom);"
        },
        {
            "filename": "js/tiny_mce/classes/dom/RangeUtils.js",
            "diff": "@@ -1,251 +0,0 @@\n-/**\n- * Range.js\n- *\n- * Copyright, Moxiecode Systems AB\n- * Released under LGPL License.\n- *\n- * License: http://www.tinymce.com/license\n- * Contributing: http://www.tinymce.com/contributing\n- */\n-\n-(function(tinymce) {\n-\ttinymce.dom.RangeUtils = function(dom) {\n-\t\tvar INVISIBLE_CHAR = '\\uFEFF';\n-\n-\t\t/**\n-\t\t * Walks the specified range like object and executes the callback for each sibling collection it finds.\n-\t\t *\n-\t\t * @param {Object} rng Range like object.\n-\t\t * @param {function} callback Callback function to execute for each sibling collection.\n-\t\t */\n-\t\tthis.walk = function(rng, callback) {\n-\t\t\tvar startContainer = rng.startContainer,\n-\t\t\t\tstartOffset = rng.startOffset,\n-\t\t\t\tendContainer = rng.endContainer,\n-\t\t\t\tendOffset = rng.endOffset,\n-\t\t\t\tancestor, startPoint,\n-\t\t\t\tendPoint, node, parent, siblings, nodes;\n-\n-\t\t\t// Handle table cell selection the table plugin enables\n-\t\t\t// you to fake select table cells and perform formatting actions on them\n-\t\t\tnodes = dom.select('td.mceSelected,th.mceSelected');\n-\t\t\tif (nodes.length > 0) {\n-\t\t\t\ttinymce.each(nodes, function(node) {\n-\t\t\t\t\tcallback([node]);\n-\t\t\t\t});\n-\n-\t\t\t\treturn;\n-\t\t\t}\n-\n-\t\t\t/**\n-\t\t\t * Excludes start/end text node if they are out side the range\n-\t\t\t *\n-\t\t\t * @private\n-\t\t\t * @param {Array} nodes Nodes to exclude items from.\n-\t\t\t * @return {Array} Array with nodes excluding the start/end container if needed.\n-\t\t\t */\n-\t\t\tfunction exclude(nodes) {\n-\t\t\t\tvar node;\n-\n-\t\t\t\t// First node is excluded\n-\t\t\t\tnode = nodes[0];\n-\t\t\t\tif (node.nodeType === 3 && node === startContainer && startOffset >= node.nodeValue.length) {\n-\t\t\t\t\tnodes.splice(0, 1);\n-\t\t\t\t}\n-\n-\t\t\t\t// Last node is excluded\n-\t\t\t\tnode = nodes[nodes.length - 1];\n-\t\t\t\tif (endOffset === 0 && nodes.length > 0 && node === endContainer && node.nodeType === 3) {\n-\t\t\t\t\tnodes.splice(nodes.length - 1, 1);\n-\t\t\t\t}\n-\n-\t\t\t\treturn nodes;\n-\t\t\t};\n-\n-\t\t\t/**\n-\t\t\t * Collects siblings\n-\t\t\t *\n-\t\t\t * @private\n-\t\t\t * @param {Node} node Node to collect siblings from.\n-\t\t\t * @param {String} name Name of the sibling to check for.\n-\t\t\t * @return {Array} Array of collected siblings.\n-\t\t\t */\n-\t\t\tfunction collectSiblings(node, name, end_node) {\n-\t\t\t\tvar siblings = [];\n-\n-\t\t\t\tfor (; node && node != end_node; node = node[name])\n-\t\t\t\t\tsiblings.push(node);\n-\n-\t\t\t\treturn siblings;\n-\t\t\t};\n-\n-\t\t\t/**\n-\t\t\t * Find an end point this is the node just before the common ancestor root.\n-\t\t\t *\n-\t\t\t * @private\n-\t\t\t * @param {Node} node Node to start at.\n-\t\t\t * @param {Node} root Root/ancestor element to stop just before.\n-\t\t\t * @return {Node} Node just before the root element.\n-\t\t\t */\n-\t\t\tfunction findEndPoint(node, root) {\n-\t\t\t\tdo {\n-\t\t\t\t\tif (node.parentNode == root)\n-\t\t\t\t\t\treturn node;\n-\n-\t\t\t\t\tnode = node.parentNode;\n-\t\t\t\t} while(node);\n-\t\t\t};\n-\n-\t\t\tfunction walkBoundary(start_node, end_node, next) {\n-\t\t\t\tvar siblingName = next ? 'nextSibling' : 'previousSibling';\n-\n-\t\t\t\tfor (node = start_node, parent = node.parentNode; node && node != end_node; node = parent) {\n-\t\t\t\t\tparent = node.parentNode;\n-\t\t\t\t\tsiblings = collectSiblings(node == start_node ? node : node[siblingName], siblingName);\n-\n-\t\t\t\t\tif (siblings.length) {\n-\t\t\t\t\t\tif (!next)\n-\t\t\t\t\t\t\tsiblings.reverse();\n-\n-\t\t\t\t\t\tcallback(exclude(siblings));\n-\t\t\t\t\t}\n-\t\t\t\t}\n-\t\t\t};\n-\n-\t\t\t// If index based start position then resolve it\n-\t\t\tif (startContainer.nodeType == 1 && startContainer.hasChildNodes())\n-\t\t\t\tstartContainer = startContainer.childNodes[startOffset];\n-\n-\t\t\t// If index based end position then resolve it\n-\t\t\tif (endContainer.nodeType == 1 && endContainer.hasChildNodes())\n-\t\t\t\tendContainer = endContainer.childNodes[Math.min(endOffset - 1, endContainer.childNodes.length - 1)];\n-\n-\t\t\t// Same container\n-\t\t\tif (startContainer == endContainer)\n-\t\t\t\treturn callback(exclude([startContainer]));\n-\n-\t\t\t// Find common ancestor and end points\n-\t\t\tancestor = dom.findCommonAncestor(startContainer, endContainer);\n-\t\t\t\t\n-\t\t\t// Process left side\n-\t\t\tfor (node = startContainer; node; node = node.parentNode) {\n-\t\t\t\tif (node === endContainer)\n-\t\t\t\t\treturn walkBoundary(startContainer, ancestor, true);\n-\n-\t\t\t\tif (node === ancestor)\n-\t\t\t\t\tbreak;\n-\t\t\t}\n-\n-\t\t\t// Process right side\n-\t\t\tfor (node = endContainer; node; node = node.parentNode) {\n-\t\t\t\tif (node === startContainer)\n-\t\t\t\t\treturn walkBoundary(endContainer, ancestor);\n-\n-\t\t\t\tif (node === ancestor)\n-\t\t\t\t\tbreak;\n-\t\t\t}\n-\n-\t\t\t// Find start/end point\n-\t\t\tstartPoint = findEndPoint(startContainer, ancestor) || startContainer;\n-\t\t\tendPoint = findEndPoint(endContainer, ancestor) || endContainer;\n-\n-\t\t\t// Walk left leaf\n-\t\t\twalkBoundary(startContainer, startPoint, true);\n-\n-\t\t\t// Walk the middle from start to end point\n-\t\t\tsiblings = collectSiblings(\n-\t\t\t\tstartPoint == startContainer ? startPoint : startPoint.nextSibling,\n-\t\t\t\t'nextSibling',\n-\t\t\t\tendPoint == endContainer ? endPoint.nextSibling : endPoint\n-\t\t\t);\n-\n-\t\t\tif (siblings.length)\n-\t\t\t\tcallback(exclude(siblings));\n-\n-\t\t\t// Walk right leaf\n-\t\t\twalkBoundary(endContainer, endPoint);\n-\t\t};\n-\n-\t\t/**\n-\t\t * Splits the specified range at it's start/end points.\n-\t\t *\n-\t\t * @param {Range/RangeObject} rng Range to split.\n-\t\t * @return {Object} Range position object.\n-\t\t */\n-\t\tthis.split = function(rng) {\n-\t\t\tvar startContainer = rng.startContainer,\n-\t\t\t\tstartOffset = rng.startOffset,\n-\t\t\t\tendContainer = rng.endContainer,\n-\t\t\t\tendOffset = rng.endOffset;\n-\n-\t\t\tfunction splitText(node, offset) {\n-\t\t\t\treturn node.splitText(offset);\n-\t\t\t};\n-\n-\t\t\t// Handle single text node\n-\t\t\tif (startContainer == endContainer && startContainer.nodeType == 3) {\n-\t\t\t\tif (startOffset > 0 && startOffset < startContainer.nodeValue.length) {\n-\t\t\t\t\tendContainer = splitText(startContainer, startOffset);\n-\t\t\t\t\tstartContainer = endContainer.previousSibling;\n-\n-\t\t\t\t\tif (endOffset > startOffset) {\n-\t\t\t\t\t\tendOffset = endOffset - startOffset;\n-\t\t\t\t\t\tstartContainer = endContainer = splitText(endContainer, endOffset).previousSibling;\n-\t\t\t\t\t\tendOffset = endContainer.nodeValue.length;\n-\t\t\t\t\t\tstartOffset = 0;\n-\t\t\t\t\t} else {\n-\t\t\t\t\t\tendOffset = 0;\n-\t\t\t\t\t}\n-\t\t\t\t}\n-\t\t\t} else {\n-\t\t\t\t// Split startContainer text node if needed\n-\t\t\t\tif (startContainer.nodeType == 3 && startOffset > 0 && startOffset < startContainer.nodeValue.length) {\n-\t\t\t\t\tstartContainer = splitText(startContainer, startOffset);\n-\t\t\t\t\tstartOffset = 0;\n-\t\t\t\t}\n-\n-\t\t\t\t// Split endContainer text node if needed\n-\t\t\t\tif (endContainer.nodeType == 3 && endOffset > 0 && endOffset < endContainer.nodeValue.length) {\n-\t\t\t\t\tendContainer = splitText(endContainer, endOffset).previousSibling;\n-\t\t\t\t\tendOffset = endContainer.nodeValue.length;\n-\t\t\t\t}\n-\t\t\t}\n-\n-\t\t\treturn {\n-\t\t\t\tstartContainer : startContainer,\n-\t\t\t\tstartOffset : startOffset,\n-\t\t\t\tendContainer : endContainer,\n-\t\t\t\tendOffset : endOffset\n-\t\t\t};\n-\t\t};\n-\n-\t};\n-\n-\t/**\n-\t * Compares two ranges and checks if they are equal.\n-\t *\n-\t * @static\n-\t * @param {DOMRange} rng1 First range to compare.\n-\t * @param {DOMRange} rng2 First range to compare.\n-\t * @return {Boolean} true/false if the ranges are equal.\n-\t */\n-\ttinymce.dom.RangeUtils.compareRanges = function(rng1, rng2) {\n-\t\tif (rng1 && rng2) {\n-\t\t\t// Compare native IE ranges\n-\t\t\tif (rng1.item || rng1.duplicate) {\n-\t\t\t\t// Both are control ranges and the selected element matches\n-\t\t\t\tif (rng1.item && rng2.item && rng1.item(0) === rng2.item(0))\n-\t\t\t\t\treturn true;\n-\n-\t\t\t\t// Both are text ranges and the range matches\n-\t\t\t\tif (rng1.isEqual && rng2.isEqual && rng2.isEqual(rng1))\n-\t\t\t\t\treturn true;\n-\t\t\t} else {\n-\t\t\t\t// Compare w3c ranges\n-\t\t\t\treturn rng1.startContainer == rng2.startContainer && rng1.startOffset == rng2.startOffset;\n-\t\t\t}\n-\t\t}\n-\n-\t\treturn false;\n-\t};\n-})(tinymce);"
        },
        {
            "filename": "js/tiny_mce/classes/dom/ScriptLoader.js",
            "diff": "@@ -1,284 +0,0 @@\n-/**\n- * ScriptLoader.js\n- *\n- * Copyright, Moxiecode Systems AB\n- * Released under LGPL License.\n- *\n- * License: http://www.tinymce.com/license\n- * Contributing: http://www.tinymce.com/contributing\n- */\n-\n-(function(tinymce) {\n-\t/**\n-\t * This class handles asynchronous/synchronous loading of JavaScript files it will execute callbacks when various items gets loaded. This class is useful to load external JavaScript files. \n-\t *\n-\t * @class tinymce.dom.ScriptLoader\n-\t * @example\n-\t * // Load a script from a specific URL using the global script loader\n-\t * tinymce.ScriptLoader.load('somescript.js');\n-\t * \n-\t * // Load a script using a unique instance of the script loader\n-\t * var scriptLoader = new tinymce.dom.ScriptLoader();\n-\t * \n-\t * scriptLoader.load('somescript.js');\n-\t * \n-\t * // Load multiple scripts\n-\t * var scriptLoader = new tinymce.dom.ScriptLoader();\n-\t * \n-\t * scriptLoader.add('somescript1.js');\n-\t * scriptLoader.add('somescript2.js');\n-\t * scriptLoader.add('somescript3.js');\n-\t * \n-\t * scriptLoader.loadQueue(function() {\n-\t *    alert('All scripts are now loaded.');\n-\t * });\n-\t */\n-\ttinymce.dom.ScriptLoader = function(settings) {\n-\t\tvar QUEUED = 0,\n-\t\t\tLOADING = 1,\n-\t\t\tLOADED = 2,\n-\t\t\tstates = {},\n-\t\t\tqueue = [],\n-\t\t\tscriptLoadedCallbacks = {},\n-\t\t\tqueueLoadedCallbacks = [],\n-\t\t\tloading = 0,\n-\t\t\tundef;\n-\n-\t\t/**\n-\t\t * Loads a specific script directly without adding it to the load queue.\n-\t\t *\n-\t\t * @method load\n-\t\t * @param {String} url Absolute URL to script to add.\n-\t\t * @param {function} callback Optional callback function to execute ones this script gets loaded.\n-\t\t * @param {Object} scope Optional scope to execute callback in.\n-\t\t */\n-\t\tfunction loadScript(url, callback) {\n-\t\t\tvar t = this, dom = tinymce.DOM, elm, uri, loc, id;\n-\n-\t\t\t// Execute callback when script is loaded\n-\t\t\tfunction done() {\n-\t\t\t\tdom.remove(id);\n-\n-\t\t\t\tif (elm)\n-\t\t\t\t\telm.onreadystatechange = elm.onload = elm = null;\n-\n-\t\t\t\tcallback();\n-\t\t\t};\n-\t\t\t\n-\t\t\tfunction error() {\n-\t\t\t\t// Report the error so it's easier for people to spot loading errors\n-\t\t\t\tif (typeof(console) !== \"undefined\" && console.log)\n-\t\t\t\t\tconsole.log(\"Failed to load: \" + url);\n-\n-\t\t\t\t// We can't mark it as done if there is a load error since\n-\t\t\t\t// A) We don't want to produce 404 errors on the server and\n-\t\t\t\t// B) the onerror event won't fire on all browsers.\n-\t\t\t\t// done();\n-\t\t\t};\n-\n-\t\t\tid = dom.uniqueId();\n-\n-\t\t\tif (tinymce.isIE6) {\n-\t\t\t\turi = new tinymce.util.URI(url);\n-\t\t\t\tloc = location;\n-\n-\t\t\t\t// If script is from same domain and we\n-\t\t\t\t// use IE 6 then use XHR since it's more reliable\n-\t\t\t\tif (uri.host == loc.hostname && uri.port == loc.port && (uri.protocol + ':') == loc.protocol && uri.protocol.toLowerCase() != 'file') {\n-\t\t\t\t\ttinymce.util.XHR.send({\n-\t\t\t\t\t\turl : tinymce._addVer(uri.getURI()),\n-\t\t\t\t\t\tsuccess : function(content) {\n-\t\t\t\t\t\t\t// Create new temp script element\n-\t\t\t\t\t\t\tvar script = dom.create('script', {\n-\t\t\t\t\t\t\t\ttype : 'text/javascript'\n-\t\t\t\t\t\t\t});\n-\n-\t\t\t\t\t\t\t// Evaluate script in global scope\n-\t\t\t\t\t\t\tscript.text = content;\n-\t\t\t\t\t\t\tdocument.getElementsByTagName('head')[0].appendChild(script);\n-\t\t\t\t\t\t\tdom.remove(script);\n-\n-\t\t\t\t\t\t\tdone();\n-\t\t\t\t\t\t},\n-\t\t\t\t\t\t\n-\t\t\t\t\t\terror : error\n-\t\t\t\t\t});\n-\n-\t\t\t\t\treturn;\n-\t\t\t\t}\n-\t\t\t}\n-\n-\t\t\t// Create new script element\n-\t\t\telm = document.createElement('script');\n-\t\t\telm.id = id;\n-\t\t\telm.type = 'text/javascript';\n-\t\t\telm.src = tinymce._addVer(url);\n-\n-\t\t\t// Add onload listener for non IE browsers since IE9\n-\t\t\t// fires onload event before the script is parsed and executed\n-\t\t\tif (!tinymce.isIE || tinymce.isIE11)\n-\t\t\t\telm.onload = done;\n-\n-\t\t\t// Add onerror event will get fired on some browsers but not all of them\n-\t\t\telm.onerror = error;\n-\n-\t\t\t// Opera 9.60 doesn't seem to fire the onreadystate event at correctly\n-\t\t\tif (!tinymce.isOpera) {\n-\t\t\t\telm.onreadystatechange = function() {\n-\t\t\t\t\tvar state = elm.readyState;\n-\n-\t\t\t\t\t// Loaded state is passed on IE 6 however there\n-\t\t\t\t\t// are known issues with this method but we can't use\n-\t\t\t\t\t// XHR in a cross domain loading\n-\t\t\t\t\tif (state == 'complete' || state == 'loaded')\n-\t\t\t\t\t\tdone();\n-\t\t\t\t};\n-\t\t\t}\n-\n-\t\t\t// Most browsers support this feature so we report errors\n-\t\t\t// for those at least to help users track their missing plugins etc\n-\t\t\t// todo: Removed since it produced error if the document is unloaded by navigating away, re-add it as an option\n-\t\t\t/*elm.onerror = function() {\n-\t\t\t\talert('Failed to load: ' + url);\n-\t\t\t};*/\n-\n-\t\t\t// Add script to document\n-\t\t\t(document.getElementsByTagName('head')[0] || document.body).appendChild(elm);\n-\t\t};\n-\n-\t\t/**\n-\t\t * Returns true/false if a script has been loaded or not.\n-\t\t *\n-\t\t * @method isDone\n-\t\t * @param {String} url URL to check for.\n-\t\t * @return [Boolean} true/false if the URL is loaded.\n-\t\t */\n-\t\tthis.isDone = function(url) {\n-\t\t\treturn states[url] == LOADED;\n-\t\t};\n-\n-\t\t/**\n-\t\t * Marks a specific script to be loaded. This can be useful if a script got loaded outside\n-\t\t * the script loader or to skip it from loading some script.\n-\t\t *\n-\t\t * @method markDone\n-\t\t * @param {string} u Absolute URL to the script to mark as loaded.\n-\t\t */\n-\t\tthis.markDone = function(url) {\n-\t\t\tstates[url] = LOADED;\n-\t\t};\n-\n-\t\t/**\n-\t\t * Adds a specific script to the load queue of the script loader.\n-\t\t *\n-\t\t * @method add\n-\t\t * @param {String} url Absolute URL to script to add.\n-\t\t * @param {function} callback Optional callback function to execute ones this script gets loaded.\n-\t\t * @param {Object} scope Optional scope to execute callback in.\n-\t\t */\n-\t\tthis.add = this.load = function(url, callback, scope) {\n-\t\t\tvar item, state = states[url];\n-\n-\t\t\t// Add url to load queue\n-\t\t\tif (state == undef) {\n-\t\t\t\tqueue.push(url);\n-\t\t\t\tstates[url] = QUEUED;\n-\t\t\t}\n-\n-\t\t\tif (callback) {\n-\t\t\t\t// Store away callback for later execution\n-\t\t\t\tif (!scriptLoadedCallbacks[url])\n-\t\t\t\t\tscriptLoadedCallbacks[url] = [];\n-\n-\t\t\t\tscriptLoadedCallbacks[url].push({\n-\t\t\t\t\tfunc : callback,\n-\t\t\t\t\tscope : scope || this\n-\t\t\t\t});\n-\t\t\t}\n-\t\t};\n-\n-\t\t/**\n-\t\t * Starts the loading of the queue.\n-\t\t *\n-\t\t * @method loadQueue\n-\t\t * @param {function} callback Optional callback to execute when all queued items are loaded.\n-\t\t * @param {Object} scope Optional scope to execute the callback in.\n-\t\t */\n-\t\tthis.loadQueue = function(callback, scope) {\n-\t\t\tthis.loadScripts(queue, callback, scope);\n-\t\t};\n-\n-\t\t/**\n-\t\t * Loads the specified queue of files and executes the callback ones they are loaded.\n-\t\t * This method is generally not used outside this class but it might be useful in some scenarios. \n-\t\t *\n-\t\t * @method loadScripts\n-\t\t * @param {Array} scripts Array of queue items to load.\n-\t\t * @param {function} callback Optional callback to execute ones all items are loaded.\n-\t\t * @param {Object} scope Optional scope to execute callback in.\n-\t\t */\n-\t\tthis.loadScripts = function(scripts, callback, scope) {\n-\t\t\tvar loadScripts;\n-\n-\t\t\tfunction execScriptLoadedCallbacks(url) {\n-\t\t\t\t// Execute URL callback functions\n-\t\t\t\ttinymce.each(scriptLoadedCallbacks[url], function(callback) {\n-\t\t\t\t\tcallback.func.call(callback.scope);\n-\t\t\t\t});\n-\n-\t\t\t\tscriptLoadedCallbacks[url] = undef;\n-\t\t\t};\n-\n-\t\t\tqueueLoadedCallbacks.push({\n-\t\t\t\tfunc : callback,\n-\t\t\t\tscope : scope || this\n-\t\t\t});\n-\n-\t\t\tloadScripts = function() {\n-\t\t\t\tvar loadingScripts = tinymce.grep(scripts);\n-\n-\t\t\t\t// Current scripts has been handled\n-\t\t\t\tscripts.length = 0;\n-\n-\t\t\t\t// Load scripts that needs to be loaded\n-\t\t\t\ttinymce.each(loadingScripts, function(url) {\n-\t\t\t\t\t// Script is already loaded then execute script callbacks directly\n-\t\t\t\t\tif (states[url] == LOADED) {\n-\t\t\t\t\t\texecScriptLoadedCallbacks(url);\n-\t\t\t\t\t\treturn;\n-\t\t\t\t\t}\n-\n-\t\t\t\t\t// Is script not loading then start loading it\n-\t\t\t\t\tif (states[url] != LOADING) {\n-\t\t\t\t\t\tstates[url] = LOADING;\n-\t\t\t\t\t\tloading++;\n-\n-\t\t\t\t\t\tloadScript(url, function() {\n-\t\t\t\t\t\t\tstates[url] = LOADED;\n-\t\t\t\t\t\t\tloading--;\n-\n-\t\t\t\t\t\t\texecScriptLoadedCallbacks(url);\n-\n-\t\t\t\t\t\t\t// Load more scripts if they where added by the recently loaded script\n-\t\t\t\t\t\t\tloadScripts();\n-\t\t\t\t\t\t});\n-\t\t\t\t\t}\n-\t\t\t\t});\n-\n-\t\t\t\t// No scripts are currently loading then execute all pending queue loaded callbacks\n-\t\t\t\tif (!loading) {\n-\t\t\t\t\ttinymce.each(queueLoadedCallbacks, function(callback) {\n-\t\t\t\t\t\tcallback.func.call(callback.scope);\n-\t\t\t\t\t});\n-\n-\t\t\t\t\tqueueLoadedCallbacks.length = 0;\n-\t\t\t\t}\n-\t\t\t};\n-\n-\t\t\tloadScripts();\n-\t\t};\n-\t};\n-\n-\t// Global script loader\n-\ttinymce.ScriptLoader = new tinymce.dom.ScriptLoader();\n-})(tinymce);"
        },
        {
            "filename": "js/tiny_mce/classes/dom/Selection.js",
            "diff": "@@ -1,1374 +0,0 @@\n-/**\n- * Selection.js\n- *\n- * Copyright, Moxiecode Systems AB\n- * Released under LGPL License.\n- *\n- * License: http://www.tinymce.com/license\n- * Contributing: http://www.tinymce.com/contributing\n- */\n-\n-(function(tinymce) {\n-\tfunction trimNl(s) {\n-\t\treturn s.replace(/[\\n\\r]+/g, '');\n-\t};\n-\n-\t// Shorten names\n-\tvar is = tinymce.is, isIE = tinymce.isIE, each = tinymce.each, TreeWalker = tinymce.dom.TreeWalker;\n-\n-\t/**\n-\t * This class handles text and control selection it's an crossbrowser utility class.\n-\t * Consult the TinyMCE Wiki API for more details and examples on how to use this class.\n-\t *\n-\t * @class tinymce.dom.Selection\n-\t * @example\n-\t * // Getting the currently selected node for the active editor\n-\t * alert(tinymce.activeEditor.selection.getNode().nodeName);\n-\t */\n-\ttinymce.create('tinymce.dom.Selection', {\n-\t\t/**\n-\t\t * Constructs a new selection instance.\n-\t\t *\n-\t\t * @constructor\n-\t\t * @method Selection\n-\t\t * @param {tinymce.dom.DOMUtils} dom DOMUtils object reference.\n-\t\t * @param {Window} win Window to bind the selection object to.\n-\t\t * @param {tinymce.dom.Serializer} serializer DOM serialization class to use for getContent.\n-\t\t */\n-\t\tSelection : function(dom, win, serializer, editor) {\n-\t\t\tvar t = this;\n-\n-\t\t\tt.dom = dom;\n-\t\t\tt.win = win;\n-\t\t\tt.serializer = serializer;\n-\t\t\tt.editor = editor;\n-\n-\t\t\t// Add events\n-\t\t\teach([\n-\t\t\t\t/**\n-\t\t\t\t * This event gets executed before contents is extracted from the selection.\n-\t\t\t\t *\n-\t\t\t\t * @event onBeforeSetContent\n-\t\t\t\t * @param {tinymce.dom.Selection} selection Selection object that fired the event.\n-\t\t\t\t * @param {Object} args Contains things like the contents that will be returned.\n-\t\t\t\t */\n-\t\t\t\t'onBeforeSetContent',\n-\n-\t\t\t\t/**\n-\t\t\t\t * This event gets executed before contents is inserted into selection.\n-\t\t\t\t *\n-\t\t\t\t * @event onBeforeGetContent\n-\t\t\t\t * @param {tinymce.dom.Selection} selection Selection object that fired the event.\n-\t\t\t\t * @param {Object} args Contains things like the contents that will be inserted.\n-\t\t\t\t */\n-\t\t\t\t'onBeforeGetContent',\n-\n-\t\t\t\t/**\n-\t\t\t\t * This event gets executed when contents is inserted into selection.\n-\t\t\t\t *\n-\t\t\t\t * @event onSetContent\n-\t\t\t\t * @param {tinymce.dom.Selection} selection Selection object that fired the event.\n-\t\t\t\t * @param {Object} args Contains things like the contents that will be inserted.\n-\t\t\t\t */\n-\t\t\t\t'onSetContent',\n-\n-\t\t\t\t/**\n-\t\t\t\t * This event gets executed when contents is extracted from the selection.\n-\t\t\t\t *\n-\t\t\t\t * @event onGetContent\n-\t\t\t\t * @param {tinymce.dom.Selection} selection Selection object that fired the event.\n-\t\t\t\t * @param {Object} args Contains things like the contents that will be returned.\n-\t\t\t\t */\n-\t\t\t\t'onGetContent'\n-\t\t\t], function(e) {\n-\t\t\t\tt[e] = new tinymce.util.Dispatcher(t);\n-\t\t\t});\n-\n-\t\t\t// No W3C Range support\n-\t\t\tif (!t.win.getSelection)\n-\t\t\t\tt.tridentSel = new tinymce.dom.TridentSelection(t);\n-\n-\t\t\tif (tinymce.isIE && ! tinymce.isIE11 && dom.boxModel)\n-\t\t\t\tthis._fixIESelection();\n-\n-\t\t\t// Prevent leaks\n-\t\t\ttinymce.addUnload(t.destroy, t);\n-\t\t},\n-\n-\t\t/**\n-\t\t * Move the selection cursor range to the specified node and offset.\n-\t\t * @param node Node to put the cursor in.\n-\t\t * @param offset Offset from the start of the node to put the cursor at.\n-\t\t */\n-\t\tsetCursorLocation: function(node, offset) {\n-\t\t\tvar t = this; var r = t.dom.createRng();\n-\t\t\tr.setStart(node, offset);\n-\t\t\tr.setEnd(node, offset);\n-\t\t\tt.setRng(r);\n-\t\t\tt.collapse(false);\n-\t\t},\n-\t\t/**\n-\t\t * Returns the selected contents using the DOM serializer passed in to this class.\n-\t\t *\n-\t\t * @method getContent\n-\t\t * @param {Object} s Optional settings class with for example output format text or html.\n-\t\t * @return {String} Selected contents in for example HTML format.\n-\t\t * @example\n-\t\t * // Alerts the currently selected contents\n-\t\t * alert(tinyMCE.activeEditor.selection.getContent());\n-\t\t *\n-\t\t * // Alerts the currently selected contents as plain text\n-\t\t * alert(tinyMCE.activeEditor.selection.getContent({format : 'text'}));\n-\t\t */\n-\t\tgetContent : function(s) {\n-\t\t\tvar t = this, r = t.getRng(), e = t.dom.create(\"body\"), se = t.getSel(), wb, wa, n;\n-\n-\t\t\ts = s || {};\n-\t\t\twb = wa = '';\n-\t\t\ts.get = true;\n-\t\t\ts.format = s.format || 'html';\n-\t\t\ts.forced_root_block = '';\n-\t\t\tt.onBeforeGetContent.dispatch(t, s);\n-\n-\t\t\tif (s.format == 'text')\n-\t\t\t\treturn t.isCollapsed() ? '' : (r.text || (se.toString ? se.toString() : ''));\n-\n-\t\t\tif (r.cloneContents) {\n-\t\t\t\tn = r.cloneContents();\n-\n-\t\t\t\tif (n)\n-\t\t\t\t\te.appendChild(n);\n-\t\t\t} else if (is(r.item) || is(r.htmlText)) {\n-\t\t\t\t// IE will produce invalid markup if elements are present that\n-\t\t\t\t// it doesn't understand like custom elements or HTML5 elements.\n-\t\t\t\t// Adding a BR in front of the contents and then remoiving it seems to fix it though.\n-\t\t\t\te.innerHTML = '<br>' + (r.item ? r.item(0).outerHTML : r.htmlText);\n-\t\t\t\te.removeChild(e.firstChild);\n-\t\t\t} else\n-\t\t\t\te.innerHTML = r.toString();\n-\n-\t\t\t// Keep whitespace before and after\n-\t\t\tif (/^\\s/.test(e.innerHTML))\n-\t\t\t\twb = ' ';\n-\n-\t\t\tif (/\\s+$/.test(e.innerHTML))\n-\t\t\t\twa = ' ';\n-\n-\t\t\ts.getInner = true;\n-\n-\t\t\ts.content = t.isCollapsed() ? '' : wb + t.serializer.serialize(e, s) + wa;\n-\t\t\tt.onGetContent.dispatch(t, s);\n-\n-\t\t\treturn s.content;\n-\t\t},\n-\n-\t\t/**\n-\t\t * Sets the current selection to the specified content. If any contents is selected it will be replaced\n-\t\t * with the contents passed in to this function. If there is no selection the contents will be inserted\n-\t\t * where the caret is placed in the editor/page.\n-\t\t *\n-\t\t * @method setContent\n-\t\t * @param {String} content HTML contents to set could also be other formats depending on settings.\n-\t\t * @param {Object} args Optional settings object with for example data format.\n-\t\t * @example\n-\t\t * // Inserts some HTML contents at the current selection\n-\t\t * tinyMCE.activeEditor.selection.setContent('<strong>Some contents</strong>');\n-\t\t */\n-\t\tsetContent : function(content, args) {\n-\t\t\tvar self = this, rng = self.getRng(), caretNode, doc = self.win.document, frag, temp;\n-\n-\t\t\targs = args || {format : 'html'};\n-\t\t\targs.set = true;\n-\t\t\tcontent = args.content = content;\n-\n-\t\t\t// Dispatch before set content event\n-\t\t\tif (!args.no_events)\n-\t\t\t\tself.onBeforeSetContent.dispatch(self, args);\n-\n-\t\t\tcontent = args.content;\n-\n-\t\t\tif (rng.insertNode) {\n-\t\t\t\t// Make caret marker since insertNode places the caret in the beginning of text after insert\n-\t\t\t\tcontent += '<span id=\"__caret\">_</span>';\n-\n-\t\t\t\t// Delete and insert new node\n-\t\t\t\tif (rng.startContainer == doc && rng.endContainer == doc) {\n-\t\t\t\t\t// WebKit will fail if the body is empty since the range is then invalid and it can't insert contents\n-\t\t\t\t\tdoc.body.innerHTML = content;\n-\t\t\t\t} else {\n-\t\t\t\t\trng.deleteContents();\n-\n-\t\t\t\t\tif (doc.body.childNodes.length === 0) {\n-\t\t\t\t\t\tdoc.body.innerHTML = content;\n-\t\t\t\t\t} else {\n-\t\t\t\t\t\t// createContextualFragment doesn't exists in IE 9 DOMRanges\n-\t\t\t\t\t\tif (rng.createContextualFragment) {\n-\t\t\t\t\t\t\trng.insertNode(rng.createContextualFragment(content));\n-\t\t\t\t\t\t} else {\n-\t\t\t\t\t\t\t// Fake createContextualFragment call in IE 9\n-\t\t\t\t\t\t\tfrag = doc.createDocumentFragment();\n-\t\t\t\t\t\t\ttemp = doc.createElement('div');\n-\n-\t\t\t\t\t\t\tfrag.appendChild(temp);\n-\t\t\t\t\t\t\ttemp.outerHTML = content;\n-\n-\t\t\t\t\t\t\trng.insertNode(frag);\n-\t\t\t\t\t\t}\n-\t\t\t\t\t}\n-\t\t\t\t}\n-\n-\t\t\t\t// Move to caret marker\n-\t\t\t\tcaretNode = self.dom.get('__caret');\n-\n-\t\t\t\t// Make sure we wrap it compleatly, Opera fails with a simple select call\n-\t\t\t\trng = doc.createRange();\n-\t\t\t\trng.setStartBefore(caretNode);\n-\t\t\t\trng.setEndBefore(caretNode);\n-\t\t\t\tself.setRng(rng);\n-\n-\t\t\t\t// Remove the caret position\n-\t\t\t\tself.dom.remove('__caret');\n-\n-\t\t\t\ttry {\n-\t\t\t\t\tself.setRng(rng);\n-\t\t\t\t} catch (ex) {\n-\t\t\t\t\t// Might fail on Opera for some odd reason\n-\t\t\t\t}\n-\t\t\t} else {\n-\t\t\t\tif (rng.item) {\n-\t\t\t\t\t// Delete content and get caret text selection\n-\t\t\t\t\tdoc.execCommand('Delete', false, null);\n-\t\t\t\t\trng = self.getRng();\n-\t\t\t\t}\n-\n-\t\t\t\t// Explorer removes spaces from the beginning of pasted contents\n-\t\t\t\tif (/^\\s+/.test(content)) {\n-\t\t\t\t\trng.pasteHTML('<span id=\"__mce_tmp\">_</span>' + content);\n-\t\t\t\t\tself.dom.remove('__mce_tmp');\n-\t\t\t\t} else\n-\t\t\t\t\trng.pasteHTML(content);\n-\t\t\t}\n-\n-\t\t\t// Dispatch set content event\n-\t\t\tif (!args.no_events)\n-\t\t\t\tself.onSetContent.dispatch(self, args);\n-\t\t},\n-\n-\t\t/**\n-\t\t * Returns the start element of a selection range. If the start is in a text\n-\t\t * node the parent element will be returned.\n-\t\t *\n-\t\t * @method getStart\n-\t\t * @return {Element} Start element of selection range.\n-\t\t */\n-\t\tgetStart : function() {\n-\t\t\tvar self = this, rng = self.getRng(), startElement, parentElement, checkRng, node;\n-\n-\t\t\tif (rng.duplicate || rng.item) {\n-\t\t\t\t// Control selection, return first item\n-\t\t\t\tif (rng.item)\n-\t\t\t\t\treturn rng.item(0);\n-\n-\t\t\t\t// Get start element\n-\t\t\t\tcheckRng = rng.duplicate();\n-\t\t\t\tcheckRng.collapse(1);\n-\t\t\t\tstartElement = checkRng.parentElement();\n-\t\t\t\tif (startElement.ownerDocument !== self.dom.doc) {\n-\t\t\t\t\tstartElement = self.dom.getRoot();\n-\t\t\t\t}\n-\n-\t\t\t\t// Check if range parent is inside the start element, then return the inner parent element\n-\t\t\t\t// This will fix issues when a single element is selected, IE would otherwise return the wrong start element\n-\t\t\t\tparentElement = node = rng.parentElement();\n-\t\t\t\twhile (node = node.parentNode) {\n-\t\t\t\t\tif (node == startElement) {\n-\t\t\t\t\t\tstartElement = parentElement;\n-\t\t\t\t\t\tbreak;\n-\t\t\t\t\t}\n-\t\t\t\t}\n-\n-\t\t\t\treturn startElement;\n-\t\t\t} else {\n-\t\t\t\tstartElement = rng.startContainer;\n-\n-\t\t\t\tif (startElement.nodeType == 1 && startElement.hasChildNodes())\n-\t\t\t\t\tstartElement = startElement.childNodes[Math.min(startElement.childNodes.length - 1, rng.startOffset)];\n-\n-\t\t\t\tif (startElement && startElement.nodeType == 3)\n-\t\t\t\t\treturn startElement.parentNode;\n-\n-\t\t\t\treturn startElement;\n-\t\t\t}\n-\t\t},\n-\n-\t\t/**\n-\t\t * Returns the end element of a selection range. If the end is in a text\n-\t\t * node the parent element will be returned.\n-\t\t *\n-\t\t * @method getEnd\n-\t\t * @return {Element} End element of selection range.\n-\t\t */\n-\t\tgetEnd : function() {\n-\t\t\tvar self = this, rng = self.getRng(), endElement, endOffset;\n-\n-\t\t\tif (rng.duplicate || rng.item) {\n-\t\t\t\tif (rng.item)\n-\t\t\t\t\treturn rng.item(0);\n-\n-\t\t\t\trng = rng.duplicate();\n-\t\t\t\trng.collapse(0);\n-\t\t\t\tendElement = rng.parentElement();\n-\t\t\t\tif (endElement.ownerDocument !== self.dom.doc) {\n-\t\t\t\t\tendElement = self.dom.getRoot();\n-\t\t\t\t}\n-\n-\t\t\t\tif (endElement && endElement.nodeName == 'BODY')\n-\t\t\t\t\treturn endElement.lastChild || endElement;\n-\n-\t\t\t\treturn endElement;\n-\t\t\t} else {\n-\t\t\t\tendElement = rng.endContainer;\n-\t\t\t\tendOffset = rng.endOffset;\n-\n-\t\t\t\tif (endElement.nodeType == 1 && endElement.hasChildNodes())\n-\t\t\t\t\tendElement = endElement.childNodes[endOffset > 0 ? endOffset - 1 : endOffset];\n-\n-\t\t\t\tif (endElement && endElement.nodeType == 3)\n-\t\t\t\t\treturn endElement.parentNode;\n-\n-\t\t\t\treturn endElement;\n-\t\t\t}\n-\t\t},\n-\n-\t\t/**\n-\t\t * Returns a bookmark location for the current selection. This bookmark object\n-\t\t * can then be used to restore the selection after some content modification to the document.\n-\t\t *\n-\t\t * @method getBookmark\n-\t\t * @param {Number} type Optional state if the bookmark should be simple or not. Default is complex.\n-\t\t * @param {Boolean} normalized Optional state that enables you to get a position that it would be after normalization.\n-\t\t * @return {Object} Bookmark object, use moveToBookmark with this object to restore the selection.\n-\t\t * @example\n-\t\t * // Stores a bookmark of the current selection\n-\t\t * var bm = tinyMCE.activeEditor.selection.getBookmark();\n-\t\t *\n-\t\t * tinyMCE.activeEditor.setContent(tinyMCE.activeEditor.getContent() + 'Some new content');\n-\t\t *\n-\t\t * // Restore the selection bookmark\n-\t\t * tinyMCE.activeEditor.selection.moveToBookmark(bm);\n-\t\t */\n-\t\tgetBookmark : function(type, normalized) {\n-\t\t\tvar t = this, dom = t.dom, rng, rng2, id, collapsed, name, element, index, chr = '\\uFEFF', styles;\n-\n-\t\t\tfunction findIndex(name, element) {\n-\t\t\t\tvar index = 0;\n-\n-\t\t\t\teach(dom.select(name), function(node, i) {\n-\t\t\t\t\tif (node == element)\n-\t\t\t\t\t\tindex = i;\n-\t\t\t\t});\n-\n-\t\t\t\treturn index;\n-\t\t\t};\n-\n-\t\t\tfunction normalizeTableCellSelection(rng) {\n-\t\t\t\tfunction moveEndPoint(start) {\n-\t\t\t\t\tvar container, offset, childNodes, prefix = start ? 'start' : 'end';\n-\n-\t\t\t\t\tcontainer = rng[prefix + 'Container'];\n-\t\t\t\t\toffset = rng[prefix + 'Offset'];\n-\n-\t\t\t\t\tif (container.nodeType == 1 && container.nodeName == \"TR\") {\n-\t\t\t\t\t\tchildNodes = container.childNodes;\n-\t\t\t\t\t\tcontainer = childNodes[Math.min(start ? offset : offset - 1, childNodes.length - 1)];\n-\t\t\t\t\t\tif (container) {\n-\t\t\t\t\t\t\toffset = start ? 0 : container.childNodes.length;\n-\t\t\t\t\t\t\trng['set' + (start ? 'Start' : 'End')](container, offset);\n-\t\t\t\t\t\t}\n-\t\t\t\t\t}\n-\t\t\t\t};\n-\n-\t\t\t\tmoveEndPoint(true);\n-\t\t\t\tmoveEndPoint();\n-\n-\t\t\t\treturn rng;\n-\t\t\t};\n-\n-\t\t\tfunction getLocation() {\n-\t\t\t\tvar rng = t.getRng(true), root = dom.getRoot(), bookmark = {};\n-\n-\t\t\t\tfunction getPoint(rng, start) {\n-\t\t\t\t\tvar container = rng[start ? 'startContainer' : 'endContainer'],\n-\t\t\t\t\t\toffset = rng[start ? 'startOffset' : 'endOffset'], point = [], node, childNodes, after = 0;\n-\n-\t\t\t\t\tif (container.nodeType == 3) {\n-\t\t\t\t\t\tif (normalized) {\n-\t\t\t\t\t\t\tfor (node = container.previousSibling; node && node.nodeType == 3; node = node.previousSibling)\n-\t\t\t\t\t\t\t\toffset += node.nodeValue.length;\n-\t\t\t\t\t\t}\n-\n-\t\t\t\t\t\tpoint.push(offset);\n-\t\t\t\t\t} else {\n-\t\t\t\t\t\tchildNodes = container.childNodes;\n-\n-\t\t\t\t\t\tif (offset >= childNodes.length && childNodes.length) {\n-\t\t\t\t\t\t\tafter = 1;\n-\t\t\t\t\t\t\toffset = Math.max(0, childNodes.length - 1);\n-\t\t\t\t\t\t}\n-\n-\t\t\t\t\t\tpoint.push(t.dom.nodeIndex(childNodes[offset], normalized) + after);\n-\t\t\t\t\t}\n-\n-\t\t\t\t\tfor (; container && container != root; container = container.parentNode)\n-\t\t\t\t\t\tpoint.push(t.dom.nodeIndex(container, normalized));\n-\n-\t\t\t\t\treturn point;\n-\t\t\t\t};\n-\n-\t\t\t\tbookmark.start = getPoint(rng, true);\n-\n-\t\t\t\tif (!t.isCollapsed())\n-\t\t\t\t\tbookmark.end = getPoint(rng);\n-\n-\t\t\t\treturn bookmark;\n-\t\t\t};\n-\n-\t\t\tif (type == 2) {\n-\t\t\t\tif (t.tridentSel)\n-\t\t\t\t\treturn t.tridentSel.getBookmark(type);\n-\n-\t\t\t\treturn getLocation();\n-\t\t\t}\n-\n-\t\t\t// Handle simple range\n-\t\t\tif (type) {\n-\t\t\t\trng = t.getRng();\n-\n-\t\t\t\tif (rng.setStart) {\n-\t\t\t\t\trng = {\n-\t\t\t\t\t\tstartContainer: rng.startContainer,\n-\t\t\t\t\t\tstartOffset: rng.startOffset,\n-\t\t\t\t\t\tendContainer: rng.endContainer,\n-\t\t\t\t\t\tendOffset: rng.endOffset\n-\t\t\t\t\t};\n-\t\t\t\t}\n-\n-\t\t\t\treturn {rng : rng};\n-\t\t\t}\n-\n-\t\t\trng = t.getRng();\n-\t\t\tid = dom.uniqueId();\n-\t\t\tcollapsed = tinyMCE.activeEditor.selection.isCollapsed();\n-\t\t\tstyles = 'overflow:hidden;line-height:0px';\n-\n-\t\t\t// Explorer method\n-\t\t\tif (rng.duplicate || rng.item) {\n-\t\t\t\t// Text selection\n-\t\t\t\tif (!rng.item) {\n-\t\t\t\t\trng2 = rng.duplicate();\n-\n-\t\t\t\t\ttry {\n-\t\t\t\t\t\t// Insert start marker\n-\t\t\t\t\t\trng.collapse();\n-\t\t\t\t\t\trng.pasteHTML('<span data-mce-type=\"bookmark\" id=\"' + id + '_start\" style=\"' + styles + '\">' + chr + '</span>');\n-\n-\t\t\t\t\t\t// Insert end marker\n-\t\t\t\t\t\tif (!collapsed) {\n-\t\t\t\t\t\t\trng2.collapse(false);\n-\n-\t\t\t\t\t\t\t// Detect the empty space after block elements in IE and move the end back one character <p></p>] becomes <p>]</p>\n-\t\t\t\t\t\t\trng.moveToElementText(rng2.parentElement());\n-\t\t\t\t\t\t\tif (rng.compareEndPoints('StartToEnd', rng2) === 0)\n-\t\t\t\t\t\t\t\trng2.move('character', -1);\n-\n-\t\t\t\t\t\t\trng2.pasteHTML('<span data-mce-type=\"bookmark\" id=\"' + id + '_end\" style=\"' + styles + '\">' + chr + '</span>');\n-\t\t\t\t\t\t}\n-\t\t\t\t\t} catch (ex) {\n-\t\t\t\t\t\t// IE might throw unspecified error so lets ignore it\n-\t\t\t\t\t\treturn null;\n-\t\t\t\t\t}\n-\t\t\t\t} else {\n-\t\t\t\t\t// Control selection\n-\t\t\t\t\telement = rng.item(0);\n-\t\t\t\t\tname = element.nodeName;\n-\n-\t\t\t\t\treturn {name : name, index : findIndex(name, element)};\n-\t\t\t\t}\n-\t\t\t} else {\n-\t\t\t\telement = t.getNode();\n-\t\t\t\tname = element.nodeName;\n-\t\t\t\tif (name == 'IMG')\n-\t\t\t\t\treturn {name : name, index : findIndex(name, element)};\n-\n-\t\t\t\t// W3C method\n-\t\t\t\trng2 = normalizeTableCellSelection(rng.cloneRange());\n-\n-\t\t\t\t// Insert end marker\n-\t\t\t\tif (!collapsed) {\n-\t\t\t\t\trng2.collapse(false);\n-\t\t\t\t\trng2.insertNode(dom.create('span', {'data-mce-type' : \"bookmark\", id : id + '_end', style : styles}, chr));\n-\t\t\t\t}\n-\n-\t\t\t\trng = normalizeTableCellSelection(rng);\n-\t\t\t\trng.collapse(true);\n-\t\t\t\trng.insertNode(dom.create('span', {'data-mce-type' : \"bookmark\", id : id + '_start', style : styles}, chr));\n-\t\t\t}\n-\n-\t\t\tt.moveToBookmark({id : id, keep : 1});\n-\n-\t\t\treturn {id : id};\n-\t\t},\n-\n-\t\t/**\n-\t\t * Restores the selection to the specified bookmark.\n-\t\t *\n-\t\t * @method moveToBookmark\n-\t\t * @param {Object} bookmark Bookmark to restore selection from.\n-\t\t * @return {Boolean} true/false if it was successful or not.\n-\t\t * @example\n-\t\t * // Stores a bookmark of the current selection\n-\t\t * var bm = tinyMCE.activeEditor.selection.getBookmark();\n-\t\t *\n-\t\t * tinyMCE.activeEditor.setContent(tinyMCE.activeEditor.getContent() + 'Some new content');\n-\t\t *\n-\t\t * // Restore the selection bookmark\n-\t\t * tinyMCE.activeEditor.selection.moveToBookmark(bm);\n-\t\t */\n-\t\tmoveToBookmark : function(bookmark) {\n-\t\t\tvar t = this, dom = t.dom, marker1, marker2, rng, rng2, root, startContainer, endContainer, startOffset, endOffset;\n-\n-\t\t\tfunction setEndPoint(start) {\n-\t\t\t\tvar point = bookmark[start ? 'start' : 'end'], i, node, offset, children;\n-\n-\t\t\t\tif (point) {\n-\t\t\t\t\toffset = point[0];\n-\n-\t\t\t\t\t// Find container node\n-\t\t\t\t\tfor (node = root, i = point.length - 1; i >= 1; i--) {\n-\t\t\t\t\t\tchildren = node.childNodes;\n-\n-\t\t\t\t\t\tif (point[i] > children.length - 1)\n-\t\t\t\t\t\t\treturn;\n-\n-\t\t\t\t\t\tnode = children[point[i]];\n-\t\t\t\t\t}\n-\n-\t\t\t\t\t// Move text offset to best suitable location\n-\t\t\t\t\tif (node.nodeType === 3)\n-\t\t\t\t\t\toffset = Math.min(point[0], node.nodeValue.length);\n-\n-\t\t\t\t\t// Move element offset to best suitable location\n-\t\t\t\t\tif (node.nodeType === 1)\n-\t\t\t\t\t\toffset = Math.min(point[0], node.childNodes.length);\n-\n-\t\t\t\t\t// Set offset within container node\n-\t\t\t\t\tif (start)\n-\t\t\t\t\t\trng.setStart(node, offset);\n-\t\t\t\t\telse\n-\t\t\t\t\t\trng.setEnd(node, offset);\n-\t\t\t\t}\n-\n-\t\t\t\treturn true;\n-\t\t\t};\n-\n-\t\t\tfunction restoreEndPoint(suffix) {\n-\t\t\t\tvar marker = dom.get(bookmark.id + '_' + suffix), node, idx, next, prev, keep = bookmark.keep;\n-\n-\t\t\t\tif (marker) {\n-\t\t\t\t\tnode = marker.parentNode;\n-\n-\t\t\t\t\tif (suffix == 'start') {\n-\t\t\t\t\t\tif (!keep) {\n-\t\t\t\t\t\t\tidx = dom.nodeIndex(marker);\n-\t\t\t\t\t\t} else {\n-\t\t\t\t\t\t\tnode = marker.firstChild;\n-\t\t\t\t\t\t\tidx = 1;\n-\t\t\t\t\t\t}\n-\n-\t\t\t\t\t\tstartContainer = endContainer = node;\n-\t\t\t\t\t\tstartOffset = endOffset = idx;\n-\t\t\t\t\t} else {\n-\t\t\t\t\t\tif (!keep) {\n-\t\t\t\t\t\t\tidx = dom.nodeIndex(marker);\n-\t\t\t\t\t\t} else {\n-\t\t\t\t\t\t\tnode = marker.firstChild;\n-\t\t\t\t\t\t\tidx = 1;\n-\t\t\t\t\t\t}\n-\n-\t\t\t\t\t\tendContainer = node;\n-\t\t\t\t\t\tendOffset = idx;\n-\t\t\t\t\t}\n-\n-\t\t\t\t\tif (!keep) {\n-\t\t\t\t\t\tprev = marker.previousSibling;\n-\t\t\t\t\t\tnext = marker.nextSibling;\n-\n-\t\t\t\t\t\t// Remove all marker text nodes\n-\t\t\t\t\t\teach(tinymce.grep(marker.childNodes), function(node) {\n-\t\t\t\t\t\t\tif (node.nodeType == 3)\n-\t\t\t\t\t\t\t\tnode.nodeValue = node.nodeValue.replace(/\\uFEFF/g, '');\n-\t\t\t\t\t\t});\n-\n-\t\t\t\t\t\t// Remove marker but keep children if for example contents where inserted into the marker\n-\t\t\t\t\t\t// Also remove duplicated instances of the marker for example by a split operation or by WebKit auto split on paste feature\n-\t\t\t\t\t\twhile (marker = dom.get(bookmark.id + '_' + suffix))\n-\t\t\t\t\t\t\tdom.remove(marker, 1);\n-\n-\t\t\t\t\t\t// If siblings are text nodes then merge them unless it's Opera since it some how removes the node\n-\t\t\t\t\t\t// and we are sniffing since adding a lot of detection code for a browser with 3% of the market isn't worth the effort. Sorry, Opera but it's just a fact\n-\t\t\t\t\t\tif (prev && next && prev.nodeType == next.nodeType && prev.nodeType == 3 && !tinymce.isOpera) {\n-\t\t\t\t\t\t\tidx = prev.nodeValue.length;\n-\t\t\t\t\t\t\tprev.appendData(next.nodeValue);\n-\t\t\t\t\t\t\tdom.remove(next);\n-\n-\t\t\t\t\t\t\tif (suffix == 'start') {\n-\t\t\t\t\t\t\t\tstartContainer = endContainer = prev;\n-\t\t\t\t\t\t\t\tstartOffset = endOffset = idx;\n-\t\t\t\t\t\t\t} else {\n-\t\t\t\t\t\t\t\tendContainer = prev;\n-\t\t\t\t\t\t\t\tendOffset = idx;\n-\t\t\t\t\t\t\t}\n-\t\t\t\t\t\t}\n-\t\t\t\t\t}\n-\t\t\t\t}\n-\t\t\t};\n-\n-\t\t\tfunction addBogus(node) {\n-\t\t\t\t// Adds a bogus BR element for empty block elements\n-\t\t\t\tif (dom.isBlock(node) && !node.innerHTML && !isIE)\n-\t\t\t\t\tnode.innerHTML = '<br data-mce-bogus=\"1\" />';\n-\n-\t\t\t\treturn node;\n-\t\t\t};\n-\n-\t\t\tif (bookmark) {\n-\t\t\t\tif (bookmark.start) {\n-\t\t\t\t\trng = dom.createRng();\n-\t\t\t\t\troot = dom.getRoot();\n-\n-\t\t\t\t\tif (t.tridentSel)\n-\t\t\t\t\t\treturn t.tridentSel.moveToBookmark(bookmark);\n-\n-\t\t\t\t\tif (setEndPoint(true) && setEndPoint()) {\n-\t\t\t\t\t\tt.setRng(rng);\n-\t\t\t\t\t}\n-\t\t\t\t} else if (bookmark.id) {\n-\t\t\t\t\t// Restore start/end points\n-\t\t\t\t\trestoreEndPoint('start');\n-\t\t\t\t\trestoreEndPoint('end');\n-\n-\t\t\t\t\tif (startContainer) {\n-\t\t\t\t\t\trng = dom.createRng();\n-\t\t\t\t\t\trng.setStart(addBogus(startContainer), startOffset);\n-\t\t\t\t\t\trng.setEnd(addBogus(endContainer), endOffset);\n-\t\t\t\t\t\tt.setRng(rng);\n-\t\t\t\t\t}\n-\t\t\t\t} else if (bookmark.name) {\n-\t\t\t\t\tt.select(dom.select(bookmark.name)[bookmark.index]);\n-\t\t\t\t} else if (bookmark.rng) {\n-\t\t\t\t\trng = bookmark.rng;\n-\n-\t\t\t\t\tif (rng.startContainer) {\n-\t\t\t\t\t\trng2 = t.dom.createRng();\n-\n-\t\t\t\t\t\ttry {\n-\t\t\t\t\t\t\trng2.setStart(rng.startContainer, rng.startOffset);\n-\t\t\t\t\t\t\trng2.setEnd(rng.endContainer, rng.endOffset);\n-\t\t\t\t\t\t} catch (e) {\n-\t\t\t\t\t\t\t// Might fail with index error\n-\t\t\t\t\t\t}\n-\n-\t\t\t\t\t\trng = rng2;\n-\t\t\t\t\t}\n-\n-\t\t\t\t\tt.setRng(rng);\n-\t\t\t\t}\n-\t\t\t}\n-\t\t},\n-\n-\t\t/**\n-\t\t * Selects the specified element. This will place the start and end of the selection range around the element.\n-\t\t *\n-\t\t * @method select\n-\t\t * @param {Element} node HMTL DOM element to select.\n-\t\t * @param {Boolean} content Optional bool state if the contents should be selected or not on non IE browser.\n-\t\t * @return {Element} Selected element the same element as the one that got passed in.\n-\t\t * @example\n-\t\t * // Select the first paragraph in the active editor\n-\t\t * tinyMCE.activeEditor.selection.select(tinyMCE.activeEditor.dom.select('p')[0]);\n-\t\t */\n-\t\tselect : function(node, content) {\n-\t\t\tvar t = this, dom = t.dom, rng = dom.createRng(), idx;\n-\n-\t\t\tfunction setPoint(node, start) {\n-\t\t\t\tvar walker = new TreeWalker(node, node);\n-\n-\t\t\t\tdo {\n-\t\t\t\t\t// Text node\n-\t\t\t\t\tif (node.nodeType == 3 && tinymce.trim(node.nodeValue).length !== 0) {\n-\t\t\t\t\t\tif (start)\n-\t\t\t\t\t\t\trng.setStart(node, 0);\n-\t\t\t\t\t\telse\n-\t\t\t\t\t\t\trng.setEnd(node, node.nodeValue.length);\n-\n-\t\t\t\t\t\treturn;\n-\t\t\t\t\t}\n-\n-\t\t\t\t\t// BR element\n-\t\t\t\t\tif (node.nodeName == 'BR') {\n-\t\t\t\t\t\tif (start)\n-\t\t\t\t\t\t\trng.setStartBefore(node);\n-\t\t\t\t\t\telse\n-\t\t\t\t\t\t\trng.setEndBefore(node);\n-\n-\t\t\t\t\t\treturn;\n-\t\t\t\t\t}\n-\t\t\t\t} while (node = (start ? walker.next() : walker.prev()));\n-\t\t\t};\n-\n-\t\t\tif (node) {\n-\t\t\t\tidx = dom.nodeIndex(node);\n-\t\t\t\trng.setStart(node.parentNode, idx);\n-\t\t\t\trng.setEnd(node.parentNode, idx + 1);\n-\n-\t\t\t\t// Find first/last text node or BR element\n-\t\t\t\tif (content) {\n-\t\t\t\t\tsetPoint(node, 1);\n-\t\t\t\t\tsetPoint(node);\n-\t\t\t\t}\n-\n-\t\t\t\tt.setRng(rng);\n-\t\t\t}\n-\n-\t\t\treturn node;\n-\t\t},\n-\n-\t\t/**\n-\t\t * Returns true/false if the selection range is collapsed or not. Collapsed means if it's a caret or a larger selection.\n-\t\t *\n-\t\t * @method isCollapsed\n-\t\t * @return {Boolean} true/false state if the selection range is collapsed or not. Collapsed means if it's a caret or a larger selection.\n-\t\t */\n-\t\tisCollapsed : function() {\n-\t\t\tvar t = this, r = t.getRng(), s = t.getSel();\n-\n-\t\t\tif (!r || r.item)\n-\t\t\t\treturn false;\n-\n-\t\t\tif (r.compareEndPoints)\n-\t\t\t\treturn r.compareEndPoints('StartToEnd', r) === 0;\n-\n-\t\t\treturn !s || r.collapsed;\n-\t\t},\n-\n-\t\t/**\n-\t\t * Collapse the selection to start or end of range.\n-\t\t *\n-\t\t * @method collapse\n-\t\t * @param {Boolean} to_start Optional boolean state if to collapse to end or not. Defaults to start.\n-\t\t */\n-\t\tcollapse : function(to_start) {\n-\t\t\tvar self = this, rng = self.getRng(), node;\n-\n-\t\t\t// Control range on IE\n-\t\t\tif (rng.item) {\n-\t\t\t\tnode = rng.item(0);\n-\t\t\t\trng = self.win.document.body.createTextRange();\n-\t\t\t\trng.moveToElementText(node);\n-\t\t\t}\n-\n-\t\t\trng.collapse(!!to_start);\n-\t\t\tself.setRng(rng);\n-\t\t},\n-\n-\t\t/**\n-\t\t * Returns the browsers internal selection object.\n-\t\t *\n-\t\t * @method getSel\n-\t\t * @return {Selection} Internal browser selection object.\n-\t\t */\n-\t\tgetSel : function() {\n-\t\t\tvar t = this, w = this.win;\n-\n-\t\t\treturn w.getSelection ? w.getSelection() : w.document.selection;\n-\t\t},\n-\n-\t\t/**\n-\t\t * Returns the browsers internal range object.\n-\t\t *\n-\t\t * @method getRng\n-\t\t * @param {Boolean} w3c Forces a compatible W3C range on IE.\n-\t\t * @return {Range} Internal browser range object.\n-\t\t * @see http://www.quirksmode.org/dom/range_intro.html\n-\t\t * @see http://www.dotvoid.com/2001/03/using-the-range-object-in-mozilla/\n-\t\t */\n-\t\tgetRng : function(w3c) {\n-\t\t\tvar self = this, selection, rng, elm, doc = self.win.document;\n-\n-\t\t\t// Workaround for IE 11 not being able to select images properly see #6613 see quirk fix\n-\t\t\tif (self.fakeRng) {\n-\t\t\t\treturn self.fakeRng;\n-\t\t\t}\n-\n-\t\t\t// Found tridentSel object then we need to use that one\n-\t\t\tif (w3c && self.tridentSel) {\n-\t\t\t\treturn self.tridentSel.getRangeAt(0);\n-\t\t\t}\n-\n-\t\t\ttry {\n-\t\t\t\tif (selection = self.getSel()) {\n-\t\t\t\t\trng = selection.rangeCount > 0 ? selection.getRangeAt(0) : (selection.createRange ? selection.createRange() : doc.createRange());\n-\t\t\t\t}\n-\t\t\t} catch (ex) {\n-\t\t\t\t// IE throws unspecified error here if TinyMCE is placed in a frame/iframe\n-\t\t\t}\n-\n-\t\t\t// We have W3C ranges and it's IE then fake control selection since IE9 doesn't handle that correctly yet\n-\t\t\tif (tinymce.isIE && ! tinymce.isIE11 && rng && rng.setStart && doc.selection.createRange().item) {\n-\t\t\t\telm = doc.selection.createRange().item(0);\n-\t\t\t\trng = doc.createRange();\n-\t\t\t\trng.setStartBefore(elm);\n-\t\t\t\trng.setEndAfter(elm);\n-\t\t\t}\n-\n-\t\t\t// No range found then create an empty one\n-\t\t\t// This can occur when the editor is placed in a hidden container element on Gecko\n-\t\t\t// Or on IE when there was an exception\n-\t\t\tif (!rng) {\n-\t\t\t\trng = doc.createRange ? doc.createRange() : doc.body.createTextRange();\n-\t\t\t}\n-\n-\t\t\t// If range is at start of document then move it to start of body\n-\t\t\tif (rng.setStart && rng.startContainer.nodeType === 9 && rng.collapsed) {\n-\t\t\t\telm = self.dom.getRoot();\n-\t\t\t\trng.setStart(elm, 0);\n-\t\t\t\trng.setEnd(elm, 0);\n-\t\t\t}\n-\n-\t\t\tif (self.selectedRange && self.explicitRange) {\n-\t\t\t\tif (rng.compareBoundaryPoints(rng.START_TO_START, self.selectedRange) === 0 && rng.compareBoundaryPoints(rng.END_TO_END, self.selectedRange) === 0) {\n-\t\t\t\t\t// Safari, Opera and Chrome only ever select text which causes the range to change.\n-\t\t\t\t\t// This lets us use the originally set range if the selection hasn't been changed by the user.\n-\t\t\t\t\trng = self.explicitRange;\n-\t\t\t\t} else {\n-\t\t\t\t\tself.selectedRange = null;\n-\t\t\t\t\tself.explicitRange = null;\n-\t\t\t\t}\n-\t\t\t}\n-\n-\t\t\treturn rng;\n-\t\t},\n-\n-\t\t/**\n-\t\t * Changes the selection to the specified DOM range.\n-\t\t *\n-\t\t * @method setRng\n-\t\t * @param {Range} r Range to select.\n-\t\t */\n-\t\tsetRng : function(r, forward) {\n-\t\t\tvar s, t = this;\n-\n-\t\t\tif (!t.tridentSel) {\n-\t\t\t\ts = t.getSel();\n-\n-\t\t\t\tif (s) {\n-\t\t\t\t\tt.explicitRange = r;\n-\n-\t\t\t\t\ttry {\n-\t\t\t\t\t\ts.removeAllRanges();\n-\t\t\t\t\t} catch (ex) {\n-\t\t\t\t\t\t// IE9 might throw errors here don't know why\n-\t\t\t\t\t}\n-\n-\t\t\t\t\ts.addRange(r);\n-\n-\t\t\t\t\t// Forward is set to false and we have an extend function\n-\t\t\t\t\tif (forward === false && s.extend) {\n-\t\t\t\t\t\ts.collapse(r.endContainer, r.endOffset);\n-\t\t\t\t\t\ts.extend(r.startContainer, r.startOffset);\n-\t\t\t\t\t}\n-\n-\t\t\t\t\t// adding range isn't always successful so we need to check range count otherwise an exception can occur\n-\t\t\t\t\tt.selectedRange = s.rangeCount > 0 ? s.getRangeAt(0) : null;\n-\t\t\t\t}\n-\t\t\t} else {\n-\t\t\t\t// Is W3C Range\n-\t\t\t\tif (r.cloneRange) {\n-\t\t\t\t\ttry {\n-\t\t\t\t\t\tt.tridentSel.addRange(r);\n-\t\t\t\t\t\treturn;\n-\t\t\t\t\t} catch (ex) {\n-\t\t\t\t\t\t//IE9 throws an error here if called before selection is placed in the editor\n-\t\t\t\t\t}\n-\t\t\t\t}\n-\n-\t\t\t\t// Is IE specific range\n-\t\t\t\ttry {\n-\t\t\t\t\tr.select();\n-\t\t\t\t} catch (ex) {\n-\t\t\t\t\t// Needed for some odd IE bug #1843306\n-\t\t\t\t}\n-\t\t\t}\n-\t\t},\n-\n-\t\t/**\n-\t\t * Sets the current selection to the specified DOM element.\n-\t\t *\n-\t\t * @method setNode\n-\t\t * @param {Element} n Element to set as the contents of the selection.\n-\t\t * @return {Element} Returns the element that got passed in.\n-\t\t * @example\n-\t\t * // Inserts a DOM node at current selection/caret location\n-\t\t * tinyMCE.activeEditor.selection.setNode(tinyMCE.activeEditor.dom.create('img', {src : 'some.gif', title : 'some title'}));\n-\t\t */\n-\t\tsetNode : function(n) {\n-\t\t\tvar t = this;\n-\n-\t\t\tt.setContent(t.dom.getOuterHTML(n));\n-\n-\t\t\treturn n;\n-\t\t},\n-\n-\t\t/**\n-\t\t * Returns the currently selected element or the common ancestor element for both start and end of the selection.\n-\t\t *\n-\t\t * @method getNode\n-\t\t * @return {Element} Currently selected element or common ancestor element.\n-\t\t * @example\n-\t\t * // Alerts the currently selected elements node name\n-\t\t * alert(tinyMCE.activeEditor.selection.getNode().nodeName);\n-\t\t */\n-\t\tgetNode : function() {\n-\t\t\tvar t = this, rng = t.getRng(), sel = t.getSel(), elm, start = rng.startContainer, end = rng.endContainer;\n-\n-\t\t\tfunction skipEmptyTextNodes(n, forwards) {\n-\t\t\t\tvar orig = n;\n-\t\t\t\twhile (n && n.nodeType === 3 && n.length === 0) {\n-\t\t\t\t\tn = forwards ? n.nextSibling : n.previousSibling;\n-\t\t\t\t}\n-\t\t\t\treturn n || orig;\n-\t\t\t};\n-\n-\t\t\t// Range maybe lost after the editor is made visible again\n-\t\t\tif (!rng)\n-\t\t\t\treturn t.dom.getRoot();\n-\n-\t\t\tif (rng.setStart) {\n-\t\t\t\telm = rng.commonAncestorContainer;\n-\n-\t\t\t\t// Handle selection a image or other control like element such as anchors\n-\t\t\t\tif (!rng.collapsed) {\n-\t\t\t\t\tif (rng.startContainer == rng.endContainer) {\n-\t\t\t\t\t\tif (rng.endOffset - rng.startOffset < 2) {\n-\t\t\t\t\t\t\tif (rng.startContainer.hasChildNodes())\n-\t\t\t\t\t\t\t\telm = rng.startContainer.childNodes[rng.startOffset];\n-\t\t\t\t\t\t}\n-\t\t\t\t\t}\n-\n-\t\t\t\t\t// If the anchor node is a element instead of a text node then return this element\n-\t\t\t\t\t//if (tinymce.isWebKit && sel.anchorNode && sel.anchorNode.nodeType == 1)\n-\t\t\t\t\t//\treturn sel.anchorNode.childNodes[sel.anchorOffset];\n-\n-\t\t\t\t\t// Handle cases where the selection is immediately wrapped around a node and return that node instead of it's parent.\n-\t\t\t\t\t// This happens when you double click an underlined word in FireFox.\n-\t\t\t\t\tif (start.nodeType === 3 && end.nodeType === 3) {\n-\t\t\t\t\t\tif (start.length === rng.startOffset) {\n-\t\t\t\t\t\t\tstart = skipEmptyTextNodes(start.nextSibling, true);\n-\t\t\t\t\t\t} else {\n-\t\t\t\t\t\t\tstart = start.parentNode;\n-\t\t\t\t\t\t}\n-\t\t\t\t\t\tif (rng.endOffset === 0) {\n-\t\t\t\t\t\t\tend = skipEmptyTextNodes(end.previousSibling, false);\n-\t\t\t\t\t\t} else {\n-\t\t\t\t\t\t\tend = end.parentNode;\n-\t\t\t\t\t\t}\n-\n-\t\t\t\t\t\tif (start && start === end)\n-\t\t\t\t\t\t\treturn start;\n-\t\t\t\t\t}\n-\t\t\t\t}\n-\n-\t\t\t\tif (elm && elm.nodeType == 3)\n-\t\t\t\t\treturn elm.parentNode;\n-\n-\t\t\t\treturn elm;\n-\t\t\t}\n-\n-\t\t\treturn rng.item ? rng.item(0) : rng.parentElement();\n-\t\t},\n-\n-\t\tgetSelectedBlocks : function(st, en) {\n-\t\t\tvar t = this, dom = t.dom, sb, eb, n, bl = [];\n-\n-\t\t\tsb = dom.getParent(st || t.getStart(), dom.isBlock);\n-\t\t\teb = dom.getParent(en || t.getEnd(), dom.isBlock);\n-\n-\t\t\tif (sb)\n-\t\t\t\tbl.push(sb);\n-\n-\t\t\tif (sb && eb && sb != eb) {\n-\t\t\t\tn = sb;\n-\n-\t\t\t\tvar walker = new TreeWalker(sb, dom.getRoot());\n-\t\t\t\twhile ((n = walker.next()) && n != eb) {\n-\t\t\t\t\tif (dom.isBlock(n))\n-\t\t\t\t\t\tbl.push(n);\n-\t\t\t\t}\n-\t\t\t}\n-\n-\t\t\tif (eb && sb != eb)\n-\t\t\t\tbl.push(eb);\n-\n-\t\t\treturn bl;\n-\t\t},\n-\n-\t\tisForward: function(){\n-\t\t\tvar dom = this.dom, sel = this.getSel(), anchorRange, focusRange;\n-\n-\t\t\t// No support for selection direction then always return true\n-\t\t\tif (!sel || sel.anchorNode == null || sel.focusNode == null) {\n-\t\t\t\treturn true;\n-\t\t\t}\n-\n-\t\t\tanchorRange = dom.createRng();\n-\t\t\tanchorRange.setStart(sel.anchorNode, sel.anchorOffset);\n-\t\t\tanchorRange.collapse(true);\n-\n-\t\t\tfocusRange = dom.createRng();\n-\t\t\tfocusRange.setStart(sel.focusNode, sel.focusOffset);\n-\t\t\tfocusRange.collapse(true);\n-\n-\t\t\treturn anchorRange.compareBoundaryPoints(anchorRange.START_TO_START, focusRange) <= 0;\n-\t\t},\n-\n-\t\tnormalize : function() {\n-\t\t\tvar self = this, rng, normalized, collapsed, node, sibling;\n-\n-\t\t\tfunction normalizeEndPoint(start) {\n-\t\t\t\tvar container, offset, walker, dom = self.dom, body = dom.getRoot(), node, nonEmptyElementsMap, nodeName;\n-\n-\t\t\t\tfunction hasBrBeforeAfter(node, left) {\n-\t\t\t\t\tvar walker = new TreeWalker(node, dom.getParent(node.parentNode, dom.isBlock) || body);\n-\n-\t\t\t\t\twhile (node = walker[left ? 'prev' : 'next']()) {\n-\t\t\t\t\t\tif (node.nodeName === \"BR\") {\n-\t\t\t\t\t\t\treturn true;\n-\t\t\t\t\t\t}\n-\t\t\t\t\t}\n-\t\t\t\t};\n-\n-\t\t\t\t// Walks the dom left/right to find a suitable text node to move the endpoint into\n-\t\t\t\t// It will only walk within the current parent block or body and will stop if it hits a block or a BR/IMG\n-\t\t\t\tfunction findTextNodeRelative(left, startNode) {\n-\t\t\t\t\tvar walker, lastInlineElement;\n-\n-\t\t\t\t\tstartNode = startNode || container;\n-\t\t\t\t\twalker = new TreeWalker(startNode, dom.getParent(startNode.parentNode, dom.isBlock) || body);\n-\n-\t\t\t\t\t// Walk left until we hit a text node we can move to or a block/br/img\n-\t\t\t\t\twhile (node = walker[left ? 'prev' : 'next']()) {\n-\t\t\t\t\t\t// Found text node that has a length\n-\t\t\t\t\t\tif (node.nodeType === 3 && node.nodeValue.length > 0) {\n-\t\t\t\t\t\t\tcontainer = node;\n-\t\t\t\t\t\t\toffset = left ? node.nodeValue.length : 0;\n-\t\t\t\t\t\t\tnormalized = true;\n-\t\t\t\t\t\t\treturn;\n-\t\t\t\t\t\t}\n-\n-\t\t\t\t\t\t// Break if we find a block or a BR/IMG/INPUT etc\n-\t\t\t\t\t\tif (dom.isBlock(node) || nonEmptyElementsMap[node.nodeName.toLowerCase()]) {\n-\t\t\t\t\t\t\treturn;\n-\t\t\t\t\t\t}\n-\n-\t\t\t\t\t\tlastInlineElement = node;\n-\t\t\t\t\t}\n-\n-\t\t\t\t\t// Only fetch the last inline element when in caret mode for now\n-\t\t\t\t\tif (collapsed && lastInlineElement) {\n-\t\t\t\t\t\tcontainer = lastInlineElement;\n-\t\t\t\t\t\tnormalized = true;\n-\t\t\t\t\t\toffset = 0;\n-\t\t\t\t\t}\n-\t\t\t\t};\n-\n-\t\t\t\tcontainer = rng[(start ? 'start' : 'end') + 'Container'];\n-\t\t\t\toffset = rng[(start ? 'start' : 'end') + 'Offset'];\n-\t\t\t\tnonEmptyElementsMap = dom.schema.getNonEmptyElements();\n-\n-\t\t\t\t// If the container is a document move it to the body element\n-\t\t\t\tif (container.nodeType === 9) {\n-\t\t\t\t\tcontainer = dom.getRoot();\n-\t\t\t\t\toffset = 0;\n-\t\t\t\t}\n-\n-\t\t\t\t// If the container is body try move it into the closest text node or position\n-\t\t\t\tif (container === body) {\n-\t\t\t\t\t// If start is before/after a image, table etc\n-\t\t\t\t\tif (start) {\n-\t\t\t\t\t\tnode = container.childNodes[offset > 0 ? offset - 1 : 0];\n-\t\t\t\t\t\tif (node) {\n-\t\t\t\t\t\t\tnodeName = node.nodeName.toLowerCase();\n-\t\t\t\t\t\t\tif (nonEmptyElementsMap[node.nodeName] || node.nodeName == \"TABLE\") {\n-\t\t\t\t\t\t\t\treturn;\n-\t\t\t\t\t\t\t}\n-\t\t\t\t\t\t}\n-\t\t\t\t\t}\n-\n-\t\t\t\t\t// Resolve the index\n-\t\t\t\t\tif (container.hasChildNodes()) {\n-\t\t\t\t\t\tcontainer = container.childNodes[Math.min(!start && offset > 0 ? offset - 1 : offset, container.childNodes.length - 1)];\n-\t\t\t\t\t\toffset = 0;\n-\n-\t\t\t\t\t\t// Don't walk into elements that doesn't have any child nodes like a IMG\n-\t\t\t\t\t\tif (container.hasChildNodes() && !/TABLE/.test(container.nodeName)) {\n-\t\t\t\t\t\t\t// Walk the DOM to find a text node to place the caret at or a BR\n-\t\t\t\t\t\t\tnode = container;\n-\t\t\t\t\t\t\twalker = new TreeWalker(container, body);\n-\n-\t\t\t\t\t\t\tdo {\n-\t\t\t\t\t\t\t\t// Found a text node use that position\n-\t\t\t\t\t\t\t\tif (node.nodeType === 3 && node.nodeValue.length > 0) {\n-\t\t\t\t\t\t\t\t\toffset = start ? 0 : node.nodeValue.length;\n-\t\t\t\t\t\t\t\t\tcontainer = node;\n-\t\t\t\t\t\t\t\t\tnormalized = true;\n-\t\t\t\t\t\t\t\t\tbreak;\n-\t\t\t\t\t\t\t\t}\n-\n-\t\t\t\t\t\t\t\t// Found a BR/IMG element that we can place the caret before\n-\t\t\t\t\t\t\t\tif (nonEmptyElementsMap[node.nodeName.toLowerCase()]) {\n-\t\t\t\t\t\t\t\t\toffset = dom.nodeIndex(node);\n-\t\t\t\t\t\t\t\t\tcontainer = node.parentNode;\n-\n-\t\t\t\t\t\t\t\t\t// Put caret after image when moving the end point\n-\t\t\t\t\t\t\t\t\tif (node.nodeName ==  \"IMG\" && !start) {\n-\t\t\t\t\t\t\t\t\t\toffset++;\n-\t\t\t\t\t\t\t\t\t}\n-\n-\t\t\t\t\t\t\t\t\tnormalized = true;\n-\t\t\t\t\t\t\t\t\tbreak;\n-\t\t\t\t\t\t\t\t}\n-\t\t\t\t\t\t\t} while (node = (start ? walker.next() : walker.prev()));\n-\t\t\t\t\t\t}\n-\t\t\t\t\t}\n-\t\t\t\t}\n-\n-\t\t\t\t// Lean the caret to the left if possible\n-\t\t\t\tif (collapsed) {\n-\t\t\t\t\t// So this: <b>x</b><i>|x</i>\n-\t\t\t\t\t// Becomes: <b>x|</b><i>x</i>\n-\t\t\t\t\t// Seems that only gecko has issues with this\n-\t\t\t\t\tif (container.nodeType === 3 && offset === 0) {\n-\t\t\t\t\t\tfindTextNodeRelative(true);\n-\t\t\t\t\t}\n-\n-\t\t\t\t\t// Lean left into empty inline elements when the caret is before a BR\n-\t\t\t\t\t// So this: <i><b></b><i>|<br></i>\n-\t\t\t\t\t// Becomes: <i><b>|</b><i><br></i>\n-\t\t\t\t\t// Seems that only gecko has issues with this\n-\t\t\t\t\tif (container.nodeType === 1) {\n-\t\t\t\t\t\tnode = container.childNodes[offset];\n-\t\t\t\t\t\tif(node && node.nodeName === 'BR' && !hasBrBeforeAfter(node) && !hasBrBeforeAfter(node, true)) {\n-\t\t\t\t\t\t\tfindTextNodeRelative(true, container.childNodes[offset]);\n-\t\t\t\t\t\t}\n-\t\t\t\t\t}\n-\t\t\t\t}\n-\n-\t\t\t\t// Lean the start of the selection right if possible\n-\t\t\t\t// So this: x[<b>x]</b>\n-\t\t\t\t// Becomes: x<b>[x]</b>\n-\t\t\t\tif (start && !collapsed && container.nodeType === 3 && offset === container.nodeValue.length) {\n-\t\t\t\t\tfindTextNodeRelative(false);\n-\t\t\t\t}\n-\n-\t\t\t\t// Set endpoint if it was normalized\n-\t\t\t\tif (normalized)\n-\t\t\t\t\trng['set' + (start ? 'Start' : 'End')](container, offset);\n-\t\t\t};\n-\n-\t\t\t// Normalize only on non IE browsers for now\n-\t\t\tif (tinymce.isIE)\n-\t\t\t\treturn;\n-\t\t\t\n-\t\t\trng = self.getRng();\n-\t\t\tcollapsed = rng.collapsed;\n-\n-\t\t\t// Normalize the end points\n-\t\t\tnormalizeEndPoint(true);\n-\n-\t\t\tif (!collapsed)\n-\t\t\t\tnormalizeEndPoint();\n-\n-\t\t\t// Set the selection if it was normalized\n-\t\t\tif (normalized) {\n-\t\t\t\t// If it was collapsed then make sure it still is\n-\t\t\t\tif (collapsed) {\n-\t\t\t\t\trng.collapse(true);\n-\t\t\t\t}\n-\n-\t\t\t\t//console.log(self.dom.dumpRng(rng));\n-\t\t\t\tself.setRng(rng, self.isForward());\n-\t\t\t}\n-\t\t},\n-\n-\t\t/**\n-\t\t * Executes callback of the current selection matches the specified selector or not and passes the state and args to the callback.\n-\t\t *\n-\t\t * @method selectorChanged\n-\t\t * @param {String} selector CSS selector to check for.\n-\t\t * @param {function} callback Callback with state and args when the selector is matches or not.\n-\t\t */\n-\t\tselectorChanged: function(selector, callback) {\n-\t\t\tvar self = this, currentSelectors;\n-\n-\t\t\tif (!self.selectorChangedData) {\n-\t\t\t\tself.selectorChangedData = {};\n-\t\t\t\tcurrentSelectors = {};\n-\n-\t\t\t\tself.editor.onNodeChange.addToTop(function(ed, cm, node) {\n-\t\t\t\t\tvar dom = self.dom, parents = dom.getParents(node, null, dom.getRoot()), matchedSelectors = {};\n-\n-\t\t\t\t\t// Check for new matching selectors\n-\t\t\t\t\teach(self.selectorChangedData, function(callbacks, selector) {\n-\t\t\t\t\t\teach(parents, function(node) {\n-\t\t\t\t\t\t\tif (dom.is(node, selector)) {\n-\t\t\t\t\t\t\t\tif (!currentSelectors[selector]) {\n-\t\t\t\t\t\t\t\t\t// Execute callbacks\n-\t\t\t\t\t\t\t\t\teach(callbacks, function(callback) {\n-\t\t\t\t\t\t\t\t\t\tcallback(true, {node: node, selector: selector, parents: parents});\n-\t\t\t\t\t\t\t\t\t});\n-\n-\t\t\t\t\t\t\t\t\tcurrentSelectors[selector] = callbacks;\n-\t\t\t\t\t\t\t\t}\n-\n-\t\t\t\t\t\t\t\tmatchedSelectors[selector] = callbacks;\n-\t\t\t\t\t\t\t\treturn false;\n-\t\t\t\t\t\t\t}\n-\t\t\t\t\t\t});\n-\t\t\t\t\t});\n-\n-\t\t\t\t\t// Check if current selectors still match\n-\t\t\t\t\teach(currentSelectors, function(callbacks, selector) {\n-\t\t\t\t\t\tif (!matchedSelectors[selector]) {\n-\t\t\t\t\t\t\tdelete currentSelectors[selector];\n-\n-\t\t\t\t\t\t\teach(callbacks, function(callback) {\n-\t\t\t\t\t\t\t\tcallback(false, {node: node, selector: selector, parents: parents});\n-\t\t\t\t\t\t\t});\n-\t\t\t\t\t\t}\n-\t\t\t\t\t});\n-\t\t\t\t});\n-\t\t\t}\n-\n-\t\t\t// Add selector listeners\n-\t\t\tif (!self.selectorChangedData[selector]) {\n-\t\t\t\tself.selectorChangedData[selector] = [];\n-\t\t\t}\n-\n-\t\t\tself.selectorChangedData[selector].push(callback);\n-\n-\t\t\treturn self;\n-\t\t},\n-\n-\t\tscrollIntoView: function(elm) {\n-\t\t\tvar y, viewPort, self = this, dom = self.dom;\n-\n-\t\t\tviewPort = dom.getViewPort(self.editor.getWin());\n-\t\t\ty = dom.getPos(elm).y;\n-\t\t\tif (y < viewPort.y || y + 25 > viewPort.y + viewPort.h) {\n-\t\t\t\tself.editor.getWin().scrollTo(0, y < viewPort.y ? y : y - viewPort.h + 25);\n-\t\t\t}\n-\t\t},\n-\n-\t\tdestroy : function(manual) {\n-\t\t\tvar self = this;\n-\n-\t\t\tself.win = null;\n-\n-\t\t\t// Manual destroy then remove unload handler\n-\t\t\tif (!manual)\n-\t\t\t\ttinymce.removeUnload(self.destroy);\n-\t\t},\n-\n-\t\t// IE has an issue where you can't select/move the caret by clicking outside the body if the document is in standards mode\n-\t\t_fixIESelection : function() {\n-\t\t\tvar dom = this.dom, doc = dom.doc, body = doc.body, started, startRng, htmlElm;\n-\n-\t\t\t// Return range from point or null if it failed\n-\t\t\tfunction rngFromPoint(x, y) {\n-\t\t\t\tvar rng = body.createTextRange();\n-\n-\t\t\t\ttry {\n-\t\t\t\t\trng.moveToPoint(x, y);\n-\t\t\t\t} catch (ex) {\n-\t\t\t\t\t// IE sometimes throws and exception, so lets just ignore it\n-\t\t\t\t\trng = null;\n-\t\t\t\t}\n-\n-\t\t\t\treturn rng;\n-\t\t\t};\n-\n-\t\t\t// Fires while the selection is changing\n-\t\t\tfunction selectionChange(e) {\n-\t\t\t\tvar pointRng;\n-\n-\t\t\t\t// Check if the button is down or not\n-\t\t\t\tif (e.button) {\n-\t\t\t\t\t// Create range from mouse position\n-\t\t\t\t\tpointRng = rngFromPoint(e.x, e.y);\n-\n-\t\t\t\t\tif (pointRng) {\n-\t\t\t\t\t\t// Check if pointRange is before/after selection then change the endPoint\n-\t\t\t\t\t\tif (pointRng.compareEndPoints('StartToStart', startRng) > 0)\n-\t\t\t\t\t\t\tpointRng.setEndPoint('StartToStart', startRng);\n-\t\t\t\t\t\telse\n-\t\t\t\t\t\t\tpointRng.setEndPoint('EndToEnd', startRng);\n-\n-\t\t\t\t\t\tpointRng.select();\n-\t\t\t\t\t}\n-\t\t\t\t} else\n-\t\t\t\t\tendSelection();\n-\t\t\t}\n-\n-\t\t\t// Removes listeners\n-\t\t\tfunction endSelection() {\n-\t\t\t\tvar rng = doc.selection.createRange();\n-\n-\t\t\t\t// If the range is collapsed then use the last start range\n-\t\t\t\tif (startRng && !rng.item && rng.compareEndPoints('StartToEnd', rng) === 0)\n-\t\t\t\t\tstartRng.select();\n-\n-\t\t\t\tdom.unbind(doc, 'mouseup', endSelection);\n-\t\t\t\tdom.unbind(doc, 'mousemove', selectionChange);\n-\t\t\t\tstartRng = started = 0;\n-\t\t\t};\n-\n-\t\t\t// Make HTML element unselectable since we are going to handle selection by hand\n-\t\t\tdoc.documentElement.unselectable = true;\n-\t\t\t\n-\t\t\t// Detect when user selects outside BODY\n-\t\t\tdom.bind(doc, ['mousedown', 'contextmenu'], function(e) {\n-\t\t\t\tif (e.target.nodeName === 'HTML') {\n-\t\t\t\t\tif (started)\n-\t\t\t\t\t\tendSelection();\n-\n-\t\t\t\t\t// Detect vertical scrollbar, since IE will fire a mousedown on the scrollbar and have target set as HTML\n-\t\t\t\t\thtmlElm = doc.documentElement;\n-\t\t\t\t\tif (htmlElm.scrollHeight > htmlElm.clientHeight)\n-\t\t\t\t\t\treturn;\n-\n-\t\t\t\t\tstarted = 1;\n-\t\t\t\t\t// Setup start position\n-\t\t\t\t\tstartRng = rngFromPoint(e.x, e.y);\n-\t\t\t\t\tif (startRng) {\n-\t\t\t\t\t\t// Listen for selection change events\n-\t\t\t\t\t\tdom.bind(doc, 'mouseup', endSelection);\n-\t\t\t\t\t\tdom.bind(doc, 'mousemove', selectionChange);\n-\n-\t\t\t\t\t\tdom.win.focus();\n-\t\t\t\t\t\tstartRng.select();\n-\t\t\t\t\t}\n-\t\t\t\t}\n-\t\t\t});\n-\t\t}\n-\t});\n-})(tinymce);"
        },
        {
            "filename": "js/tiny_mce/classes/dom/Serializer.js",
            "diff": "@@ -1,399 +0,0 @@\n-/**\n- * Serializer.js\n- *\n- * Copyright, Moxiecode Systems AB\n- * Released under LGPL License.\n- *\n- * License: http://www.tinymce.com/license\n- * Contributing: http://www.tinymce.com/contributing\n- */\n-\n-(function(tinymce) {\n-\t/**\n-\t * This class is used to serialize DOM trees into a string. Consult the TinyMCE Wiki API for more details and examples on how to use this class. \n-\t *\n-\t * @class tinymce.dom.Serializer\n-\t */\n-\n-\t/**\n-\t * Constucts a new DOM serializer class.\n-\t *\n-\t * @constructor\n-\t * @method Serializer\n-\t * @param {Object} settings Serializer settings object.\n-\t * @param {tinymce.dom.DOMUtils} dom DOMUtils instance reference.\n-\t * @param {tinymce.html.Schema} schema Optional schema reference.\n-\t */\n-\ttinymce.dom.Serializer = function(settings, dom, schema) {\n-\t\tvar onPreProcess, onPostProcess, isIE = tinymce.isIE, each = tinymce.each, htmlParser;\n-\n-\t\t// Support the old apply_source_formatting option\n-\t\tif (!settings.apply_source_formatting)\n-\t\t\tsettings.indent = false;\n-\n-\t\t// Default DOM and Schema if they are undefined\n-\t\tdom = dom || tinymce.DOM;\n-\t\tschema = schema || new tinymce.html.Schema(settings);\n-\t\tsettings.entity_encoding = settings.entity_encoding || 'named';\n-\t\tsettings.remove_trailing_brs = \"remove_trailing_brs\" in settings ? settings.remove_trailing_brs : true;\n-\n-\t\t/**\n-\t\t * This event gets executed before a HTML fragment gets serialized into a HTML string. This event enables you to do modifications to the DOM before the serialization occurs. It's important to know that the element that is getting serialized is cloned so it's not inside a document.\n-\t\t *\n-\t\t * @event onPreProcess\n-\t\t * @param {tinymce.dom.Serializer} sender object/Serializer instance that is serializing an element.\n-\t\t * @param {Object} args Object containing things like the current node.\n-\t\t * @example\n-\t\t * // Adds an observer to the onPreProcess event\n-\t\t * serializer.onPreProcess.add(function(se, o) {\n-\t\t *     // Add a class to each paragraph\n-\t\t *     se.dom.addClass(se.dom.select('p', o.node), 'myclass');\n-\t\t * });\n-\t\t */\n-\t\tonPreProcess = new tinymce.util.Dispatcher(self);\n-\n-\t\t/**\n-\t\t * This event gets executed after a HTML fragment has been serialized into a HTML string. This event enables you to do modifications to the HTML string like regexp replaces etc. \n-\t\t *\n-\t\t * @event onPreProcess\n-\t\t * @param {tinymce.dom.Serializer} sender object/Serializer instance that is serializing an element.\n-\t\t * @param {Object} args Object containing things like the current contents. \n-\t\t * @example\n-\t\t * // Adds an observer to the onPostProcess event\n-\t\t * serializer.onPostProcess.add(function(se, o) {\n-\t\t *    // Remove all paragraphs and replace with BR\n-\t\t *    o.content = o.content.replace(/<p[^>]+>|<p>/g, '');\n-\t\t *    o.content = o.content.replace(/<\\/p>/g, '<br />');\n-\t\t * });\n-\t\t */\n-\t\tonPostProcess = new tinymce.util.Dispatcher(self);\n-\n-\t\thtmlParser = new tinymce.html.DomParser(settings, schema);\n-\n-\t\t// Convert move data-mce-src, data-mce-href and data-mce-style into nodes or process them if needed\n-\t\thtmlParser.addAttributeFilter('src,href,style', function(nodes, name) {\n-\t\t\tvar i = nodes.length, node, value, internalName = 'data-mce-' + name, urlConverter = settings.url_converter, urlConverterScope = settings.url_converter_scope, undef;\n-\n-\t\t\twhile (i--) {\n-\t\t\t\tnode = nodes[i];\n-\n-\t\t\t\tvalue = node.attributes.map[internalName];\n-\t\t\t\tif (value !== undef) {\n-\t\t\t\t\t// Set external name to internal value and remove internal\n-\t\t\t\t\tnode.attr(name, value.length > 0 ? value : null);\n-\t\t\t\t\tnode.attr(internalName, null);\n-\t\t\t\t} else {\n-\t\t\t\t\t// No internal attribute found then convert the value we have in the DOM\n-\t\t\t\t\tvalue = node.attributes.map[name];\n-\n-\t\t\t\t\tif (name === \"style\")\n-\t\t\t\t\t\tvalue = dom.serializeStyle(dom.parseStyle(value), node.name);\n-\t\t\t\t\telse if (urlConverter)\n-\t\t\t\t\t\tvalue = urlConverter.call(urlConverterScope, value, name, node.name);\n-\n-\t\t\t\t\tnode.attr(name, value.length > 0 ? value : null);\n-\t\t\t\t}\n-\t\t\t}\n-\t\t});\n-\n-\t\t// Remove internal classes mceItem<..> or mceSelected\n-\t\thtmlParser.addAttributeFilter('class', function(nodes, name) {\n-\t\t\tvar i = nodes.length, node, value;\n-\n-\t\t\twhile (i--) {\n-\t\t\t\tnode = nodes[i];\n-\t\t\t\tvalue = node.attr('class').replace(/(?:^|\\s)mce(Item\\w+|Selected)(?!\\S)/g, '');\n-\t\t\t\tnode.attr('class', value.length > 0 ? value : null);\n-\t\t\t}\n-\t\t});\n-\n-\t\t// Remove bookmark elements\n-\t\thtmlParser.addAttributeFilter('data-mce-type', function(nodes, name, args) {\n-\t\t\tvar i = nodes.length, node;\n-\n-\t\t\twhile (i--) {\n-\t\t\t\tnode = nodes[i];\n-\n-\t\t\t\tif (node.attributes.map['data-mce-type'] === 'bookmark' && !args.cleanup)\n-\t\t\t\t\tnode.remove();\n-\t\t\t}\n-\t\t});\n-\n-\t\t// Remove expando attributes\n-\t\thtmlParser.addAttributeFilter('data-mce-expando', function(nodes, name, args) {\n-\t\t\tvar i = nodes.length;\n-\n-\t\t\twhile (i--) {\n-\t\t\t\tnodes[i].attr(name, null);\n-\t\t\t}\n-\t\t});\n-\n-\t\thtmlParser.addNodeFilter('noscript', function(nodes) {\n-\t\t\tvar i = nodes.length, node;\n-\n-\t\t\twhile (i--) {\n-\t\t\t\tnode = nodes[i].firstChild;\n-\n-\t\t\t\tif (node) {\n-\t\t\t\t\tnode.value = tinymce.html.Entities.decode(node.value);\n-\t\t\t\t}\n-\t\t\t}\n-\t\t});\n-\n-\t\t// Force script into CDATA sections and remove the mce- prefix also add comments around styles\n-\t\thtmlParser.addNodeFilter('script,style', function(nodes, name) {\n-\t\t\tvar i = nodes.length, node, value;\n-\n-\t\t\tfunction trim(value) {\n-\t\t\t\treturn value.replace(/(<!--\\[CDATA\\[|\\]\\]-->)/g, '\\n')\n-\t\t\t\t\t\t.replace(/^[\\r\\n]*|[\\r\\n]*$/g, '')\n-\t\t\t\t\t\t.replace(/^\\s*((<!--)?(\\s*\\/\\/)?\\s*<!\\[CDATA\\[|(<!--\\s*)?\\/\\*\\s*<!\\[CDATA\\[\\s*\\*\\/|(\\/\\/)?\\s*<!--|\\/\\*\\s*<!--\\s*\\*\\/)\\s*[\\r\\n]*/gi, '')\n-\t\t\t\t\t\t.replace(/\\s*(\\/\\*\\s*\\]\\]>\\s*\\*\\/(-->)?|\\s*\\/\\/\\s*\\]\\]>(-->)?|\\/\\/\\s*(-->)?|\\]\\]>|\\/\\*\\s*-->\\s*\\*\\/|\\s*-->\\s*)\\s*$/g, '');\n-\t\t\t};\n-\n-\t\t\twhile (i--) {\n-\t\t\t\tnode = nodes[i];\n-\t\t\t\tvalue = node.firstChild ? node.firstChild.value : '';\n-\n-\t\t\t\tif (name === \"script\") {\n-\t\t\t\t\t// Remove mce- prefix from script elements\n-\t\t\t\t\tnode.attr('type', (node.attr('type') || 'text/javascript').replace(/^mce\\-/, ''));\n-\n-\t\t\t\t\tif (value.length > 0)\n-\t\t\t\t\t\tnode.firstChild.value = '// <![CDATA[\\n' + trim(value) + '\\n// ]]>';\n-\t\t\t\t} else {\n-\t\t\t\t\tif (value.length > 0)\n-\t\t\t\t\t\tnode.firstChild.value = '<!--\\n' + trim(value) + '\\n-->';\n-\t\t\t\t}\n-\t\t\t}\n-\t\t});\n-\n-\t\t// Convert comments to cdata and handle protected comments\n-\t\thtmlParser.addNodeFilter('#comment', function(nodes, name) {\n-\t\t\tvar i = nodes.length, node;\n-\n-\t\t\twhile (i--) {\n-\t\t\t\tnode = nodes[i];\n-\n-\t\t\t\tif (node.value.indexOf('[CDATA[') === 0) {\n-\t\t\t\t\tnode.name = '#cdata';\n-\t\t\t\t\tnode.type = 4;\n-\t\t\t\t\tnode.value = node.value.replace(/^\\[CDATA\\[|\\]\\]$/g, '');\n-\t\t\t\t} else if (node.value.indexOf('mce:protected ') === 0) {\n-\t\t\t\t\tnode.name = \"#text\";\n-\t\t\t\t\tnode.type = 3;\n-\t\t\t\t\tnode.raw = true;\n-\t\t\t\t\tnode.value = unescape(node.value).substr(14);\n-\t\t\t\t}\n-\t\t\t}\n-\t\t});\n-\n-\t\thtmlParser.addNodeFilter('xml:namespace,input', function(nodes, name) {\n-\t\t\tvar i = nodes.length, node;\n-\n-\t\t\twhile (i--) {\n-\t\t\t\tnode = nodes[i];\n-\t\t\t\tif (node.type === 7)\n-\t\t\t\t\tnode.remove();\n-\t\t\t\telse if (node.type === 1) {\n-\t\t\t\t\tif (name === \"input\" && !(\"type\" in node.attributes.map))\n-\t\t\t\t\t\tnode.attr('type', 'text');\n-\t\t\t\t}\n-\t\t\t}\n-\t\t});\n-\n-\t\t// Fix list elements, TODO: Replace this later\n-\t\tif (settings.fix_list_elements) {\n-\t\t\thtmlParser.addNodeFilter('ul,ol', function(nodes, name) {\n-\t\t\t\tvar i = nodes.length, node, parentNode;\n-\n-\t\t\t\twhile (i--) {\n-\t\t\t\t\tnode = nodes[i];\n-\t\t\t\t\tparentNode = node.parent;\n-\n-\t\t\t\t\tif (parentNode.name === 'ul' || parentNode.name === 'ol') {\n-\t\t\t\t\t\tif (node.prev && node.prev.name === 'li') {\n-\t\t\t\t\t\t\tnode.prev.append(node);\n-\t\t\t\t\t\t}\n-\t\t\t\t\t}\n-\t\t\t\t}\n-\t\t\t});\n-\t\t}\n-\n-\t\t// Remove internal data attributes\n-\t\thtmlParser.addAttributeFilter('data-mce-src,data-mce-href,data-mce-style', function(nodes, name) {\n-\t\t\tvar i = nodes.length;\n-\n-\t\t\twhile (i--) {\n-\t\t\t\tnodes[i].attr(name, null);\n-\t\t\t}\n-\t\t});\n-\n-\t\t// Return public methods\n-\t\treturn {\n-\t\t\t/**\n-\t\t\t * Schema instance that was used to when the Serializer was constructed.\n-\t\t\t *\n-\t\t\t * @field {tinymce.html.Schema} schema\n-\t\t\t */\n-\t\t\tschema : schema,\n-\n-\t\t\t/**\n-\t\t\t * Adds a node filter function to the parser used by the serializer, the parser will collect the specified nodes by name\n-\t\t\t * and then execute the callback ones it has finished parsing the document.\n-\t\t\t *\n-\t\t\t * @example\n-\t\t\t * parser.addNodeFilter('p,h1', function(nodes, name) {\n-\t\t\t *\t\tfor (var i = 0; i < nodes.length; i++) {\n-\t\t\t *\t\t\tconsole.log(nodes[i].name);\n-\t\t\t *\t\t}\n-\t\t\t * });\n-\t\t\t * @method addNodeFilter\n-\t\t\t * @method {String} name Comma separated list of nodes to collect.\n-\t\t\t * @param {function} callback Callback function to execute once it has collected nodes.\n-\t\t\t */\n-\t\t\taddNodeFilter : htmlParser.addNodeFilter,\n-\n-\t\t\t/**\n-\t\t\t * Adds a attribute filter function to the parser used by the serializer, the parser will collect nodes that has the specified attributes\n-\t\t\t * and then execute the callback ones it has finished parsing the document.\n-\t\t\t *\n-\t\t\t * @example\n-\t\t\t * parser.addAttributeFilter('src,href', function(nodes, name) {\n-\t\t\t *\t\tfor (var i = 0; i < nodes.length; i++) {\n-\t\t\t *\t\t\tconsole.log(nodes[i].name);\n-\t\t\t *\t\t}\n-\t\t\t * });\n-\t\t\t * @method addAttributeFilter\n-\t\t\t * @method {String} name Comma separated list of nodes to collect.\n-\t\t\t * @param {function} callback Callback function to execute once it has collected nodes.\n-\t\t\t */\n-\t\t\taddAttributeFilter : htmlParser.addAttributeFilter,\n-\n-\t\t\t/**\n-\t\t\t * Fires when the Serializer does a preProcess on the contents.\n-\t\t\t *\n-\t\t\t * @event onPreProcess\n-\t\t\t * @param {tinymce.Editor} sender Editor instance.\n-\t\t\t * @param {Object} obj PreProcess object.\n-\t\t\t * @option {Node} node DOM node for the item being serialized.\n-\t\t\t * @option {String} format The specified output format normally \"html\".\n-\t\t\t * @option {Boolean} get Is true if the process is on a getContent operation.\n-\t\t\t * @option {Boolean} set Is true if the process is on a setContent operation.\n-\t\t\t * @option {Boolean} cleanup Is true if the process is on a cleanup operation.\n-\t\t\t */\n-\t\t\tonPreProcess : onPreProcess,\n-\n-\t\t\t/**\n-\t\t\t * Fires when the Serializer does a postProcess on the contents.\n-\t\t\t *\n-\t\t\t * @event onPostProcess\n-\t\t\t * @param {tinymce.Editor} sender Editor instance.\n-\t\t\t * @param {Object} obj PreProcess object.\n-\t\t\t */\n-\t\t\tonPostProcess : onPostProcess,\n-\n-\t\t\t/**\n-\t\t\t * Serializes the specified browser DOM node into a HTML string.\n-\t\t\t *\n-\t\t\t * @method serialize\n-\t\t\t * @param {DOMNode} node DOM node to serialize.\n-\t\t\t * @param {Object} args Arguments option that gets passed to event handlers.\n-\t\t\t */\n-\t\t\tserialize : function(node, args) {\n-\t\t\t\tvar impl, doc, oldDoc, htmlSerializer, content;\n-\n-\t\t\t\t// Explorer won't clone contents of script and style and the\n-\t\t\t\t// selected index of select elements are cleared on a clone operation.\n-\t\t\t\tif (isIE && dom.select('script,style,select,map').length > 0) {\n-\t\t\t\t\tcontent = node.innerHTML;\n-\t\t\t\t\tnode = node.cloneNode(false);\n-\t\t\t\t\tdom.setHTML(node, content);\n-\t\t\t\t} else\n-\t\t\t\t\tnode = node.cloneNode(true);\n-\n-\t\t\t\t// Nodes needs to be attached to something in WebKit/Opera\n-\t\t\t\t// Older builds of Opera crashes if you attach the node to an document created dynamically\n-\t\t\t\t// and since we can't feature detect a crash we need to sniff the acutal build number\n-\t\t\t\t// This fix will make DOM ranges and make Sizzle happy!\n-\t\t\t\timpl = node.ownerDocument.implementation;\n-\t\t\t\tif (impl.createHTMLDocument) {\n-\t\t\t\t\t// Create an empty HTML document\n-\t\t\t\t\tdoc = impl.createHTMLDocument(\"\");\n-\n-\t\t\t\t\t// Add the element or it's children if it's a body element to the new document\n-\t\t\t\t\teach(node.nodeName == 'BODY' ? node.childNodes : [node], function(node) {\n-\t\t\t\t\t\tdoc.body.appendChild(doc.importNode(node, true));\n-\t\t\t\t\t});\n-\n-\t\t\t\t\t// Grab first child or body element for serialization\n-\t\t\t\t\tif (node.nodeName != 'BODY')\n-\t\t\t\t\t\tnode = doc.body.firstChild;\n-\t\t\t\t\telse\n-\t\t\t\t\t\tnode = doc.body;\n-\n-\t\t\t\t\t// set the new document in DOMUtils so createElement etc works\n-\t\t\t\t\toldDoc = dom.doc;\n-\t\t\t\t\tdom.doc = doc;\n-\t\t\t\t}\n-\n-\t\t\t\targs = args || {};\n-\t\t\t\targs.format = args.format || 'html';\n-\n-\t\t\t\t// Pre process\n-\t\t\t\tif (!args.no_events) {\n-\t\t\t\t\targs.node = node;\n-\t\t\t\t\tonPreProcess.dispatch(self, args);\n-\t\t\t\t}\n-\n-\t\t\t\t// Setup serializer\n-\t\t\t\thtmlSerializer = new tinymce.html.Serializer(settings, schema);\n-\n-\t\t\t\t// Parse and serialize HTML\n-\t\t\t\targs.content = htmlSerializer.serialize(\n-\t\t\t\t\thtmlParser.parse(tinymce.trim(args.getInner ? node.innerHTML : dom.getOuterHTML(node)), args)\n-\t\t\t\t);\n-\n-\t\t\t\t// Replace all BOM characters for now until we can find a better solution\n-\t\t\t\tif (!args.cleanup)\n-\t\t\t\t\targs.content = args.content.replace(/\\uFEFF/g, '');\n-\n-\t\t\t\t// Post process\n-\t\t\t\tif (!args.no_events)\n-\t\t\t\t\tonPostProcess.dispatch(self, args);\n-\n-\t\t\t\t// Restore the old document if it was changed\n-\t\t\t\tif (oldDoc)\n-\t\t\t\t\tdom.doc = oldDoc;\n-\n-\t\t\t\targs.node = null;\n-\n-\t\t\t\treturn args.content;\n-\t\t\t},\n-\n-\t\t\t/**\n-\t\t\t * Adds valid elements rules to the serializers schema instance this enables you to specify things\n-\t\t\t * like what elements should be outputted and what attributes specific elements might have.\n-\t\t\t * Consult the Wiki for more details on this format.\n-\t\t\t *\n-\t\t\t * @method addRules\n-\t\t\t * @param {String} rules Valid elements rules string to add to schema.\n-\t\t\t */\n-\t\t\taddRules : function(rules) {\n-\t\t\t\tschema.addValidElements(rules);\n-\t\t\t},\n-\n-\t\t\t/**\n-\t\t\t * Sets the valid elements rules to the serializers schema instance this enables you to specify things\n-\t\t\t * like what elements should be outputted and what attributes specific elements might have.\n-\t\t\t * Consult the Wiki for more details on this format.\n-\t\t\t *\n-\t\t\t * @method setRules\n-\t\t\t * @param {String} rules Valid elements rules string.\n-\t\t\t */\n-\t\t\tsetRules : function(rules) {\n-\t\t\t\tschema.setValidElements(rules);\n-\t\t\t}\n-\t\t};\n-\t};\n-})(tinymce);\n\\ No newline at end of file"
        },
        {
            "filename": "js/tiny_mce/classes/dom/Sizzle.js",
            "diff": "@@ -1,1449 +0,0 @@\n-// #ifndef jquery\n-\n-/*\n- * Sizzle CSS Selector Engine\n- *  Copyright, The Dojo Foundation\n- *  Released under the MIT, BSD, and GPL Licenses.\n- *  More information: http://sizzlejs.com/\n- */\n-(function(){\n-\n-var chunker = /((?:\\((?:\\([^()]+\\)|[^()]+)+\\)|\\[(?:\\[[^\\[\\]]*\\]|['\"][^'\"]*['\"]|[^\\[\\]'\"]+)+\\]|\\\\.|[^ >+~,(\\[\\\\]+)+|[>+~])(\\s*,\\s*)?((?:.|\\r|\\n)*)/g,\n-\texpando = \"sizcache\",\n-\tdone = 0,\n-\ttoString = Object.prototype.toString,\n-\thasDuplicate = false,\n-\tbaseHasDuplicate = true,\n-\trBackslash = /\\\\/g,\n-\trReturn = /\\r\\n/g,\n-\trNonWord = /\\W/;\n-\n-// Here we check if the JavaScript engine is using some sort of\n-// optimization where it does not always call our comparision\n-// function. If that is the case, discard the hasDuplicate value.\n-//   Thus far that includes Google Chrome.\n-[0, 0].sort(function() {\n-\tbaseHasDuplicate = false;\n-\treturn 0;\n-});\n-\n-var Sizzle = function( selector, context, results, seed ) {\n-\tresults = results || [];\n-\tcontext = context || document;\n-\n-\tvar origContext = context;\n-\n-\tif ( context.nodeType !== 1 && context.nodeType !== 9 ) {\n-\t\treturn [];\n-\t}\n-\n-\tif ( !selector || typeof selector !== \"string\" ) {\n-\t\treturn results;\n-\t}\n-\n-\tvar m, set, checkSet, extra, ret, cur, pop, i,\n-\t\tprune = true,\n-\t\tcontextXML = Sizzle.isXML( context ),\n-\t\tparts = [],\n-\t\tsoFar = selector;\n-\n-\t// Reset the position of the chunker regexp (start from head)\n-\tdo {\n-\t\tchunker.exec( \"\" );\n-\t\tm = chunker.exec( soFar );\n-\n-\t\tif ( m ) {\n-\t\t\tsoFar = m[3];\n-\n-\t\t\tparts.push( m[1] );\n-\n-\t\t\tif ( m[2] ) {\n-\t\t\t\textra = m[3];\n-\t\t\t\tbreak;\n-\t\t\t}\n-\t\t}\n-\t} while ( m );\n-\n-\tif ( parts.length > 1 && origPOS.exec( selector ) ) {\n-\n-\t\tif ( parts.length === 2 && Expr.relative[ parts[0] ] ) {\n-\t\t\tset = posProcess( parts[0] + parts[1], context, seed );\n-\n-\t\t} else {\n-\t\t\tset = Expr.relative[ parts[0] ] ?\n-\t\t\t\t[ context ] :\n-\t\t\t\tSizzle( parts.shift(), context );\n-\n-\t\t\twhile ( parts.length ) {\n-\t\t\t\tselector = parts.shift();\n-\n-\t\t\t\tif ( Expr.relative[ selector ] ) {\n-\t\t\t\t\tselector += parts.shift();\n-\t\t\t\t}\n-\n-\t\t\t\tset = posProcess( selector, set, seed );\n-\t\t\t}\n-\t\t}\n-\n-\t} else {\n-\t\t// Take a shortcut and set the context if the root selector is an ID\n-\t\t// (but not if it'll be faster if the inner selector is an ID)\n-\t\tif ( !seed && parts.length > 1 && context.nodeType === 9 && !contextXML &&\n-\t\t\t\tExpr.match.ID.test(parts[0]) && !Expr.match.ID.test(parts[parts.length - 1]) ) {\n-\n-\t\t\tret = Sizzle.find( parts.shift(), context, contextXML );\n-\t\t\tcontext = ret.expr ?\n-\t\t\t\tSizzle.filter( ret.expr, ret.set )[0] :\n-\t\t\t\tret.set[0];\n-\t\t}\n-\n-\t\tif ( context ) {\n-\t\t\tret = seed ?\n-\t\t\t\t{ expr: parts.pop(), set: makeArray(seed) } :\n-\t\t\t\tSizzle.find( parts.pop(), parts.length === 1 && (parts[0] === \"~\" || parts[0] === \"+\") && context.parentNode ? context.parentNode : context, contextXML );\n-\n-\t\t\tset = ret.expr ?\n-\t\t\t\tSizzle.filter( ret.expr, ret.set ) :\n-\t\t\t\tret.set;\n-\n-\t\t\tif ( parts.length > 0 ) {\n-\t\t\t\tcheckSet = makeArray( set );\n-\n-\t\t\t} else {\n-\t\t\t\tprune = false;\n-\t\t\t}\n-\n-\t\t\twhile ( parts.length ) {\n-\t\t\t\tcur = parts.pop();\n-\t\t\t\tpop = cur;\n-\n-\t\t\t\tif ( !Expr.relative[ cur ] ) {\n-\t\t\t\t\tcur = \"\";\n-\t\t\t\t} else {\n-\t\t\t\t\tpop = parts.pop();\n-\t\t\t\t}\n-\n-\t\t\t\tif ( pop == null ) {\n-\t\t\t\t\tpop = context;\n-\t\t\t\t}\n-\n-\t\t\t\tExpr.relative[ cur ]( checkSet, pop, contextXML );\n-\t\t\t}\n-\n-\t\t} else {\n-\t\t\tcheckSet = parts = [];\n-\t\t}\n-\t}\n-\n-\tif ( !checkSet ) {\n-\t\tcheckSet = set;\n-\t}\n-\n-\tif ( !checkSet ) {\n-\t\tSizzle.error( cur || selector );\n-\t}\n-\n-\tif ( toString.call(checkSet) === \"[object Array]\" ) {\n-\t\tif ( !prune ) {\n-\t\t\tresults.push.apply( results, checkSet );\n-\n-\t\t} else if ( context && context.nodeType === 1 ) {\n-\t\t\tfor ( i = 0; checkSet[i] != null; i++ ) {\n-\t\t\t\tif ( checkSet[i] && (checkSet[i] === true || checkSet[i].nodeType === 1 && Sizzle.contains(context, checkSet[i])) ) {\n-\t\t\t\t\tresults.push( set[i] );\n-\t\t\t\t}\n-\t\t\t}\n-\n-\t\t} else {\n-\t\t\tfor ( i = 0; checkSet[i] != null; i++ ) {\n-\t\t\t\tif ( checkSet[i] && checkSet[i].nodeType === 1 ) {\n-\t\t\t\t\tresults.push( set[i] );\n-\t\t\t\t}\n-\t\t\t}\n-\t\t}\n-\n-\t} else {\n-\t\tmakeArray( checkSet, results );\n-\t}\n-\n-\tif ( extra ) {\n-\t\tSizzle( extra, origContext, results, seed );\n-\t\tSizzle.uniqueSort( results );\n-\t}\n-\n-\treturn results;\n-};\n-\n-Sizzle.uniqueSort = function( results ) {\n-\tif ( sortOrder ) {\n-\t\thasDuplicate = baseHasDuplicate;\n-\t\tresults.sort( sortOrder );\n-\n-\t\tif ( hasDuplicate ) {\n-\t\t\tfor ( var i = 1; i < results.length; i++ ) {\n-\t\t\t\tif ( results[i] === results[ i - 1 ] ) {\n-\t\t\t\t\tresults.splice( i--, 1 );\n-\t\t\t\t}\n-\t\t\t}\n-\t\t}\n-\t}\n-\n-\treturn results;\n-};\n-\n-Sizzle.matches = function( expr, set ) {\n-\treturn Sizzle( expr, null, null, set );\n-};\n-\n-Sizzle.matchesSelector = function( node, expr ) {\n-\treturn Sizzle( expr, null, null, [node] ).length > 0;\n-};\n-\n-Sizzle.find = function( expr, context, isXML ) {\n-\tvar set, i, len, match, type, left;\n-\n-\tif ( !expr ) {\n-\t\treturn [];\n-\t}\n-\n-\tfor ( i = 0, len = Expr.order.length; i < len; i++ ) {\n-\t\ttype = Expr.order[i];\n-\n-\t\tif ( (match = Expr.leftMatch[ type ].exec( expr )) ) {\n-\t\t\tleft = match[1];\n-\t\t\tmatch.splice( 1, 1 );\n-\n-\t\t\tif ( left.substr( left.length - 1 ) !== \"\\\\\" ) {\n-\t\t\t\tmatch[1] = (match[1] || \"\").replace( rBackslash, \"\" );\n-\t\t\t\tset = Expr.find[ type ]( match, context, isXML );\n-\n-\t\t\t\tif ( set != null ) {\n-\t\t\t\t\texpr = expr.replace( Expr.match[ type ], \"\" );\n-\t\t\t\t\tbreak;\n-\t\t\t\t}\n-\t\t\t}\n-\t\t}\n-\t}\n-\n-\tif ( !set ) {\n-\t\tset = typeof context.getElementsByTagName !== \"undefined\" ?\n-\t\t\tcontext.getElementsByTagName( \"*\" ) :\n-\t\t\t[];\n-\t}\n-\n-\treturn { set: set, expr: expr };\n-};\n-\n-Sizzle.filter = function( expr, set, inplace, not ) {\n-\tvar match, anyFound,\n-\t\ttype, found, item, filter, left,\n-\t\ti, pass,\n-\t\told = expr,\n-\t\tresult = [],\n-\t\tcurLoop = set,\n-\t\tisXMLFilter = set && set[0] && Sizzle.isXML( set[0] );\n-\n-\twhile ( expr && set.length ) {\n-\t\tfor ( type in Expr.filter ) {\n-\t\t\tif ( (match = Expr.leftMatch[ type ].exec( expr )) != null && match[2] ) {\n-\t\t\t\tfilter = Expr.filter[ type ];\n-\t\t\t\tleft = match[1];\n-\n-\t\t\t\tanyFound = false;\n-\n-\t\t\t\tmatch.splice(1,1);\n-\n-\t\t\t\tif ( left.substr( left.length - 1 ) === \"\\\\\" ) {\n-\t\t\t\t\tcontinue;\n-\t\t\t\t}\n-\n-\t\t\t\tif ( curLoop === result ) {\n-\t\t\t\t\tresult = [];\n-\t\t\t\t}\n-\n-\t\t\t\tif ( Expr.preFilter[ type ] ) {\n-\t\t\t\t\tmatch = Expr.preFilter[ type ]( match, curLoop, inplace, result, not, isXMLFilter );\n-\n-\t\t\t\t\tif ( !match ) {\n-\t\t\t\t\t\tanyFound = found = true;\n-\n-\t\t\t\t\t} else if ( match === true ) {\n-\t\t\t\t\t\tcontinue;\n-\t\t\t\t\t}\n-\t\t\t\t}\n-\n-\t\t\t\tif ( match ) {\n-\t\t\t\t\tfor ( i = 0; (item = curLoop[i]) != null; i++ ) {\n-\t\t\t\t\t\tif ( item ) {\n-\t\t\t\t\t\t\tfound = filter( item, match, i, curLoop );\n-\t\t\t\t\t\t\tpass = not ^ found;\n-\n-\t\t\t\t\t\t\tif ( inplace && found != null ) {\n-\t\t\t\t\t\t\t\tif ( pass ) {\n-\t\t\t\t\t\t\t\t\tanyFound = true;\n-\n-\t\t\t\t\t\t\t\t} else {\n-\t\t\t\t\t\t\t\t\tcurLoop[i] = false;\n-\t\t\t\t\t\t\t\t}\n-\n-\t\t\t\t\t\t\t} else if ( pass ) {\n-\t\t\t\t\t\t\t\tresult.push( item );\n-\t\t\t\t\t\t\t\tanyFound = true;\n-\t\t\t\t\t\t\t}\n-\t\t\t\t\t\t}\n-\t\t\t\t\t}\n-\t\t\t\t}\n-\n-\t\t\t\tif ( found !== undefined ) {\n-\t\t\t\t\tif ( !inplace ) {\n-\t\t\t\t\t\tcurLoop = result;\n-\t\t\t\t\t}\n-\n-\t\t\t\t\texpr = expr.replace( Expr.match[ type ], \"\" );\n-\n-\t\t\t\t\tif ( !anyFound ) {\n-\t\t\t\t\t\treturn [];\n-\t\t\t\t\t}\n-\n-\t\t\t\t\tbreak;\n-\t\t\t\t}\n-\t\t\t}\n-\t\t}\n-\n-\t\t// Improper expression\n-\t\tif ( expr === old ) {\n-\t\t\tif ( anyFound == null ) {\n-\t\t\t\tSizzle.error( expr );\n-\n-\t\t\t} else {\n-\t\t\t\tbreak;\n-\t\t\t}\n-\t\t}\n-\n-\t\told = expr;\n-\t}\n-\n-\treturn curLoop;\n-};\n-\n-Sizzle.error = function( msg ) {\n-\tthrow new Error( \"Syntax error, unrecognized expression: \" + msg );\n-};\n-\n-/**\n- * Utility function for retreiving the text value of an array of DOM nodes\n- * @param {Array|Element} elem\n- */\n-var getText = Sizzle.getText = function( elem ) {\n-    var i, node,\n-\t\tnodeType = elem.nodeType,\n-\t\tret = \"\";\n-\n-\tif ( nodeType ) {\n-\t\tif ( nodeType === 1 || nodeType === 9 || nodeType === 11 ) {\n-\t\t\t// Use textContent || innerText for elements\n-\t\t\tif ( typeof elem.textContent === 'string' ) {\n-\t\t\t\treturn elem.textContent;\n-\t\t\t} else if ( typeof elem.innerText === 'string' ) {\n-\t\t\t\t// Replace IE's carriage returns\n-\t\t\t\treturn elem.innerText.replace( rReturn, '' );\n-\t\t\t} else {\n-\t\t\t\t// Traverse it's children\n-\t\t\t\tfor ( elem = elem.firstChild; elem; elem = elem.nextSibling) {\n-\t\t\t\t\tret += getText( elem );\n-\t\t\t\t}\n-\t\t\t}\n-\t\t} else if ( nodeType === 3 || nodeType === 4 ) {\n-\t\t\treturn elem.nodeValue;\n-\t\t}\n-\t} else {\n-\n-\t\t// If no nodeType, this is expected to be an array\n-\t\tfor ( i = 0; (node = elem[i]); i++ ) {\n-\t\t\t// Do not traverse comment nodes\n-\t\t\tif ( node.nodeType !== 8 ) {\n-\t\t\t\tret += getText( node );\n-\t\t\t}\n-\t\t}\n-\t}\n-\treturn ret;\n-};\n-\n-var Expr = Sizzle.selectors = {\n-\torder: [ \"ID\", \"NAME\", \"TAG\" ],\n-\n-\tmatch: {\n-\t\tID: /#((?:[\\w\\u00c0-\\uFFFF\\-]|\\\\.)+)/,\n-\t\tCLASS: /\\.((?:[\\w\\u00c0-\\uFFFF\\-]|\\\\.)+)/,\n-\t\tNAME: /\\[name=['\"]*((?:[\\w\\u00c0-\\uFFFF\\-]|\\\\.)+)['\"]*\\]/,\n-\t\tATTR: /\\[\\s*((?:[\\w\\u00c0-\\uFFFF\\-]|\\\\.)+)\\s*(?:(\\S?=)\\s*(?:(['\"])(.*?)\\3|(#?(?:[\\w\\u00c0-\\uFFFF\\-]|\\\\.)*)|)|)\\s*\\]/,\n-\t\tTAG: /^((?:[\\w\\u00c0-\\uFFFF\\*\\-]|\\\\.)+)/,\n-\t\tCHILD: /:(only|nth|last|first)-child(?:\\(\\s*(even|odd|(?:[+\\-]?\\d+|(?:[+\\-]?\\d*)?n\\s*(?:[+\\-]\\s*\\d+)?))\\s*\\))?/,\n-\t\tPOS: /:(nth|eq|gt|lt|first|last|even|odd)(?:\\((\\d*)\\))?(?=[^\\-]|$)/,\n-\t\tPSEUDO: /:((?:[\\w\\u00c0-\\uFFFF\\-]|\\\\.)+)(?:\\((['\"]?)((?:\\([^\\)]+\\)|[^\\(\\)]*)+)\\2\\))?/\n-\t},\n-\n-\tleftMatch: {},\n-\n-\tattrMap: {\n-\t\t\"class\": \"className\",\n-\t\t\"for\": \"htmlFor\"\n-\t},\n-\n-\tattrHandle: {\n-\t\thref: function( elem ) {\n-\t\t\treturn elem.getAttribute( \"href\" );\n-\t\t},\n-\t\ttype: function( elem ) {\n-\t\t\treturn elem.getAttribute( \"type\" );\n-\t\t}\n-\t},\n-\n-\trelative: {\n-\t\t\"+\": function(checkSet, part){\n-\t\t\tvar isPartStr = typeof part === \"string\",\n-\t\t\t\tisTag = isPartStr && !rNonWord.test( part ),\n-\t\t\t\tisPartStrNotTag = isPartStr && !isTag;\n-\n-\t\t\tif ( isTag ) {\n-\t\t\t\tpart = part.toLowerCase();\n-\t\t\t}\n-\n-\t\t\tfor ( var i = 0, l = checkSet.length, elem; i < l; i++ ) {\n-\t\t\t\tif ( (elem = checkSet[i]) ) {\n-\t\t\t\t\twhile ( (elem = elem.previousSibling) && elem.nodeType !== 1 ) {}\n-\n-\t\t\t\t\tcheckSet[i] = isPartStrNotTag || elem && elem.nodeName.toLowerCase() === part ?\n-\t\t\t\t\t\telem || false :\n-\t\t\t\t\t\telem === part;\n-\t\t\t\t}\n-\t\t\t}\n-\n-\t\t\tif ( isPartStrNotTag ) {\n-\t\t\t\tSizzle.filter( part, checkSet, true );\n-\t\t\t}\n-\t\t},\n-\n-\t\t\">\": function( checkSet, part ) {\n-\t\t\tvar elem,\n-\t\t\t\tisPartStr = typeof part === \"string\",\n-\t\t\t\ti = 0,\n-\t\t\t\tl = checkSet.length;\n-\n-\t\t\tif ( isPartStr && !rNonWord.test( part ) ) {\n-\t\t\t\tpart = part.toLowerCase();\n-\n-\t\t\t\tfor ( ; i < l; i++ ) {\n-\t\t\t\t\telem = checkSet[i];\n-\n-\t\t\t\t\tif ( elem ) {\n-\t\t\t\t\t\tvar parent = elem.parentNode;\n-\t\t\t\t\t\tcheckSet[i] = parent.nodeName.toLowerCase() === part ? parent : false;\n-\t\t\t\t\t}\n-\t\t\t\t}\n-\n-\t\t\t} else {\n-\t\t\t\tfor ( ; i < l; i++ ) {\n-\t\t\t\t\telem = checkSet[i];\n-\n-\t\t\t\t\tif ( elem ) {\n-\t\t\t\t\t\tcheckSet[i] = isPartStr ?\n-\t\t\t\t\t\t\telem.parentNode :\n-\t\t\t\t\t\t\telem.parentNode === part;\n-\t\t\t\t\t}\n-\t\t\t\t}\n-\n-\t\t\t\tif ( isPartStr ) {\n-\t\t\t\t\tSizzle.filter( part, checkSet, true );\n-\t\t\t\t}\n-\t\t\t}\n-\t\t},\n-\n-\t\t\"\": function(checkSet, part, isXML){\n-\t\t\tvar nodeCheck,\n-\t\t\t\tdoneName = done++,\n-\t\t\t\tcheckFn = dirCheck;\n-\n-\t\t\tif ( typeof part === \"string\" && !rNonWord.test( part ) ) {\n-\t\t\t\tpart = part.toLowerCase();\n-\t\t\t\tnodeCheck = part;\n-\t\t\t\tcheckFn = dirNodeCheck;\n-\t\t\t}\n-\n-\t\t\tcheckFn( \"parentNode\", part, doneName, checkSet, nodeCheck, isXML );\n-\t\t},\n-\n-\t\t\"~\": function( checkSet, part, isXML ) {\n-\t\t\tvar nodeCheck,\n-\t\t\t\tdoneName = done++,\n-\t\t\t\tcheckFn = dirCheck;\n-\n-\t\t\tif ( typeof part === \"string\" && !rNonWord.test( part ) ) {\n-\t\t\t\tpart = part.toLowerCase();\n-\t\t\t\tnodeCheck = part;\n-\t\t\t\tcheckFn = dirNodeCheck;\n-\t\t\t}\n-\n-\t\t\tcheckFn( \"previousSibling\", part, doneName, checkSet, nodeCheck, isXML );\n-\t\t}\n-\t},\n-\n-\tfind: {\n-\t\tID: function( match, context, isXML ) {\n-\t\t\tif ( typeof context.getElementById !== \"undefined\" && !isXML ) {\n-\t\t\t\tvar m = context.getElementById(match[1]);\n-\t\t\t\t// Check parentNode to catch when Blackberry 4.6 returns\n-\t\t\t\t// nodes that are no longer in the document #6963\n-\t\t\t\treturn m && m.parentNode ? [m] : [];\n-\t\t\t}\n-\t\t},\n-\n-\t\tNAME: function( match, context ) {\n-\t\t\tif ( typeof context.getElementsByName !== \"undefined\" ) {\n-\t\t\t\tvar ret = [],\n-\t\t\t\t\tresults = context.getElementsByName( match[1] );\n-\n-\t\t\t\tfor ( var i = 0, l = results.length; i < l; i++ ) {\n-\t\t\t\t\tif ( results[i].getAttribute(\"name\") === match[1] ) {\n-\t\t\t\t\t\tret.push( results[i] );\n-\t\t\t\t\t}\n-\t\t\t\t}\n-\n-\t\t\t\treturn ret.length === 0 ? null : ret;\n-\t\t\t}\n-\t\t},\n-\n-\t\tTAG: function( match, context ) {\n-\t\t\tif ( typeof context.getElementsByTagName !== \"undefined\" ) {\n-\t\t\t\treturn context.getElementsByTagName( match[1] );\n-\t\t\t}\n-\t\t}\n-\t},\n-\tpreFilter: {\n-\t\tCLASS: function( match, curLoop, inplace, result, not, isXML ) {\n-\t\t\tmatch = \" \" + match[1].replace( rBackslash, \"\" ) + \" \";\n-\n-\t\t\tif ( isXML ) {\n-\t\t\t\treturn match;\n-\t\t\t}\n-\n-\t\t\tfor ( var i = 0, elem; (elem = curLoop[i]) != null; i++ ) {\n-\t\t\t\tif ( elem ) {\n-\t\t\t\t\tif ( not ^ (elem.className && (\" \" + elem.className + \" \").replace(/[\\t\\n\\r]/g, \" \").indexOf(match) >= 0) ) {\n-\t\t\t\t\t\tif ( !inplace ) {\n-\t\t\t\t\t\t\tresult.push( elem );\n-\t\t\t\t\t\t}\n-\n-\t\t\t\t\t} else if ( inplace ) {\n-\t\t\t\t\t\tcurLoop[i] = false;\n-\t\t\t\t\t}\n-\t\t\t\t}\n-\t\t\t}\n-\n-\t\t\treturn false;\n-\t\t},\n-\n-\t\tID: function( match ) {\n-\t\t\treturn match[1].replace( rBackslash, \"\" );\n-\t\t},\n-\n-\t\tTAG: function( match, curLoop ) {\n-\t\t\treturn match[1].replace( rBackslash, \"\" ).toLowerCase();\n-\t\t},\n-\n-\t\tCHILD: function( match ) {\n-\t\t\tif ( match[1] === \"nth\" ) {\n-\t\t\t\tif ( !match[2] ) {\n-\t\t\t\t\tSizzle.error( match[0] );\n-\t\t\t\t}\n-\n-\t\t\t\tmatch[2] = match[2].replace(/^\\+|\\s*/g, '');\n-\n-\t\t\t\t// parse equations like 'even', 'odd', '5', '2n', '3n+2', '4n-1', '-n+6'\n-\t\t\t\tvar test = /(-?)(\\d*)(?:n([+\\-]?\\d*))?/.exec(\n-\t\t\t\t\tmatch[2] === \"even\" && \"2n\" || match[2] === \"odd\" && \"2n+1\" ||\n-\t\t\t\t\t!/\\D/.test( match[2] ) && \"0n+\" + match[2] || match[2]);\n-\n-\t\t\t\t// calculate the numbers (first)n+(last) including if they are negative\n-\t\t\t\tmatch[2] = (test[1] + (test[2] || 1)) - 0;\n-\t\t\t\tmatch[3] = test[3] - 0;\n-\t\t\t}\n-\t\t\telse if ( match[2] ) {\n-\t\t\t\tSizzle.error( match[0] );\n-\t\t\t}\n-\n-\t\t\t// TODO: Move to normal caching system\n-\t\t\tmatch[0] = done++;\n-\n-\t\t\treturn match;\n-\t\t},\n-\n-\t\tATTR: function( match, curLoop, inplace, result, not, isXML ) {\n-\t\t\tvar name = match[1] = match[1].replace( rBackslash, \"\" );\n-\n-\t\t\tif ( !isXML && Expr.attrMap[name] ) {\n-\t\t\t\tmatch[1] = Expr.attrMap[name];\n-\t\t\t}\n-\n-\t\t\t// Handle if an un-quoted value was used\n-\t\t\tmatch[4] = ( match[4] || match[5] || \"\" ).replace( rBackslash, \"\" );\n-\n-\t\t\tif ( match[2] === \"~=\" ) {\n-\t\t\t\tmatch[4] = \" \" + match[4] + \" \";\n-\t\t\t}\n-\n-\t\t\treturn match;\n-\t\t},\n-\n-\t\tPSEUDO: function( match, curLoop, inplace, result, not ) {\n-\t\t\tif ( match[1] === \"not\" ) {\n-\t\t\t\t// If we're dealing with a complex expression, or a simple one\n-\t\t\t\tif ( ( chunker.exec(match[3]) || \"\" ).length > 1 || /^\\w/.test(match[3]) ) {\n-\t\t\t\t\tmatch[3] = Sizzle(match[3], null, null, curLoop);\n-\n-\t\t\t\t} else {\n-\t\t\t\t\tvar ret = Sizzle.filter(match[3], curLoop, inplace, true ^ not);\n-\n-\t\t\t\t\tif ( !inplace ) {\n-\t\t\t\t\t\tresult.push.apply( result, ret );\n-\t\t\t\t\t}\n-\n-\t\t\t\t\treturn false;\n-\t\t\t\t}\n-\n-\t\t\t} else if ( Expr.match.POS.test( match[0] ) || Expr.match.CHILD.test( match[0] ) ) {\n-\t\t\t\treturn true;\n-\t\t\t}\n-\n-\t\t\treturn match;\n-\t\t},\n-\n-\t\tPOS: function( match ) {\n-\t\t\tmatch.unshift( true );\n-\n-\t\t\treturn match;\n-\t\t}\n-\t},\n-\n-\tfilters: {\n-\t\tenabled: function( elem ) {\n-\t\t\treturn elem.disabled === false && elem.type !== \"hidden\";\n-\t\t},\n-\n-\t\tdisabled: function( elem ) {\n-\t\t\treturn elem.disabled === true;\n-\t\t},\n-\n-\t\tchecked: function( elem ) {\n-\t\t\treturn elem.checked === true;\n-\t\t},\n-\n-\t\tselected: function( elem ) {\n-\t\t\t// Accessing this property makes selected-by-default\n-\t\t\t// options in Safari work properly\n-\t\t\tif ( elem.parentNode ) {\n-\t\t\t\telem.parentNode.selectedIndex;\n-\t\t\t}\n-\n-\t\t\treturn elem.selected === true;\n-\t\t},\n-\n-\t\tparent: function( elem ) {\n-\t\t\treturn !!elem.firstChild;\n-\t\t},\n-\n-\t\tempty: function( elem ) {\n-\t\t\treturn !elem.firstChild;\n-\t\t},\n-\n-\t\thas: function( elem, i, match ) {\n-\t\t\treturn !!Sizzle( match[3], elem ).length;\n-\t\t},\n-\n-\t\theader: function( elem ) {\n-\t\t\treturn (/h\\d/i).test( elem.nodeName );\n-\t\t},\n-\n-\t\ttext: function( elem ) {\n-\t\t\tvar attr = elem.getAttribute( \"type\" ), type = elem.type;\n-\t\t\t// IE6 and 7 will map elem.type to 'text' for new HTML5 types (search, etc)\n-\t\t\t// use getAttribute instead to test this case\n-\t\t\treturn elem.nodeName.toLowerCase() === \"input\" && \"text\" === type && ( attr === type || attr === null );\n-\t\t},\n-\n-\t\tradio: function( elem ) {\n-\t\t\treturn elem.nodeName.toLowerCase() === \"input\" && \"radio\" === elem.type;\n-\t\t},\n-\n-\t\tcheckbox: function( elem ) {\n-\t\t\treturn elem.nodeName.toLowerCase() === \"input\" && \"checkbox\" === elem.type;\n-\t\t},\n-\n-\t\tfile: function( elem ) {\n-\t\t\treturn elem.nodeName.toLowerCase() === \"input\" && \"file\" === elem.type;\n-\t\t},\n-\n-\t\tpassword: function( elem ) {\n-\t\t\treturn elem.nodeName.toLowerCase() === \"input\" && \"password\" === elem.type;\n-\t\t},\n-\n-\t\tsubmit: function( elem ) {\n-\t\t\tvar name = elem.nodeName.toLowerCase();\n-\t\t\treturn (name === \"input\" || name === \"button\") && \"submit\" === elem.type;\n-\t\t},\n-\n-\t\timage: function( elem ) {\n-\t\t\treturn elem.nodeName.toLowerCase() === \"input\" && \"image\" === elem.type;\n-\t\t},\n-\n-\t\treset: function( elem ) {\n-\t\t\tvar name = elem.nodeName.toLowerCase();\n-\t\t\treturn (name === \"input\" || name === \"button\") && \"reset\" === elem.type;\n-\t\t},\n-\n-\t\tbutton: function( elem ) {\n-\t\t\tvar name = elem.nodeName.toLowerCase();\n-\t\t\treturn name === \"input\" && \"button\" === elem.type || name === \"button\";\n-\t\t},\n-\n-\t\tinput: function( elem ) {\n-\t\t\treturn (/input|select|textarea|button/i).test( elem.nodeName );\n-\t\t},\n-\n-\t\tfocus: function( elem ) {\n-\t\t\treturn elem === elem.ownerDocument.activeElement;\n-\t\t}\n-\t},\n-\tsetFilters: {\n-\t\tfirst: function( elem, i ) {\n-\t\t\treturn i === 0;\n-\t\t},\n-\n-\t\tlast: function( elem, i, match, array ) {\n-\t\t\treturn i === array.length - 1;\n-\t\t},\n-\n-\t\teven: function( elem, i ) {\n-\t\t\treturn i % 2 === 0;\n-\t\t},\n-\n-\t\todd: function( elem, i ) {\n-\t\t\treturn i % 2 === 1;\n-\t\t},\n-\n-\t\tlt: function( elem, i, match ) {\n-\t\t\treturn i < match[3] - 0;\n-\t\t},\n-\n-\t\tgt: function( elem, i, match ) {\n-\t\t\treturn i > match[3] - 0;\n-\t\t},\n-\n-\t\tnth: function( elem, i, match ) {\n-\t\t\treturn match[3] - 0 === i;\n-\t\t},\n-\n-\t\teq: function( elem, i, match ) {\n-\t\t\treturn match[3] - 0 === i;\n-\t\t}\n-\t},\n-\tfilter: {\n-\t\tPSEUDO: function( elem, match, i, array ) {\n-\t\t\tvar name = match[1],\n-\t\t\t\tfilter = Expr.filters[ name ];\n-\n-\t\t\tif ( filter ) {\n-\t\t\t\treturn filter( elem, i, match, array );\n-\n-\t\t\t} else if ( name === \"contains\" ) {\n-\t\t\t\treturn (elem.textContent || elem.innerText || getText([ elem ]) || \"\").indexOf(match[3]) >= 0;\n-\n-\t\t\t} else if ( name === \"not\" ) {\n-\t\t\t\tvar not = match[3];\n-\n-\t\t\t\tfor ( var j = 0, l = not.length; j < l; j++ ) {\n-\t\t\t\t\tif ( not[j] === elem ) {\n-\t\t\t\t\t\treturn false;\n-\t\t\t\t\t}\n-\t\t\t\t}\n-\n-\t\t\t\treturn true;\n-\n-\t\t\t} else {\n-\t\t\t\tSizzle.error( name );\n-\t\t\t}\n-\t\t},\n-\n-\t\tCHILD: function( elem, match ) {\n-\t\t\tvar first, last,\n-\t\t\t\tdoneName, parent, cache,\n-\t\t\t\tcount, diff,\n-\t\t\t\ttype = match[1],\n-\t\t\t\tnode = elem;\n-\n-\t\t\tswitch ( type ) {\n-\t\t\t\tcase \"only\":\n-\t\t\t\tcase \"first\":\n-\t\t\t\t\twhile ( (node = node.previousSibling) ) {\n-\t\t\t\t\t\tif ( node.nodeType === 1 ) {\n-\t\t\t\t\t\t\treturn false;\n-\t\t\t\t\t\t}\n-\t\t\t\t\t}\n-\n-\t\t\t\t\tif ( type === \"first\" ) {\n-\t\t\t\t\t\treturn true;\n-\t\t\t\t\t}\n-\n-\t\t\t\t\tnode = elem;\n-\n-\t\t\t\t\t/* falls through */\n-\t\t\t\tcase \"last\":\n-\t\t\t\t\twhile ( (node = node.nextSibling) ) {\n-\t\t\t\t\t\tif ( node.nodeType === 1 ) {\n-\t\t\t\t\t\t\treturn false;\n-\t\t\t\t\t\t}\n-\t\t\t\t\t}\n-\n-\t\t\t\t\treturn true;\n-\n-\t\t\t\tcase \"nth\":\n-\t\t\t\t\tfirst = match[2];\n-\t\t\t\t\tlast = match[3];\n-\n-\t\t\t\t\tif ( first === 1 && last === 0 ) {\n-\t\t\t\t\t\treturn true;\n-\t\t\t\t\t}\n-\n-\t\t\t\t\tdoneName = match[0];\n-\t\t\t\t\tparent = elem.parentNode;\n-\n-\t\t\t\t\tif ( parent && (parent[ expando ] !== doneName || !elem.nodeIndex) ) {\n-\t\t\t\t\t\tcount = 0;\n-\n-\t\t\t\t\t\tfor ( node = parent.firstChild; node; node = node.nextSibling ) {\n-\t\t\t\t\t\t\tif ( node.nodeType === 1 ) {\n-\t\t\t\t\t\t\t\tnode.nodeIndex = ++count;\n-\t\t\t\t\t\t\t}\n-\t\t\t\t\t\t}\n-\n-\t\t\t\t\t\tparent[ expando ] = doneName;\n-\t\t\t\t\t}\n-\n-\t\t\t\t\tdiff = elem.nodeIndex - last;\n-\n-\t\t\t\t\tif ( first === 0 ) {\n-\t\t\t\t\t\treturn diff === 0;\n-\n-\t\t\t\t\t} else {\n-\t\t\t\t\t\treturn ( diff % first === 0 && diff / first >= 0 );\n-\t\t\t\t\t}\n-\t\t\t}\n-\t\t},\n-\n-\t\tID: function( elem, match ) {\n-\t\t\treturn elem.nodeType === 1 && elem.getAttribute(\"id\") === match;\n-\t\t},\n-\n-\t\tTAG: function( elem, match ) {\n-\t\t\treturn (match === \"*\" && elem.nodeType === 1) || !!elem.nodeName && elem.nodeName.toLowerCase() === match;\n-\t\t},\n-\n-\t\tCLASS: function( elem, match ) {\n-\t\t\treturn (\" \" + (elem.className || elem.getAttribute(\"class\")) + \" \")\n-\t\t\t\t.indexOf( match ) > -1;\n-\t\t},\n-\n-\t\tATTR: function( elem, match ) {\n-\t\t\tvar name = match[1],\n-\t\t\t\tresult = Sizzle.attr ?\n-\t\t\t\t\tSizzle.attr( elem, name ) :\n-\t\t\t\t\tExpr.attrHandle[ name ] ?\n-\t\t\t\t\tExpr.attrHandle[ name ]( elem ) :\n-\t\t\t\t\telem[ name ] != null ?\n-\t\t\t\t\t\telem[ name ] :\n-\t\t\t\t\t\telem.getAttribute( name ),\n-\t\t\t\tvalue = result + \"\",\n-\t\t\t\ttype = match[2],\n-\t\t\t\tcheck = match[4];\n-\n-\t\t\treturn result == null ?\n-\t\t\t\ttype === \"!=\" :\n-\t\t\t\t!type && Sizzle.attr ?\n-\t\t\t\tresult != null :\n-\t\t\t\ttype === \"=\" ?\n-\t\t\t\tvalue === check :\n-\t\t\t\ttype === \"*=\" ?\n-\t\t\t\tvalue.indexOf(check) >= 0 :\n-\t\t\t\ttype === \"~=\" ?\n-\t\t\t\t(\" \" + value + \" \").indexOf(check) >= 0 :\n-\t\t\t\t!check ?\n-\t\t\t\tvalue && result !== false :\n-\t\t\t\ttype === \"!=\" ?\n-\t\t\t\tvalue !== check :\n-\t\t\t\ttype === \"^=\" ?\n-\t\t\t\tvalue.indexOf(check) === 0 :\n-\t\t\t\ttype === \"$=\" ?\n-\t\t\t\tvalue.substr(value.length - check.length) === check :\n-\t\t\t\ttype === \"|=\" ?\n-\t\t\t\tvalue === check || value.substr(0, check.length + 1) === check + \"-\" :\n-\t\t\t\tfalse;\n-\t\t},\n-\n-\t\tPOS: function( elem, match, i, array ) {\n-\t\t\tvar name = match[2],\n-\t\t\t\tfilter = Expr.setFilters[ name ];\n-\n-\t\t\tif ( filter ) {\n-\t\t\t\treturn filter( elem, i, match, array );\n-\t\t\t}\n-\t\t}\n-\t}\n-};\n-\n-var origPOS = Expr.match.POS,\n-\tfescape = function(all, num){\n-\t\treturn \"\\\\\" + (num - 0 + 1);\n-\t};\n-\n-for ( var type in Expr.match ) {\n-\tExpr.match[ type ] = new RegExp( Expr.match[ type ].source + (/(?![^\\[]*\\])(?![^\\(]*\\))/.source) );\n-\tExpr.leftMatch[ type ] = new RegExp( /(^(?:.|\\r|\\n)*?)/.source + Expr.match[ type ].source.replace(/\\\\(\\d+)/g, fescape) );\n-}\n-// Expose origPOS\n-// \"global\" as in regardless of relation to brackets/parens\n-Expr.match.globalPOS = origPOS;\n-\n-var makeArray = function( array, results ) {\n-\tarray = Array.prototype.slice.call( array, 0 );\n-\n-\tif ( results ) {\n-\t\tresults.push.apply( results, array );\n-\t\treturn results;\n-\t}\n-\n-\treturn array;\n-};\n-\n-// Perform a simple check to determine if the browser is capable of\n-// converting a NodeList to an array using builtin methods.\n-// Also verifies that the returned array holds DOM nodes\n-// (which is not the case in the Blackberry browser)\n-try {\n-\tArray.prototype.slice.call( document.documentElement.childNodes, 0 )[0].nodeType;\n-\n-// Provide a fallback method if it does not work\n-} catch( e ) {\n-\tmakeArray = function( array, results ) {\n-\t\tvar i = 0,\n-\t\t\tret = results || [];\n-\n-\t\tif ( toString.call(array) === \"[object Array]\" ) {\n-\t\t\tArray.prototype.push.apply( ret, array );\n-\n-\t\t} else {\n-\t\t\tif ( typeof array.length === \"number\" ) {\n-\t\t\t\tfor ( var l = array.length; i < l; i++ ) {\n-\t\t\t\t\tret.push( array[i] );\n-\t\t\t\t}\n-\n-\t\t\t} else {\n-\t\t\t\tfor ( ; array[i]; i++ ) {\n-\t\t\t\t\tret.push( array[i] );\n-\t\t\t\t}\n-\t\t\t}\n-\t\t}\n-\n-\t\treturn ret;\n-\t};\n-}\n-\n-var sortOrder, siblingCheck;\n-\n-if ( document.documentElement.compareDocumentPosition ) {\n-\tsortOrder = function( a, b ) {\n-\t\tif ( a === b ) {\n-\t\t\thasDuplicate = true;\n-\t\t\treturn 0;\n-\t\t}\n-\n-\t\tif ( !a.compareDocumentPosition || !b.compareDocumentPosition ) {\n-\t\t\treturn a.compareDocumentPosition ? -1 : 1;\n-\t\t}\n-\n-\t\treturn a.compareDocumentPosition(b) & 4 ? -1 : 1;\n-\t};\n-\n-} else {\n-\tsortOrder = function( a, b ) {\n-\t\t// The nodes are identical, we can exit early\n-\t\tif ( a === b ) {\n-\t\t\thasDuplicate = true;\n-\t\t\treturn 0;\n-\n-\t\t// Fallback to using sourceIndex (in IE) if it's available on both nodes\n-\t\t} else if ( a.sourceIndex && b.sourceIndex ) {\n-\t\t\treturn a.sourceIndex - b.sourceIndex;\n-\t\t}\n-\n-\t\tvar al, bl,\n-\t\t\tap = [],\n-\t\t\tbp = [],\n-\t\t\taup = a.parentNode,\n-\t\t\tbup = b.parentNode,\n-\t\t\tcur = aup;\n-\n-\t\t// If the nodes are siblings (or identical) we can do a quick check\n-\t\tif ( aup === bup ) {\n-\t\t\treturn siblingCheck( a, b );\n-\n-\t\t// If no parents were found then the nodes are disconnected\n-\t\t} else if ( !aup ) {\n-\t\t\treturn -1;\n-\n-\t\t} else if ( !bup ) {\n-\t\t\treturn 1;\n-\t\t}\n-\n-\t\t// Otherwise they're somewhere else in the tree so we need\n-\t\t// to build up a full list of the parentNodes for comparison\n-\t\twhile ( cur ) {\n-\t\t\tap.unshift( cur );\n-\t\t\tcur = cur.parentNode;\n-\t\t}\n-\n-\t\tcur = bup;\n-\n-\t\twhile ( cur ) {\n-\t\t\tbp.unshift( cur );\n-\t\t\tcur = cur.parentNode;\n-\t\t}\n-\n-\t\tal = ap.length;\n-\t\tbl = bp.length;\n-\n-\t\t// Start walking down the tree looking for a discrepancy\n-\t\tfor ( var i = 0; i < al && i < bl; i++ ) {\n-\t\t\tif ( ap[i] !== bp[i] ) {\n-\t\t\t\treturn siblingCheck( ap[i], bp[i] );\n-\t\t\t}\n-\t\t}\n-\n-\t\t// We ended someplace up the tree so do a sibling check\n-\t\treturn i === al ?\n-\t\t\tsiblingCheck( a, bp[i], -1 ) :\n-\t\t\tsiblingCheck( ap[i], b, 1 );\n-\t};\n-\n-\tsiblingCheck = function( a, b, ret ) {\n-\t\tif ( a === b ) {\n-\t\t\treturn ret;\n-\t\t}\n-\n-\t\tvar cur = a.nextSibling;\n-\n-\t\twhile ( cur ) {\n-\t\t\tif ( cur === b ) {\n-\t\t\t\treturn -1;\n-\t\t\t}\n-\n-\t\t\tcur = cur.nextSibling;\n-\t\t}\n-\n-\t\treturn 1;\n-\t};\n-}\n-\n-// Check to see if the browser returns elements by name when\n-// querying by getElementById (and provide a workaround)\n-(function(){\n-\t// We're going to inject a fake input element with a specified name\n-\tvar form = document.createElement(\"div\"),\n-\t\tid = \"script\" + (new Date()).getTime(),\n-\t\troot = document.documentElement;\n-\n-\tform.innerHTML = \"<a name='\" + id + \"'/>\";\n-\n-\t// Inject it into the root element, check its status, and remove it quickly\n-\troot.insertBefore( form, root.firstChild );\n-\n-\t// The workaround has to do additional checks after a getElementById\n-\t// Which slows things down for other browsers (hence the branching)\n-\tif ( document.getElementById( id ) ) {\n-\t\tExpr.find.ID = function( match, context, isXML ) {\n-\t\t\tif ( typeof context.getElementById !== \"undefined\" && !isXML ) {\n-\t\t\t\tvar m = context.getElementById(match[1]);\n-\n-\t\t\t\treturn m ?\n-\t\t\t\t\tm.id === match[1] || typeof m.getAttributeNode !== \"undefined\" && m.getAttributeNode(\"id\").nodeValue === match[1] ?\n-\t\t\t\t\t\t[m] :\n-\t\t\t\t\t\tundefined :\n-\t\t\t\t\t[];\n-\t\t\t}\n-\t\t};\n-\n-\t\tExpr.filter.ID = function( elem, match ) {\n-\t\t\tvar node = typeof elem.getAttributeNode !== \"undefined\" && elem.getAttributeNode(\"id\");\n-\n-\t\t\treturn elem.nodeType === 1 && node && node.nodeValue === match;\n-\t\t};\n-\t}\n-\n-\troot.removeChild( form );\n-\n-\t// release memory in IE\n-\troot = form = null;\n-})();\n-\n-(function(){\n-\t// Check to see if the browser returns only elements\n-\t// when doing getElementsByTagName(\"*\")\n-\n-\t// Create a fake element\n-\tvar div = document.createElement(\"div\");\n-\tdiv.appendChild( document.createComment(\"\") );\n-\n-\t// Make sure no comments are found\n-\tif ( div.getElementsByTagName(\"*\").length > 0 ) {\n-\t\tExpr.find.TAG = function( match, context ) {\n-\t\t\tvar results = context.getElementsByTagName( match[1] );\n-\n-\t\t\t// Filter out possible comments\n-\t\t\tif ( match[1] === \"*\" ) {\n-\t\t\t\tvar tmp = [];\n-\n-\t\t\t\tfor ( var i = 0; results[i]; i++ ) {\n-\t\t\t\t\tif ( results[i].nodeType === 1 ) {\n-\t\t\t\t\t\ttmp.push( results[i] );\n-\t\t\t\t\t}\n-\t\t\t\t}\n-\n-\t\t\t\tresults = tmp;\n-\t\t\t}\n-\n-\t\t\treturn results;\n-\t\t};\n-\t}\n-\n-\t// Check to see if an attribute returns normalized href attributes\n-\tdiv.innerHTML = \"<a href='#'></a>\";\n-\n-\tif ( div.firstChild && typeof div.firstChild.getAttribute !== \"undefined\" &&\n-\t\t\tdiv.firstChild.getAttribute(\"href\") !== \"#\" ) {\n-\n-\t\tExpr.attrHandle.href = function( elem ) {\n-\t\t\treturn elem.getAttribute( \"href\", 2 );\n-\t\t};\n-\t}\n-\n-\t// release memory in IE\n-\tdiv = null;\n-})();\n-\n-if ( document.querySelectorAll ) {\n-\t(function(){\n-\t\tvar oldSizzle = Sizzle,\n-\t\t\tdiv = document.createElement(\"div\"),\n-\t\t\tid = \"__sizzle__\";\n-\n-\t\tdiv.innerHTML = \"<p class='TEST'></p>\";\n-\n-\t\t// Safari can't handle uppercase or unicode characters when\n-\t\t// in quirks mode.\n-\t\tif ( div.querySelectorAll && div.querySelectorAll(\".TEST\").length === 0 ) {\n-\t\t\treturn;\n-\t\t}\n-\n-\t\tSizzle = function( query, context, extra, seed ) {\n-\t\t\tcontext = context || document;\n-\n-\t\t\t// Only use querySelectorAll on non-XML documents\n-\t\t\t// (ID selectors don't work in non-HTML documents)\n-\t\t\tif ( !seed && !Sizzle.isXML(context) ) {\n-\t\t\t\t// See if we find a selector to speed up\n-\t\t\t\tvar match = /^(\\w+$)|^\\.([\\w\\-]+$)|^#([\\w\\-]+$)/.exec( query );\n-\n-\t\t\t\tif ( match && (context.nodeType === 1 || context.nodeType === 9) ) {\n-\t\t\t\t\t// Speed-up: Sizzle(\"TAG\")\n-\t\t\t\t\tif ( match[1] ) {\n-\t\t\t\t\t\treturn makeArray( context.getElementsByTagName( query ), extra );\n-\n-\t\t\t\t\t// Speed-up: Sizzle(\".CLASS\")\n-\t\t\t\t\t} else if ( match[2] && Expr.find.CLASS && context.getElementsByClassName ) {\n-\t\t\t\t\t\treturn makeArray( context.getElementsByClassName( match[2] ), extra );\n-\t\t\t\t\t}\n-\t\t\t\t}\n-\n-\t\t\t\tif ( context.nodeType === 9 ) {\n-\t\t\t\t\t// Speed-up: Sizzle(\"body\")\n-\t\t\t\t\t// The body element only exists once, optimize finding it\n-\t\t\t\t\tif ( query === \"body\" && context.body ) {\n-\t\t\t\t\t\treturn makeArray( [ context.body ], extra );\n-\n-\t\t\t\t\t// Speed-up: Sizzle(\"#ID\")\n-\t\t\t\t\t} else if ( match && match[3] ) {\n-\t\t\t\t\t\tvar elem = context.getElementById( match[3] );\n-\n-\t\t\t\t\t\t// Check parentNode to catch when Blackberry 4.6 returns\n-\t\t\t\t\t\t// nodes that are no longer in the document #6963\n-\t\t\t\t\t\tif ( elem && elem.parentNode ) {\n-\t\t\t\t\t\t\t// Handle the case where IE and Opera return items\n-\t\t\t\t\t\t\t// by name instead of ID\n-\t\t\t\t\t\t\tif ( elem.id === match[3] ) {\n-\t\t\t\t\t\t\t\treturn makeArray( [ elem ], extra );\n-\t\t\t\t\t\t\t}\n-\n-\t\t\t\t\t\t} else {\n-\t\t\t\t\t\t\treturn makeArray( [], extra );\n-\t\t\t\t\t\t}\n-\t\t\t\t\t}\n-\n-\t\t\t\t\ttry {\n-\t\t\t\t\t\treturn makeArray( context.querySelectorAll(query), extra );\n-\t\t\t\t\t} catch(qsaError) {}\n-\n-\t\t\t\t// qSA works strangely on Element-rooted queries\n-\t\t\t\t// We can work around this by specifying an extra ID on the root\n-\t\t\t\t// and working up from there (Thanks to Andrew Dupont for the technique)\n-\t\t\t\t// IE 8 doesn't work on object elements\n-\t\t\t\t} else if ( context.nodeType === 1 && context.nodeName.toLowerCase() !== \"object\" ) {\n-\t\t\t\t\tvar oldContext = context,\n-\t\t\t\t\t\told = context.getAttribute( \"id\" ),\n-\t\t\t\t\t\tnid = old || id,\n-\t\t\t\t\t\thasParent = context.parentNode,\n-\t\t\t\t\t\trelativeHierarchySelector = /^\\s*[+~]/.test( query );\n-\n-\t\t\t\t\tif ( !old ) {\n-\t\t\t\t\t\tcontext.setAttribute( \"id\", nid );\n-\t\t\t\t\t} else {\n-\t\t\t\t\t\tnid = nid.replace( /'/g, \"\\\\$&\" );\n-\t\t\t\t\t}\n-\t\t\t\t\tif ( relativeHierarchySelector && hasParent ) {\n-\t\t\t\t\t\tcontext = context.parentNode;\n-\t\t\t\t\t}\n-\n-\t\t\t\t\ttry {\n-\t\t\t\t\t\tif ( !relativeHierarchySelector || hasParent ) {\n-\t\t\t\t\t\t\treturn makeArray( context.querySelectorAll( \"[id='\" + nid + \"'] \" + query ), extra );\n-\t\t\t\t\t\t}\n-\n-\t\t\t\t\t} catch(pseudoError) {\n-\t\t\t\t\t} finally {\n-\t\t\t\t\t\tif ( !old ) {\n-\t\t\t\t\t\t\toldContext.removeAttribute( \"id\" );\n-\t\t\t\t\t\t}\n-\t\t\t\t\t}\n-\t\t\t\t}\n-\t\t\t}\n-\n-\t\t\treturn oldSizzle(query, context, extra, seed);\n-\t\t};\n-\n-\t\tfor ( var prop in oldSizzle ) {\n-\t\t\tSizzle[ prop ] = oldSizzle[ prop ];\n-\t\t}\n-\n-\t\t// release memory in IE\n-\t\tdiv = null;\n-\t})();\n-}\n-\n-(function(){\n-\tvar html = document.documentElement,\n-\t\tmatches = html.matchesSelector || html.mozMatchesSelector || html.webkitMatchesSelector || html.msMatchesSelector;\n-\n-\tif ( matches ) {\n-\t\t// Check to see if it's possible to do matchesSelector\n-\t\t// on a disconnected node (IE 9 fails this)\n-\t\tvar disconnectedMatch = !matches.call( document.createElement( \"div\" ), \"div\" ),\n-\t\t\tpseudoWorks = false;\n-\n-\t\ttry {\n-\t\t\t// This should fail with an exception\n-\t\t\t// Gecko does not error, returns false instead\n-\t\t\tmatches.call( document.documentElement, \"[test!='']:sizzle\" );\n-\n-\t\t} catch( pseudoError ) {\n-\t\t\tpseudoWorks = true;\n-\t\t}\n-\n-\t\tSizzle.matchesSelector = function( node, expr ) {\n-\t\t\t// Make sure that attribute selectors are quoted\n-\t\t\texpr = expr.replace(/\\=\\s*([^'\"\\]]*)\\s*\\]/g, \"='$1']\");\n-\n-\t\t\tif ( !Sizzle.isXML( node ) ) {\n-\t\t\t\ttry {\n-\t\t\t\t\tif ( pseudoWorks || !Expr.match.PSEUDO.test( expr ) && !/!=/.test( expr ) ) {\n-\t\t\t\t\t\tvar ret = matches.call( node, expr );\n-\n-\t\t\t\t\t\t// IE 9's matchesSelector returns false on disconnected nodes\n-\t\t\t\t\t\tif ( ret || !disconnectedMatch ||\n-\t\t\t\t\t\t\t\t// As well, disconnected nodes are said to be in a document\n-\t\t\t\t\t\t\t\t// fragment in IE 9, so check for that\n-\t\t\t\t\t\t\t\tnode.document && node.document.nodeType !== 11 ) {\n-\t\t\t\t\t\t\treturn ret;\n-\t\t\t\t\t\t}\n-\t\t\t\t\t}\n-\t\t\t\t} catch(e) {}\n-\t\t\t}\n-\n-\t\t\treturn Sizzle(expr, null, null, [node]).length > 0;\n-\t\t};\n-\t}\n-})();\n-\n-(function(){\n-\tvar div = document.createElement(\"div\");\n-\n-\tdiv.innerHTML = \"<div class='test e'></div><div class='test'></div>\";\n-\n-\t// Opera can't find a second classname (in 9.6)\n-\t// Also, make sure that getElementsByClassName actually exists\n-\tif ( !div.getElementsByClassName || div.getElementsByClassName(\"e\").length === 0 ) {\n-\t\treturn;\n-\t}\n-\n-\t// Safari caches class attributes, doesn't catch changes (in 3.2)\n-\tdiv.lastChild.className = \"e\";\n-\n-\tif ( div.getElementsByClassName(\"e\").length === 1 ) {\n-\t\treturn;\n-\t}\n-\n-\tExpr.order.splice(1, 0, \"CLASS\");\n-\tExpr.find.CLASS = function( match, context, isXML ) {\n-\t\tif ( typeof context.getElementsByClassName !== \"undefined\" && !isXML ) {\n-\t\t\treturn context.getElementsByClassName(match[1]);\n-\t\t}\n-\t};\n-\n-\t// release memory in IE\n-\tdiv = null;\n-})();\n-\n-function dirNodeCheck( dir, cur, doneName, checkSet, nodeCheck, isXML ) {\n-\tfor ( var i = 0, l = checkSet.length; i < l; i++ ) {\n-\t\tvar elem = checkSet[i];\n-\n-\t\tif ( elem ) {\n-\t\t\tvar match = false;\n-\n-\t\t\telem = elem[dir];\n-\n-\t\t\twhile ( elem ) {\n-\t\t\t\tif ( elem[ expando ] === doneName ) {\n-\t\t\t\t\tmatch = checkSet[elem.sizset];\n-\t\t\t\t\tbreak;\n-\t\t\t\t}\n-\n-\t\t\t\tif ( elem.nodeType === 1 && !isXML ){\n-\t\t\t\t\telem[ expando ] = doneName;\n-\t\t\t\t\telem.sizset = i;\n-\t\t\t\t}\n-\n-\t\t\t\tif ( elem.nodeName.toLowerCase() === cur ) {\n-\t\t\t\t\tmatch = elem;\n-\t\t\t\t\tbreak;\n-\t\t\t\t}\n-\n-\t\t\t\telem = elem[dir];\n-\t\t\t}\n-\n-\t\t\tcheckSet[i] = match;\n-\t\t}\n-\t}\n-}\n-\n-function dirCheck( dir, cur, doneName, checkSet, nodeCheck, isXML ) {\n-\tfor ( var i = 0, l = checkSet.length; i < l; i++ ) {\n-\t\tvar elem = checkSet[i];\n-\n-\t\tif ( elem ) {\n-\t\t\tvar match = false;\n-\n-\t\t\telem = elem[dir];\n-\n-\t\t\twhile ( elem ) {\n-\t\t\t\tif ( elem[ expando ] === doneName ) {\n-\t\t\t\t\tmatch = checkSet[elem.sizset];\n-\t\t\t\t\tbreak;\n-\t\t\t\t}\n-\n-\t\t\t\tif ( elem.nodeType === 1 ) {\n-\t\t\t\t\tif ( !isXML ) {\n-\t\t\t\t\t\telem[ expando ] = doneName;\n-\t\t\t\t\t\telem.sizset = i;\n-\t\t\t\t\t}\n-\n-\t\t\t\t\tif ( typeof cur !== \"string\" ) {\n-\t\t\t\t\t\tif ( elem === cur ) {\n-\t\t\t\t\t\t\tmatch = true;\n-\t\t\t\t\t\t\tbreak;\n-\t\t\t\t\t\t}\n-\n-\t\t\t\t\t} else if ( Sizzle.filter( cur, [elem] ).length > 0 ) {\n-\t\t\t\t\t\tmatch = elem;\n-\t\t\t\t\t\tbreak;\n-\t\t\t\t\t}\n-\t\t\t\t}\n-\n-\t\t\t\telem = elem[dir];\n-\t\t\t}\n-\n-\t\t\tcheckSet[i] = match;\n-\t\t}\n-\t}\n-}\n-\n-if ( document.documentElement.contains ) {\n-\tSizzle.contains = function( a, b ) {\n-\t\treturn a !== b && (a.contains ? a.contains(b) : true);\n-\t};\n-\n-} else if ( document.documentElement.compareDocumentPosition ) {\n-\tSizzle.contains = function( a, b ) {\n-\t\treturn !!(a.compareDocumentPosition(b) & 16);\n-\t};\n-\n-} else {\n-\tSizzle.contains = function() {\n-\t\treturn false;\n-\t};\n-}\n-\n-Sizzle.isXML = function( elem ) {\n-\t// documentElement is verified for cases where it doesn't yet exist\n-\t// (such as loading iframes in IE - #4833)\n-\tvar documentElement = (elem ? elem.ownerDocument || elem : 0).documentElement;\n-\n-\treturn documentElement ? documentElement.nodeName !== \"HTML\" : false;\n-};\n-\n-var posProcess = function( selector, context, seed ) {\n-\tvar match,\n-\t\ttmpSet = [],\n-\t\tlater = \"\",\n-\t\troot = context.nodeType ? [context] : context;\n-\n-\t// Position selectors must be done after the filter\n-\t// And so must :not(positional) so we move all PSEUDOs to the end\n-\twhile ( (match = Expr.match.PSEUDO.exec( selector )) ) {\n-\t\tlater += match[0];\n-\t\tselector = selector.replace( Expr.match.PSEUDO, \"\" );\n-\t}\n-\n-\tselector = Expr.relative[selector] ? selector + \"*\" : selector;\n-\n-\tfor ( var i = 0, l = root.length; i < l; i++ ) {\n-\t\tSizzle( selector, root[i], tmpSet, seed );\n-\t}\n-\n-\treturn Sizzle.filter( later, tmpSet );\n-};\n-\n-// EXPOSE\n-\n-window.tinymce.dom.Sizzle = Sizzle;\n-\n-})();\n-\n-// #endif"
        },
        {
            "filename": "js/tiny_mce/classes/dom/TreeWalker.js",
            "diff": "@@ -1,64 +0,0 @@\n-/**\n- * TreeWalker.js\n- *\n- * Copyright, Moxiecode Systems AB\n- * Released under LGPL License.\n- *\n- * License: http://www.tinymce.com/license\n- * Contributing: http://www.tinymce.com/contributing\n- */\n-\n-tinymce.dom.TreeWalker = function(start_node, root_node) {\n-\tvar node = start_node;\n-\n-\tfunction findSibling(node, start_name, sibling_name, shallow) {\n-\t\tvar sibling, parent;\n-\n-\t\tif (node) {\n-\t\t\t// Walk into nodes if it has a start\n-\t\t\tif (!shallow && node[start_name])\n-\t\t\t\treturn node[start_name];\n-\n-\t\t\t// Return the sibling if it has one\n-\t\t\tif (node != root_node) {\n-\t\t\t\tsibling = node[sibling_name];\n-\t\t\t\tif (sibling)\n-\t\t\t\t\treturn sibling;\n-\n-\t\t\t\t// Walk up the parents to look for siblings\n-\t\t\t\tfor (parent = node.parentNode; parent && parent != root_node; parent = parent.parentNode) {\n-\t\t\t\t\tsibling = parent[sibling_name];\n-\t\t\t\t\tif (sibling)\n-\t\t\t\t\t\treturn sibling;\n-\t\t\t\t}\n-\t\t\t}\n-\t\t}\n-\t};\n-\n-\t/**\n-\t * Returns the current node.\n-\t *\n-\t * @return {Node} Current node where the walker is.\n-\t */\n-\tthis.current = function() {\n-\t\treturn node;\n-\t};\n-\n-\t/**\n-\t * Walks to the next node in tree.\n-\t *\n-\t * @return {Node} Current node where the walker is after moving to the next node.\n-\t */\n-\tthis.next = function(shallow) {\n-\t\treturn (node = findSibling(node, 'firstChild', 'nextSibling', shallow));\n-\t};\n-\n-\t/**\n-\t * Walks to the previous node in tree.\n-\t *\n-\t * @return {Node} Current node where the walker is after moving to the previous node.\n-\t */\n-\tthis.prev = function(shallow) {\n-\t\treturn (node = findSibling(node, 'lastChild', 'previousSibling', shallow));\n-\t};\n-};"
        },
        {
            "filename": "js/tiny_mce/classes/dom/TridentSelection.js",
            "diff": "@@ -1,482 +0,0 @@\n-/**\n- * TridentSelection.js\n- *\n- * Copyright, Moxiecode Systems AB\n- * Released under LGPL License.\n- *\n- * License: http://www.tinymce.com/license\n- * Contributing: http://www.tinymce.com/contributing\n- */\n-\n-(function() {\n-\tfunction Selection(selection) {\n-\t\tvar self = this, dom = selection.dom, TRUE = true, FALSE = false;\n-\n-\t\tfunction getPosition(rng, start) {\n-\t\t\tvar checkRng, startIndex = 0, endIndex, inside,\n-\t\t\t\tchildren, child, offset, index, position = -1, parent;\n-\n-\t\t\t// Setup test range, collapse it and get the parent\n-\t\t\tcheckRng = rng.duplicate();\n-\t\t\tcheckRng.collapse(start);\n-\t\t\tparent = checkRng.parentElement();\n-\n-\t\t\t// Check if the selection is within the right document\n-\t\t\tif (parent.ownerDocument !== selection.dom.doc)\n-\t\t\t\treturn;\n-\n-\t\t\t// IE will report non editable elements as it's parent so look for an editable one\n-\t\t\twhile (parent.contentEditable === \"false\") {\n-\t\t\t\tparent = parent.parentNode;\n-\t\t\t}\n-\n-\t\t\t// If parent doesn't have any children then return that we are inside the element\n-\t\t\tif (!parent.hasChildNodes()) {\n-\t\t\t\treturn {node : parent, inside : 1};\n-\t\t\t}\n-\n-\t\t\t// Setup node list and endIndex\n-\t\t\tchildren = parent.children;\n-\t\t\tendIndex = children.length - 1;\n-\n-\t\t\t// Perform a binary search for the position\n-\t\t\twhile (startIndex <= endIndex) {\n-\t\t\t\tindex = Math.floor((startIndex + endIndex) / 2);\n-\n-\t\t\t\t// Move selection to node and compare the ranges\n-\t\t\t\tchild = children[index];\n-\t\t\t\tcheckRng.moveToElementText(child);\n-\t\t\t\tposition = checkRng.compareEndPoints(start ? 'StartToStart' : 'EndToEnd', rng);\n-\n-\t\t\t\t// Before/after or an exact match\n-\t\t\t\tif (position > 0) {\n-\t\t\t\t\tendIndex = index - 1;\n-\t\t\t\t} else if (position < 0) {\n-\t\t\t\t\tstartIndex = index + 1;\n-\t\t\t\t} else {\n-\t\t\t\t\treturn {node : child};\n-\t\t\t\t}\n-\t\t\t}\n-\n-\t\t\t// Check if child position is before or we didn't find a position\n-\t\t\tif (position < 0) {\n-\t\t\t\t// No element child was found use the parent element and the offset inside that\n-\t\t\t\tif (!child) {\n-\t\t\t\t\tcheckRng.moveToElementText(parent);\n-\t\t\t\t\tcheckRng.collapse(true);\n-\t\t\t\t\tchild = parent;\n-\t\t\t\t\tinside = true;\n-\t\t\t\t} else\n-\t\t\t\t\tcheckRng.collapse(false);\n-\n-\t\t\t\t// Walk character by character in text node until we hit the selected range endpoint, hit the end of document or parent isn't the right one\n-\t\t\t\t// We need to walk char by char since rng.text or rng.htmlText will trim line endings\n-\t\t\t\toffset = 0;\n-\t\t\t\twhile (checkRng.compareEndPoints(start ? 'StartToStart' : 'StartToEnd', rng) !== 0) {\n-\t\t\t\t\tif (checkRng.move('character', 1) === 0 || parent != checkRng.parentElement()) {\n-\t\t\t\t\t\tbreak;\n-\t\t\t\t\t}\n-\n-\t\t\t\t\toffset++;\n-\t\t\t\t}\n-\t\t\t} else {\n-\t\t\t\t// Child position is after the selection endpoint\n-\t\t\t\tcheckRng.collapse(true);\n-\n-\t\t\t\t// Walk character by character in text node until we hit the selected range endpoint, hit the end of document or parent isn't the right one\n-\t\t\t\toffset = 0;\n-\t\t\t\twhile (checkRng.compareEndPoints(start ? 'StartToStart' : 'StartToEnd', rng) !== 0) {\n-\t\t\t\t\tif (checkRng.move('character', -1) === 0 || parent != checkRng.parentElement()) {\n-\t\t\t\t\t\tbreak;\n-\t\t\t\t\t}\n-\n-\t\t\t\t\toffset++;\n-\t\t\t\t}\n-\t\t\t}\n-\n-\t\t\treturn {node : child, position : position, offset : offset, inside : inside};\n-\t\t};\n-\n-\t\t// Returns a W3C DOM compatible range object by using the IE Range API\n-\t\tfunction getRange() {\n-\t\t\tvar ieRange = selection.getRng(), domRange = dom.createRng(), element, collapsed, tmpRange, element2, bookmark, fail;\n-\n-\t\t\t// If selection is outside the current document just return an empty range\n-\t\t\telement = ieRange.item ? ieRange.item(0) : ieRange.parentElement();\n-\t\t\tif (element.ownerDocument != dom.doc)\n-\t\t\t\treturn domRange;\n-\n-\t\t\tcollapsed = selection.isCollapsed();\n-\n-\t\t\t// Handle control selection\n-\t\t\tif (ieRange.item) {\n-\t\t\t\tdomRange.setStart(element.parentNode, dom.nodeIndex(element));\n-\t\t\t\tdomRange.setEnd(domRange.startContainer, domRange.startOffset + 1);\n-\n-\t\t\t\treturn domRange;\n-\t\t\t}\n-\n-\t\t\tfunction findEndPoint(start) {\n-\t\t\t\tvar endPoint = getPosition(ieRange, start), container, offset, textNodeOffset = 0, sibling, undef, nodeValue;\n-\n-\t\t\t\tcontainer = endPoint.node;\n-\t\t\t\toffset = endPoint.offset;\n-\n-\t\t\t\tif (endPoint.inside && !container.hasChildNodes()) {\n-\t\t\t\t\tdomRange[start ? 'setStart' : 'setEnd'](container, 0);\n-\t\t\t\t\treturn;\n-\t\t\t\t}\n-\n-\t\t\t\tif (offset === undef) {\n-\t\t\t\t\tdomRange[start ? 'setStartBefore' : 'setEndAfter'](container);\n-\t\t\t\t\treturn;\n-\t\t\t\t}\n-\n-\t\t\t\tif (endPoint.position < 0) {\n-\t\t\t\t\tsibling = endPoint.inside ? container.firstChild : container.nextSibling;\n-\n-\t\t\t\t\tif (!sibling) {\n-\t\t\t\t\t\tdomRange[start ? 'setStartAfter' : 'setEndAfter'](container);\n-\t\t\t\t\t\treturn;\n-\t\t\t\t\t}\n-\n-\t\t\t\t\tif (!offset) {\n-\t\t\t\t\t\tif (sibling.nodeType == 3)\n-\t\t\t\t\t\t\tdomRange[start ? 'setStart' : 'setEnd'](sibling, 0);\n-\t\t\t\t\t\telse\n-\t\t\t\t\t\t\tdomRange[start ? 'setStartBefore' : 'setEndBefore'](sibling);\n-\n-\t\t\t\t\t\treturn;\n-\t\t\t\t\t}\n-\n-\t\t\t\t\t// Find the text node and offset\n-\t\t\t\t\twhile (sibling) {\n-\t\t\t\t\t\tnodeValue = sibling.nodeValue;\n-\t\t\t\t\t\ttextNodeOffset += nodeValue.length;\n-\n-\t\t\t\t\t\t// We are at or passed the position we where looking for\n-\t\t\t\t\t\tif (textNodeOffset >= offset) {\n-\t\t\t\t\t\t\tcontainer = sibling;\n-\t\t\t\t\t\t\ttextNodeOffset -= offset;\n-\t\t\t\t\t\t\ttextNodeOffset = nodeValue.length - textNodeOffset;\n-\t\t\t\t\t\t\tbreak;\n-\t\t\t\t\t\t}\n-\n-\t\t\t\t\t\tsibling = sibling.nextSibling;\n-\t\t\t\t\t}\n-\t\t\t\t} else {\n-\t\t\t\t\t// Find the text node and offset\n-\t\t\t\t\tsibling = container.previousSibling;\n-\n-\t\t\t\t\tif (!sibling)\n-\t\t\t\t\t\treturn domRange[start ? 'setStartBefore' : 'setEndBefore'](container);\n-\n-\t\t\t\t\t// If there isn't any text to loop then use the first position\n-\t\t\t\t\tif (!offset) {\n-\t\t\t\t\t\tif (container.nodeType == 3)\n-\t\t\t\t\t\t\tdomRange[start ? 'setStart' : 'setEnd'](sibling, container.nodeValue.length);\n-\t\t\t\t\t\telse\n-\t\t\t\t\t\t\tdomRange[start ? 'setStartAfter' : 'setEndAfter'](sibling);\n-\n-\t\t\t\t\t\treturn;\n-\t\t\t\t\t}\n-\n-\t\t\t\t\twhile (sibling) {\n-\t\t\t\t\t\ttextNodeOffset += sibling.nodeValue.length;\n-\n-\t\t\t\t\t\t// We are at or passed the position we where looking for\n-\t\t\t\t\t\tif (textNodeOffset >= offset) {\n-\t\t\t\t\t\t\tcontainer = sibling;\n-\t\t\t\t\t\t\ttextNodeOffset -= offset;\n-\t\t\t\t\t\t\tbreak;\n-\t\t\t\t\t\t}\n-\n-\t\t\t\t\t\tsibling = sibling.previousSibling;\n-\t\t\t\t\t}\n-\t\t\t\t}\n-\n-\t\t\t\tdomRange[start ? 'setStart' : 'setEnd'](container, textNodeOffset);\n-\t\t\t};\n-\n-\t\t\ttry {\n-\t\t\t\t// Find start point\n-\t\t\t\tfindEndPoint(true);\n-\n-\t\t\t\t// Find end point if needed\n-\t\t\t\tif (!collapsed)\n-\t\t\t\t\tfindEndPoint();\n-\t\t\t} catch (ex) {\n-\t\t\t\t// IE has a nasty bug where text nodes might throw \"invalid argument\" when you\n-\t\t\t\t// access the nodeValue or other properties of text nodes. This seems to happend when\n-\t\t\t\t// text nodes are split into two nodes by a delete/backspace call. So lets detect it and try to fix it.\n-\t\t\t\tif (ex.number == -2147024809) {\n-\t\t\t\t\t// Get the current selection\n-\t\t\t\t\tbookmark = self.getBookmark(2);\n-\n-\t\t\t\t\t// Get start element\n-\t\t\t\t\ttmpRange = ieRange.duplicate();\n-\t\t\t\t\ttmpRange.collapse(true);\n-\t\t\t\t\telement = tmpRange.parentElement();\n-\n-\t\t\t\t\t// Get end element\n-\t\t\t\t\tif (!collapsed) {\n-\t\t\t\t\t\ttmpRange = ieRange.duplicate();\n-\t\t\t\t\t\ttmpRange.collapse(false);\n-\t\t\t\t\t\telement2 = tmpRange.parentElement();\n-\t\t\t\t\t\telement2.innerHTML = element2.innerHTML;\n-\t\t\t\t\t}\n-\n-\t\t\t\t\t// Remove the broken elements\n-\t\t\t\t\telement.innerHTML = element.innerHTML;\n-\n-\t\t\t\t\t// Restore the selection\n-\t\t\t\t\tself.moveToBookmark(bookmark);\n-\n-\t\t\t\t\t// Since the range has moved we need to re-get it\n-\t\t\t\t\tieRange = selection.getRng();\n-\n-\t\t\t\t\t// Find start point\n-\t\t\t\t\tfindEndPoint(true);\n-\n-\t\t\t\t\t// Find end point if needed\n-\t\t\t\t\tif (!collapsed)\n-\t\t\t\t\t\tfindEndPoint();\n-\t\t\t\t} else\n-\t\t\t\t\tthrow ex; // Throw other errors\n-\t\t\t}\n-\n-\t\t\treturn domRange;\n-\t\t};\n-\n-\t\tthis.getBookmark = function(type) {\n-\t\t\tvar rng = selection.getRng(), start, end, bookmark = {};\n-\n-\t\t\tfunction getIndexes(node) {\n-\t\t\t\tvar parent, root, children, i, indexes = [];\n-\n-\t\t\t\tparent = node.parentNode;\n-\t\t\t\troot = dom.getRoot().parentNode;\n-\n-\t\t\t\twhile (parent != root && parent.nodeType !== 9) {\n-\t\t\t\t\tchildren = parent.children;\n-\n-\t\t\t\t\ti = children.length;\n-\t\t\t\t\twhile (i--) {\n-\t\t\t\t\t\tif (node === children[i]) {\n-\t\t\t\t\t\t\tindexes.push(i);\n-\t\t\t\t\t\t\tbreak;\n-\t\t\t\t\t\t}\n-\t\t\t\t\t}\n-\n-\t\t\t\t\tnode = parent;\n-\t\t\t\t\tparent = parent.parentNode;\n-\t\t\t\t}\n-\n-\t\t\t\treturn indexes;\n-\t\t\t};\n-\n-\t\t\tfunction getBookmarkEndPoint(start) {\n-\t\t\t\tvar position;\n-\n-\t\t\t\tposition = getPosition(rng, start);\n-\t\t\t\tif (position) {\n-\t\t\t\t\treturn {\n-\t\t\t\t\t\tposition : position.position,\n-\t\t\t\t\t\toffset : position.offset,\n-\t\t\t\t\t\tindexes : getIndexes(position.node),\n-\t\t\t\t\t\tinside : position.inside\n-\t\t\t\t\t};\n-\t\t\t\t}\n-\t\t\t};\n-\n-\t\t\t// Non ubstructive bookmark\n-\t\t\tif (type === 2) {\n-\t\t\t\t// Handle text selection\n-\t\t\t\tif (!rng.item) {\n-\t\t\t\t\tbookmark.start = getBookmarkEndPoint(true);\n-\n-\t\t\t\t\tif (!selection.isCollapsed())\n-\t\t\t\t\t\tbookmark.end = getBookmarkEndPoint();\n-\t\t\t\t} else\n-\t\t\t\t\tbookmark.start = {ctrl : true, indexes : getIndexes(rng.item(0))};\n-\t\t\t}\n-\n-\t\t\treturn bookmark;\n-\t\t};\n-\n-\t\tthis.moveToBookmark = function(bookmark) {\n-\t\t\tvar rng, body = dom.doc.body;\n-\n-\t\t\tfunction resolveIndexes(indexes) {\n-\t\t\t\tvar node, i, idx, children;\n-\n-\t\t\t\tnode = dom.getRoot();\n-\t\t\t\tfor (i = indexes.length - 1; i >= 0; i--) {\n-\t\t\t\t\tchildren = node.children;\n-\t\t\t\t\tidx = indexes[i];\n-\n-\t\t\t\t\tif (idx <= children.length - 1) {\n-\t\t\t\t\t\tnode = children[idx];\n-\t\t\t\t\t}\n-\t\t\t\t}\n-\n-\t\t\t\treturn node;\n-\t\t\t};\n-\t\t\t\n-\t\t\tfunction setBookmarkEndPoint(start) {\n-\t\t\t\tvar endPoint = bookmark[start ? 'start' : 'end'], moveLeft, moveRng, undef;\n-\n-\t\t\t\tif (endPoint) {\n-\t\t\t\t\tmoveLeft = endPoint.position > 0;\n-\n-\t\t\t\t\tmoveRng = body.createTextRange();\n-\t\t\t\t\tmoveRng.moveToElementText(resolveIndexes(endPoint.indexes));\n-\n-\t\t\t\t\toffset = endPoint.offset;\n-\t\t\t\t\tif (offset !== undef) {\n-\t\t\t\t\t\tmoveRng.collapse(endPoint.inside || moveLeft);\n-\t\t\t\t\t\tmoveRng.moveStart('character', moveLeft ? -offset : offset);\n-\t\t\t\t\t} else\n-\t\t\t\t\t\tmoveRng.collapse(start);\n-\n-\t\t\t\t\trng.setEndPoint(start ? 'StartToStart' : 'EndToStart', moveRng);\n-\n-\t\t\t\t\tif (start)\n-\t\t\t\t\t\trng.collapse(true);\n-\t\t\t\t}\n-\t\t\t};\n-\n-\t\t\tif (bookmark.start) {\n-\t\t\t\tif (bookmark.start.ctrl) {\n-\t\t\t\t\trng = body.createControlRange();\n-\t\t\t\t\trng.addElement(resolveIndexes(bookmark.start.indexes));\n-\t\t\t\t\trng.select();\n-\t\t\t\t} else {\n-\t\t\t\t\trng = body.createTextRange();\n-\t\t\t\t\tsetBookmarkEndPoint(true);\n-\t\t\t\t\tsetBookmarkEndPoint();\n-\t\t\t\t\trng.select();\n-\t\t\t\t}\n-\t\t\t}\n-\t\t};\n-\n-\t\tthis.addRange = function(rng) {\n-\t\t\tvar ieRng, ctrlRng, startContainer, startOffset, endContainer, endOffset, sibling,\n-\t\t\t\tdoc = selection.dom.doc, body = doc.body, nativeRng, ctrlElm;\n-\n-\t\t\tfunction setEndPoint(start) {\n-\t\t\t\tvar container, offset, marker, tmpRng, nodes;\n-\n-\t\t\t\tmarker = dom.create('a');\n-\t\t\t\tcontainer = start ? startContainer : endContainer;\n-\t\t\t\toffset = start ? startOffset : endOffset;\n-\t\t\t\ttmpRng = ieRng.duplicate();\n-\n-\t\t\t\tif (container == doc || container == doc.documentElement) {\n-\t\t\t\t\tcontainer = body;\n-\t\t\t\t\toffset = 0;\n-\t\t\t\t}\n-\n-\t\t\t\tif (container.nodeType == 3) {\n-\t\t\t\t\tcontainer.parentNode.insertBefore(marker, container);\n-\t\t\t\t\ttmpRng.moveToElementText(marker);\n-\t\t\t\t\ttmpRng.moveStart('character', offset);\n-\t\t\t\t\tdom.remove(marker);\n-\t\t\t\t\tieRng.setEndPoint(start ? 'StartToStart' : 'EndToEnd', tmpRng);\n-\t\t\t\t} else {\n-\t\t\t\t\tnodes = container.childNodes;\n-\n-\t\t\t\t\tif (nodes.length) {\n-\t\t\t\t\t\tif (offset >= nodes.length) {\n-\t\t\t\t\t\t\tdom.insertAfter(marker, nodes[nodes.length - 1]);\n-\t\t\t\t\t\t} else {\n-\t\t\t\t\t\t\tcontainer.insertBefore(marker, nodes[offset]);\n-\t\t\t\t\t\t}\n-\n-\t\t\t\t\t\ttmpRng.moveToElementText(marker);\n-\t\t\t\t\t} else if (container.canHaveHTML) {\n-\t\t\t\t\t\t// Empty node selection for example <div>|</div>\n-\t\t\t\t\t\t// Setting innerHTML with a span marker then remove that marker seems to keep empty block elements open\n-\t\t\t\t\t\tcontainer.innerHTML = '<span>\\uFEFF</span>';\n-\t\t\t\t\t\tmarker = container.firstChild;\n-\t\t\t\t\t\ttmpRng.moveToElementText(marker);\n-\t\t\t\t\t\ttmpRng.collapse(FALSE); // Collapse false works better than true for some odd reason\n-\t\t\t\t\t}\n-\n-\t\t\t\t\tieRng.setEndPoint(start ? 'StartToStart' : 'EndToEnd', tmpRng);\n-\t\t\t\t\tdom.remove(marker);\n-\t\t\t\t}\n-\t\t\t}\n-\n-\t\t\t// Setup some shorter versions\n-\t\t\tstartContainer = rng.startContainer;\n-\t\t\tstartOffset = rng.startOffset;\n-\t\t\tendContainer = rng.endContainer;\n-\t\t\tendOffset = rng.endOffset;\n-\t\t\tieRng = body.createTextRange();\n-\n-\t\t\t// If single element selection then try making a control selection out of it\n-\t\t\tif (startContainer == endContainer && startContainer.nodeType == 1) {\n-\t\t\t\t// Trick to place the caret inside an empty block element like <p></p>\n-\t\t\t\tif (startOffset == endOffset && !startContainer.hasChildNodes()) {\n-\t\t\t\t\tif (startContainer.canHaveHTML) {\n-\t\t\t\t\t\t// Check if previous sibling is an empty block if it is then we need to render it\n-\t\t\t\t\t\t// IE would otherwise move the caret into the sibling instead of the empty startContainer see: #5236\n-\t\t\t\t\t\t// Example this: <p></p><p>|</p> would become this: <p>|</p><p></p>\n-\t\t\t\t\t\tsibling = startContainer.previousSibling;\n-\t\t\t\t\t\tif (sibling && !sibling.hasChildNodes() && dom.isBlock(sibling)) {\n-\t\t\t\t\t\t\tsibling.innerHTML = '\\uFEFF';\n-\t\t\t\t\t\t} else {\n-\t\t\t\t\t\t\tsibling = null;\n-\t\t\t\t\t\t}\n-\n-\t\t\t\t\t\tstartContainer.innerHTML = '<span>\\uFEFF</span><span>\\uFEFF</span>';\n-\t\t\t\t\t\tieRng.moveToElementText(startContainer.lastChild);\n-\t\t\t\t\t\tieRng.select();\n-\t\t\t\t\t\tdom.doc.selection.clear();\n-\t\t\t\t\t\tstartContainer.innerHTML = '';\n-\n-\t\t\t\t\t\tif (sibling) {\n-\t\t\t\t\t\t\tsibling.innerHTML = '';\n-\t\t\t\t\t\t}\n-\t\t\t\t\t\treturn;\n-\t\t\t\t\t} else {\n-\t\t\t\t\t\tstartOffset = dom.nodeIndex(startContainer);\n-\t\t\t\t\t\tstartContainer = startContainer.parentNode;\n-\t\t\t\t\t}\n-\t\t\t\t}\n-\n-\t\t\t\tif (startOffset == endOffset - 1) {\n-\t\t\t\t\ttry {\n-\t\t\t\t\t\tctrlElm = startContainer.childNodes[startOffset];\n-\t\t\t\t\t\tctrlRng = body.createControlRange();\n-\t\t\t\t\t\tctrlRng.addElement(ctrlElm);\n-\t\t\t\t\t\tctrlRng.select();\n-\n-\t\t\t\t\t\t// Check if the range produced is on the correct element and is a control range\n-\t\t\t\t\t\t// On IE 8 it will select the parent contentEditable container if you select an inner element see: #5398\n-\t\t\t\t\t\tnativeRng = selection.getRng();\n-\t\t\t\t\t\tif (nativeRng.item && ctrlElm === nativeRng.item(0)) {\n-\t\t\t\t\t\t\treturn;\n-\t\t\t\t\t\t}\n-\t\t\t\t\t} catch (ex) {\n-\t\t\t\t\t\t// Ignore\n-\t\t\t\t\t}\n-\t\t\t\t}\n-\t\t\t}\n-\n-\t\t\t// Set start/end point of selection\n-\t\t\tsetEndPoint(true);\n-\t\t\tsetEndPoint();\n-\n-\t\t\t// Select the new range and scroll it into view\n-\t\t\tieRng.select();\n-\t\t};\n-\n-\t\t// Expose range method\n-\t\tthis.getRangeAt = getRange;\n-\t};\n-\n-\t// Expose the selection object\n-\ttinymce.dom.TridentSelection = Selection;\n-})();"
        },
        {
            "filename": "js/tiny_mce/classes/firebug/FIREBUG.LICENSE",
            "diff": "@@ -1,30 +0,0 @@\n-Software License Agreement (BSD License)\n-\n-Copyright (c) 2007, Parakey Inc.\n-All rights reserved.\n-\n-Redistribution and use of this software in source and binary forms, with or without modification,\n-are permitted provided that the following conditions are met:\n-\n-* Redistributions of source code must retain the above\n-  copyright notice, this list of conditions and the\n-  following disclaimer.\n-\n-* Redistributions in binary form must reproduce the above\n-  copyright notice, this list of conditions and the\n-  following disclaimer in the documentation and/or other\n-  materials provided with the distribution.\n-\n-* Neither the name of Parakey Inc. nor the names of its\n-  contributors may be used to endorse or promote products\n-  derived from this software without specific prior\n-  written permission of Parakey Inc.\n-\n-THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND ANY EXPRESS OR\n-IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND\n-FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR\n-CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n-DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n-DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER\n-IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT\n-OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n\\ No newline at end of file"
        }
    ],
    "commitTime": "2023-10-02 12:41:36"
}